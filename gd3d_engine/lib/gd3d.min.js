var __decorate=this&&this.__decorate||function(t,e,a,r){var i,o=arguments.length,n=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,a):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,e,a,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(n=(o<3?i(n):o>3?i(e,a,n):i(e,a))||n);return o>3&&n&&Object.defineProperty(e,a,n),n},__metadata=this&&this.__metadata||function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},__extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var a in e)e.hasOwnProperty(a)&&(t[a]=e[a])};return function(e,a){function __(){this.constructor=e}t(e,a),e.prototype=null===a?Object.create(a):(__.prototype=a.prototype,new __)}}(),gd3d;!function(t){!function(e){function getPrefixStyleName(t,e){var a="";if(null!=e)a=getPrefix(t,e);else{if(null==i){var r=document.createElement("div").style;i=getPrefix("transform",r)}a=i}return""==a?t:a+t.charAt(0).toUpperCase()+t.substring(1,t.length)}function getPrefix(t,e){if(t in e)return"";t=t.charAt(0).toUpperCase()+t.substring(1,t.length);for(var a=["webkit","ms","Moz","O"],r=0;r<a.length;r++)if(a[r]+t in e)return a[r];return""}!function(t){t[t.AddChild=0]="AddChild",t[t.RemoveChild=1]="RemoveChild",t[t.ChangeVisible=2]="ChangeVisible",t[t.AddCamera=3]="AddCamera",t[t.AddCanvasRender=4]="AddCanvasRender"}(e.NotifyType||(e.NotifyType={}));var a;!function(t){t[t.Free=0]="Free",t[t.FixedWidthType=1]="FixedWidthType",t[t.FixedHeightType=2]="FixedHeightType"}(a=e.CanvasFixedType||(e.CanvasFixedType={}));var r=function(){function application(){this.limitFrame=!0,this.version="v0.0.1",this.build="b000077",this._tar=-1,this._standDeltaTime=-1,this.canvasFixedType=a.Free,this._scaleFromPandding=1,this.beStepNumber=0,this.pretimer=0,this.isFrustumCulling=!0,this._userCode=[],this._userCodeNew=[],this._editorCode=[],this._editorCodeNew=[],this._bePlay=!1,this.be2dstate=!1,this.curcameraindex=-1,this._bePause=!1,this._beStepForward=!1,this.orientation=e.OrientationMode.AUTO,this.shouldRotate=!1,this.lastWidth=0,this.lastHeight=0,this.OffOrientationUpdate=!1}return Object.defineProperty(application.prototype,"width",{get:function(){return this.webgl.canvas.width},enumerable:!0,configurable:!0}),Object.defineProperty(application.prototype,"height",{get:function(){return this.webgl.canvas.height},enumerable:!0,configurable:!0}),Object.defineProperty(application.prototype,"timeScale",{get:function(){return this._timeScale},set:function(t){this._timeScale=t},enumerable:!0,configurable:!0}),Object.defineProperty(application.prototype,"targetFrame",{get:function(){return this._tar},set:function(t){0==t&&(t=-1),this._tar=t,this._standDeltaTime=1/this._tar},enumerable:!0,configurable:!0}),Object.defineProperty(application.prototype,"canvasFixHeight",{set:function(t){this._fixHeight=t},enumerable:!0,configurable:!0}),Object.defineProperty(application.prototype,"canvasFixWidth",{set:function(t){this._fixWidth=t},enumerable:!0,configurable:!0}),Object.defineProperty(application.prototype,"canvasClientWidth",{get:function(){return this._canvasClientWidth},enumerable:!0,configurable:!0}),Object.defineProperty(application.prototype,"canvasClientHeight",{get:function(){return this._canvasClientHeight},enumerable:!0,configurable:!0}),Object.defineProperty(application.prototype,"scaleFromPandding",{get:function(){return this._scaleFromPandding},enumerable:!0,configurable:!0}),application.prototype.start=function(t,e,r,i){if(void 0===e&&(e=a.Free),void 0===r&&(r=1200),void 0===i&&(i=!1),console.log("version: "+this.version+"  build: "+this.build),null!=t){t.style.overflow="hidden",t.style.position="absolute",t.style.width="100%",t.style.height="100%",this.outcontainer=t;var o=document.createElement("div");o.className="full",o.style.overflow="hidden",o.style.position="absolute",o.style.width="100%",o.style.height="100%",this.container=o,t.appendChild(o);var n=document.createElement("canvas");if(null==n)throw alert("Failed to create canvas at the application.start()"),Error("Failed to create canvas at the application.start()");n.className="full",n.style.position="absolute",n.style.width="100%",n.style.height="100%",n.style.backgroundColor="#1e1e1e",n.setAttribute("tabindex","1"),o.appendChild(n),this.ccWidth=n.clientWidth,this.ccHeight=n.clientHeight,this.startForCanvas(n,e,r,i)}else console.error("root div does Null at application start ")},application.prototype.startForCanvas=function(r,i,o,n){void 0===i&&(i=a.Free),void 0===o&&(o=1200),void 0===n&&(n=!1),this._timeScale=1,e.sceneMgr.app=this;var s=new e.WebGLUtils;if(this.webgl=s.setupWebGL(r),null==this.webgl)throw alert("Failed to get webgl at the application.start()"),Error("Failed to get webgl at the application.start()");switch(this.canvasFixedType=i,i){case a.Free:this.screenAdaptiveType="宽高度自适应(宽高都不固定,真实像素宽高)",r.width=this.ccWidth,r.height=this.ccHeight,this._scaleFromPandding=1;break;case a.FixedWidthType:this.canvasFixWidth=o,this.screenAdaptiveType="宽度自适应(宽度固定,一般横屏使用)",r.width=this._fixWidth,r.height=this._fixWidth*this.ccHeight/this.ccWidth,this._scaleFromPandding=this.ccHeight/this.webgl.canvas.height;break;case a.FixedHeightType:this.canvasFixHeight=o,this.screenAdaptiveType="高度自适应(高度固定，一般竖屏使用)",r.height=this._fixHeight,r.width=this.ccWidth*this._fixHeight/this.ccHeight,this._scaleFromPandding=this.ccHeight/this.webgl.canvas.height}this._canvasClientWidth=r.width,this._canvasClientHeight=r.height,t.render.webglkit.initConst(this.webgl),this.initRender(),this.initAssetMgr(),this.initInputMgr(),this.initScene(),this.beginTimer=this.lastTimer=this.pretimer=Date.now()/1e3,this.loop(),t.io.referenceInfo.regDefaultType();var l=window.initovercallback;if(null!=l&&l(this),n){var h=new e.WebGLDebugUtils;this.webgl=h.makeDebugContext(this.webgl),console.error(" i am ---webglDebug-")}},application.prototype.markNotify=function(t,e){this.doNotify(t,e)},application.prototype.doNotify=function(t,e){if(null!=t&&this.checkFilter(t)&&(this.notify&&this.notify.notify(t,e),null!=t.children))for(var a in t.children)this.doNotify(t.children[a],e)},application.prototype.checkFilter=function(e){return!(e instanceof t.framework.transform&&e.gameObject.hideFlags&t.framework.HideFlags.HideInHierarchy)&&!(e instanceof t.framework.transform2D&&e.hideFlags&t.framework.HideFlags.HideInHierarchy)},application.prototype.showFps=function(){this.container&&(null==this.stats?(this.stats=new Stats.Stats(this),this.stats.container.style.position="absolute",this.stats.container.style.left="0px",this.stats.container.style.top="0px",this.container.appendChild(this.stats.container)):this.container.appendChild(this.stats.container))},application.prototype.closeFps=function(){null!=this.stats&&this.container.removeChild(this.stats.container)},application.prototype.showDrawCall=function(){e.DrawCallInfo.inc.showDrawcallInfo()},application.prototype.closeDrawCall=function(){e.DrawCallInfo.inc.closeDrawCallInfo()},application.prototype.update=function(t){this.updateOrientationMode(),this.updateScreenAsp(),this.bePlay&&(this.bePause?this.beStepForward&&this.beStepNumber>0&&(this.beStepNumber--,this.updateUserCode(t)):(this._inputmgr&&this._inputmgr.update(t),this.updateUserCode(t))),this.updateEditorCode(t),null!=this._scene&&this._scene.update(t)},application.prototype.updateScreenAsp=function(){this.outcontainer&&(this.webgl&&this.webgl.canvas&&(this.ccWidth=null!=this.webgl.canvas.clientWidth?this.webgl.canvas.clientWidth:this.ccWidth,this.ccHeight=null!=this.webgl.canvas.clientHeight?this.webgl.canvas.clientHeight:this.ccHeight),this.ccWidth==this._canvasClientWidth&&this.ccHeight==this._canvasClientHeight||(this._canvasClientWidth=this.ccWidth,this._canvasClientHeight=this.ccHeight,this.canvasFixedType==a.Free?(this.webgl.canvas.width=this.ccWidth,this.webgl.canvas.height=this.ccHeight,this._scaleFromPandding=1):this.canvasFixedType==a.FixedWidthType?(this.webgl.canvas.width=this._fixWidth,this.webgl.canvas.height=this._fixWidth*this.ccHeight/this.ccWidth,this._scaleFromPandding=this.ccHeight/this.webgl.canvas.height):this.canvasFixedType==a.FixedHeightType&&(this.webgl.canvas.height=this._fixHeight,this.webgl.canvas.width=this.ccWidth*this._fixHeight/this.ccHeight,this._scaleFromPandding=this.ccHeight/this.webgl.canvas.height)))},application.prototype.getUserUpdateTimer=function(){return this.usercodetime},application.prototype.getTotalTime=function(){return this.totalTime},Object.defineProperty(application.prototype,"deltaTime",{get:function(){return this._deltaTime*this._timeScale},enumerable:!0,configurable:!0}),application.prototype.getUpdateTimer=function(){return this.updateTimer},application.prototype.loop=function(){var t=Date.now()/1e3;if(this._deltaTime=t-this.lastTimer,this.totalTime=t-this.beginTimer,this.updateTimer=t-this.pretimer,this._deltaTime<this._standDeltaTime){var e=this,a=this._standDeltaTime-this._deltaTime;setTimeout(function(){var t=Date.now()/1e3;e.lastTimer=t,e.pretimer=t,e.update(e._standDeltaTime),null!=e.stats&&e.stats.update(),e.loop()},1e3*a)}else this.update(this.deltaTime),null!=this.stats&&this.stats.update(),this.lastTimer=t,this.pretimer=t,this.limitFrame?requestAnimationFrame(this.loop.bind(this)):setTimeout(this.loop.bind(this),1)},application.prototype.initScene=function(){null==this._scene&&(this._scene=new e.scene(this),e.sceneMgr.scene=this._scene)},application.prototype.initRender=function(){e.uniformSetter.initAutouniform(),t.render.shaderUniform.webgl=this.webgl,t.render.shaderUniform.initApplyUnifmFunc()},application.prototype.getScene=function(){return this._scene},application.prototype.initAssetMgr=function(){null==this._assetmgr&&(this._assetmgr=new e.assetMgr(this),this._assetmgr.initDefAsset())},application.prototype.getAssetMgr=function(){return this._assetmgr},application.prototype.initInputMgr=function(){null==this._inputmgr&&(this._inputmgr=new e.inputMgr(this))},application.prototype.getInputMgr=function(){return this._inputmgr},Object.defineProperty(application.prototype,"bePlay",{get:function(){return this._bePlay},set:function(t){this._bePlay=t},enumerable:!0,configurable:!0}),Object.defineProperty(application.prototype,"bePause",{get:function(){return this._bePause},set:function(t){this._bePause=t},enumerable:!0,configurable:!0}),Object.defineProperty(application.prototype,"beStepForward",{get:function(){return this._beStepForward},set:function(t){this._beStepForward=t},enumerable:!0,configurable:!0}),application.prototype.updateUserCode=function(t){for(a=this._userCodeNew.length-1;a>=0;a--)0==(r=this._userCodeNew[a]).isClosed()&&(r.onStart(this),this._userCode.push(r),this._userCodeNew.splice(a,1));for(var e=-1,a=0;a<this._userCode.length;a++){var r=this._userCode[a];0==r.isClosed()?r.onUpdate(t):e<0&&(e=a)}e>=0&&this._userCode.splice(e,1)},application.prototype.updateEditorCode=function(t){for(e=this._editorCodeNew.length-1;e>=0;e--)0==(a=this._editorCodeNew[e]).isClosed()&&(a.onStart(this),this._editorCode.push(a),this._editorCodeNew.splice(e,1));for(var e=this._editorCode.length-1;e>=0;e--){var a=this._editorCode[e];a.isClosed()?this._editorCode.splice(e,1):a.onUpdate(t)}},application.prototype.addUserCodeDirect=function(t){this._userCodeNew.push(t)},application.prototype.addUserCode=function(e){var a=t.reflect.getPrototype(e);if(null!=a){var r=t.reflect.createInstance(a,{usercode:"1"});this.addUserCodeDirect(r)}},application.prototype.addEditorCode=function(e){var a=t.reflect.getPrototype(e);if(null!=a){var r=t.reflect.createInstance(a,{editorcode:"1"});this.addEditorCodeDirect(r)}},application.prototype.addEditorCodeDirect=function(t){this._editorCodeNew.push(t)},application.prototype.updateOrientationMode=function(){if(!this.OffOrientationUpdate&&this.outcontainer){var t=this.outcontainer.getBoundingClientRect();this.shouldRotate=!1,this.orientation!=e.OrientationMode.AUTO&&(this.shouldRotate=(this.orientation==e.OrientationMode.LANDSCAPE||this.orientation==e.OrientationMode.LANDSCAPE_FLIPPED)&&t.height>t.width||this.orientation==e.OrientationMode.PORTRAIT&&t.width>t.height);var a=this.shouldRotate?t.height:t.width,r=this.shouldRotate?t.width:t.height;if((this.lastWidth!=a||this.lastHeight!=r)&&(this.lastWidth=a,this.lastHeight=r,this.container)){this.container.style[getPrefixStyleName("transformOrigin")]="0% 0% 0px",this.container.style.width=a+"px",this.container.style.height=r+"px";var i=0;this.shouldRotate?this.orientation==e.OrientationMode.LANDSCAPE?(i=90,this.container.style.top=(t.height-a)/2+"px",this.container.style.left=(t.width+r)/2+"px"):(i=-90,this.container.style.top=(t.height+a)/2+"px",this.container.style.left=(t.width-r)/2+"px"):(this.container.style.top=(t.height-r)/2+"px",this.container.style.left=(t.width-a)/2+"px");var o="rotate("+i+"deg)";this.container.style[getPrefixStyleName("transform")]=o}}},application}();e.application=r,e.OrientationMode={AUTO:"auto",PORTRAIT:"portrait",LANDSCAPE:"landscape",LANDSCAPE_FLIPPED:"landscapeFlipped"};var i=null;e.getPrefixStyleName=getPrefixStyleName,e.getPrefix=getPrefix}(t.framework||(t.framework={}))}(gd3d||(gd3d={}));var gd3d;!function(t){!function(t){var e=function(){function DeviceInfo(){}return DeviceInfo.getExtension=function(){this.debuginfo=t.sceneMgr.app.webgl.getExtension("WEBGL_debug_renderer_info"),null==this.debuginfo&&console.warn("extension(WEBGL_debug_renderer_info) not support!")},Object.defineProperty(DeviceInfo,"GraphDevice",{get:function(){return null==this.debuginfo&&this.getExtension(),this.debuginfo?t.sceneMgr.app.webgl.getParameter(this.debuginfo.UNMASKED_RENDERER_WEBGL):"unknown"},enumerable:!0,configurable:!0}),Object.defineProperty(DeviceInfo,"CanvasWidth",{get:function(){return t.sceneMgr.app?t.sceneMgr.app.webgl.canvas.width:null},enumerable:!0,configurable:!0}),Object.defineProperty(DeviceInfo,"CanvasHeight",{get:function(){return t.sceneMgr.app?t.sceneMgr.app.webgl.canvas.height:null},enumerable:!0,configurable:!0}),Object.defineProperty(DeviceInfo,"ScreenAdaptiveType",{get:function(){return t.sceneMgr.app?t.sceneMgr.app.screenAdaptiveType:"unknown"},enumerable:!0,configurable:!0}),Object.defineProperty(DeviceInfo,"ScreenWidth",{get:function(){return window.screen.width*(window.devicePixelRatio||1)},enumerable:!0,configurable:!0}),Object.defineProperty(DeviceInfo,"ScreenHeight",{get:function(){return window.screen.height*(window.devicePixelRatio||1)},enumerable:!0,configurable:!0}),DeviceInfo}();t.DeviceInfo=e;var a;!function(t){t[t.UI=0]="UI",t[t.SKinrender=1]="SKinrender",t[t.Meshrender=2]="Meshrender",t[t.EffectSystem=3]="EffectSystem"}(a=t.DrawCallEnum||(t.DrawCallEnum={}));var r=function(){function DrawCallInfo(){this.data=[],this.currentState=a.Meshrender}return Object.defineProperty(DrawCallInfo,"inc",{get:function(){return null==this._inc&&(this._inc=new DrawCallInfo),this._inc},enumerable:!0,configurable:!0}),DrawCallInfo.prototype.reset=function(){this.data[a.UI]=0,this.data[a.SKinrender]=0,this.data[a.Meshrender]=0,this.data[a.EffectSystem]=0},DrawCallInfo.prototype.add=function(){this.data[this.currentState]+=1},DrawCallInfo.prototype.initShowPlane=function(){var e=document.createElement("div");this.rootdiv=e,t.sceneMgr.app.container.appendChild(e),e.style.display="inline-block",e.style.position="absolute",e.style.left="100px",e.style.top="0px",e.style.height="200px",e.style.width="200px";var a=document.createElement("ul");e.appendChild(a);var r=document.createElement("li");r.textContent="SkinMeshDrawcall: ",r.style.fontSize="12px",r.style.color="Aqua",r.style.height="20px",r.style.width="200px",r.style.left="0px",a.appendChild(r),this.SKinrenderDraw=r;var i=document.createElement("li");i.textContent="MeshrenderDrawcall: ",i.style.fontSize="12px",i.style.color="Aqua",i.style.height="20px",i.style.width="200px",i.style.left="0px",a.appendChild(i),this.MeshrenderDraw=i;var o=document.createElement("li");o.textContent="EffectrenderDrawcall: ",o.style.fontSize="12px",o.style.color="Aqua",o.style.height="20px",o.style.width="200px",o.style.left="0px",a.appendChild(o),this.EffectrenderDraw=o;var n=document.createElement("li");n.textContent="EffectrenderDrawcall: ",n.style.fontSize="12px",n.style.color="Aqua",n.style.height="20px",n.style.width="200px",n.style.left="0px",a.appendChild(n),this.UIrenderDraw=n},DrawCallInfo.prototype.showPerFrame=function(){this.MeshrenderDraw.textContent="MeshrenderDrawcall: "+this.data[a.Meshrender],this.SKinrenderDraw.textContent="SkinMeshDrawcall: "+this.data[a.SKinrender],this.EffectrenderDraw.textContent="EffectrenderDrawcall: "+this.data[a.EffectSystem],this.UIrenderDraw.textContent="UIrenderDrawcall: "+this.data[a.UI]},DrawCallInfo.prototype.showDrawcallInfo=function(){null==this.SKinrenderDraw&&this.initShowPlane(),DrawCallInfo.BeActived=!0,this.rootdiv.style.visibility="visible"},DrawCallInfo.prototype.closeDrawCallInfo=function(){DrawCallInfo.BeActived=!1,this.rootdiv.style.visibility="hidden"},DrawCallInfo.BeActived=!1,DrawCallInfo}();t.DrawCallInfo=r}(t.framework||(t.framework={}))}(gd3d||(gd3d={}));var gd3d;!function(t){!function(t){var e=function(){function sceneMgr(){}return Object.defineProperty(sceneMgr,"ins",{get:function(){return null==sceneMgr._ins&&(sceneMgr._ins=new sceneMgr),sceneMgr._ins},enumerable:!0,configurable:!0}),sceneMgr}();t.sceneMgr=e}(t.framework||(t.framework={}))}(gd3d||(gd3d={}));var Stats;!function(t){var e=function(){function Stats(t){var e=this;this.mode=0,this.app=t,this.container=document.createElement("div"),this.container.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.7;z-index:1",this.container.addEventListener("click",function(t){t.preventDefault(),e.showPanel(++e.mode%e.container.children.length)},!1),this.beginTime=(performance||Date).now(),this.prevTime=this.beginTime,this.frames=0,this.fpsPanel=this.addPanel(new a("FPS","#0ff","#002")),this.msPanel=this.addPanel(new a("MS","#0f0","#020")),this.ratePanel=this.addPanel(new a("%","#0f0","#020")),this.userratePanel=this.addPanel(new a("%","#0f0","#020")),self.performance&&self.performance.memory&&(this.memPanel=this.addPanel(new a("MB","#f08","#201"))),this.showPanel(0)}return Stats.prototype.update=function(){this.beginTime=this.end()},Stats.prototype.showPanel=function(t){for(var e=0;e<this.container.children.length;e++)this.container.children[e].style.display=e===t?"block":"none";this.mode=t},Stats.prototype.addPanel=function(t){return this.container.appendChild(t.canvas),t},Stats.prototype.begin=function(){this.beginTime=(performance||Date).now()},Stats.prototype.end=function(){this.frames++;var t=(performance||Date).now();if(this.msPanel.update(t-this.beginTime,200),t>this.prevTime+1e3){var e=1e3*this.frames/(t-this.prevTime);if(this.fpsPanel.update(e,100),this.ratePanel.update(this.app.getUpdateTimer()*this.frames/10,100),this.userratePanel.update(this.app.getUserUpdateTimer()*this.frames/10,100),this.prevTime=t,this.frames=0,this.memPanel){var a=performance.memory;this.memPanel.update(a.usedJSHeapSize/1048576,a.jsHeapSizeLimit/1048576)}}return t},Stats}();t.Stats=e;var a=function(){function Panel(t,e,a){this.name=t,this.fg=e,this.bg=a,this.min=1/0,this.max=0,this.PR=Math.round(window.devicePixelRatio||1),this.WIDTH=80*this.PR,this.HEIGHT=48*this.PR,this.TEXT_X=3*this.PR,this.TEXT_Y=2*this.PR,this.GRAPH_X=3*this.PR,this.GRAPH_Y=15*this.PR,this.GRAPH_WIDTH=74*this.PR,this.GRAPH_HEIGHT=30*this.PR,this.canvas=document.createElement("canvas"),this.canvas.width=this.WIDTH,this.canvas.height=this.HEIGHT,this.canvas.style.cssText="width:80px;height:48px",this.context=this.canvas.getContext("2d"),this.context.font="bold "+9*this.PR+"px Helvetica,Arial,sans-serif",this.context.textBaseline="top",this.context.fillStyle=a,this.context.fillRect(0,0,this.WIDTH,this.HEIGHT),this.context.fillStyle=e,this.context.fillText(t,this.TEXT_X,this.TEXT_Y),this.context.fillRect(this.GRAPH_X,this.GRAPH_Y,this.GRAPH_WIDTH,this.GRAPH_HEIGHT),this.context.fillStyle=a,this.context.globalAlpha=.9,this.context.fillRect(this.GRAPH_X,this.GRAPH_Y,this.GRAPH_WIDTH,this.GRAPH_HEIGHT)}return Panel.prototype.update=function(t,e){this.min=Math.min(this.min,t),this.max=Math.max(this.max,t),this.context.fillStyle=this.bg,this.context.globalAlpha=1,this.context.fillRect(0,0,this.WIDTH,this.GRAPH_Y),this.context.fillStyle=this.fg,this.context.fillText(Math.round(t)+" "+this.name+" ("+Math.round(this.min)+"-"+Math.round(this.max)+")",this.TEXT_X,this.TEXT_Y),this.context.drawImage(this.canvas,this.GRAPH_X+this.PR,this.GRAPH_Y,this.GRAPH_WIDTH-this.PR,this.GRAPH_HEIGHT,this.GRAPH_X,this.GRAPH_Y,this.GRAPH_WIDTH-this.PR,this.GRAPH_HEIGHT),this.context.fillRect(this.GRAPH_X+this.GRAPH_WIDTH-this.PR,this.GRAPH_Y,this.PR,this.GRAPH_HEIGHT),this.context.fillStyle=this.bg,this.context.globalAlpha=.9,this.context.fillRect(this.GRAPH_X+this.GRAPH_WIDTH-this.PR,this.GRAPH_Y,this.PR,Math.round((1-t/e)*this.GRAPH_HEIGHT))},Panel}()}(Stats||(Stats={}));var gd3d;!function(t){t.gd3d_reflect_root={};!function(e){function regType(e,a){void 0==e.__gdmeta__&&(e.__gdmeta__={}),void 0==e.__gdmeta__.class&&(e.__gdmeta__.class={});var r=e.constructor.name;if(null==r){var i=e.constructor.toString(),o=i.indexOf("(");r=i.substring(9,o)}if(e.__gdmeta__.class.typename=r,null==t.gd3d_reflect_root.__gdmeta__&&(t.gd3d_reflect_root.__gdmeta__={}),t.gd3d_reflect_root.__gdmeta__[r]=e,null==e.__gdmeta__.class.custom&&(e.__gdmeta__.class.custom={}),null!=a)for(var n in a)e.__gdmeta__.class.custom[n]=a[n]}function regFunc(t,e,a){void 0==t.__gdmeta__&&(t.__gdmeta__={}),null==t.__gdmeta__[e]&&(t.__gdmeta__[e]={}),t.__gdmeta__[e].type="function";var r=Reflect.getMetadata("design:paramtypes",t,e),i=Reflect.getMetadata("design:returntype",t,e);t.__gdmeta__[e].paramtypes=[];for(var o in r)t.__gdmeta__[e].paramtypes[o]=r[o].name;if(t.__gdmeta__[e].returntype=null==i?null:i.name,null==t.__gdmeta__[e].custom&&(t.__gdmeta__[e].custom={}),null!=a)for(var n in a)t.__gdmeta__[e].custom[n]=a[n]}function regField(t,e,a){if(void 0==t.__gdmeta__&&(t.__gdmeta__={}),null==t.__gdmeta__[e]&&(t.__gdmeta__[e]={}),t.__gdmeta__[e].type="field",null==t.__gdmeta__[e].custom&&(t.__gdmeta__[e].custom={}),null!=a)for(var r in a)t.__gdmeta__[e].custom[r]=a[r]}e.getPrototypes=function getPrototypes(){return t.gd3d_reflect_root.__gdmeta__},e.getPrototype=function getPrototype(e){return t.gd3d_reflect_root.__gdmeta__[e]},e.createInstance=function createInstance(t,e){if(null==e)return new(i=t.constructor);var a=t.__gdmeta__.class.custom;for(var r in e)if(a[r]!=e[r])return console.warn("createInstance:"+name+". tag do not match."),null;var i=t.constructor;return new i},e.getClassName=function getClassName(t){return t.__gdmeta__.class.typename},e.getClassTag=function getClassTag(t,e){return t.__gdmeta__.class.custom[e]},e.getMeta=function getMeta(t){return t.__gdmeta__},e.attr_Class=function attr_Class(t){regType(t.prototype,null)},e.attr_Func=function attr_Func(t){return void 0===t&&(t=null),function(e,a,r){regFunc(e,a,t)}},e.attr_Field=function attr_Field(t){return void 0===t&&(t=null),function(e,a){regField(e,a,t)}},e.userCode=function userCode(t){regType(t.prototype,{usercode:"1"})},e.editorCode=function editorCode(t){regType(t.prototype,{editorcode:"1"})},e.selfClone=function selfClone(t){regType(t.prototype,{selfclone:"1"})},e.nodeComponent=function nodeComponent(t){regType(t.prototype,{nodecomp:"1"})},e.nodeComponentInspector=function nodeComponentInspector(t){regType(t.prototype,{nodecomp_inspector:"1"})},e.nodeRender=function nodeRender(t){regType(t.prototype,{renderer:"1"})},e.nodeCamera=function nodeCamera(t){regType(t.prototype,{camera:"1"})},e.nodeLight=function nodeLight(t){regType(t.prototype,{light:"1"})},e.nodeBoxCollider=function nodeBoxCollider(t){regType(t.prototype,{boxcollider:"1"})},e.nodeBoxCollider2d=function nodeBoxCollider2d(t){regType(t.prototype,{boxcollider2d:"1"})},e.nodeSphereCollider=function nodeSphereCollider(t){regType(t.prototype,{spherecollider:"1"})},e.nodeEffectBatcher=function nodeEffectBatcher(t){regType(t.prototype,{effectbatcher:"1"})},e.nodeMeshCollider=function nodeMeshCollider(t){regType(t.prototype,{meshcollider:"1"})},e.nodeCanvasRendererCollider=function nodeCanvasRendererCollider(t){regType(t.prototype,{canvasRenderer:"1"})},e.node2DComponent=function node2DComponent(t){regType(t.prototype,{"2dcomp":"1"})},e.pluginMenuItem=function pluginMenuItem(t){regType(t.prototype,{plugin_menuitem:"1"})},e.pluginWindow=function pluginWindow(t){regType(t.prototype,{plugin_window:"1"})},e.pluginExt=function pluginExt(t){regType(t.prototype,{plugin_ext:"1"})},e.compValue=function compValue(t,e,a,r){return void 0===t&&(t=!1),void 0===e&&(e=0),void 0===a&&(a=Number.MIN_VALUE),void 0===r&&(r=Number.MAX_VALUE),function(i,o){regField(i,o,{compValue:"1",integer:t?"1":"0",defvalue:e.toString(),min:a.toString(),max:r.toString()})}},e.compCall=function compCall(t){return void 0===t&&(t=null),function(e,a,r){regFunc(e,a,{compcall:"1"}),regFunc(e,a,t)}},e.SerializeType=function SerializeType(t){regType(t.prototype,{SerializeType:"1"})},e.Field=function Field(t,e,a){return void 0===e&&(e=void 0),void 0===a&&(a=void 0),function(r,i){regField(r,i,{SerializeField:!0,valueType:t}),void 0==e||regField(r,i,{defaultValue:e}),"reference"==t&&void 0!=a&&regField(r,i,{referenceType:a})}},e.UIComment=function UIComment(t){return function(e,a){regField(e,a,{UIComment:t})}};!function(t){t[t.None=0]="None",t[t.RangeFloat=1]="RangeFloat",t[t.MultiLineString=2]="MultiLineString",t[t.Enum=3]="Enum"}(e.FieldUIStyle||(e.FieldUIStyle={})),e.UIStyle=function UIStyle(t,e,a,r){return function(i,o){regField(i,o,{FieldUIStyle:t,min:e||null,max:a||null,defvalue:r||null})}}}(t.reflect||(t.reflect={}))}(gd3d||(gd3d={}));var gd3d;!function(t){!function(e){var a=function(){function canvas(){this.is2dUI=!0,this.hasPlayed=!1,this.playDirty=!1,this.pointDown=!1,this.pointSelect=null,this.pointEvent=new e.PointEvent,this.pointX=0,this.pointY=0,this.lastWidth=0,this.lastHeight=0,this.lastMaskSta=-1,this.pixelWidth=640,this.pixelHeight=480,this.rootNode=new e.transform2D,this.rootNode.canvas=this}return canvas.prototype.addChild=function(t){this.rootNode.addChild(t)},canvas.prototype.removeChild=function(t){this.rootNode.removeChild(t)},canvas.prototype.getChildren=function(){return this.rootNode.children},canvas.prototype.getChildCount=function(){return null==this.rootNode.children?0:this.rootNode.children.length},canvas.prototype.getChild=function(t){return this.rootNode.children[t]},canvas.prototype.update=function(e,a,r,i){this.pixelWidth,this.pixelHeight;this.rootNode.localScale.x=2/this.pixelWidth,this.rootNode.localScale.y=-2/this.pixelHeight,this.rootNode.localTranslate.y=1,this.rootNode.localTranslate.x=-1,this.pixelWidth==this.lastWidth&&this.pixelHeight==this.lastHeight||(this.lastWidth=this.rootNode.width=this.pixelWidth,this.lastHeight=this.rootNode.height=this.pixelHeight,this.rootNode.markDirty()),this.rootNode.pivot.x=0,this.rootNode.pivot.y=0,this.rootNode.updateTran(!1),this.pointEvent.eated=!1,this.pointEvent.x=r,this.pointEvent.y=i,this.pointEvent.selected=this.pointSelect;var o=!1;0==this.pointDown&&0==a?o=!0:0==this.pointDown&&1==a?this.pointEvent.type=t.event.PointEventEnum.PointDown:1==this.pointDown&&1==a?(this.pointEvent.type=t.event.PointEventEnum.PointHold,this.pointX==this.pointEvent.x&&this.pointY==this.pointEvent.y&&(o=!0)):1==this.pointDown&&0==a&&(this.pointEvent.type=t.event.PointEventEnum.PointUp),o||(this.scene.app.bePlay&&(this.rootNode.onCapturePointEvent(this,this.pointEvent),this.rootNode.onPointEvent(this,this.pointEvent)),this.pointSelect=this.pointEvent.selected,this.pointDown=a,this.pointX=this.pointEvent.x,this.pointY=this.pointEvent.y),this.scene.app.bePlay&&(this.hasPlayed||(this.playDirty=!0),this.objupdate(this.rootNode,e),this.playDirty=!1,this.hasPlayed=!0)},canvas.prototype.objupdate=function(t,e){if(t.init(this.playDirty),t.components.length>0&&t.update(e),null!=t.children)for(var a=0;a<t.children.length;a++)this.objupdate(t.children[a],e)},canvas.prototype.render=function(a,r){if(this.context=a,this.assetmgr=r,this.lastMat=null,null==this.batcher){this.webgl=a.webgl,this.batcher=new e.batcher2D;var i=t.render.VertexFormatMask.Position|t.render.VertexFormatMask.Color|t.render.VertexFormatMask.UV0|t.render.VertexFormatMask.ColorEX;this.batcher.initBuffer(a.webgl,i,t.render.DrawModeEnum.VboTri)}null!=this.beforeRender&&this.beforeRender(),this.drawScene(this.rootNode,a,r),this.batcher.end(a.webgl),e.DrawCallInfo.inc.currentState=e.DrawCallEnum.UI,null!=this.afterRender&&this.afterRender()},canvas.prototype.pushRawData=function(e,a){if(e!=this.lastMat)this.lastMat=e,this.batcher.end(this.webgl),(n=this.lastMat.getShader().passes.base[0]).use(this.webgl),e.uploadUnifoms(n,this.context),this.batcher.begin(this.webgl,n);else{var r=e.statedMapUniforms.MaskState,i=e.statedMapUniforms._maskRect;if(null!=r&&null!=r.value&&null!=i&&null!=i.value){var o=i.value;if(null==this.lastMaskV4&&(this.lastMaskV4=new t.math.vector4),r.value!=this.lastMaskSta||this.lastMaskV4.x!=o.x||this.lastMaskV4.y!=o.y||this.lastMaskV4.z!=o.z||this.lastMaskV4.w!=o.w){this.lastMaskSta=r.value,t.math.vec4Clone(o,this.lastMaskV4),this.batcher.end(this.webgl);var n=this.lastMat.getShader().passes.base[0];e.uploadUnifoms(n,this.context)}}}this.batcher.push(this.webgl,a,null)},canvas.prototype.drawScene=function(t,e,a){if(t.visible&&(null!=t.renderer&&t.renderer.render(this),null!=t.children))for(var r=0;r<t.children.length;r++)this.drawScene(t.children[r],e,a)},canvas.prototype.getRoot=function(){return null==this.rootNode&&(this.rootNode=new e.transform2D,this.rootNode.canvas=this,this.scene.app.markNotify(this.rootNode,e.NotifyType.AddChild)),this.rootNode},canvas.prototype.ModelPosToCanvasPos=function(t,e){if(null!=t&&null!=e){var a=1-(t.x-1)/-2,r=(t.y-1)/-2;e.x=a*this.pixelWidth,e.y=r*this.pixelHeight}},__decorate([t.reflect.Field("number"),__metadata("design:type",Number)],canvas.prototype,"pixelWidth",void 0),__decorate([t.reflect.Field("number"),__metadata("design:type",Number)],canvas.prototype,"pixelHeight",void 0),__decorate([t.reflect.Field("transform2D"),__metadata("design:type",e.transform2D)],canvas.prototype,"rootNode",void 0),canvas=__decorate([t.reflect.SerializeType,__metadata("design:paramtypes",[])],canvas)}();e.canvas=a}(t.framework||(t.framework={}))}(gd3d||(gd3d={}));var gd3d;!function(t){!function(e){var a=function(){function batcher2D(){this.vboCount=0,this.eboCount=0}return batcher2D.prototype.initBuffer=function(e,a,r){this.mesh=new t.render.glMesh,this.mesh.initBuffer(e,a,128,t.render.MeshTypeEnum.Dynamic),this.dataForVbo=new Float32Array(128),this.drawMode=r,r!=t.render.DrawModeEnum.EboLine&&r!=t.render.DrawModeEnum.EboTri||(this.mesh.addIndex(e,128),this.dataForEbo=new Uint16Array(128))},batcher2D.prototype.begin=function(t,e){this.vboCount>0&&this.end(t),this.curPass=e},batcher2D.prototype.push=function(e,a,r){if((this.vboCount+a.length>2048||null!=r&&this.eboCount+r.length>2048)&&this.end(e),this.vboCount+a.length>this.dataForVbo.length){for(var i=new Float32Array(2*this.dataForVbo.length),o=0;o<this.dataForVbo.length;o++)i[o]=this.dataForVbo[o];this.dataForVbo=i,this.mesh.resetVboSize(e,this.dataForVbo.length)}for(o=0;o<a.length;o++)this.dataForVbo[this.vboCount+o]=a[o];if(this.vboCount+=a.length,this.drawMode!=t.render.DrawModeEnum.VboLine&&this.drawMode!=t.render.DrawModeEnum.VboTri&&null!=r){if(this.eboCount+r.length>this.dataForEbo.length){for(var i=new Uint16Array(2*this.dataForEbo.length),o=0;o<this.dataForEbo.length;o++)i[o]=this.dataForEbo[o];this.dataForEbo=i,this.mesh.resetEboSize(e,0,this.dataForEbo.length)}for(o=0;o<r.length;o++)this.dataForEbo[this.eboCount+o]=r[o];this.eboCount+=r.length}},batcher2D.prototype.end=function(e){if(0!=this.vboCount){this.mesh.uploadVertexData(e,this.dataForVbo),this.eboCount>0&&this.mesh.uploadIndexData(e,0,this.dataForEbo);var a=this.vboCount/(this.mesh.vertexByteSize/4)|0;this.curPass.use(e),this.mesh.bind(e,this.curPass.program,this.drawMode==t.render.DrawModeEnum.EboLine||this.drawMode==t.render.DrawModeEnum.EboTri?0:-1),this.drawMode==t.render.DrawModeEnum.EboLine?this.mesh.drawElementLines(e,0,this.eboCount):this.drawMode==t.render.DrawModeEnum.EboTri?this.mesh.drawElementTris(e,0,this.eboCount):this.drawMode==t.render.DrawModeEnum.VboLine?this.mesh.drawArrayLines(e,0,a):this.drawMode==t.render.DrawModeEnum.VboTri&&this.mesh.drawArrayTris(e,0,a),this.vboCount=0,this.eboCount=0}},batcher2D}();e.batcher2D=a;var r=function(){function canvasRenderer(){this.layer=e.RenderLayerEnum.Common,this.queue=0,this.cupTans2ds=[],this.canvas=new e.canvas,this.canvas.is2dUI=!1}return Object.defineProperty(canvasRenderer.prototype,"renderLayer",{get:function(){return this.gameObject.layer},set:function(t){this.gameObject.layer=t},enumerable:!0,configurable:!0}),canvasRenderer.prototype.getBound=function(){return null},canvasRenderer.prototype.intersectsTransform=function(t){return!1},canvasRenderer.prototype.start=function(){this.canvas.scene=this.gameObject.getScene(),this.canvas.parentTrans=this.gameObject.transform,this.inputmgr=this.gameObject.getScene().app.getInputMgr()},canvasRenderer.prototype.onPlay=function(){},canvasRenderer.prototype.addChild=function(t){this.canvas.addChild(t)},canvasRenderer.prototype.removeChild=function(t){this.canvas.removeChild(t)},canvasRenderer.prototype.getChildren=function(){return this.canvas.getChildren()},canvasRenderer.prototype.getChildCount=function(){return this.canvas.getChildCount()},canvasRenderer.prototype.getChild=function(t){return this.canvas.getChild(t)},canvasRenderer.prototype.update=function(e){var a=this.canvas.pixelWidth/this.canvas.pixelHeight;if(this.gameObject.transform.localScale.x=this.gameObject.transform.localScale.y*a,null!=this.cameraTouch){var r=this.gameObject.getScene(),i=t.math.pool.new_vector2(this.inputmgr.point.x,this.inputmgr.point.y),o=this.cameraTouch.creatRayByScreen(i,r.app),n=t.math.pool.new_vector2();this.pickModelPos(o,n)?this.canvas.update(e,this.inputmgr.point.touch,n.x,n.y):this.canvas.update(e,!1,0,0),t.math.pool.delete_vector2(i),t.math.pool.delete_vector2(n)}else this.canvas.update(e,!1,0,0)},canvasRenderer.prototype.pickModelPos=function(e,a){var r=!1;if(!e||!a)return r;this.gameObject.getScene();var i=t.math.pool.new_pickInfo();if(e.intersectPlaneTransform(this.gameObject.transform,i)&&i.pickedtran==this.gameObject.transform){var o=this.gameObject.transform.getWorldMatrix(),n=t.math.pool.new_matrix();t.math.matrixInverse(o,n);var s=t.math.pool.new_vector3();t.math.matrixTransformVector3(i.hitposition,n,s),a.x=s.x,a.y=s.y,r=!0,t.math.pool.delete_matrix(n),t.math.pool.delete_vector3(s)}return r},canvasRenderer.prototype.pickAll2d=function(e){var a,r=t.math.pool.new_vector2();return this.pickModelPos(e,r)&&(a=[],this.dopick2d(r,this.canvas.getRoot(),a,!0)),t.math.pool.delete_vector2(r),a},canvasRenderer.prototype.pick2d=function(e){var a,r=t.math.pool.new_vector2();if(this.pickModelPos(e,r)){var i=[];this.dopick2d(r,this.canvas.getRoot(),i),i&&i[0]&&(a=i[0])}return t.math.pool.delete_vector2(r),a},canvasRenderer.prototype.dopick2d=function(t,e,a,r){if(void 0===r&&(r=!1),t&&e&&a){if(e.children&&e.children.length>0)for(var i=e.children.length-1;i>=0;i--)this.dopick2d(t,e.children[i],a,r);!e.ContainsCanvasPoint(t)||a.push(e)}},canvasRenderer.prototype.calScreenPosToCanvasPos=function(e,a,r){if(e&&a&&r){var i=e.creatRayByScreen(a,this.gameObject.getScene().app),o=t.math.pool.new_vector2();this.pickModelPos(i,o),this.canvas.ModelPosToCanvasPos(o,r),t.math.pool.delete_vector2(o)}},canvasRenderer.prototype.calCanvasPosToWorldPos=function(e,a){if(this.canvas&&e&&a){var r=t.math.pool.new_vector3();r.x=e.x/this.canvas.pixelWidth*2-1,r.y=e.y/this.canvas.pixelHeight*-2+1;var i=this.gameObject.transform.getWorldMatrix();t.math.matrixTransformVector3(r,i,a),a.z=this.gameObject.transform.getWorldTranslate().z,t.math.pool.delete_vector3(r)}},canvasRenderer.prototype.render=function(t,e,a){t.updateModel(this.gameObject.transform),this.canvas.render(t,e)},canvasRenderer.prototype.remove=function(){},canvasRenderer.prototype.clone=function(){},__decorate([t.reflect.Field("canvas"),__metadata("design:type",e.canvas)],canvasRenderer.prototype,"canvas",void 0),canvasRenderer=__decorate([t.reflect.nodeRender,t.reflect.nodeComponent,t.reflect.nodeCanvasRendererCollider,__metadata("design:paramtypes",[])],canvasRenderer)}();e.canvasRenderer=r}(t.framework||(t.framework={}))}(gd3d||(gd3d={}));var gd3d;!function(t){!function(t){var e=function(){return function PointEvent(){}}();t.PointEvent=e}(t.framework||(t.framework={}))}(gd3d||(gd3d={}));var gd3d;!function(t){!function(e){var a;!function(t){t[t.CONSTANT_PIXEL_SIZE=0]="CONSTANT_PIXEL_SIZE",t[t.SCALE_WITH_SCREEN_SIZE=1]="SCALE_WITH_SCREEN_SIZE"}(a=e.UIScaleMode||(e.UIScaleMode={}));var r=function(){function overlay2D(){this.init=!1,this.autoAsp=!0,this.screenMatchRate=0,this.matchReference_width=800,this.matchReference_height=600,this.scaleMode=a.CONSTANT_PIXEL_SIZE,this.sortOrder=0,this.viewPixelrect=new t.math.rect,this.canvas=new e.canvas,e.sceneMgr.app.markNotify(this.canvas.getRoot(),e.NotifyType.AddChild)}return overlay2D.prototype.start=function(t){t!=this.camera&&(this.camera=t,this.app=t.gameObject.getScene().app,this.canvas.scene=t.gameObject.getScene(),this.inputmgr=t.gameObject.getScene().app.getInputMgr())},overlay2D.prototype.addChild=function(t){this.canvas.addChild(t)},overlay2D.prototype.removeChild=function(t){this.canvas.removeChild(t)},overlay2D.prototype.getChildren=function(){return this.canvas.getChildren()},overlay2D.prototype.getChildCount=function(){return this.canvas.getChildCount()},overlay2D.prototype.getChild=function(t){return this.canvas.getChild(t)},overlay2D.prototype.render=function(e,r,i){if(this.canvas.getRoot().visible&&this.camera){var o=new t.math.rect;switch(this.camera.calcViewPortPixel(r.app,o),this.scaleMode){case a.CONSTANT_PIXEL_SIZE:if(this.canvas.pixelWidth==o.w&&this.canvas.pixelHeight==o.h)break;this.canvas.pixelWidth=o.w,this.canvas.pixelHeight=o.h,this.canvas.getRoot().markDirty();break;case a.SCALE_WITH_SCREEN_SIZE:var n=this.screenMatchRate<0?0:this.screenMatchRate;n=n>1?1:n;var s=o.w/o.h,l=t.math.numberLerp(this.matchReference_width,this.matchReference_height*s,n),h=t.math.numberLerp(this.matchReference_height,this.matchReference_width/s,1-n);this.canvas.pixelWidth==l&&this.canvas.pixelHeight==h||(this.canvas.pixelWidth=l,this.canvas.pixelHeight=h,this.canvas.getRoot().markDirty())}e.updateOverlay(),this.canvas.render(e,r)}},overlay2D.prototype.update=function(t){this.camera.calcViewPortPixel(this.app,this.viewPixelrect);var e=this.camera.viewport,a=this.inputmgr.point.x-e.x*this.app.width,r=this.inputmgr.point.y-e.y*this.app.height,i=a/this.viewPixelrect.w*2-1,o=r/this.viewPixelrect.h*-2+1;this.canvas.update(t,this.inputmgr.point.touch,i,o)},overlay2D.prototype.pick2d=function(e,a,r){if(void 0===r&&(r=0),null==this.camera)return null;var i=new t.math.rect,o=(this.camera.calcViewPortPixel(this.app,i),e/i.w*2-1),n=a/i.h*-2+1,s=t.math.pool.new_vector2();s.x=o,s.y=n;var l=this.canvas.getRoot(),h=this.dopick2d(s,l,r);return t.math.pool.delete_vector2(s),h},overlay2D.prototype.dopick2d=function(t,e,a){if(void 0===a&&(a=0),null!=e.components)for(i=e.components.length-1;i>=0;i--){var r=e.components[i];if(null!=r&&r.comp.transform.ContainsCanvasPoint(t,a))return r.comp.transform}if(null!=e.children)for(var i=e.children.length-1;i>=0;i--){var o=this.dopick2d(t,e.children[i],a);if(null!=o)return o}return null},overlay2D.prototype.calScreenPosToCanvasPos=function(e,a){if(this.camera&&this.canvas){var r=new t.math.rect;this.camera.calcViewPortPixel(this.app,r);var i=t.math.pool.new_vector2();i.x=e.x/r.w*2-1,i.y=e.y/r.h*-2+1;var o=t.math.pool.new_matrix3x2();t.math.matrix3x2Clone(this.canvas.getRoot().getWorldMatrix(),o),t.math.matrix3x2Inverse(o,o),t.math.matrix3x2TransformVector2(o,i,a),t.math.pool.delete_vector2(i)}},__decorate([t.reflect.Field("canvas"),__metadata("design:type",e.canvas)],overlay2D.prototype,"canvas",void 0),__decorate([t.reflect.Field("boolean"),__metadata("design:type",Boolean)],overlay2D.prototype,"autoAsp",void 0),__decorate([t.reflect.Field("number"),__metadata("design:type",Number)],overlay2D.prototype,"screenMatchRate",void 0),__decorate([t.reflect.Field("number"),__metadata("design:type",Object)],overlay2D.prototype,"matchReference_width",void 0),__decorate([t.reflect.Field("number"),__metadata("design:type",Object)],overlay2D.prototype,"matchReference_height",void 0),__decorate([t.reflect.Field("number"),__metadata("design:type",Number)],overlay2D.prototype,"scaleMode",void 0),__decorate([t.reflect.Field("number"),__metadata("design:type",Number)],overlay2D.prototype,"sortOrder",void 0),overlay2D=__decorate([t.reflect.SerializeType,__metadata("design:paramtypes",[])],overlay2D)}();e.overlay2D=r}(t.framework||(t.framework={}))}(gd3d||(gd3d={}));var gd3d;!function(t){!function(e){var a=new Uint8Array(1),r=new Int8Array(1),i=new Int16Array(1),o=new Int32Array(1),n=new Uint16Array(1),s=new Uint32Array(1),l=new Float32Array(1),h=new Float64Array(1);e.UByte=function UByte(t){return void 0===t&&(t=0),"string"==typeof t&&(t=Number(t)),a[0]=t,a[0]},e.Byte=function Byte(t){return void 0===t&&(t=0),"string"==typeof t&&(t=Number(t)),r[0]=t,r[0]},e.Int16=function Int16(t){return void 0===t&&(t=0),"string"==typeof t&&(t=Number(t)),i[0]=t,i[0]},e.Int32=function Int32(t){return void 0===t&&(t=0),"string"==typeof t&&(t=Number(t)),o[0]=t,o[0]},e.UInt16=function UInt16(t){return void 0===t&&(t=0),"string"==typeof t&&(t=Number(t)),n[0]=t,n[0]},e.UInt32=function UInt32(t){return void 0===t&&(t=0),"string"==typeof t&&(t=Number(t)),s[0]=t,s[0]},e.Float=function Float(t){return void 0===t&&(t=0),"string"==typeof t&&(t=Number(t)),l[0]=t,l[0]},e.Double=function Double(t){return void 0===t&&(t=0),"string"==typeof t&&(t=Number(t)),h[0]=t,h[0]};var c=function(){function vector2(t,e,a,r){void 0===t&&(t=0),void 0===e&&(e=0),void 0===a&&(a=0),void 0===r&&(r=0),this.rawData=new Float32Array(2),this.rawData[0]=t,this.rawData[1]=e}return Object.defineProperty(vector2.prototype,"x",{get:function(){return this.rawData[0]},set:function(t){this.rawData[0]=t},enumerable:!0,configurable:!0}),Object.defineProperty(vector2.prototype,"y",{get:function(){return this.rawData[1]},set:function(t){this.rawData[1]=t},enumerable:!0,configurable:!0}),vector2.prototype.toString=function(){return this.x+","+this.y},__decorate([t.reflect.Field("number"),__metadata("design:type",Number),__metadata("design:paramtypes",[Number])],vector2.prototype,"x",null),__decorate([t.reflect.Field("number"),__metadata("design:type",Number),__metadata("design:paramtypes",[Number])],vector2.prototype,"y",null),vector2=__decorate([t.reflect.SerializeType,__metadata("design:paramtypes",[Number,Number,Number,Number])],vector2)}();e.vector2=c;var u=function(){function rect(t,e,a,r){void 0===t&&(t=0),void 0===e&&(e=0),void 0===a&&(a=0),void 0===r&&(r=0),this.rawData=new Float32Array(4),this.rawData[0]=t,this.rawData[1]=e,this.rawData[2]=a,this.rawData[3]=r}return Object.defineProperty(rect.prototype,"x",{get:function(){return this.rawData[0]},set:function(t){this.rawData[0]=t},enumerable:!0,configurable:!0}),Object.defineProperty(rect.prototype,"y",{get:function(){return this.rawData[1]},set:function(t){this.rawData[1]=t},enumerable:!0,configurable:!0}),Object.defineProperty(rect.prototype,"w",{get:function(){return this.rawData[2]},set:function(t){this.rawData[2]=t},enumerable:!0,configurable:!0}),Object.defineProperty(rect.prototype,"h",{get:function(){return this.rawData[3]},set:function(t){this.rawData[3]=t},enumerable:!0,configurable:!0}),rect.prototype.toString=function(){return this.rawData[0]+","+this.rawData[1]+","+this.rawData[2]+","+this.rawData[3]},__decorate([t.reflect.Field("number"),__metadata("design:type",Number),__metadata("design:paramtypes",[Number])],rect.prototype,"x",null),__decorate([t.reflect.Field("number"),__metadata("design:type",Number),__metadata("design:paramtypes",[Number])],rect.prototype,"y",null),__decorate([t.reflect.Field("number"),__metadata("design:type",Number),__metadata("design:paramtypes",[Number])],rect.prototype,"w",null),__decorate([t.reflect.Field("number"),__metadata("design:type",Number),__metadata("design:paramtypes",[Number])],rect.prototype,"h",null),rect=__decorate([t.reflect.SerializeType,__metadata("design:paramtypes",[Number,Number,Number,Number])],rect)}();e.rect=u;var d=function(){function border(t,e,a,r){void 0===t&&(t=0),void 0===e&&(e=0),void 0===a&&(a=0),void 0===r&&(r=0),this.rawData=new Float32Array(4),this.rawData[0]=t,this.rawData[1]=e,this.rawData[2]=a,this.rawData[3]=r}return Object.defineProperty(border.prototype,"l",{get:function(){return this.rawData[0]},set:function(t){this.rawData[0]=t},enumerable:!0,configurable:!0}),Object.defineProperty(border.prototype,"t",{get:function(){return this.rawData[1]},set:function(t){this.rawData[1]=t},enumerable:!0,configurable:!0}),Object.defineProperty(border.prototype,"r",{get:function(){return this.rawData[2]},set:function(t){this.rawData[2]=t},enumerable:!0,configurable:!0}),Object.defineProperty(border.prototype,"b",{get:function(){return this.rawData[3]},set:function(t){this.rawData[3]=t},enumerable:!0,configurable:!0}),border.prototype.toString=function(){return this.r+","+this.t+","+this.r+","+this.b},__decorate([t.reflect.Field("number"),__metadata("design:type",Number),__metadata("design:paramtypes",[Number])],border.prototype,"l",null),__decorate([t.reflect.Field("number"),__metadata("design:type",Number),__metadata("design:paramtypes",[Number])],border.prototype,"t",null),__decorate([t.reflect.Field("number"),__metadata("design:type",Number),__metadata("design:paramtypes",[Number])],border.prototype,"r",null),__decorate([t.reflect.Field("number"),__metadata("design:type",Number),__metadata("design:paramtypes",[Number])],border.prototype,"b",null),border=__decorate([t.reflect.SerializeType,__metadata("design:paramtypes",[Number,Number,Number,Number])],border)}();e.border=d;var m=function(){function color(t,e,a,r){void 0===t&&(t=1),void 0===e&&(e=1),void 0===a&&(a=1),void 0===r&&(r=1),this.rawData=new Float32Array(4),this.rawData[0]=t,this.rawData[1]=e,this.rawData[2]=a,this.rawData[3]=r}return Object.defineProperty(color.prototype,"r",{get:function(){return this.rawData[0]},set:function(t){this.rawData[0]=t},enumerable:!0,configurable:!0}),Object.defineProperty(color.prototype,"g",{get:function(){return this.rawData[1]},set:function(t){this.rawData[1]=t},enumerable:!0,configurable:!0}),Object.defineProperty(color.prototype,"b",{get:function(){return this.rawData[2]},set:function(t){this.rawData[2]=t},enumerable:!0,configurable:!0}),Object.defineProperty(color.prototype,"a",{get:function(){return this.rawData[3]},set:function(t){this.rawData[3]=t},enumerable:!0,configurable:!0}),color.prototype.toString=function(){return this.r+","+this.g+","+this.b+","+this.a},__decorate([t.reflect.Field("number"),__metadata("design:type",Number),__metadata("design:paramtypes",[Number])],color.prototype,"r",null),__decorate([t.reflect.Field("number"),__metadata("design:type",Number),__metadata("design:paramtypes",[Number])],color.prototype,"g",null),__decorate([t.reflect.Field("number"),__metadata("design:type",Number),__metadata("design:paramtypes",[Number])],color.prototype,"b",null),__decorate([t.reflect.Field("number"),__metadata("design:type",Number),__metadata("design:paramtypes",[Number])],color.prototype,"a",null),color=__decorate([t.reflect.SerializeType,__metadata("design:paramtypes",[Number,Number,Number,Number])],color)}();e.color=m;var p=function(){function vector3(t,e,a){void 0===t&&(t=0),void 0===e&&(e=0),void 0===a&&(a=0),this.rawData=new Float32Array(3),this.rawData[0]=t,this.rawData[1]=e,this.rawData[2]=a}return Object.defineProperty(vector3.prototype,"x",{get:function(){return this.rawData[0]},set:function(t){this.rawData[0]=t},enumerable:!0,configurable:!0}),Object.defineProperty(vector3.prototype,"y",{get:function(){return this.rawData[1]},set:function(t){this.rawData[1]=t},enumerable:!0,configurable:!0}),Object.defineProperty(vector3.prototype,"z",{get:function(){return this.rawData[2]},set:function(t){this.rawData[2]=t},enumerable:!0,configurable:!0}),vector3.prototype.toString=function(){return this.rawData[0]+","+this.rawData[1]+","+this.rawData[2]},__decorate([t.reflect.Field("number"),__metadata("design:type",Number),__metadata("design:paramtypes",[Number])],vector3.prototype,"x",null),__decorate([t.reflect.Field("number"),__metadata("design:type",Number),__metadata("design:paramtypes",[Number])],vector3.prototype,"y",null),__decorate([t.reflect.Field("number"),__metadata("design:type",Number),__metadata("design:paramtypes",[Number])],vector3.prototype,"z",null),vector3=__decorate([t.reflect.SerializeType,__metadata("design:paramtypes",[Number,Number,Number])],vector3)}();e.vector3=p;var f=function(){function vector4(t,e,a,r){void 0===t&&(t=0),void 0===e&&(e=0),void 0===a&&(a=0),void 0===r&&(r=0),this.rawData=new Float32Array(4),this.rawData[0]=t,this.rawData[1]=e,this.rawData[2]=a,this.rawData[3]=r}return Object.defineProperty(vector4.prototype,"x",{get:function(){return this.rawData[0]},set:function(t){this.rawData[0]=t},enumerable:!0,configurable:!0}),Object.defineProperty(vector4.prototype,"y",{get:function(){return this.rawData[1]},set:function(t){this.rawData[1]=t},enumerable:!0,configurable:!0}),Object.defineProperty(vector4.prototype,"z",{get:function(){return this.rawData[2]},set:function(t){this.rawData[2]=t},enumerable:!0,configurable:!0}),Object.defineProperty(vector4.prototype,"w",{get:function(){return this.rawData[3]},set:function(t){this.rawData[3]=t},enumerable:!0,configurable:!0}),vector4.prototype.toString=function(){return this.rawData[0]+","+this.rawData[1]+","+this.rawData[2]+","+this.rawData[3]},__decorate([t.reflect.Field("number"),__metadata("design:type",Number),__metadata("design:paramtypes",[Number])],vector4.prototype,"x",null),__decorate([t.reflect.Field("number"),__metadata("design:type",Number),__metadata("design:paramtypes",[Number])],vector4.prototype,"y",null),__decorate([t.reflect.Field("number"),__metadata("design:type",Number),__metadata("design:paramtypes",[Number])],vector4.prototype,"z",null),__decorate([t.reflect.Field("number"),__metadata("design:type",Number),__metadata("design:paramtypes",[Number])],vector4.prototype,"w",null),vector4=__decorate([t.reflect.SerializeType,__metadata("design:paramtypes",[Number,Number,Number,Number])],vector4)}();e.vector4=f;var g=function(){function quaternion(t,e,a,r){void 0===t&&(t=0),void 0===e&&(e=0),void 0===a&&(a=0),void 0===r&&(r=1),this.rawData=new Float32Array(4),this.rawData[0]=t,this.rawData[1]=e,this.rawData[2]=a,this.rawData[3]=r}return Object.defineProperty(quaternion.prototype,"x",{get:function(){return this.rawData[0]},set:function(t){this.rawData[0]=t},enumerable:!0,configurable:!0}),Object.defineProperty(quaternion.prototype,"y",{get:function(){return this.rawData[1]},set:function(t){this.rawData[1]=t},enumerable:!0,configurable:!0}),Object.defineProperty(quaternion.prototype,"z",{get:function(){return this.rawData[2]},set:function(t){this.rawData[2]=t},enumerable:!0,configurable:!0}),Object.defineProperty(quaternion.prototype,"w",{get:function(){return this.rawData[3]},set:function(t){this.rawData[3]=t},enumerable:!0,configurable:!0}),quaternion.prototype.toString=function(){return this.rawData[0]+","+this.rawData[1]+","+this.rawData[2]+","+this.rawData[3]},__decorate([t.reflect.Field("number"),__metadata("design:type",Number),__metadata("design:paramtypes",[Number])],quaternion.prototype,"x",null),__decorate([t.reflect.Field("number"),__metadata("design:type",Number),__metadata("design:paramtypes",[Number])],quaternion.prototype,"y",null),__decorate([t.reflect.Field("number"),__metadata("design:type",Number),__metadata("design:paramtypes",[Number])],quaternion.prototype,"z",null),__decorate([t.reflect.Field("number"),__metadata("design:type",Number),__metadata("design:paramtypes",[Number])],quaternion.prototype,"w",null),quaternion=__decorate([t.reflect.SerializeType,__metadata("design:paramtypes",[Number,Number,Number,Number])],quaternion)}();e.quaternion=g;var v=function(){function matrix(t){void 0===t&&(t=null),this.rawData=t||new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return matrix.prototype.toString=function(){return"["+this.rawData[0]+","+this.rawData[1]+","+this.rawData[2]+","+this.rawData[3]+"],["+this.rawData[4]+","+this.rawData[5]+","+this.rawData[6]+","+this.rawData[7]+"],["+this.rawData[8]+","+this.rawData[9]+","+this.rawData[10]+","+this.rawData[11]+"],["+this.rawData[12]+","+this.rawData[13]+","+this.rawData[14]+","+this.rawData[15]+"]"},matrix}();e.matrix=v;var y=function(){function matrix3x2(t){void 0===t&&(t=null),this.rawData=t||new Float32Array([1,0,0,1,0,0])}return matrix3x2.prototype.toString=function(){return"["+this.rawData[0]+","+this.rawData[1]+","+this.rawData[2]+"],["+this.rawData[3]+","+this.rawData[4]+","+this.rawData[5]+"]"},matrix3x2}();e.matrix3x2=y,e.vec4FormJson=function vec4FormJson(t,e){var a=(t=(t=t.replace("(","")).replace(")","")).split(",");e.x=Number(a[0]),e.y=Number(a[1]),e.z=Number(a[2]),e.w=Number(a[3])},e.vec3FormJson=function vec3FormJson(t,e){var a=(t=(t=t.replace("(","")).replace(")","")).split(",");e.x=Number(a[0]),e.y=Number(a[1]),e.z=Number(a[2])},e.vec2FormJson=function vec2FormJson(t,e){var a=(t=(t=t.replace("(","")).replace(")","")).split(",");e.x=Number(a[0]),e.y=Number(a[1])},e.colorFormJson=function colorFormJson(t,e){var a=(t=(t=t.replace("RGBA(","")).replace(")","")).split(",");e.r=Number(a[0]),e.g=Number(a[1]),e.b=Number(a[2]),e.a=Number(a[3])}}(t.math||(t.math={}))}(gd3d||(gd3d={}));var gd3d;!function(t){!function(e){var a;!function(t){t[t.LEFT=1]="LEFT",t[t.TOP=2]="TOP",t[t.RIGHT=4]="RIGHT",t[t.BOTTOM=8]="BOTTOM",t[t.H_CENTER=16]="H_CENTER",t[t.V_CENTER=32]="V_CENTER"}(a=e.layoutOption||(e.layoutOption={}));var r=function(){function C2DComponent(t,e){void 0===e&&(e=!1),this.comp=t,this.init=e}return __decorate([t.reflect.Field("I2DComponent"),__metadata("design:type",Object)],C2DComponent.prototype,"comp",void 0),C2DComponent=__decorate([t.reflect.SerializeType,__metadata("design:paramtypes",[Object,Boolean])],C2DComponent)}();e.C2DComponent=r;var i=function(){function transform2D(){this.prefab="",this.layer=e.cullingmaskutil.maskTolayer(e.CullingMask.default),this.tag=e.StringUtil.builtinTag_Untagged,this.name="noname",this.isStatic=!1,this.width=0,this.height=0,this.pivot=new t.math.vector2(0,0),this.hideFlags=e.HideFlags.None,this._visible=!0,this.insId=new e.insID,this.dirty=!0,this.dirtyChild=!0,this.dirtyWorldDecompose=!1,this.localTranslate=new t.math.vector2(0,0),this.localScale=new t.math.vector2(1,1),this.localRotate=0,this._isMask=!1,this._parentIsMask=!1,this.localMatrix=new t.math.matrix3x2,this.worldMatrix=new t.math.matrix3x2,this.canvasWorldMatrix=new t.math.matrix3x2,this.worldRotate=new t.math.angelref,this.worldTranslate=new t.math.vector2(0,0),this.worldScale=new t.math.vector2(1,1),this.components=[],this.componentsInit=[],this.optionArr=[a.LEFT,a.TOP,a.RIGHT,a.BOTTOM,a.H_CENTER,a.V_CENTER],this._layoutState=0,this.layoutValueMap={},this._layoutPercentState=0,this.layoutDirty=!1,this.lastParentWidth=0,this.lastParentHeight=0,this.lastParentPivot=new t.math.vector2(0,0),this.lastPivot=new t.math.vector2(0,0)}return Object.defineProperty(transform2D.prototype,"canvas",{get:function(){return null==this._canvas?null==this.parent?null:this.parent.canvas:this._canvas},set:function(t){t&&(this._canvas=t)},enumerable:!0,configurable:!0}),Object.defineProperty(transform2D.prototype,"visibleInScene",{get:function(){for(var t=this;t.visible;)t=t.parent;return t.visible},enumerable:!0,configurable:!0}),Object.defineProperty(transform2D.prototype,"visible",{get:function(){return this._visible},set:function(t){t!=this._visible&&(this._visible=t,e.sceneMgr.app.markNotify(this,e.NotifyType.ChangeVisible))},enumerable:!0,configurable:!0}),Object.defineProperty(transform2D.prototype,"transform",{get:function(){return this},enumerable:!0,configurable:!0}),Object.defineProperty(transform2D.prototype,"maskRect",{get:function(){return null==this._temp_maskRect&&(this._temp_maskRect=new t.math.rect),null!=this._maskRect&&(this._temp_maskRect.x=this._maskRect.x,this._temp_maskRect.y=this._maskRect.y,this._temp_maskRect.w=this._maskRect.w,this._temp_maskRect.h=this._maskRect.h),this._temp_maskRect},enumerable:!0,configurable:!0}),Object.defineProperty(transform2D.prototype,"isMask",{get:function(){return this._isMask},set:function(t){this._isMask=t,this.markDirty(),null!=this.parent&&this.updateTran(!0)},enumerable:!0,configurable:!0}),transform2D.prototype.updateMaskRect=function(){var e,a,r,i,o;if(null!=this.parent?(this._parentIsMask=this.parent.isMask||this.parent.parentIsMask,o=this.parent.maskRect):this._parentIsMask=!1,this.isMask||this.parentIsMask){if(this.isMask){var n=this.getWorldTranslate(),s=this.canvas.pixelWidth,l=this.canvas.pixelHeight;if(e=n.x/s,a=n.y/l,r=this.width/s,i=this.height/l,this.parentIsMask&&null!=o){var h=Math.max(e,o.x),c=Math.max(a,o.y),u=Math.min(e+r,o.x+o.w),d=Math.min(a+i,o.y+o.h);e=h,a=c,r=u-h,i=d-c}}else null!=o&&(e=o.x,a=o.y,r=o.w,i=o.h);null==this._maskRect&&(this._maskRect=new t.math.rect),this._maskRect.x==e&&this._maskRect.x==a&&this._maskRect.x==r&&this._maskRect.x==i||(this._maskRect.x=e,this._maskRect.y=a,this._maskRect.w=r,this._maskRect.h=i)}},Object.defineProperty(transform2D.prototype,"parentIsMask",{get:function(){return this._parentIsMask},enumerable:!0,configurable:!0}),transform2D.prototype.addChild=function(t){null!=t.parent&&t.parent.removeChild(t),null==this.children&&(this.children=[]),this.children.push(t),t.parent=this,t.canvas=this.canvas,e.sceneMgr.app.markNotify(t,e.NotifyType.AddChild),this.markDirty()},transform2D.prototype.addChildAt=function(t,a){a<0||(null!=t.parent&&t.parent.removeChild(t),null==this.children&&(this.children=[]),this.children.splice(a,0,t),t.canvas=this.canvas,t.parent=this,e.sceneMgr.app.markNotify(t,e.NotifyType.AddChild),this.markDirty())},transform2D.prototype.removeChild=function(t){if(t.parent!=this||null==this.children)throw new Error("not my child.");var a=this.children.indexOf(t);a>=0&&(this.children.splice(a,1),t.parent=null,e.sceneMgr.app.markNotify(t,e.NotifyType.RemoveChild))},transform2D.prototype.removeAllChild=function(){for(;this.children.length>0;)this.removeChild(this.children[0])},transform2D.prototype.markDirty=function(){this.dirty=!0;for(var t=this.parent;null!=t;)t.dirtyChild=!0,t=t.parent},transform2D.prototype.updateTran=function(e){if(0!=this.dirtyChild||0!=this.dirty||0!=e){if(this.dirty&&t.math.matrix3x2MakeTransformRTS(this.localTranslate,this.localScale,this.localRotate,this.localMatrix),(this.dirty||e)&&(this.refreshLayout(),null==this.parent?t.math.matrix3x2Clone(this.localMatrix,this.worldMatrix):t.math.matrix3x2Multiply(this.parent.worldMatrix,this.localMatrix,this.worldMatrix),this.updateMaskRect(),null!=this.renderer&&this.renderer.updateTran(),this.dirtyWorldDecompose=!0),null!=this.children)for(var a=0;a<this.children.length;a++)this.children[a].updateTran(e||this.dirty);this.dirty=!1,this.dirtyChild=!1}},transform2D.prototype.updateWorldTran=function(){var t=this.parent,e=[];for(e.push(this);null!=t;)t.dirty&&e.push(t),t=t.parent;e.pop().updateTran(!1)},transform2D.prototype.CalcReCanvasMtx=function(e){if(e){var a=t.math.pool.new_vector2(),r=t.math.pool.new_vector2();a.x=this.canvas.pixelWidth/2,a.y=-this.canvas.pixelHeight/2,r.x=this.canvas.pixelWidth/2,r.y=this.canvas.pixelHeight/2,t.math.matrix3x2MakeTransformRTS(r,a,0,e)}},transform2D.prototype.decomposeWorldMatrix=function(){if(this.dirtyWorldDecompose){var e=t.math.pool.new_matrix3x2();this.CalcReCanvasMtx(e),t.math.matrix3x2Multiply(e,this.worldMatrix,this.canvasWorldMatrix),t.math.matrix3x2Decompose(this.canvasWorldMatrix,this.worldScale,this.worldRotate,this.worldTranslate),t.math.pool.delete_matrix3x2(e),this.dirtyWorldDecompose=!1}},transform2D.prototype.getWorldTranslate=function(){return this.decomposeWorldMatrix(),this.worldTranslate},transform2D.prototype.getWorldScale=function(){return this.decomposeWorldMatrix(),this.worldScale},transform2D.prototype.getWorldRotate=function(){return this.decomposeWorldMatrix(),this.worldRotate},transform2D.prototype.getLocalMatrix=function(){return this.localMatrix},transform2D.prototype.getWorldMatrix=function(){return this.worldMatrix},transform2D.prototype.getCanvasWorldMatrix=function(){return this.decomposeWorldMatrix(),this.canvasWorldMatrix},transform2D.getTransInfoInCanvas=function(e,a){var r=e.getWorldMatrix(),i=e.canvas.getRoot().getWorldMatrix(),o=t.math.pool.new_matrix3x2();t.math.matrix3x2Inverse(i,o);var n=t.math.pool.new_matrix3x2();t.math.matrix3x2Multiply(o,r,n);var s=t.math.pool.new_vector2(),l=new t.math.angelref,h=t.math.pool.new_vector2();t.math.matrix3x2Decompose(n,s,l,h),t.math.vec2Clone(e.pivot,a.pivot),t.math.vec2Clone(h,a.pivotPos),a.rot=l.v,a.width=e.width*s.x,a.height=e.height*s.y,t.math.pool.delete_matrix3x2(o),t.math.pool.delete_matrix3x2(n),t.math.pool.delete_vector2(s),t.math.pool.delete_vector2(h)},transform2D.prototype.setWorldPosition=function(e){this.dirty=!0,this.updateWorldTran();var a=this.getWorldTranslate(),r=t.math.pool.new_vector2();r.x=e.x-a.x,r.y=e.y-a.y;var i=t.math.pool.new_matrix3x2();null!=this.parent?t.math.matrix3x2Clone(this.parent.worldMatrix,i):t.math.matrix3x2MakeIdentity(i);var o=t.math.pool.new_matrix3x2();t.math.matrix3x2Inverse(i,o);var n=t.math.pool.new_vector2();t.math.matrix3x2TransformNormal(o,r,n),this.localTranslate.x+=n.x,this.localTranslate.y+=n.y,t.math.pool.delete_matrix3x2(o),t.math.pool.delete_vector2(r),t.math.pool.delete_vector2(n)},transform2D.prototype.dispose=function(){if(this.children){for(var t in this.children)this.children[t].dispose();this.removeAllChild()}this.removeAllComponents()},transform2D.prototype.update=function(t){if(0!=this.components.length)for(var e=0;e<this.components.length;e++)this.components[e].comp.update(t)},transform2D.prototype.init=function(t){if(void 0===t&&(t=!1),this.componentsInit.length>0){for(var e=0;e<this.componentsInit.length;e++)this.componentsInit[e].comp.start(),this.componentsInit[e].init=!0,t&&this.componentsInit[e].comp.onPlay();this.componentsInit.length=0}},transform2D.prototype.addComponent=function(e){null==this.components&&(this.components=[]);for(var a in this.components)if(this.components[a].comp.constructor.name==e)throw new Error("已经有一个"+e+"的组件了，不能俩");var r=t.reflect.getPrototype(e),i=t.reflect.createInstance(r,{"2dcomp":"1"});return this.addComponentDirect(i)},transform2D.prototype.addComponentDirect=function(e){if(null!=e.transform)throw new Error("this components has added to a  gameObject");e.transform=this,null==this.components&&(this.components=[]);var a=new r(e,!1);if(this.components.push(a),this.componentsInit.push(a),"1"==t.reflect.getClassTag(e.__proto__,"renderer")){if(null!=this.renderer)throw new Error("已经有一个渲染器的组件了，不能俩");this.renderer=e}if("1"==t.reflect.getClassTag(e.__proto__,"boxcollider2d")){if(null!=this.collider)throw new Error("已经有一个碰撞组件了，不能俩");this.collider=e}return e},transform2D.prototype.removeComponent=function(t){if(t)for(var e=0;e<this.components.length;e++)if(this.components[e].comp==t){this.components[e].init;this.components.splice(e,1);t.remove();break}},transform2D.prototype.removeComponentByTypeName=function(e){for(var a=0;a<this.components.length;a++)if(t.reflect.getClassName(this.components[a].comp)==e){var r=this.components.splice(a,1);return r[0].comp==this.renderer&&(this.renderer=null),r[0].comp==this.collider&&(this.collider=null),r[0].comp.remove(),r[0]}},transform2D.prototype.removeAllComponents=function(){for(var t=0;t<this.components.length;t++)this.components[t].comp.remove();this.renderer&&(this.renderer=null),this.collider&&(this.renderer=null),this.components.length=0},transform2D.prototype.getComponent=function(e){for(var a=0;a<this.components.length;a++)if(t.reflect.getClassName(this.components[a].comp.__proto__)==e)return this.components[a].comp;return null},transform2D.prototype.getComponents=function(){for(var t=[],e=0;e<this.components.length;e++)t.push(this.components[e].comp);return t},transform2D.prototype.getComponentsInChildren=function(t){var e=[];return this.getNodeCompoents(this,t,e),e},transform2D.prototype.getNodeCompoents=function(e,a,r){for(var i in e.components)t.reflect.getClassName(e.components[i].comp.__proto__)==a&&r.push(e.components[i].comp);if(null!=e.children)for(var i in e.children)this.getNodeCompoents(e.children[i],a,r)},transform2D.prototype.onCapturePointEvent=function(t,e){if(null!=this.components)for(r=0;r<=this.components.length;r++)if(0==e.eated){var a=this.components[r];null!=a&&a.init&&a.comp.onPointEvent(t,e,!0)}if(0==e.eated&&null!=this.children)for(var r=0;r<=this.children.length;r++){var i=this.children[r];null!=i&&i.visible&&i.onCapturePointEvent(t,e)}},transform2D.prototype.ContainsCanvasPoint=function(e,a){void 0===a&&(a=0);var r=!1,i=this.getWorldMatrix(),o=t.math.pool.new_matrix3x2();t.math.matrix3x2Inverse(i,o);var n=t.math.pool.new_vector2();return t.math.matrix3x2TransformVector2(o,e,n),n.x+=this.pivot.x*this.width,n.y+=this.pivot.y*this.height,r=n.x+a>=0&&n.y+a>=0&&n.x<this.width+a&&n.y<this.height+a,t.math.pool.delete_matrix3x2(o),t.math.pool.delete_vector2(n),r},transform2D.prototype.onPointEvent=function(t,e){if(null!=this.children)for(r=this.children.length-1;r>=0;r--)if(0==e.eated){var a=this.children[r];null!=a&&a.visible&&a.onPointEvent(t,e)}if(0==e.eated&&null!=this.components)for(var r=this.components.length-1;r>=0;r--){var i=this.components[r];null!=i&&i.init&&i.comp.onPointEvent(t,e,!1)}},Object.defineProperty(transform2D.prototype,"layoutState",{get:function(){return this._layoutState},set:function(t){isNaN(t)||void 0==t||t!=this._layoutState&&(this.layoutDirty=!0,this.markDirty(),this._layoutState=t)},enumerable:!0,configurable:!0}),transform2D.prototype.setLayoutValue=function(t,e){isNaN(t)||isNaN(e)||void 0==t||void 0==e||void 0!=this.layoutValueMap[t]&&e==this.layoutValueMap[t]||(this.layoutDirty=!0,this.markDirty(),this.layoutValueMap[t]=e)},transform2D.prototype.getLayoutValue=function(t){return void 0==this.layoutValueMap[t]&&(this.layoutValueMap[t]=0),this.layoutValueMap[t]},Object.defineProperty(transform2D.prototype,"layoutPercentState",{get:function(){return this._layoutPercentState},set:function(t){isNaN(t)||void 0==t||t!=this._layoutPercentState&&(this.layoutDirty=!0,this.markDirty(),this._layoutPercentState=t)},enumerable:!0,configurable:!0}),transform2D.prototype.refreshLayout=function(){var e=this.parent;if(e&&(e.width==this.lastParentWidth&&e.height==this.lastParentHeight&&e.pivot.x==this.lastParentPivot.x&&e.pivot.y==this.lastParentPivot.y&&this.pivot.x==this.lastPivot.x&&this.pivot.y==this.lastPivot.y||(this.layoutDirty=!0),this.layoutDirty)){var r=this._layoutState;0!=r&&(r&a.LEFT?(r&a.RIGHT&&(this.width=e.width-this.getLayValue(a.LEFT)-this.getLayValue(a.RIGHT)),this.localTranslate.x=this.getLayValue(a.LEFT)-e.pivot.x*e.width+this.pivot.x*this.width):r&a.RIGHT&&(this.localTranslate.x=e.width-this.width-this.getLayValue(a.RIGHT)-e.pivot.x*e.width+this.pivot.x*this.width),r&a.H_CENTER&&(this.localTranslate.x=(e.width-this.width)/2+this.getLayValue(a.H_CENTER)-e.pivot.x*e.width+this.pivot.x*this.width),r&a.TOP?(r&a.BOTTOM&&(this.height=e.height-this.getLayValue(a.TOP)-this.getLayValue(a.BOTTOM)),this.localTranslate.y=this.getLayValue(a.TOP)-e.pivot.y*e.height+this.pivot.y*this.height):r&a.BOTTOM&&(this.localTranslate.y=e.height-this.height-this.getLayValue(a.BOTTOM)-e.pivot.y*e.height+this.pivot.y*this.height),r&a.V_CENTER&&(this.localTranslate.y=(e.height-this.height)/2+this.getLayValue(a.V_CENTER)-e.pivot.y*e.height+this.pivot.y*this.height),t.math.matrix3x2MakeTransformRTS(this.localTranslate,this.localScale,this.localRotate,this.localMatrix)),this.layoutDirty=!1,this.lastParentWidth=e.width,this.lastParentHeight=e.height,this.lastParentPivot.x=e.pivot.x,this.lastParentPivot.y=e.pivot.y,this.lastPivot.x=this.pivot.x,this.lastPivot.y=this.pivot.y}},transform2D.prototype.getLayValue=function(t){void 0==this.layoutValueMap[t]&&(this.layoutValueMap[t]=0);var e=0;if(this._layoutPercentState&t){if(this.parent)switch(t){case a.LEFT:case a.H_CENTER:case a.RIGHT:e=this.parent.width*this.layoutValueMap[t]/100;break;case a.TOP:case a.V_CENTER:case a.BOTTOM:e=this.parent.height*this.layoutValueMap[t]/100}}else e=this.layoutValueMap[t];return e},transform2D.prototype.clone=function(){return t.io.cloneObj(this)},__decorate([t.reflect.Field("string"),__metadata("design:type",String)],transform2D.prototype,"prefab",void 0),__decorate([t.reflect.Field("number"),t.reflect.UIStyle("enum"),__metadata("design:type",Number)],transform2D.prototype,"layer",void 0),__decorate([t.reflect.Field("string"),__metadata("design:type",String)],transform2D.prototype,"tag",void 0),__decorate([t.reflect.Field("string"),__metadata("design:type",String)],transform2D.prototype,"name",void 0),__decorate([t.reflect.Field("boolean"),__metadata("design:type",Boolean)],transform2D.prototype,"isStatic",void 0),__decorate([t.reflect.Field("transform2D[]"),__metadata("design:type",Array)],transform2D.prototype,"children",void 0),__decorate([t.reflect.Field("number"),__metadata("design:type",Number)],transform2D.prototype,"width",void 0),__decorate([t.reflect.Field("number"),__metadata("design:type",Number)],transform2D.prototype,"height",void 0),__decorate([t.reflect.Field("vector2"),__metadata("design:type",t.math.vector2)],transform2D.prototype,"pivot",void 0),__decorate([t.reflect.Field("vector2"),__metadata("design:type",t.math.vector2)],transform2D.prototype,"localTranslate",void 0),__decorate([t.reflect.Field("vector2"),__metadata("design:type",t.math.vector2)],transform2D.prototype,"localScale",void 0),__decorate([t.reflect.Field("number"),__metadata("design:type",Number)],transform2D.prototype,"localRotate",void 0),__decorate([t.reflect.Field("boolean"),__metadata("design:type",Object),__metadata("design:paramtypes",[Boolean])],transform2D.prototype,"isMask",null),__decorate([t.reflect.Field("C2DComponent[]"),__metadata("design:type",Array)],transform2D.prototype,"components",void 0),__decorate([t.reflect.Field("number"),__metadata("design:type",Number),__metadata("design:paramtypes",[Number])],transform2D.prototype,"layoutState",null),__decorate([t.reflect.Field("numberdic"),__metadata("design:type",Object)],transform2D.prototype,"layoutValueMap",void 0),__decorate([t.reflect.Field("number"),__metadata("design:type",Number),__metadata("design:paramtypes",[Number])],transform2D.prototype,"layoutPercentState",null),transform2D=__decorate([t.reflect.SerializeType],transform2D)}();e.transform2D=i;var o=function(){function t2dInfo(){this.pivot=new t.math.vector2,this.pivotPos=new t.math.vector2}return t2dInfo.getCenter=function(t,e){e.x=t.pivotPos.x+t.width*(.5-t.pivot.x)*Math.cos(t.rot)-t.height*(.5-t.pivot.y)*Math.sin(t.rot),e.y=t.pivotPos.y-t.width*(.5-t.pivot.x)*Math.sin(t.rot)+t.height*(.5-t.pivot.y)*Math.cos(t.rot)},t2dInfo}();e.t2dInfo=o}(t.framework||(t.framework={}))}(gd3d||(gd3d={}));var gd3d;!function(t){!function(t){var e=function(){function behaviour2d(){}return behaviour2d.prototype.start=function(){},behaviour2d.prototype.onPlay=function(){},behaviour2d.prototype.update=function(t){},behaviour2d.prototype.onPointEvent=function(t,e,a){},behaviour2d.prototype.remove=function(){},behaviour2d}();t.behaviour2d=e}(t.framework||(t.framework={}))}(gd3d||(gd3d={}));var gd3d;!function(t){!function(e){var a=function(){function boxcollider2d(){}return boxcollider2d.prototype.getBound=function(){return this._obb},boxcollider2d.prototype.intersectsTransform=function(t){if(null==t)return!1;if(null==this._obb||null==t.collider.getBound())return!1;var e=t.collider.getBound();return this._obb.intersects(e)},boxcollider2d.prototype.build=function(){var t=this.transform;this._obb=new e.obb2d,this._obb.buildByCenterSize(t.getWorldTranslate(),t.width,t.height),this.refreshTofullOver()},boxcollider2d.prototype.refreshTofullOver=function(){if(this._obb&&this._obb.size&&this._obb.offset){var t=this.transform;this._obb.size.x=t.width,this._obb.size.y=t.height,this._obb.offset.x=(.5-t.pivot.x)*this._obb.size.x,this._obb.offset.y=(.5-t.pivot.y)*this._obb.size.y}},boxcollider2d.prototype.start=function(){this.build()},boxcollider2d.prototype.onPlay=function(){},boxcollider2d.prototype.update=function(t){this._obb&&this._obb.update(this.transform.getCanvasWorldMatrix())},boxcollider2d.prototype.onPointEvent=function(t,e,a){},boxcollider2d.prototype.remove=function(){this._obb&&this._obb.dispose(),this._obb=null},boxcollider2d=__decorate([t.reflect.node2DComponent,t.reflect.nodeBoxCollider2d],boxcollider2d)}();e.boxcollider2d=a}(t.framework||(t.framework={}))}(gd3d||(gd3d={}));var gd3d;!function(t){!function(e){var a;!function(t){t[t.None=0]="None",t[t.ColorTint=1]="ColorTint",t[t.SpriteSwap=2]="SpriteSwap"}(a=e.TransitionType||(e.TransitionType={}));var r=function(){function button(){this._transition=a.ColorTint,this._origianlSpriteName="",this._pressedSpriteName="",this._normalColor=new t.math.color(1,1,1,1),this._pressedColor=new t.math.color(.5,.5,.5,1),this._fadeDuration=.1,this.UIEventer=new t.event.UIEvent,this._downInThis=!1,this._dragOut=!1}return Object.defineProperty(button.prototype,"transition",{get:function(){return this._transition},set:function(t){this._transition=t,null!=this._targetImage&&(t==a.ColorTint?this._targetImage.color=this.normalColor:this._targetImage.color=this._originalColor)},enumerable:!0,configurable:!0}),Object.defineProperty(button.prototype,"targetImage",{get:function(){return this._targetImage},set:function(t){null!=this._targetImage&&(this._targetImage.color=this._originalColor),null!=t?(this._originalColor=t.color,this._originalSprite=t.sprite,t.sprite&&(this._origianlSpriteName=t.sprite.getName()),this._transition==a.ColorTint&&(t.color=this.normalColor)):(this._originalColor=null,this._originalSprite=null),this._targetImage=t},enumerable:!0,configurable:!0}),Object.defineProperty(button.prototype,"pressedGraphic",{get:function(){return this._pressedSprite},set:function(t){this._pressedSprite=t,null!=t&&(this._pressedSpriteName=t.getName())},enumerable:!0,configurable:!0}),Object.defineProperty(button.prototype,"normalColor",{get:function(){return this._normalColor},set:function(t){this._normalColor=t,null!=this._targetImage&&this.transition==a.ColorTint&&(this._targetImage.color=t)},enumerable:!0,configurable:!0}),Object.defineProperty(button.prototype,"pressedColor",{get:function(){return this._pressedColor},set:function(t){this._pressedColor=t},enumerable:!0,configurable:!0}),Object.defineProperty(button.prototype,"fadeDuration",{get:function(){return this._fadeDuration},set:function(t){this._fadeDuration=t},enumerable:!0,configurable:!0}),button.prototype.render=function(t){},button.prototype.updateTran=function(){},button.prototype.start=function(){},button.prototype.onPlay=function(){},button.prototype.update=function(t){},button.prototype.remove=function(){this._targetImage=null,this.transform=null,this._normalColor=null,this._originalColor=null,this._pressedColor=null,this.pressedGraphic&&this.pressedGraphic.unuse(!0)},button.prototype.onPointEvent=function(e,a,r){0==r&&(this.transform.ContainsCanvasPoint(new t.math.vector2(a.x,a.y))?(a.eated=!0,a.type==t.event.PointEventEnum.PointDown?(this._downInThis=!0,this.showPress()):a.type==t.event.PointEventEnum.PointHold&&this._downInThis?1==this._dragOut&&(this._dragOut=!1,this.showPress()):a.type==t.event.PointEventEnum.PointUp&&this._downInThis&&(this._downInThis=!1,this.showNormal(),this.UIEventer.EmitEnum(t.event.UIEventEnum.PointerClick))):a.type==t.event.PointEventEnum.PointUp?this._downInThis=!1:a.type==t.event.PointEventEnum.PointHold&&this._downInThis&&0==this._dragOut&&(this._dragOut=!0,this.showNormal()))},button.prototype.addListener=function(t,e,a){this.UIEventer.OnEnum(t,e,a)},button.prototype.removeListener=function(e,a,r){this.UIEventer.RemoveListener(t.event.UIEventEnum[e],a,r)},button.prototype.showNormal=function(){this.transition==a.ColorTint?this.changeColor(this._normalColor):this.transition==a.SpriteSwap&&(this._originalSprite||(this._originalSprite=this.tryGetSprite(this._origianlSpriteName)),this.changeSprite(this._originalSprite))},button.prototype.showPress=function(){this.transition!=a.None&&(this.transition==a.ColorTint?this.changeColor(this._pressedColor):this.transition==a.SpriteSwap&&(null!=this._targetImage&&null!=this._targetImage.sprite&&null==this._originalSprite&&(this._originalSprite=this._targetImage.sprite),this._pressedSprite||(this._pressedSprite=this.tryGetSprite(this._pressedSpriteName)),this.changeSprite(this._pressedSprite)))},button.prototype.tryGetSprite=function(t){if(null!=this.transform.canvas.assetmgr.mapNamed[t]){var e=this.transform.canvas.assetmgr.getAssetByName(t);if(e)return e}},button.prototype.changeColor=function(t){null!=this._targetImage&&(this._targetImage.color=t,this._targetImage.transform.markDirty())},button.prototype.changeSprite=function(t){null!=t&&null!=this._targetImage&&(this._targetImage.sprite=t,this._targetImage.transform.markDirty())},__decorate([t.reflect.Field("number"),__metadata("design:type",Object),__metadata("design:paramtypes",[Number])],button.prototype,"transition",null),__decorate([t.reflect.Field("string"),__metadata("design:type",String)],button.prototype,"_origianlSpriteName",void 0),__decorate([t.reflect.Field("string"),__metadata("design:type",String)],button.prototype,"_pressedSpriteName",void 0),__decorate([t.reflect.Field("reference",null,"image2D"),__metadata("design:type",Object),__metadata("design:paramtypes",[e.image2D])],button.prototype,"targetImage",null),__decorate([t.reflect.Field("color"),t.reflect.UIStyle("color"),__metadata("design:type",Object),__metadata("design:paramtypes",[t.math.color])],button.prototype,"normalColor",null),__decorate([t.reflect.Field("color"),t.reflect.UIStyle("color"),__metadata("design:type",Object),__metadata("design:paramtypes",[t.math.color])],button.prototype,"pressedColor",null),__decorate([t.reflect.Field("number"),__metadata("design:type",Object),__metadata("design:paramtypes",[Number])],button.prototype,"fadeDuration",null),button=__decorate([t.reflect.node2DComponent],button)}();e.button=r}(t.framework||(t.framework={}))}(gd3d||(gd3d={}));var gd3d;!function(t){!function(e){var a=function(){function image2D(){this._unitLen=13,this.datar=[0,0,0,1,1,1,1,0,0,1,1,1,1,0,0,0,1,1,1,1,1,0,1,1,1,1,0,0,0,1,1,1,1,0,1,1,1,1,1,0,0,0,1,1,1,1,0,1,1,1,1,1,0,0,0,1,1,1,1,1,0,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,1,1],this.needRefreshImg=!1,this.color=new t.math.color(1,1,1,1),this._imageType=r.Simple,this._fillMethod=i.Horizontal,this._fillAmmount=1,this._spriteName="",this._imageBorder=new t.math.border,t.io.enumMgr.enumMap.ImageType=r,t.io.enumMgr.enumMap.FillMethod=i}return Object.defineProperty(image2D.prototype,"uimat",{get:function(){if(this._sprite&&this._sprite.texture){var t=this.transform.parentIsMask?"_("+this.transform.insId+")":"",a=this._sprite.texture.getName()+"_uimask"+t,r=this.transform.canvas;if(!r.assetmgr)return;var i=this._uimat;i&&i.getName()==a||(i&&i.unuse(),(i=r.assetmgr.getAssetByName(a))&&i.use()),null==i&&((i=new e.material(a)).setShader(r.assetmgr.getShader("shader/defmaskui")),i.use()),i.setFloat("MaskState",this.transform.parentIsMask?1:0),this._uimat=i}return this._uimat},enumerable:!0,configurable:!0}),Object.defineProperty(image2D.prototype,"imageType",{get:function(){return this._imageType},set:function(t){this._imageType=t,this.prepareData(),null!=this.transform&&this.transform.markDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(image2D.prototype,"fillMethod",{get:function(){return this._fillMethod},set:function(t){this._fillMethod=t,this.prepareData(),null!=this.transform&&this.transform.markDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(image2D.prototype,"fillAmmount",{get:function(){return this._fillAmmount},set:function(t){this._fillAmmount=t,null!=this.transform&&this.transform.markDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(image2D.prototype,"sprite",{get:function(){return this._sprite},set:function(t){t!=this._sprite&&(this.needRefreshImg=!0,this._sprite&&this._sprite.unuse(),this._sprite=t,t?(this._sprite.use(),this._spriteName=this._sprite.getName(),this.prepareData(),null!=this.transform&&(this.transform.markDirty(),this.updateTran())):this._spriteName="")},enumerable:!0,configurable:!0}),Object.defineProperty(image2D.prototype,"imageBorder",{get:function(){return this._imageBorder},enumerable:!0,configurable:!0}),image2D.prototype.render=function(e){if(null==this._sprite){var a=void 0;null!=e.assetmgr.mapNamed[this._spriteName]?a=e.assetmgr.getAssetByName(this._spriteName):e.assetmgr.mapDefaultSprite[this._spriteName]&&(a=e.assetmgr.getDefaultSprite(this._spriteName)),a&&(this.sprite=a,this.needRefreshImg=!0)}var r=this.uimat;if(r){var i=null;if(null!=this._sprite&&null!=this._sprite.texture&&(i=this._sprite.texture),null!=i){if(this.needRefreshImg&&(r.setTexture("_MainTex",i),this.needRefreshImg=!1),this.transform.parentIsMask){null==this._cacheMaskV4&&(this._cacheMaskV4=new t.math.vector4);var o=this.transform.maskRect;this._cacheMaskV4.x==o.x&&this._cacheMaskV4.y==o.y&&this._cacheMaskV4.w==o.w&&this._cacheMaskV4.z==o.h||(this._cacheMaskV4.x=o.x,this._cacheMaskV4.y=o.y,this._cacheMaskV4.z=o.w,this._cacheMaskV4.w=o.h,r.setVector4("_maskRect",this._cacheMaskV4))}e.pushRawData(r,this.datar)}}},image2D.prototype.start=function(){},image2D.prototype.onPlay=function(){},image2D.prototype.update=function(t){},image2D.prototype.remove=function(){this._sprite&&this._sprite.unuse(!0),this._uimat&&this._uimat.unuse(!0),this.datar.length=0,this.transform=null,this._imageBorder=null},image2D.prototype.onPointEvent=function(t,e,a){},image2D.prototype.prepareData=function(){if(null!=this._sprite){var t=this._sprite.urange,e=this._sprite.vrange,a=t.y-t.x,o=e.y-e.x;switch(this._imageType){case r.Simple:this.datar=[0,0,0,1,1,1,1,t.x,e.x,1,1,1,1,0,0,0,1,1,1,1,t.y,e.x,1,1,1,1,0,0,0,1,1,1,1,t.x,e.y,1,1,1,1,0,0,0,1,1,1,1,t.x,e.y,1,1,1,1,0,0,0,1,1,1,1,t.y,e.x,1,1,1,1,0,0,0,1,1,1,1,t.y,e.y,1,1,1,1];break;case r.Sliced:this.datar=[0,0,0,1,1,1,1,t.x,e.x,1,1,1,1,0,0,0,1,1,1,1,t.y,e.x,1,1,1,1,0,0,0,1,1,1,1,t.x,e.y,1,1,1,1,0,0,0,1,1,1,1,t.x,e.y,1,1,1,1,0,0,0,1,1,1,1,t.y,e.x,1,1,1,1,0,0,0,1,1,1,1,t.y,e.y,1,1,1,1,0,0,0,1,1,1,1,t.x,e.x,1,1,1,1,0,0,0,1,1,1,1,t.y,e.x,1,1,1,1,0,0,0,1,1,1,1,t.x,e.y,1,1,1,1,0,0,0,1,1,1,1,t.x,e.y,1,1,1,1,0,0,0,1,1,1,1,t.y,e.x,1,1,1,1,0,0,0,1,1,1,1,t.y,e.y,1,1,1,1,0,0,0,1,1,1,1,t.x,e.x,1,1,1,1,0,0,0,1,1,1,1,t.y,e.x,1,1,1,1,0,0,0,1,1,1,1,t.x,e.y,1,1,1,1,0,0,0,1,1,1,1,t.x,e.y,1,1,1,1,0,0,0,1,1,1,1,t.y,e.x,1,1,1,1,0,0,0,1,1,1,1,t.y,e.y,1,1,1,1,0,0,0,1,1,1,1,t.x,e.x,1,1,1,1,0,0,0,1,1,1,1,t.y,e.x,1,1,1,1,0,0,0,1,1,1,1,t.x,e.y,1,1,1,1,0,0,0,1,1,1,1,t.x,e.y,1,1,1,1,0,0,0,1,1,1,1,t.y,e.x,1,1,1,1,0,0,0,1,1,1,1,t.y,e.y,1,1,1,1,0,0,0,1,1,1,1,t.x,e.x,1,1,1,1,0,0,0,1,1,1,1,t.y,e.x,1,1,1,1,0,0,0,1,1,1,1,t.x,e.y,1,1,1,1,0,0,0,1,1,1,1,t.x,e.y,1,1,1,1,0,0,0,1,1,1,1,t.y,e.x,1,1,1,1,0,0,0,1,1,1,1,t.y,e.y,1,1,1,1,0,0,0,1,1,1,1,t.x,e.x,1,1,1,1,0,0,0,1,1,1,1,t.y,e.x,1,1,1,1,0,0,0,1,1,1,1,t.x,e.y,1,1,1,1,0,0,0,1,1,1,1,t.x,e.y,1,1,1,1,0,0,0,1,1,1,1,t.y,e.x,1,1,1,1,0,0,0,1,1,1,1,t.y,e.y,1,1,1,1,0,0,0,1,1,1,1,t.x,e.x,1,1,1,1,0,0,0,1,1,1,1,t.y,e.x,1,1,1,1,0,0,0,1,1,1,1,t.x,e.y,1,1,1,1,0,0,0,1,1,1,1,t.x,e.y,1,1,1,1,0,0,0,1,1,1,1,t.y,e.x,1,1,1,1,0,0,0,1,1,1,1,t.y,e.y,1,1,1,1,0,0,0,1,1,1,1,t.x,e.x,1,1,1,1,0,0,0,1,1,1,1,t.y,e.x,1,1,1,1,0,0,0,1,1,1,1,t.x,e.y,1,1,1,1,0,0,0,1,1,1,1,t.x,e.y,1,1,1,1,0,0,0,1,1,1,1,t.y,e.x,1,1,1,1,0,0,0,1,1,1,1,t.y,e.y,1,1,1,1,0,0,0,1,1,1,1,t.x,e.x,1,1,1,1,0,0,0,1,1,1,1,t.y,e.x,1,1,1,1,0,0,0,1,1,1,1,t.x,e.y,1,1,1,1,0,0,0,1,1,1,1,t.x,e.y,1,1,1,1,0,0,0,1,1,1,1,t.y,e.x,1,1,1,1,0,0,0,1,1,1,1,t.y,e.y,1,1,1,1];break;case r.Tiled:this.datar=[];break;case r.Filled:var n=t.x+.5*a,s=e.x+.5*o;switch(this._fillMethod){case i.Horizontal:case i.Vertical:case i.Radial_90:this.datar=[0,0,0,1,1,1,1,t.x,e.x,1,1,1,1,0,0,0,1,1,1,1,t.y,e.x,1,1,1,1,0,0,0,1,1,1,1,t.x,e.y,1,1,1,1,0,0,0,1,1,1,1,t.x,e.y,1,1,1,1,0,0,0,1,1,1,1,t.y,e.x,1,1,1,1,0,0,0,1,1,1,1,t.y,e.y,1,1,1,1];break;case i.Radial_180:this.datar=[0,0,0,1,1,1,1,t.x,e.x,1,1,1,1,0,0,0,1,1,1,1,n,e.x,1,1,1,1,0,0,0,1,1,1,1,n,e.y,1,1,1,1,0,0,0,1,1,1,1,t.x,e.x,1,1,1,1,0,0,0,1,1,1,1,n,e.y,1,1,1,1,0,0,0,1,1,1,1,t.x,e.y,1,1,1,1,0,0,0,1,1,1,1,n,e.x,1,1,1,1,0,0,0,1,1,1,1,t.y,e.x,1,1,1,1,0,0,0,1,1,1,1,n,e.y,1,1,1,1,0,0,0,1,1,1,1,n,e.y,1,1,1,1,0,0,0,1,1,1,1,t.y,e.x,1,1,1,1,0,0,0,1,1,1,1,t.y,e.y,1,1,1,1];break;case i.Radial_360:this.datar=[0,0,0,1,1,1,1,t.x,e.x,1,1,1,1,0,0,0,1,1,1,1,n,e.x,1,1,1,1,0,0,0,1,1,1,1,n,s,1,1,1,1,0,0,0,1,1,1,1,t.x,e.x,1,1,1,1,0,0,0,1,1,1,1,n,s,1,1,1,1,0,0,0,1,1,1,1,t.x,s,1,1,1,1,0,0,0,1,1,1,1,n,e.x,1,1,1,1,0,0,0,1,1,1,1,t.y,e.x,1,1,1,1,0,0,0,1,1,1,1,n,s,1,1,1,1,0,0,0,1,1,1,1,n,s,1,1,1,1,0,0,0,1,1,1,1,t.y,e.x,1,1,1,1,0,0,0,1,1,1,1,t.y,s,1,1,1,1,0,0,0,1,1,1,1,t.x,s,1,1,1,1,0,0,0,1,1,1,1,n,s,1,1,1,1,0,0,0,1,1,1,1,t.x,e.y,1,1,1,1,0,0,0,1,1,1,1,t.x,e.y,1,1,1,1,0,0,0,1,1,1,1,n,s,1,1,1,1,0,0,0,1,1,1,1,n,e.y,1,1,1,1,0,0,0,1,1,1,1,n,s,1,1,1,1,0,0,0,1,1,1,1,t.y,s,1,1,1,1,0,0,0,1,1,1,1,t.y,e.y,1,1,1,1,0,0,0,1,1,1,1,n,s,1,1,1,1,0,0,0,1,1,1,1,t.y,e.y,1,1,1,1,0,0,0,1,1,1,1,n,e.y,1,1,1,1]}}}},image2D.prototype.updateTran=function(){var t=this.transform.getWorldMatrix(),e=-this.transform.pivot.x*this.transform.width,a=this.transform.width+e,i=-this.transform.pivot.y*this.transform.height,o=this.transform.height+i,n=e*t.rawData[0]+i*t.rawData[2]+t.rawData[4],s=e*t.rawData[1]+i*t.rawData[3]+t.rawData[5],l=a*t.rawData[0]+i*t.rawData[2]+t.rawData[4],h=a*t.rawData[1]+i*t.rawData[3]+t.rawData[5],c=e*t.rawData[0]+o*t.rawData[2]+t.rawData[4],u=e*t.rawData[1]+o*t.rawData[3]+t.rawData[5],d=a*t.rawData[0]+o*t.rawData[2]+t.rawData[4],m=a*t.rawData[1]+o*t.rawData[3]+t.rawData[5];if(null!=this._sprite){switch(this._imageType){case r.Simple:this.updateSimpleData(n,s,l,h,c,u,d,m);break;case r.Sliced:this.updateSlicedData(n,s,l,h,c,u,d,m);break;case r.Tiled:this.updateTiledData(n,s,l,h,c,u,d,m);break;case r.Filled:this.updateFilledData(n,s,l,h,c,u,d,m)}for(var p=this.datar.length/this._unitLen,f=0;f<p;f++)this.datar[f*this._unitLen+3]=this.color.r,this.datar[f*this._unitLen+4]=this.color.g,this.datar[f*this._unitLen+5]=this.color.b,this.datar[f*this._unitLen+6]=this.color.a}},image2D.prototype.updateQuadData=function(t,e,a,r,i,o,n,s,l,h){void 0===l&&(l=0),void 0===h&&(h=!1);var c=6*l;h?(this.datar[(c+0)*this._unitLen]=t,this.datar[(c+0)*this._unitLen+1]=e,this.datar[(c+1)*this._unitLen]=a,this.datar[(c+1)*this._unitLen+1]=r,this.datar[(c+2)*this._unitLen]=n,this.datar[(c+2)*this._unitLen+1]=s,this.datar[(c+3)*this._unitLen]=t,this.datar[(c+3)*this._unitLen+1]=e,this.datar[(c+4)*this._unitLen]=n,this.datar[(c+4)*this._unitLen+1]=s,this.datar[(c+5)*this._unitLen]=i,this.datar[(c+5)*this._unitLen+1]=o):(this.datar[(c+0)*this._unitLen]=t,this.datar[(c+0)*this._unitLen+1]=e,this.datar[(c+1)*this._unitLen]=a,this.datar[(c+1)*this._unitLen+1]=r,this.datar[(c+2)*this._unitLen]=i,this.datar[(c+2)*this._unitLen+1]=o,this.datar[(c+3)*this._unitLen]=i,this.datar[(c+3)*this._unitLen+1]=o,this.datar[(c+4)*this._unitLen]=a,this.datar[(c+4)*this._unitLen+1]=r,this.datar[(c+5)*this._unitLen]=n,this.datar[(c+5)*this._unitLen+1]=s)},image2D.prototype.updateSimpleData=function(t,e,a,r,i,o,n,s){this.updateQuadData(t,e,a,r,i,o,n,s)},image2D.prototype.updateSlicedData=function(e,a,r,i,o,n,s,l){var h=this._imageBorder,c=this._sprite.rect,u=t.math.pool.new_vector2(),d=t.math.pool.new_vector2(),m=t.math.pool.new_vector2(),p=t.math.pool.new_vector2(),f=t.math.pool.new_vector2(),g=t.math.pool.new_vector2(),v=t.math.pool.new_vector2(),y=t.math.pool.new_vector2(),_=t.math.pool.new_vector2(),b=t.math.pool.new_vector2(),w=t.math.pool.new_vector2(),x=t.math.pool.new_vector2(),D=t.math.pool.new_vector2(),E=t.math.pool.new_vector2(),T=t.math.pool.new_vector2(),M=t.math.pool.new_vector2(),A=t.math.pool.new_vector2(),S=t.math.pool.new_vector2(),C=t.math.pool.new_vector2(),F=t.math.pool.new_vector2(),R=t.math.pool.new_vector2(),k=t.math.pool.new_vector2(),P=t.math.pool.new_vector2(),B=t.math.pool.new_vector2(),I=t.math.pool.new_vector2(),N=t.math.pool.new_vector2(),O=t.math.pool.new_vector2(),L=t.math.pool.new_vector2(),V=t.math.pool.new_vector2(),U=t.math.pool.new_vector2(),z=t.math.pool.new_vector2(),j=t.math.pool.new_vector2(),W=t.math.pool.new_vector2(),q=t.math.pool.new_vector2(),G=t.math.pool.new_vector2();u.x=e,u.y=a,d.x=r,d.y=i,m.x=o,m.y=n,p.x=s,p.y=l;t.math.vec2Distance(u,d),t.math.vec2Distance(u,m);var J=this._sprite.urange,H=this._sprite.vrange,X=h.l/this.transform.width,Q=h.r/this.transform.width,K=h.t/this.transform.height,Y=h.b/this.transform.height,Z=h.l/c.w*(J.y-J.x),$=h.r/c.w*(J.y-J.x),tt=h.t/c.h*(H.y-H.x),et=h.b/c.h*(H.y-H.x);t.math.vec2Subtract(d,u,f),t.math.vec2ScaleByNum(f,X,f),t.math.vec2Add(f,u,f),t.math.vec2Subtract(u,d,g),t.math.vec2ScaleByNum(g,Q,g),t.math.vec2Add(g,d,g),t.math.vec2Subtract(m,u,v),t.math.vec2ScaleByNum(v,K,v),t.math.vec2Add(v,u,v),t.math.vec2Subtract(u,m,y),t.math.vec2ScaleByNum(y,Y,y),t.math.vec2Add(y,m,y),t.math.vec2Subtract(f,u,W),t.math.vec2Subtract(v,u,q),t.math.vec2Add(W,q,G),t.math.vec2Add(G,u,_),t.math.vec2Subtract(g,u,W),t.math.vec2Subtract(v,u,q),t.math.vec2Add(W,q,G),t.math.vec2Add(G,u,b),t.math.vec2Subtract(d,u,W),t.math.vec2Subtract(v,u,q),t.math.vec2Add(W,q,G),t.math.vec2Add(G,u,w),t.math.vec2Subtract(f,u,W),t.math.vec2Subtract(y,u,q),t.math.vec2Add(W,q,G),t.math.vec2Add(G,u,x),t.math.vec2Subtract(g,u,W),t.math.vec2Subtract(y,u,q),t.math.vec2Add(W,q,G),t.math.vec2Add(G,u,D),t.math.vec2Subtract(d,u,W),t.math.vec2Subtract(y,u,q),t.math.vec2Add(W,q,G),t.math.vec2Add(G,u,E),t.math.vec2Subtract(f,u,W),t.math.vec2Subtract(m,u,q),t.math.vec2Add(W,q,G),t.math.vec2Add(G,u,T),t.math.vec2Subtract(g,u,W),t.math.vec2Subtract(m,u,q),t.math.vec2Add(W,q,G),t.math.vec2Add(G,u,M),A.x=J.x,A.y=H.x,R.x=Z+J.x,R.y=H.x,k.x=J.y-$,k.y=H.x,S.x=J.y,S.y=H.x,P.x=J.x,P.y=tt+H.x,I.x=Z+J.x,I.y=tt+H.x,N.x=J.y-$,N.y=tt+H.x,O.x=J.y,O.y=tt+H.x,B.x=J.x,B.y=H.y-et,L.x=Z+J.x,L.y=H.y-et,V.x=J.y-$,V.y=H.y-et,U.x=J.y,U.y=H.y-et,C.x=J.x,C.y=H.y,z.x=Z+J.x,z.y=H.y,j.x=J.y-$,j.y=H.y,F.x=J.y,F.y=H.y;for(var at,rt,it=[u,f,g,d,v,_,b,w,y,x,D,E,m,T,M,p],ot=[A,R,k,S,P,I,N,O,B,L,V,U,C,z,j,F],nt=0;nt<9;nt++){var st=Math.floor(nt/3),lt=nt%3;at=[it[0+lt+4*st],it[1+lt+4*st],it[4+lt+4*st],it[5+lt+4*st]],rt=[ot[0+lt+4*st],ot[1+lt+4*st],ot[4+lt+4*st],ot[5+lt+4*st]],this.updateQuadData(at[0].x,at[0].y,at[1].x,at[1].y,at[2].x,at[2].y,at[3].x,at[3].y,nt),this.datar[(0+6*nt)*this._unitLen+7]=rt[0].x,this.datar[(0+6*nt)*this._unitLen+8]=rt[0].y,this.datar[(1+6*nt)*this._unitLen+7]=rt[1].x,this.datar[(1+6*nt)*this._unitLen+8]=rt[1].y,this.datar[(2+6*nt)*this._unitLen+7]=rt[2].x,this.datar[(2+6*nt)*this._unitLen+8]=rt[2].y,this.datar[(3+6*nt)*this._unitLen+7]=rt[2].x,this.datar[(3+6*nt)*this._unitLen+8]=rt[2].y,this.datar[(4+6*nt)*this._unitLen+7]=rt[1].x,this.datar[(4+6*nt)*this._unitLen+8]=rt[1].y,this.datar[(5+6*nt)*this._unitLen+7]=rt[3].x,this.datar[(5+6*nt)*this._unitLen+8]=rt[3].y,at.length=0,rt.length=0}t.math.pool.delete_vector2Array(it),t.math.pool.delete_vector2Array(ot),t.math.pool.delete_vector2Array([W,q,G])},image2D.prototype.updateFilledData=function(t,e,a,r,o,n,s,l){var h=this._sprite.urange,c=this._sprite.vrange,u=h.y-h.x,d=c.y-c.x,m=h.x+.5*u,p=c.x+.5*d;switch(this._fillMethod){case i.Horizontal:case i.Vertical:case i.Radial_90:this._fillMethod==i.Horizontal?(a-=(1-this.fillAmmount)*(a-t),r-=(1-this.fillAmmount)*(r-e),s-=(1-this.fillAmmount)*(s-o),l-=(1-this.fillAmmount)*(l-n),this.datar[1*this._unitLen+7]=h.x+this.fillAmmount*u,this.datar[4*this._unitLen+7]=h.x+this.fillAmmount*u,this.datar[5*this._unitLen+7]=h.x+this.fillAmmount*u):this._fillMethod==i.Vertical?(t-=(1-this.fillAmmount)*(t-o),e-=(1-this.fillAmmount)*(e-n),a-=(1-this.fillAmmount)*(a-s),r-=(1-this.fillAmmount)*(r-l),this.datar[0*this._unitLen+8]=c.y-this.fillAmmount*d,this.datar[1*this._unitLen+8]=c.y-this.fillAmmount*d,this.datar[4*this._unitLen+8]=c.y-this.fillAmmount*d):this._fillMethod==i.Radial_90&&(this.fillAmmount>=.5?(t-=(R=2*(1-this.fillAmmount))*(t-a),e-=R*(e-r),this.datar[0*this._unitLen+7]=h.x+R*u,this.datar[1*this._unitLen+8]=c.x,this.datar[4*this._unitLen+8]=c.x):(t=a-=(R=2*(.5-this.fillAmmount))*(a-s),e=r-=R*(r-l),this.datar[0*this._unitLen+8]=c.x+R*d,this.datar[1*this._unitLen+8]=c.x+R*d,this.datar[4*this._unitLen+8]=c.x+R*d)),this.updateQuadData(t,e,a,r,o,n,s,l);break;case i.Radial_180:var f=(t+a)/2,g=(e+r)/2,v=(o+s)/2,y=(n+l)/2;this.fillAmmount>=.75?(o-=(R=4*(1-this.fillAmmount))*(o-t),n-=R*(n-e),this.datar[5*this._unitLen+8]=c.y-R*d,this.datar[0*this._unitLen+7]=h.x,this.datar[3*this._unitLen+7]=h.x,this.datar[6*this._unitLen+7]=m,this.datar[7*this._unitLen+8]=c.x,this.datar[10*this._unitLen+8]=c.x):this.fillAmmount>=.5?(o=t-=(R=4*(.75-this.fillAmmount))*(t-f),n=e-=R*(e-g),this.datar[0*this._unitLen+7]=h.x+.5*u*R,this.datar[3*this._unitLen+7]=h.x+.5*u*R,this.datar[6*this._unitLen+7]=m,this.datar[7*this._unitLen+8]=c.x,this.datar[10*this._unitLen+8]=c.x):this.fillAmmount>=.25?(o=t=f-=(R=4*(.5-this.fillAmmount))*(f-a),n=e=g-=R*(g-r),this.datar[6*this._unitLen+7]=m+.5*u*R,this.datar[7*this._unitLen+8]=c.x,this.datar[10*this._unitLen+8]=c.x):(o=t=f=a-=(R=4*(.25-this.fillAmmount))*(a-s),n=e=g=r-=R*(r-l),this.datar[7*this._unitLen+8]=c.x+R*d,this.datar[10*this._unitLen+8]=c.x+R*d),this.updateQuadData(t,e,f,g,o,n,v,y,0,!0),this.updateQuadData(f,g,a,r,v,y,s,l,1);break;case i.Radial_360:var _=(t+a)/2,b=(e+r)/2,w=(t+o)/2,x=(e+n)/2,D=(o+s)/2,E=(n+l)/2,T=(a+s)/2,M=(r+l)/2,A=(w+T)/2,S=(x+M)/2,C=D,F=E;if(this.fillAmmount>=.875)D-=(R=8*(1-this.fillAmmount))*(D-o),E-=R*(E-n),this.datar[17*this._unitLen+7]=m-.5*R*u,this.datar[14*this._unitLen+8]=c.y,this.datar[15*this._unitLen+8]=c.y,this.datar[5*this._unitLen+8]=p,this.datar[0*this._unitLen+7]=h.x,this.datar[3*this._unitLen+7]=h.x,this.datar[6*this._unitLen+7]=m,this.datar[7*this._unitLen+8]=c.x,this.datar[10*this._unitLen+8]=c.x,this.datar[19*this._unitLen+8]=p,this.datar[20*this._unitLen+7]=h.y,this.datar[22*this._unitLen+7]=h.y;else if(this.fillAmmount>=.75)D=o-=(R=8*(.875-this.fillAmmount))*(o-w),E=n-=R*(n-x),this.datar[14*this._unitLen+8]=c.y-.5*R*d,this.datar[15*this._unitLen+8]=c.y-.5*R*d,this.datar[5*this._unitLen+8]=p,this.datar[0*this._unitLen+7]=h.x,this.datar[3*this._unitLen+7]=h.x,this.datar[6*this._unitLen+7]=m,this.datar[7*this._unitLen+8]=c.x,this.datar[10*this._unitLen+8]=c.x,this.datar[19*this._unitLen+8]=p,this.datar[20*this._unitLen+7]=h.y,this.datar[22*this._unitLen+7]=h.y;else if(this.fillAmmount>=.625)D=o=w-=(R=8*(.75-this.fillAmmount))*(w-t),E=n=x-=R*(x-e),this.datar[5*this._unitLen+8]=p-.5*R*d,this.datar[0*this._unitLen+7]=h.x,this.datar[3*this._unitLen+7]=h.x,this.datar[6*this._unitLen+7]=m,this.datar[7*this._unitLen+8]=c.x,this.datar[10*this._unitLen+8]=c.x,this.datar[19*this._unitLen+8]=p,this.datar[20*this._unitLen+7]=h.y,this.datar[22*this._unitLen+7]=h.y;else if(this.fillAmmount>=.5)D=o=w=t-=(R=8*(.625-this.fillAmmount))*(t-_),E=n=x=e-=R*(e-b),this.datar[0*this._unitLen+7]=h.x+.5*R*u,this.datar[3*this._unitLen+7]=h.x+.5*R*u,this.datar[6*this._unitLen+7]=m,this.datar[7*this._unitLen+8]=c.x,this.datar[10*this._unitLen+8]=c.x,this.datar[19*this._unitLen+8]=p,this.datar[20*this._unitLen+7]=h.y,this.datar[22*this._unitLen+7]=h.y;else if(this.fillAmmount>=.375)D=o=w=t=_-=(R=8*(.5-this.fillAmmount))*(_-a),E=n=x=e=b-=R*(b-r),this.datar[6*this._unitLen+7]=m+.5*R*u,this.datar[7*this._unitLen+8]=c.x,this.datar[10*this._unitLen+8]=c.x,this.datar[19*this._unitLen+8]=p,this.datar[20*this._unitLen+7]=h.y,this.datar[22*this._unitLen+7]=h.y;else if(this.fillAmmount>=.25)D=o=w=t=_=a-=(R=8*(.375-this.fillAmmount))*(a-T),E=n=x=e=b=r-=R*(r-M),this.datar[7*this._unitLen+8]=c.x+.5*R*d,this.datar[10*this._unitLen+8]=c.x+.5*R*d,this.datar[19*this._unitLen+8]=p,this.datar[20*this._unitLen+7]=h.y,this.datar[22*this._unitLen+7]=h.y;else if(this.fillAmmount>=.125)D=o=w=t=_=a=T-=(R=8*(.25-this.fillAmmount))*(T-s),E=n=x=e=b=r=M-=R*(M-l),this.datar[19*this._unitLen+8]=p+.5*R*d,this.datar[20*this._unitLen+7]=h.y,this.datar[22*this._unitLen+7]=h.y;else{var R=8*(.125-this.fillAmmount);D=o=w=t=_=a=T=s-=R*(s-D),E=n=x=e=b=r=M=l-=R*(l-E),this.datar[20*this._unitLen+7]=h.y-.5*R*u,this.datar[22*this._unitLen+7]=h.y-.5*R*u}this.updateQuadData(t,e,_,b,w,x,A,S,0,!0),this.updateQuadData(_,b,a,r,A,S,T,M,1),this.updateQuadData(w,x,A,S,o,n,D,E,2),this.updateQuadData(A,S,T,M,C,F,s,l,3,!0)}},image2D.prototype.updateTiledData=function(t,e,a,r,i,o,n,s){for(var l=this._sprite.rect,h=(this._imageBorder,this._sprite.urange),c=this._sprite.vrange,u=h.y-h.x,d=c.y-c.x,m=a-t,p=o-e,f=this.transform.width/l.w,g=this.transform.height/l.h,v=1/f,y=1/g,_=0,b=0;b<g-1;b++)for(R=0;R<f-1;R++){B=[0,0,0,1,1,1,1,h.x,c.x,1,1,1,1,0,0,0,1,1,1,1,h.y,c.x,1,1,1,1,0,0,0,1,1,1,1,h.x,c.y,1,1,1,1,0,0,0,1,1,1,1,h.x,c.y,1,1,1,1,0,0,0,1,1,1,1,h.y,c.x,1,1,1,1,0,0,0,1,1,1,1,h.y,c.y,1,1,1,1];this.datar=this.datar.concat(B);var w=t+v*m*R,x=e+y*p*b,D=t+v*m*(R+1),E=e+y*p*b,T=t+v*m*R,M=e+y*p*(b+1),A=t+v*m*(R+1),S=e+y*p*(b+1);this.updateQuadData(w,x,D,E,T,M,A,S,_),_++}for(var C=Math.ceil(g)-1,F=g-Math.ceil(g)+1,R=0;R<f-1;R++){B=[0,0,0,1,1,1,1,h.x,c.x,1,1,1,1,0,0,0,1,1,1,1,h.y,c.x,1,1,1,1,0,0,0,1,1,1,1,h.x,c.x+F*d,1,1,1,1,0,0,0,1,1,1,1,h.x,c.x+F*d,1,1,1,1,0,0,0,1,1,1,1,h.y,c.x,1,1,1,1,0,0,0,1,1,1,1,h.y,c.x+F*d,1,1,1,1];this.datar=this.datar.concat(B);var w=t+v*m*R,x=e+y*p*C,D=t+v*m*(R+1),E=e+y*p*C,T=t+v*m*R,M=e+y*p*(C+F),A=t+v*m*(R+1),S=e+y*p*(C+F);this.updateQuadData(w,x,D,E,T,M,A,S,_),_++}for(var k=Math.ceil(f)-1,P=f-Math.ceil(f)+1,b=0;b<g-1;b++){B=[0,0,0,1,1,1,1,h.x,c.x,1,1,1,1,0,0,0,1,1,1,1,h.x+P*u,c.x,1,1,1,1,0,0,0,1,1,1,1,h.x,c.y,1,1,1,1,0,0,0,1,1,1,1,h.x,c.y,1,1,1,1,0,0,0,1,1,1,1,h.x+P*u,c.x,1,1,1,1,0,0,0,1,1,1,1,h.x+P*u,c.y,1,1,1,1];this.datar=this.datar.concat(B);var w=t+v*m*k,x=e+y*p*b,D=t+v*m*(k+P),E=e+y*p*b,T=t+v*m*k,M=e+y*p*(b+1),A=t+v*m*(k+P),S=e+y*p*(b+1);this.updateQuadData(w,x,D,E,T,M,A,S,_),_++}var B=[0,0,0,1,1,1,1,h.x,c.x,1,1,1,1,0,0,0,1,1,1,1,h.x+P*u,c.x,1,1,1,1,0,0,0,1,1,1,1,h.x,c.x+F*d,1,1,1,1,0,0,0,1,1,1,1,h.x,c.x+F*d,1,1,1,1,0,0,0,1,1,1,1,h.x+P*u,c.x,1,1,1,1,0,0,0,1,1,1,1,h.x+P*u,c.x+F*d,1,1,1,1];this.datar=this.datar.concat(B);var w=t+v*m*k,x=e+y*p*C,D=t+v*m*(k+P),E=e+y*p*C,T=t+v*m*k,M=e+y*p*(C+F),A=t+v*m*(k+P),S=e+y*p*(C+F);this.updateQuadData(w,x,D,E,T,M,A,S,_),_++},__decorate([t.reflect.Field("color"),t.reflect.UIStyle("color"),__metadata("design:type",t.math.color)],image2D.prototype,"color",void 0),__decorate([t.reflect.Field("number"),t.reflect.UIStyle("enum"),__metadata("design:type",Object),__metadata("design:paramtypes",[Number])],image2D.prototype,"imageType",null),__decorate([t.reflect.Field("number"),t.reflect.UIStyle("enum"),__metadata("design:type",Object),__metadata("design:paramtypes",[Number])],image2D.prototype,"fillMethod",null),__decorate([t.reflect.Field("number"),__metadata("design:type",Object),__metadata("design:paramtypes",[Number])],image2D.prototype,"fillAmmount",null),__decorate([t.reflect.Field("string"),__metadata("design:type",String)],image2D.prototype,"_spriteName",void 0),__decorate([t.reflect.Field("border"),__metadata("design:type",Object)],image2D.prototype,"_imageBorder",void 0),image2D=__decorate([t.reflect.node2DComponent,t.reflect.nodeRender,__metadata("design:paramtypes",[])],image2D)}();e.image2D=a;var r;!function(t){t[t.Simple=0]="Simple",t[t.Sliced=1]="Sliced",t[t.Tiled=2]="Tiled",t[t.Filled=3]="Filled"}(r=e.ImageType||(e.ImageType={}));var i;!function(t){t[t.Horizontal=0]="Horizontal",t[t.Vertical=1]="Vertical",t[t.Radial_90=2]="Radial_90",t[t.Radial_180=3]="Radial_180",t[t.Radial_360=4]="Radial_360"}(i=e.FillMethod||(e.FillMethod={}))}(t.framework||(t.framework={}))}(gd3d||(gd3d={}));var gd3d;!function(t){!function(e){var a=function(){function inputField(){this.customRegexStr="",this.beFocus=!1,this._text="",this._charlimit=0,this._lineType=r.SingleLine,this._contentType=i.None}return Object.defineProperty(inputField.prototype,"frameImage",{get:function(){return this._frameImage},set:function(t){this._frameImage=t},enumerable:!0,configurable:!0}),Object.defineProperty(inputField.prototype,"text",{get:function(){return this._text},enumerable:!0,configurable:!0}),Object.defineProperty(inputField.prototype,"characterLimit",{get:function(){return this._charlimit},set:function(t){this._charlimit=parseInt(""+t),this._charlimit=isNaN(this._charlimit)||this._charlimit<0?0:this._charlimit},enumerable:!0,configurable:!0}),Object.defineProperty(inputField.prototype,"LineType",{get:function(){return this._lineType},set:function(t){this._lineType=t},enumerable:!0,configurable:!0}),Object.defineProperty(inputField.prototype,"ContentType",{get:function(){return this._contentType},set:function(t){this._contentType=t},enumerable:!0,configurable:!0}),Object.defineProperty(inputField.prototype,"TextLabel",{get:function(){return this._textLable},set:function(t){t.text=this._text,this._textLable=t},enumerable:!0,configurable:!0}),Object.defineProperty(inputField.prototype,"PlaceholderLabel",{get:function(){return this._placeholderLabel},set:function(t){null!=t.text&&""!=t.text||(t.text="Enter Text..."),this._placeholderLabel=t},enumerable:!0,configurable:!0}),inputField.prototype.updateData=function(t){},inputField.prototype.render=function(t){},inputField.prototype.updateTran=function(){this.inputElmLayout(),this._placeholderLabel&&(this._placeholderLabel.transform.width!=this.transform.width&&(this._placeholderLabel.transform.width=this.transform.width),this._placeholderLabel.transform.height!=this.transform.height&&(this._placeholderLabel.transform.height=this.transform.height)),this._textLable&&(this._textLable.transform.width!=this.transform.width&&(this._textLable.transform.width=this.transform.width),this._textLable.transform.height!=this.transform.height&&(this._textLable.transform.height=this.transform.height))},inputField.prototype.start=function(){var t=this;if(this.inputElement=document.createElement("Input"),this.inputElement.style.opacity="0",this.inputElement.style.visibility="hidden",this.transform.canvas.scene){var e=this.transform.canvas.scene.webgl.canvas;e&&e.parentElement.appendChild(this.inputElement)}this.inputElement.onblur=function(e){t.beFocus=!1},this.inputElement.onfocus=function(e){t.beFocus=!0},this.inputElmLayout()},inputField.prototype.onPlay=function(){},inputField.prototype.inputElmLayout=function(){if(null!=this.inputElement){var t=this.transform.getWorldTranslate();this.transform.localTranslate;var e=this.inputElement.style;if(t.x+"px"!=e.left||t.y+"px"!=e.top||this.transform.width+"px"!=e.width||this.transform.height+"px"!=e.height){var a=this.transform.canvas.scene.app.canvasClientHeight/this.transform.canvas.pixelHeight;e.position="absolute",e.left=t.x*a+"px",e.top=t.y*a+"px",e.width=this.transform.width*a+"px",e.height=this.transform.height*a+"px"}}},inputField.prototype.textRefresh=function(){this.beFocus&&this._textLable&&this._placeholderLabel&&this.inputElement&&this._text!=this.inputElement.value&&(this._charlimit>0&&this.inputElement.value.length>=this._charlimit?this.inputElement.value!=this._text&&(this.inputElement.value.length>this._text.length?this.inputElement.value=this._text:this._text=this.inputElement.value):(this._text=this.inputElement.value,this._contentType==i.Custom?null!=this.customRegexStr&&""!=this.customRegexStr&&(this._text=this._text.replace(this.customRegexStr,"")):this._contentType==i.None||(this._contentType&i.Number&&this._contentType&i.Word&&this._contentType&i.ChineseCharacter&&this._contentType&i.Underline?this._text=this._text.replace(/^[\u4E00-\u9FA5a-zA-Z0-9_]{3,20}$/gi,""):this._contentType&i.Number&&this._contentType&i.Word&&this._contentType&i.Underline?this._text=this._text.replace(/[^\w\.\/]/gi,""):this._contentType&i.Number&&this._contentType&i.Word?this._text=this._text.replace(/[^(A-Za-z0-9)]/gi,""):this._contentType&i.ChineseCharacter&&this._contentType&i.Word?this._text=this._text.replace(/[^(A-Za-z\u4E00-\u9FA5)]/gi,""):this._contentType==i.Number?this._text=this._text.replace(/\D+/g,""):this._contentType==i.ChineseCharacter&&(this._text=this._text.replace(/[^\u4E00-\u9FA5]/g,""))),this.inputElement.value=this._text,this._textLable&&(this._textLable.text=this._text,this.filterContentText()),""==this._text?(this._placeholderLabel.transform.visible=!0,this._textLable.transform.visible=!1):(this._placeholderLabel.transform.visible=!1,this._textLable.transform.visible=!0)))},inputField.prototype.filterContentText=function(){if(this._textLable&&null!=this._text){var t=this._textLable,e=t.fontsize/t.font.lineHeight,a=t.font,i=0,o=0,n="";switch(this._lineType){case r.SingleLine:for(l=t.text.length-1;l>=0;l--){h=t.text.charAt(l);if(c=a.cmap[h]){if((i+=c.xAddvance*e)>t.transform.width){t.text=n;break}n=t.text[l]+n}else console.warn("can't find character \""+h+'" in '+a.getName()+" Font")}break;case r.MultiLine:var s=!0;o+=t.fontsize*t.linespace;for(var l=t.text.length-1;l>=0;l--){var h=t.text.charAt(l),c=a.cmap[h];if(c){if((i+=c.xAddvance*e)>t.transform.width&&(i=0,s=!1,o+=t.fontsize*t.linespace),!s&&o>t.transform.height){t.text=n;break}n=t.text[l]+n}else console.warn("can't find character \""+h+'" in '+a.getName()+" Font")}}}},inputField.prototype.update=function(t){this.textRefresh()},inputField.prototype.remove=function(){this._placeholderLabel=null,this._textLable=null,this.transform=null,this._frameImage=null,this.inputElement&&(this.inputElement.disabled=!1,this.inputElement.value="",this.inputElement.style.visibility="hidden",this.inputElement.parentElement&&this.inputElement.parentElement.removeChild(this.inputElement),this.inputElement=null)},inputField.prototype.onPointEvent=function(e,a,r){if(0==r){if(a.type!=t.event.PointEventEnum.PointDown)return;this.transform.ContainsCanvasPoint(new t.math.vector2(a.x,a.y))?(this.inputElement.style.visibility="visible",this.inputElement.focus()):(this.beFocus&&this.inputElement.blur(),"hidden"!=this.inputElement.style.visibility&&(this.inputElement.style.visibility="hidden"))}},__decorate([t.reflect.Field("reference",null,"image2D"),__metadata("design:type",Object),__metadata("design:paramtypes",[e.image2D])],inputField.prototype,"frameImage",null),__decorate([t.reflect.Field("number"),__metadata("design:type",Object),__metadata("design:paramtypes",[Number])],inputField.prototype,"characterLimit",null),__decorate([t.reflect.Field("number"),__metadata("design:type",Object),__metadata("design:paramtypes",[Number])],inputField.prototype,"LineType",null),__decorate([t.reflect.Field("number"),__metadata("design:type",Object),__metadata("design:paramtypes",[Number])],inputField.prototype,"ContentType",null),__decorate([t.reflect.Field("reference",null,"label"),__metadata("design:type",e.label),__metadata("design:paramtypes",[e.label])],inputField.prototype,"TextLabel",null),__decorate([t.reflect.Field("reference",null,"label"),__metadata("design:type",e.label),__metadata("design:paramtypes",[e.label])],inputField.prototype,"PlaceholderLabel",null),inputField=__decorate([t.reflect.node2DComponent,t.reflect.nodeRender],inputField)}();e.inputField=a;var r;!function(t){t[t.SingleLine=0]="SingleLine",t[t.MultiLine=1]="MultiLine"}(r=e.lineType||(e.lineType={}));var i;!function(t){t[t.None=0]="None",t[t.Number=1]="Number",t[t.Word=2]="Word",t[t.Underline=4]="Underline",t[t.ChineseCharacter=8]="ChineseCharacter",t[t.NoneChineseCharacter=16]="NoneChineseCharacter",t[t.Email=32]="Email",t[t.PassWord=64]="PassWord",t[t.Custom=128]="Custom"}(i=e.contentType||(e.contentType={}))}(t.framework||(t.framework={}))}(gd3d||(gd3d={}));var gd3d;!function(t){!function(e){var a=function(){function label(){this.needRefreshFont=!1,this._fontName="defFont",this._fontsize=14,this.linespace=1,this.horizontalType=r.Left,this.verticalType=i.Center,this.horizontalOverflow=!1,this.verticalOverflow=!1,this.indexarr=[],this.remainarrx=[],this.data_begin=new t.math.vector2(0,0),this.datar=[],this.color=new t.math.color(1,1,1,1),this.color2=new t.math.color(0,0,.5,.5),this.dirtyData=!0}return Object.defineProperty(label.prototype,"text",{get:function(){return this._text},set:function(t){t=null==t?"":t,this._text=t,this.initdater(),this.dirtyData=!0},enumerable:!0,configurable:!0}),label.prototype.initdater=function(){var t=78*this._text.length;for(this.datar.splice(0,this.datar.length);this.datar.length<t;)this.datar.push(0,0,0,1,1,1,1,0,0,1,1,1,1,0,0,0,1,1,1,1,1,0,1,1,1,1,0,0,0,1,1,1,1,0,1,1,1,1,1,0,0,0,1,1,1,1,0,1,1,1,1,1,0,0,0,1,1,1,1,1,0,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,1,1);for(;this.datar.length<t;)this.datar.pop()},Object.defineProperty(label.prototype,"font",{get:function(){return this._font},set:function(t){t!=this._font&&(this.needRefreshFont=!0,this._font&&this._font.unuse(),this._font=t,t?(this._font.use(),this._fontName=this._font.getName()):this._fontName="")},enumerable:!0,configurable:!0}),Object.defineProperty(label.prototype,"fontsize",{get:function(){return this._fontsize},set:function(t){this._fontsize=t},enumerable:!0,configurable:!0}),label.prototype.updateData=function(t){this.dirtyData=!1;var e=this._fontsize/t.lineHeight,a=this.transform.getWorldMatrix(),o=a.rawData[0],n=a.rawData[2],s=a.rawData[1],l=a.rawData[3],h=this.data_begin.x,c=this.data_begin.y,u=0,d=0;this.indexarr=[],this.remainarrx=[];var m=0;d+=this._fontsize*this.linespace;for(var p=this.horizontalOverflow?Number.MAX_VALUE:this.transform.width,f=this.verticalOverflow?Number.MAX_VALUE:this.transform.height,g=0;g<this._text.length;g++){b=this._text.charAt(g);if(void 0!=(w=t.cmap[b])){if(u+w.xAddvance*e>p){if(d+this._fontsize*this.linespace>f)break;this.indexarr.push(g),this.remainarrx.push(this.transform.width-u),u=0,d+=this._fontsize*this.linespace}u+=w.xAddvance*e}}this.indexarr.push(g),this.remainarrx.push(this.transform.width-u),m=this.transform.height-d;var g=0,v=0,y=0;this.verticalType==i.Center?y+=m/2:this.verticalType==i.Boom&&(y+=m),this.initdater();for(var _=0;_<this.indexarr.length;_++){for(v=0,this.horizontalType==r.Center?v+=this.remainarrx[_]/2:this.horizontalType==r.Right&&(v+=this.remainarrx[_]);g<this.indexarr[_];g++){var b=this._text.charAt(g),w=t.cmap[b];if(void 0!=w){var x=v+w.xOffset*e,D=y-w.yOffset*e+t.baseline*e,E=e*w.ySize,T=e*w.xSize;v+=w.xAddvance*e;var M=x+T,A=D,S=x,C=D+E,F=x+T,R=D+E;this.datar[6*g*13+0]=h+x*o+D*n,this.datar[6*g*13+1]=c+x*s+D*l,this.datar[6*g*13+13+0]=h+M*o+A*n,this.datar[6*g*13+13+1]=c+M*s+A*l,this.datar[6*g*13+26+0]=h+S*o+C*n,this.datar[6*g*13+26+1]=c+S*s+C*l,this.datar[6*g*13+39+0]=h+S*o+C*n,this.datar[6*g*13+39+1]=c+S*s+C*l,this.datar[6*g*13+52+0]=h+M*o+A*n,this.datar[6*g*13+52+1]=c+M*s+A*l,this.datar[6*g*13+65+0]=h+F*o+R*n,this.datar[6*g*13+65+1]=c+F*s+R*l;var k=w.x,P=w.y,B=w.x+w.w,I=w.y,N=w.x,O=w.y+w.h,L=w.x+w.w,V=w.y+w.h;this.datar[6*g*13+7]=k,this.datar[6*g*13+8]=P,this.datar[6*g*13+13+7]=B,this.datar[6*g*13+13+8]=I,this.datar[6*g*13+26+7]=N,this.datar[6*g*13+26+8]=O,this.datar[6*g*13+39+7]=N,this.datar[6*g*13+39+8]=O,this.datar[6*g*13+52+7]=B,this.datar[6*g*13+52+8]=I,this.datar[6*g*13+65+7]=L,this.datar[6*g*13+65+8]=V;for(var U=0;U<6;U++)this.datar[6*g*13+13*U+3]=this.color.r,this.datar[6*g*13+13*U+4]=this.color.g,this.datar[6*g*13+13*U+5]=this.color.b,this.datar[6*g*13+13*U+6]=this.color.a,this.datar[6*g*13+13*U+9]=this.color2.r,this.datar[6*g*13+13*U+10]=this.color2.g,this.datar[6*g*13+13*U+11]=this.color2.b,this.datar[6*g*13+13*U+12]=this.color2.a}}y+=this._fontsize*this.linespace}},Object.defineProperty(label.prototype,"uimat",{get:function(){if(this.font&&this.font.texture){var t=this.transform.parentIsMask?"_("+this.transform.insId+")":"",a=this.font.texture.getName()+"_fontmask"+t,r=this.transform.canvas;if(!r.assetmgr)return;var i=this._uimat;i&&i.getName()==a||(i&&i.unuse(),(i=r.assetmgr.getAssetByName(a))&&i.use()),null==i&&((i=new e.material(a)).setShader(r.assetmgr.getShader("shader/defmaskfont")),i.use()),i.setFloat("MaskState",this.transform.parentIsMask?1:0),this._uimat=i}return this._uimat},enumerable:!0,configurable:!0}),label.prototype.render=function(e){if(null==this._font&&null!=e.assetmgr.mapNamed[this._fontName]){var a=e.assetmgr.getAssetByName(this._fontName);a&&(this.font=a,this.needRefreshFont=!0)}if(null!=this._font){1==this.dirtyData&&(this.updateData(this._font),this.dirtyData=!1);var r=this.uimat;if(!r)return;var i;if(null!=this._font&&(i=this._font.texture),null!=i){if(this.needRefreshFont&&(r.setTexture("_MainTex",i),this.needRefreshFont=!1),this.transform.parentIsMask){null==this._cacheMaskV4&&(this._cacheMaskV4=new t.math.vector4);var o=this.transform.maskRect;this._cacheMaskV4.x==o.x&&this._cacheMaskV4.y==o.y&&this._cacheMaskV4.w==o.w&&this._cacheMaskV4.z==o.h||(this._cacheMaskV4.x=o.x,this._cacheMaskV4.y=o.y,this._cacheMaskV4.z=o.w,this._cacheMaskV4.w=o.h,r.setVector4("_maskRect",this._cacheMaskV4))}0!=this.datar.length&&e.pushRawData(r,this.datar)}}},label.prototype.updateTran=function(){var t=this.transform.getWorldMatrix(),e=-this.transform.pivot.x*this.transform.width,a=-this.transform.pivot.y*this.transform.height;this.data_begin.x=e*t.rawData[0]+a*t.rawData[2]+t.rawData[4],this.data_begin.y=e*t.rawData[1]+a*t.rawData[3]+t.rawData[5],this.dirtyData=!0},label.prototype.start=function(){},label.prototype.onPlay=function(){},label.prototype.update=function(t){},label.prototype.remove=function(){this._font&&this._font.unuse(!0),this._uimat&&this._uimat.unuse(!0),this.indexarr.length=0,this.remainarrx.length=0,this.datar.length=0,this.transform=null,this._cacheMaskV4=null},label.prototype.onPointEvent=function(t,e,a){},__decorate([t.reflect.Field("string"),__metadata("design:type",String),__metadata("design:paramtypes",[String])],label.prototype,"text",null),__decorate([t.reflect.Field("string"),__metadata("design:type",Object)],label.prototype,"_fontName",void 0),__decorate([t.reflect.Field("number"),__metadata("design:type",Object),__metadata("design:paramtypes",[Number])],label.prototype,"fontsize",null),__decorate([t.reflect.Field("number"),__metadata("design:type",Number)],label.prototype,"linespace",void 0),__decorate([t.reflect.Field("number"),__metadata("design:type",Number)],label.prototype,"horizontalType",void 0),__decorate([t.reflect.Field("number"),__metadata("design:type",Number)],label.prototype,"verticalType",void 0),__decorate([t.reflect.Field("boolean"),__metadata("design:type",Boolean)],label.prototype,"horizontalOverflow",void 0),__decorate([t.reflect.Field("boolean"),__metadata("design:type",Boolean)],label.prototype,"verticalOverflow",void 0),__decorate([t.reflect.Field("color"),t.reflect.UIStyle("color"),__metadata("design:type",t.math.color)],label.prototype,"color",void 0),__decorate([t.reflect.Field("color"),t.reflect.UIStyle("color"),__metadata("design:type",t.math.color)],label.prototype,"color2",void 0),label=__decorate([t.reflect.node2DComponent,t.reflect.nodeRender],label)}();e.label=a;var r;!function(t){t[t.Center=0]="Center",t[t.Left=1]="Left",t[t.Right=2]="Right"}(r=e.HorizontalType||(e.HorizontalType={}));var i;!function(t){t[t.Center=0]="Center",t[t.Top=1]="Top",t[t.Boom=2]="Boom"}(i=e.VerticalType||(e.VerticalType={}))}(t.framework||(t.framework={}))}(gd3d||(gd3d={}));var gd3d;!function(t){!function(e){var a=function(){function progressbar(){this._value=.6}return Object.defineProperty(progressbar.prototype,"cutPanel",{get:function(){return this._cutPanel},set:function(t){this._cutPanel=t,this.refreshBar()},enumerable:!0,configurable:!0}),Object.defineProperty(progressbar.prototype,"barBg",{get:function(){return this._barBg},set:function(t){this._barBg=t,this.refreshBar()},enumerable:!0,configurable:!0}),Object.defineProperty(progressbar.prototype,"barOverImg",{get:function(){return this._barOverImg},set:function(t){this._barOverImg=t,this.refreshBar()},enumerable:!0,configurable:!0}),Object.defineProperty(progressbar.prototype,"value",{get:function(){return this._value},set:function(t){this._value=t<0?0:t>1?1:t,this._cutPanel&&this._barBg&&this._barBg.transform&&(this._cutPanel.width=this._value*this._barBg.transform.width,this._cutPanel.markDirty())},enumerable:!0,configurable:!0}),progressbar.prototype.start=function(){},progressbar.prototype.onPlay=function(){},progressbar.prototype.update=function(t){this.adjustOverImg()},progressbar.prototype.refreshBar=function(){this.adjustOverImg(),this.value=this._value},progressbar.prototype.adjustOverImg=function(){if(this._barOverImg&&this._barBg){var t=this._barBg.transform,e=this._barOverImg.transform;t&&e&&t.width!=e.width&&(e.width=t.width,e.markDirty())}},progressbar.prototype.remove=function(){this._barBg=null,this._barOverImg=null,this._cutPanel=null},progressbar.prototype.onPointEvent=function(t,e,a){},__decorate([t.reflect.Field("reference",null,"transform2D"),__metadata("design:type",Object),__metadata("design:paramtypes",[e.transform2D])],progressbar.prototype,"cutPanel",null),__decorate([t.reflect.Field("reference",null,"image2D"),__metadata("design:type",Object),__metadata("design:paramtypes",[e.image2D])],progressbar.prototype,"barBg",null),__decorate([t.reflect.Field("reference",null,"image2D"),__metadata("design:type",Object),__metadata("design:paramtypes",[e.image2D])],progressbar.prototype,"barOverImg",null),__decorate([t.reflect.Field("number"),__metadata("design:type",Object),__metadata("design:paramtypes",[Number])],progressbar.prototype,"value",null),progressbar=__decorate([t.reflect.node2DComponent],progressbar)}();e.progressbar=a}(t.framework||(t.framework={}))}(gd3d||(gd3d={}));var gd3d;!function(t){!function(e){var a=function(){function rawImage2D(){this.datar=[0,0,0,1,1,1,1,0,0,1,1,1,1,0,0,0,1,1,1,1,1,0,1,1,1,1,0,0,0,1,1,1,1,0,1,1,1,1,1,0,0,0,1,1,1,1,0,1,1,1,1,1,0,0,0,1,1,1,1,1,0,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,1,1],this.needRefreshImg=!1,this.color=new t.math.color(1,1,1,1)}return Object.defineProperty(rawImage2D.prototype,"image",{get:function(){return this._image},set:function(t){this._image!=t&&(this.needRefreshImg=!0,this._image&&this._image.unuse(),this._image=t,t&&this._image.use())},enumerable:!0,configurable:!0}),Object.defineProperty(rawImage2D.prototype,"uimat",{get:function(){if(null!=this.image){var t=this.transform.parentIsMask?"_("+this.transform.insId+")":"",a=this._image.getName()+"_uimask"+t,r=this.transform.canvas;if(!r.assetmgr)return;var i=this._uimat;i&&i.getName()==a||(i&&i.unuse(),(i=r.assetmgr.getAssetByName(a))&&i.use()),null==i&&((i=new e.material(a)).setShader(r.assetmgr.getShader("shader/defmaskui")),i.use()),i.setFloat("MaskState",this.transform.parentIsMask?1:0),this._uimat=i}return this._uimat},enumerable:!0,configurable:!0}),rawImage2D.prototype.render=function(e){var a=this.image,r=this.uimat;if(r&&null!=a){if(this.needRefreshImg&&(r.setTexture("_MainTex",a),this.needRefreshImg=!1),this.transform.parentIsMask){null==this._cacheMaskV4&&(this._cacheMaskV4=new t.math.vector4);var i=this.transform.maskRect;this._cacheMaskV4.x==i.x&&this._cacheMaskV4.y==i.y&&this._cacheMaskV4.w==i.w&&this._cacheMaskV4.z==i.h||(this._cacheMaskV4.x=i.x,this._cacheMaskV4.y=i.y,this._cacheMaskV4.z=i.w,this._cacheMaskV4.w=i.h,r.setVector4("_maskRect",this._cacheMaskV4))}e.pushRawData(r,this.datar)}},rawImage2D.prototype.updateTran=function(){var t=this.transform.getWorldMatrix(),e=-this.transform.pivot.x*this.transform.width,a=this.transform.width+e,r=-this.transform.pivot.y*this.transform.height,i=this.transform.height+r,o=e*t.rawData[0]+r*t.rawData[2]+t.rawData[4],n=e*t.rawData[1]+r*t.rawData[3]+t.rawData[5],s=a*t.rawData[0]+r*t.rawData[2]+t.rawData[4],l=a*t.rawData[1]+r*t.rawData[3]+t.rawData[5],h=e*t.rawData[0]+i*t.rawData[2]+t.rawData[4],c=e*t.rawData[1]+i*t.rawData[3]+t.rawData[5],u=a*t.rawData[0]+i*t.rawData[2]+t.rawData[4],d=a*t.rawData[1]+i*t.rawData[3]+t.rawData[5];this.datar[0]=o,this.datar[1]=n,this.datar[13]=s,this.datar[14]=l,this.datar[26]=h,this.datar[27]=c,this.datar[39]=h,this.datar[40]=c,this.datar[52]=s,this.datar[53]=l,this.datar[65]=u,this.datar[66]=d;for(var m=0;m<6;m++)this.datar[13*m+3]=this.color.r,this.datar[13*m+4]=this.color.g,this.datar[13*m+5]=this.color.b,this.datar[13*m+6]=this.color.a},rawImage2D.prototype.start=function(){},rawImage2D.prototype.onPlay=function(){},rawImage2D.prototype.update=function(t){},rawImage2D.prototype.remove=function(){this._image&&this._image.unuse(!0),this._uimat&&this._uimat.unuse(!0),this._image=null,this._cacheMaskV4=null,this.transform=null,this.datar.length=0},rawImage2D.prototype.onPointEvent=function(t,e,a){},__decorate([t.reflect.Field("texture"),__metadata("design:type",Object),__metadata("design:paramtypes",[e.texture])],rawImage2D.prototype,"image",null),__decorate([t.reflect.Field("color"),t.reflect.UIStyle("vector4"),__metadata("design:type",t.math.color)],rawImage2D.prototype,"color",void 0),rawImage2D=__decorate([t.reflect.node2DComponent,t.reflect.nodeRender],rawImage2D)}();e.rawImage2D=a}(t.framework||(t.framework={}))}(gd3d||(gd3d={}));var gd3d;!function(t){!function(e){var a=function(){function scrollRect(){this.horizontal=!0,this.vertical=!0,this.isPointDown=!1}return Object.defineProperty(scrollRect.prototype,"content",{get:function(){return this._content},set:function(t){this._content=t},enumerable:!0,configurable:!0}),scrollRect.prototype.start=function(){},scrollRect.prototype.onPlay=function(){},scrollRect.prototype.update=function(t){},scrollRect.prototype.onPointEvent=function(e,a,r){if(0==r&&this.transform.ContainsCanvasPoint(new t.math.vector2(a.x,a.y))){if(a.eated=!0,null==this._content)return;if(!this.horizontal&&!this.vertical)return;var i=t.math.pool.new_vector2();i.x=a.x,i.y=a.y;var o=t.math.pool.new_vector2();this.transform.canvas.ModelPosToCanvasPos(i,o),null==this.strPoint&&(this.strPoint=new t.math.vector2);var n=this.strPoint;if(a.type==t.event.PointEventEnum.PointDown&&(this.isPointDown=!0,n.x=o.x,n.y=o.y,null==this.strPos&&(this.strPos=new t.math.vector2),t.math.vec2Clone(this._content.transform.localTranslate,this.strPos)),a.type==t.event.PointEventEnum.PointHold&&this.isPointDown){null==this.lastPoint&&(this.lastPoint=new t.math.vector2);var s=this.lastPoint;if(s.x!=o.x||s.y!=o.y){s.x=o.x,s.y=o.y;var l=s.x-n.x,h=s.y-n.y;this.SlideTo(l,h)}}t.math.pool.delete_vector2(i),t.math.pool.delete_vector2(o)}a.type==t.event.PointEventEnum.PointUp&&(this.isPointDown=!1)},scrollRect.prototype.SlideTo=function(e,a){if(null!=this._content&&null!=this.strPos){var r=this._content.transform,i=r.localTranslate,o=this.transform;t.math.vec2Clone(this.strPos,i),this.horizontal&&(i.x+=e,i.x>0&&(i.x=0),r.width>=o.width&&i.x+r.width<o.width&&(i.x=-1*(r.width-o.width))),this.vertical&&(i.y+=a,i.y>0&&(i.y=0),r.height>=o.height&&i.y+r.height<o.height&&(i.y=-1*(r.height-o.height))),r.markDirty()}},scrollRect.prototype.remove=function(){this._content=null,this.transform=null},__decorate([t.reflect.Field("reference",null,"transform2D"),__metadata("design:type",e.transform2D),__metadata("design:paramtypes",[e.transform2D])],scrollRect.prototype,"content",null),__decorate([t.reflect.Field("boolean"),__metadata("design:type",Boolean)],scrollRect.prototype,"horizontal",void 0),__decorate([t.reflect.Field("boolean"),__metadata("design:type",Boolean)],scrollRect.prototype,"vertical",void 0),scrollRect=__decorate([t.reflect.node2DComponent],scrollRect)}();e.scrollRect=a}(t.framework||(t.framework={}))}(gd3d||(gd3d={}));var gd3d;!function(t){!function(e){var a=function(){function uirect(){this.canbeClick=!0}return uirect.prototype.start=function(){},uirect.prototype.onPlay=function(){},uirect.prototype.update=function(t){},uirect.prototype.onPointEvent=function(t,e,a){},uirect.prototype.remove=function(){this.transform=null},uirect=__decorate([t.reflect.node2DComponent],uirect)}();e.uirect=a}(t.framework||(t.framework={}))}(gd3d||(gd3d={}));var gd3d;!function(t){!function(e){var a=function(){function resID(){this.id=resID.next()}return resID.next=function(){var t=resID.idAll;return resID.idAll++,t},resID.prototype.getID=function(){return this.id},resID.idAll=1,resID}();e.resID=a;var r=function(){function constText(t){this.name=t}return constText.prototype.getText=function(){return this.name},constText=__decorate([t.reflect.SerializeType,__metadata("design:paramtypes",[String])],constText)}();e.constText=r}(t.framework||(t.framework={}))}(gd3d||(gd3d={}));var gd3d;!function(t){!function(e){var a;!function(t){t[t.Unknown=0]="Unknown",t[t.Auto=1]="Auto",t[t.Bundle=2]="Bundle",t[t.CompressBundle=3]="CompressBundle",t[t.GLVertexShader=4]="GLVertexShader",t[t.GLFragmentShader=5]="GLFragmentShader",t[t.Shader=6]="Shader",t[t.Texture=7]="Texture",t[t.TextureDesc=8]="TextureDesc",t[t.Mesh=9]="Mesh",t[t.Prefab=10]="Prefab",t[t.Material=11]="Material",t[t.Aniclip=12]="Aniclip",t[t.KeyFrameAniclip=13]="KeyFrameAniclip",t[t.Scene=14]="Scene",t[t.Atlas=15]="Atlas",t[t.Font=16]="Font",t[t.TextAsset=17]="TextAsset",t[t.PackBin=18]="PackBin",t[t.PackTxt=19]="PackTxt",t[t.PathAsset=20]="PathAsset",t[t.PVR=21]="PVR",t[t.F14Effect=22]="F14Effect",t[t.DDS=23]="DDS"}(a=e.AssetTypeEnum||(e.AssetTypeEnum={}));var r;!function(t){t[t.None=0]="None",t[t.Shader=1]="Shader",t[t.Mesh=2]="Mesh",t[t.Texture=4]="Texture",t[t.Material=8]="Material",t[t.Anclip=16]="Anclip",t[t.Prefab=32]="Prefab",t[t.Scene=64]="Scene",t[t.Textasset=128]="Textasset",t[t.Pvr=256]="Pvr",t[t.f14eff=512]="f14eff",t[t.Dds=1024]="Dds"}(r=e.AssetBundleLoadState||(e.AssetBundleLoadState={}));var i=function(){return function ResourceState(){this.res=null,this.state=0,this.loadedLength=0}}();e.ResourceState=i;var o=function(t){function RefResourceState(){var e=null!==t&&t.apply(this,arguments)||this;return e.refLoadedLength=0,e}return __extends(RefResourceState,t),RefResourceState}(i);e.RefResourceState=o;var n=function(){function stateLoad(){this.iserror=!1,this.isfinish=!1,this.resstate={},this.curtask=0,this.bundleLoadState=0,this.totaltask=0,this.totalByteLength=0,this.progressCall=!1,this.compressTextLoaded=0,this.compressBinLoaded=0,this.logs=[],this.errs=[]}return Object.defineProperty(stateLoad.prototype,"fileProgress",{get:function(){return this.curtask/this.totaltask},enumerable:!0,configurable:!0}),Object.defineProperty(stateLoad.prototype,"curByteLength",{get:function(){var t=0;for(var e in this.resstate){var a=this.resstate[e];t+=a.loadedLength,a instanceof o&&(t+=a.refLoadedLength)}return t+=this.compressTextLoaded+this.compressBinLoaded},enumerable:!0,configurable:!0}),Object.defineProperty(stateLoad.prototype,"progress",{get:function(){return this.curByteLength/this.totalByteLength},enumerable:!0,configurable:!0}),stateLoad}();e.stateLoad=n;var s=function(){function assetBundle(t){this.files=[],this.packages=[],this.bundlePackBin={},this.totalLength=0,this.mapNamed={},this.url=t;var e=t.lastIndexOf("/");this.path=t.substring(0,e)}return assetBundle.prototype.loadCompressBundle=function(e,a,r,i){var o=this;r.totalByteLength=this.totalLength,t.io.loadText(e,function(t,e){if(null!=e)return r.iserror=!0,r.errs.push(new Error(e.message)),void a(r);var n=JSON.parse(t);o.bundlePackJson=n,o.parse(n.bundleinfo,o.totalLength),o.load(i,a,r),i.mapBundle[o.name]=o},function(t,e){r.compressTextLoaded=t,a(r)})},assetBundle.prototype.parse=function(t,e){void 0===e&&(e=0);for(var a=t.files,r=0;r<a.length;r++){var i=a[r],o=-1;void 0!=i.packes&&(o=i.packes),this.files.push({name:i.name,length:i.length,packes:o})}if(void 0!=t.packes)for(var o=t.packes,r=0;r<o.length;r++)this.packages.push(o[r]);else void 0!=t.totalLength&&0==e&&(this.totalLength=t.totalLength)},assetBundle.prototype.unload=function(){for(var t in this.mapNamed){var e=this.assetmgr.getAssetByName(t,this.name);e&&this.assetmgr.unuse(e)}this.assetmgr.removeAssetBundle(this.name)},assetBundle.prototype.load=function(i,o,n){var s=this;n.totalByteLength=this.totalLength;var l=this.files.length;this.assetmgr=i,this.curLoadState=r.None;var h=[],c=[],u=[],d=[],m=[],p=[],f=[],g=[],v=[],y=[],_=[],b=[],w=[],x=[],D=[],E=[],T=[],M=[],A=[],S=[];A.push(w,h,c,u,_,d,m,b,T,p,D,E,f,g,M,x,v,y),S.push(r.None,r.None,r.None,r.Shader,r.Prefab,r.Mesh,r.Material,r.Scene,r.None,r.Texture,r.Anclip,r.Textasset,r.Pvr,r.f14eff,r.Dds);for(var C=0,F={},R=0;R<this.packages.length;R++){var k=this.packages[R],P=i.calcType(k),B=this.path+"/"+k;w.push({url:B,type:P,asset:null})}for(R=0;R<this.files.length;R++){var I=this.files[R],N=i.calcType(I.name),B=this.path+"/"+I.name,O=i.getFileName(B);-1!=I.packes&&(F[B]=I.packes);j=null;switch(N){case a.GLFragmentShader:c.push({url:B,type:N,asset:null});break;case a.GLVertexShader:h.push({url:B,type:N,asset:null});break;case a.Shader:j=new e.shader(O),u.push({url:B,type:N,asset:j});break;case a.Texture:j=new e.texture(O),m.push({url:B,type:N,asset:j});break;case a.TextureDesc:j=new e.texture(O),p.push({url:B,type:N,asset:j});break;case a.Mesh:j=new e.mesh(O),d.push({url:B,type:N,asset:j});break;case a.Material:j=new e.material(O),f.push({url:B,type:N,asset:j});break;case a.Aniclip:j=new e.animationClip(O),g.push({url:B,type:N,asset:j});break;case a.Prefab:j=new e.prefab(O),v.push({url:B,type:N,asset:j});break;case a.Scene:j=new e.rawscene(O),y.push({url:B,type:N,asset:j});break;case a.TextAsset:j=new e.textasset(O),_.push({url:B,type:N,asset:j});break;case a.PVR:j=new e.texture(O),b.push({url:B,type:N,asset:j});break;case a.F14Effect:j=new e.f14eff(O),x.push({url:B,type:N,asset:j});break;case a.DDS:j=new e.texture(O),T.push({url:B,type:N,asset:j});break;case a.Font:j=new e.font(O),D.push({url:B,type:N,asset:j});break;case a.Atlas:j=new e.atlas(O),E.push({url:B,type:N,asset:j});break;case a.KeyFrameAniclip:j=new e.keyFrameAniClip(O),M.push({url:B,type:N,asset:j})}if(N!=a.GLVertexShader&&N!=a.GLFragmentShader&&N!=a.Shader&&N!=a.PackBin&&N!=a.PackTxt){if(!j)continue;this.mapNamed[O]=j.getGUID(),i.regRes(O,j)}}for(var L=[],V=0;V<A.length;V++)for(var U=0;U<A[V].length;U++){var B=A[V][U].url,z=A[V][U].type,j=A[V][U].asset,W=null;U==A[V].length-1&&(W=S[V]),L.push({url:B,type:z,asset:j,state:W})}l>(C=L.length)&&console.log("assetBundle中某个file不是资源或后缀有问题"),n.totaltask=C+1,n.curtask=1,o(n),i.doWaitState(this.url,n),n.bundleLoadState=r.None;var q=function(){var e=L[n.curtask-1].url,r=L[n.curtask-1].type,l=L[n.curtask-1].asset,h=(i.getFileName(e),L[n.curtask-1].state);if(void 0!=F[e]){var c=void 0;0==F[e]?c=s.bundlePackJson:1==F[e]?c=s.bundlePackBin:console.log("未识别的packnum: "+F[e]),i.loadResByPack(c,e,r,function(t){if(t.progressCall)return t.progressCall=!1,void o(n);void 0!=n&&(n.bundleLoadState|=h),C--,n.curtask++,0===C?(n.isfinish=!0,o(n),i.loadByMulQueue()):(o(n),q()),i.doWaitState(s.url,n)},n,l)}else r==a.PackBin?t.io.loadArrayBuffer(e,function(e,a){if(null!=a)return n.iserror=!0,n.errs.push(new Error(a.message)),o(n),void i.loadByMulQueue();var r=new t.io.binReader(e),l=r.readInt32();for(r.position=l;r.canread();){var c=r.readInt32();if(0==l)break;var u=r.readStringUtf8FixLength(c).split("|"),d=parseInt(u[1]),m=parseInt(u[2]),p=e.slice(d,d+m);s.bundlePackBin[u[0]]=p}void 0!=n&&(n.bundleLoadState|=h),C--,n.curtask++,0===C?(n.isfinish=!0,o(n),i.loadByMulQueue()):(o(n),q())},function(t,e){n.compressBinLoaded=t,o(n)}):i.loadSingleRes(e,r,function(t){return t.iserror?(o(n),void i.loadByMulQueue()):t.progressCall?(t.progressCall=!1,void o(n)):(void 0!=n&&(n.bundleLoadState|=h),C--,n.curtask++,0===C?(n.isfinish=!0,o(n),i.loadByMulQueue()):(o(n),q()),void i.doWaitState(s.url,n))},n,l)};q()},assetBundle}();e.assetBundle=s;var l=function(){function assetMgr(e){this.mapShader={},this.mapDefaultMesh={},this.mapDefaultTexture={},this.mapDefaultCubeTexture={},this.mapDefaultSprite={},this.mapMaterial={},this.mapBundle={},this.mapRes={},this.mapNamed={},this._loadingTag="_AssetLoingTag_",this.mapInLoad={},this.assetUrlDic={},this.assetFactorys={},this.waitStateDic={},this.waitQueueState=[],this.loadingQueueState=[],this.loadingCountLimit=2,this.app=e,this.webgl=e.webgl,this.shaderPool=new t.render.shaderPool,this.initAssetFactorys()}return assetMgr.prototype.initDefAsset=function(){e.defMesh.initDefaultMesh(this),e.defTexture.initDefaultTexture(this),e.defsprite.initDefaultSprite(this),e.defShader.initDefaultShader(this),e.defmaterial.initDefaultMaterial(this)},assetMgr.prototype.getShader=function(t){return this.mapShader[t]},assetMgr.prototype.getDefaultMesh=function(t){return this.mapDefaultMesh[t]},assetMgr.prototype.getDefaultTexture=function(t){return this.mapDefaultTexture[t]},assetMgr.prototype.getDefaultCubeTexture=function(t){return this.mapDefaultCubeTexture[t]},assetMgr.prototype.getDefaultSprite=function(t){return this.mapDefaultSprite[t]},assetMgr.prototype.getMaterial=function(t){return this.mapMaterial[t]},assetMgr.prototype.getAsset=function(t){var e=this.mapRes[t];return null==e?null:e.asset},assetMgr.prototype.getAssetByName=function(t,e){void 0===e&&(e=null);var a=null;if(null!=this.mapNamed[t]&&(a=this.mapNamed[t][this.mapNamed[t].length-1]),null!=e){var r=this.mapBundle[e];null!=r&&(a=r.mapNamed[t]||a)}if(null!=a){var i=this.mapRes[a];if(null!=i&&!i[this._loadingTag])return i.asset}return void 0!=this.mapDefaultMesh[t]?this.mapDefaultMesh[t]:void 0!=this.mapDefaultTexture[t]?this.mapDefaultTexture[t]:void 0!=this.mapShader[t]?this.mapShader[t]:void 0},assetMgr.prototype.getAssetBundle=function(t){return this.mapBundle[t]?this.mapBundle[t]:null},assetMgr.prototype.unuse=function(t,e){void 0===e&&(e=!1);var a=t.getGUID(),r=t.getName();if(!t.defaultAsset&&this.mapRes[a]&&(this.mapRes[a].refcount--,e&&this.mapRes[a].refcount<=0)){if(this.mapRes[a].asset.dispose(),null!=r)if(this.mapNamed[r].length<=1)delete this.mapNamed[r];else for(var i in this.mapNamed[r])a==this.mapNamed[r][i]&&this.mapNamed[r].splice(parseInt(i),1);delete this.mapRes[a]}},assetMgr.prototype.use=function(t){var e=t.getGUID(),a=t.getName();if(e<=0)throw new Error("不合法的res guid:"+a);t.defaultAsset||(null==this.mapRes[e]&&(this.mapRes[e]={asset:t,refcount:0},null!=a&&(null==this.mapNamed[a]&&(this.mapNamed[a]=[]),this.mapNamed[a].push(e))),this.mapRes[e].refcount++,this.mapRes[e][this._loadingTag]&&delete this.mapRes[e][this._loadingTag])},assetMgr.prototype.regRes=function(t,e){var a=e.getGUID();null==this.mapRes[a]&&(this.mapRes[a]={asset:e,refcount:0},this.mapRes[a][this._loadingTag]=!0,null!=t&&(null==this.mapNamed[t]&&(this.mapNamed[t]=[]),this.mapNamed[t].push(a)))},assetMgr.prototype.releaseUnuseAsset=function(){for(var t in this.mapRes)if(this.mapRes[t].refcount<=0){if(this.mapRes[t][this._loadingTag])continue;var e=this.mapRes[t].asset.getName();if(this.mapNamed[e].length<=1)delete this.mapNamed[e];else for(var a in this.mapNamed[e])this.mapRes[t].asset.getGUID()==this.mapNamed[e][a]&&this.mapNamed[e].splice(parseInt(a),1);this.mapRes[t].asset.dispose(),delete this.mapRes[t]}},assetMgr.prototype.getAssetsRefcount=function(){var t={};for(var e in this.mapNamed)if(1==this.mapNamed[e].length){r=this.mapRes[this.mapNamed[e][0]];t[e]=r.refcount}else for(var a in this.mapNamed[e]){var r=this.mapRes[this.mapNamed[e][a]];t[e+"("+a+")"]=r.refcount}return t},assetMgr.prototype.removeAssetBundle=function(t){null!=this.mapBundle[t]&&delete this.mapBundle[t],null!=this.mapInLoad[t]&&delete this.mapInLoad[t]},assetMgr.prototype.setAssetUrl=function(t,e){this.assetUrlDic[t.getGUID()]=e},assetMgr.prototype.getAssetUrl=function(t){return this.assetUrlDic[t.getGUID()]},assetMgr.prototype.loadResByPack=function(t,e,a,r,i,o){var n=this.getAssetFactory(a);if(null==n)throw new Error("cant use the type:"+a);n.loadByPack(t,e,r,i,this,o)},assetMgr.prototype.regAssetFactory=function(t,e){this.assetFactorys[t.toString()]=e},assetMgr.prototype.getAssetFactory=function(t){return this.assetFactorys[t]},assetMgr.prototype.initAssetFactorys=function(){this.regAssetFactory(a.GLVertexShader,new e.AssetFactory_GLVertexShader),this.regAssetFactory(a.GLFragmentShader,new e.AssetFactory_GLFragmentShader),this.regAssetFactory(a.Shader,new e.AssetFactory_Shader),this.regAssetFactory(a.Texture,new e.AssetFactory_Texture),this.regAssetFactory(a.TextureDesc,new e.AssetFactory_TextureDesc),this.regAssetFactory(a.Mesh,new e.AssetFactory_Mesh),this.regAssetFactory(a.Prefab,new e.AssetFactory_Prefab),this.regAssetFactory(a.Material,new e.AssetFactory_Material),this.regAssetFactory(a.Aniclip,new e.AssetFactory_Aniclip),this.regAssetFactory(a.Scene,new e.AssetFactory_Scene),this.regAssetFactory(a.Atlas,new e.AssetFactory_Atlas),this.regAssetFactory(a.Font,new e.AssetFactory_Font),this.regAssetFactory(a.TextAsset,new e.AssetFactory_TextAsset),this.regAssetFactory(a.PathAsset,new e.AssetFactory_PathAsset),this.regAssetFactory(a.PVR,new e.AssetFactory_PVR),this.regAssetFactory(a.F14Effect,new e.AssetFactory_f14eff),this.regAssetFactory(a.DDS,new e.AssetFactory_DDS),this.regAssetFactory(a.KeyFrameAniclip,new e.assetfactory_keyFrameAniClip)},assetMgr.prototype.loadSingleRes=function(t,e,a,r,i){-1==t.indexOf("glsl")&&t.indexOf(".shader.json");var o=this.getAssetFactory(e);if(null==o)throw new Error("cant use the type:"+e);o.load(t,a,r,this,i)},assetMgr.prototype.doWaitState=function(t,e){if(null!=this.waitStateDic[t]){for(var a in this.waitStateDic[t])this.waitStateDic[t][a](e);e.isfinish&&(this.waitStateDic[t].length=0)}},assetMgr.prototype.checkFreeChannel=function(){for(var t=-1,e=0;e<this.loadingQueueState.length;e++){if(void 0==this.loadingQueueState[e]){t=e;break}if(this.loadingQueueState[e].state.isfinish||this.loadingQueueState[e].state.iserror){delete this.loadingQueueState[e],t=e;break}}return-1==t&&this.loadingQueueState.length<this.loadingCountLimit&&(t=this.loadingQueueState.length),t},assetMgr.prototype.loadByMulQueue=function(){var e=this;if(0!=this.waitQueueState.length){var r=this.checkFreeChannel();if(-1!=r){var i=this.waitQueueState.shift();this.loadingQueueState[r]=i;var o=i.state,n=o.url,l=i.type,h=i.onstate;l==a.Bundle?t.io.loadText(n,function(t,a){if(null!=a)return i.state.iserror=!0,i.state.errs.push(new Error(a.message)),void h(o);var r=JSON.parse(t),l="";if(r.files)l=e.getFileName(n),(u=new s(n)).name=l,u.parse(JSON.parse(t)),u.load(e,h,o);else{var c=n.replace(".assetbundle.json",".packs.txt");l=e.getFileName(n);var u=new s(n);u.name=l,u.totalLength=r.totalLength,u.loadCompressBundle(c,h,o,e)}e.mapBundle[l]=u}):l==a.CompressBundle?t.io.loadText(n,function(t,a){if(null!=a)return i.state.iserror=!0,i.state.errs.push(new Error(a.message)),void h(o);var r=n.replace(".assetbundle.json",".packs.txt"),l=e.getFileName(n),c=JSON.parse(t),u=new s(n);u.name=l,u.totalLength=c.totalLength,u.loadCompressBundle(r,h,o,e)}):(o.totaltask=1,this.loadSingleRes(n,l,function(t){return t.iserror?(h(o),void e.loadByMulQueue()):t.progressCall?(t.progressCall=!1,void h(o)):(o.curtask=1,t.isfinish=!0,h(t),e.doWaitState(n,t),void e.loadByMulQueue())},o))}}},assetMgr.prototype.loadCompressBundle=function(t,e){void 0===e&&(e=null);var r=this.getFileName(t),i=this.calcType(t),o=new n;if(this.mapInLoad[r]=o,o.url=t,i!=a.Bundle)return o.errs.push(new Error("is not bundle compress type:"+t)),o.iserror=!0,e(o),void this.doWaitState(t,o);i=a.CompressBundle,this.waitQueueState.push({state:o,type:i,onstate:e}),this.loadByMulQueue()},assetMgr.prototype.load=function(t,e,r){void 0===e&&(e=a.Auto),void 0===r&&(r=null),null==r&&(r=function(){});var i=this.getFileName(t);if(null==this.mapInLoad[i]){var o=new n;if(this.mapInLoad[i]=o,o.url=t,e==a.Auto&&(e=this.calcType(t)),e==a.Unknown)return o.errs.push(new Error("can not sure about type:"+t)),o.iserror=!0,r(o),void this.doWaitState(t,o);this.waitQueueState.push({state:o,type:e,onstate:r}),this.loadByMulQueue()}else this.mapInLoad[i].isfinish?r(this.mapInLoad[i]):(null==this.waitStateDic[i]&&(this.waitStateDic[i]=[]),this.waitStateDic[i].push(r))},assetMgr.prototype.unload=function(t,e){void 0===e&&(e=null);var a=this.getFileName(t);if(null!=this.mapInLoad[a]){var r=this.mapInLoad[a];for(var i in r.resstate)r.resstate[i].res.unuse();delete this.mapInLoad[a]}},assetMgr.prototype.loadScene=function(t,a){var r=new Array,i=this.app.getScene();if(t.length>0){for(var o=this.getAssetByName(t),n=o.getSceneRoot();n.children.length>0;){var s=n.children.shift();r.push(s),i.addChild(s)}i._overlay2d=new Array,o.useLightMap(i),o.useFog(i),o.useNavMesh(i)}else{var l=new e.transform;l.gameObject.addComponent("camera"),l.name="camera",r.push(l),i.addChild(l)}i.name=t,i.getRoot().markDirty(),a(r)},assetMgr.prototype.saveScene=function(a){t.io.SerializeDependent.resourseDatas=[];var r=new c,i={},o=this.app.getScene(),n=t.io.serializeObj(o.getRoot(),null,this),s=[],l=o.lightmaps;for(var h in l){var u={};u.name=l[h].getName(),s.push(u);var d=this.getAssetUrl(l[h]);t.io.SerializeDependent.resourseDatas.push({url:d,type:t.io.SaveAssetType.FullUrl})}var m=e.NavMeshLoadManager.Instance.navmeshJson,p={data:m=null==m?"":m};if(o.fog){o.fog._Color;o.fog._Color=o.fog._Color.x+","+o.fog._Color.y+","+o.fog._Color.z+","+o.fog._Color.z}i.fog=o.fog,i.rootNode=n,i.lightmap=s,i.navmesh=p;var f=JSON.stringify(i);o.fog&&(o.fog._Color=void 0);var g=this.getAssetByName(o.name);g.Parse(f,this);var v=this.getAssetUrl(g);r.files[v]=f,a(r,t.io.SerializeDependent.resourseDatas)},assetMgr.prototype.savePrefab=function(e,a,r){t.io.SerializeDependent.resourseDatas=[];var i=new c,o=this.getAssetByName(a);o.apply(e);var n=t.io.serializeObj(e,null,this),s=this.getAssetUrl(o);i.files[s]=JSON.stringify(n),r(i,t.io.SerializeDependent.resourseDatas)},assetMgr.prototype.saveMaterial=function(t,e){var a=new c,r={},i={},o=t.getShader();o.defaultMapUniform;r.shader=o.getName(),r.mapUniform=i;var n=this.getAssetUrl(t);a.files[n]=JSON.stringify(r),e(a)},assetMgr.prototype.loadSingleResImmediate=function(r,i){var o,n=this,s=this.getFileName(r),l=s.substring(0,s.indexOf("."));if(i==a.GLVertexShader)t.io.loadText(r,function(t,e){n.shaderPool.compileVS(n.webgl,l,t)});else if(i==a.GLFragmentShader)t.io.loadText(r,function(t,e){n.shaderPool.compileFS(n.webgl,l,t)});else if(i==a.Shader)o=new e.shader(s),t.io.loadText(r,function(t,e){o.parse(n,JSON.parse(t)),n.mapShader[s]=o});else if(i==a.Texture){o=new e.texture(s);var h=new Image;h.src=r,h.onload=function(){var e=t.render.TextureFormatEnum.RGBA;o.glTexture=new t.render.glTexture2D(n.webgl,e),o.glTexture.uploadImage(h,!0,!0,!0,!0),n.use(o)}}else{if(i!=a.Mesh)throw new Error("cant use the type:"+i);o=new e.mesh(s),t.io.loadArrayBuffer(r,function(t,e){o.Parse(t,n.webgl),n.use(o)})}return this.regRes(s,o),o},assetMgr.prototype.loadImmediate=function(e,r){void 0===r&&(r=a.Auto);var i;if(r==a.Auto&&(r=this.calcType(e)),r==a.Unknown)throw new Error("unknown format");return r==a.Bundle?(i=new s(e),t.io.loadText(e,function(t,e){i.parse(JSON.parse(t))})):i=this.loadSingleResImmediate(e,r),i},assetMgr.prototype.getFileName=function(t){var e=t.lastIndexOf("/");return t.substr(e+1)},assetMgr.prototype.calcType=function(t){for(var e=t.lastIndexOf("/"),r=t.substr(e+1),i=r.indexOf(".",0),o=null;i>=0;){if(".vs.glsl"==(o=r.substr(i)))return a.GLVertexShader;if(".assetbundle.json"==o)return a.Bundle;if(".fs.glsl"==o)return a.GLFragmentShader;if(".shader.json"==o)return a.Shader;if(".png"==o||".jpg"==o)return a.Texture;if(".pvr.bin"==o||".pvr"==o)return a.PVR;if(".imgdesc.json"==o)return a.TextureDesc;if(".mat.json"==o)return a.Material;if(".mesh.bin"==o)return a.Mesh;if(".aniclip.bin"==o)return a.Aniclip;if(".prefab.json"==o)return a.Prefab;if(".scene.json"==o)return a.Scene;if(".atlas.json"==o)return a.Atlas;if(".font.json"==o)return a.Font;if(".json"==o||".txt"==o||".effect.json"==o)return a.TextAsset;if(".packs.bin"==o)return a.PackBin;if(".packs.txt"==o)return a.PackTxt;if(".path.json"==o)return a.PathAsset;if(".f14effect.json"==o)return a.F14Effect;if(".dds"==o||".dds.bin"==o)return a.DDS;if(".keyframeAniclip.json"==o)return a.KeyFrameAniclip;i=r.indexOf(".",i+1)}return a.Unknown},assetMgr.prototype.getDefParticleMat=function(){if(null==this.particlemat){var t=new e.material("defparticle"),a=this.getShader("particles_additive.shader.json");null==a&&(a=this.getShader("shader/def")),t.setShader(a);var r=this.getDefaultTexture("grid");t.setTexture("_MainTex",r),this.particlemat=t}return this.particlemat},assetMgr}();e.assetMgr=l;var h=function(){return function assetRef(){}}();e.assetRef=h;var c=function(){return function SaveInfo(){this.files={}}}();e.SaveInfo=c}(t.framework||(t.framework={}))}(gd3d||(gd3d={}));var PvrParse=function(){function PvrParse(t){this.version=55727696,this.flags=0,this.pixelFormatH=0,this.pixelFormatL=0,this.channelType=0,this.height=1,this.width=1,this.depth=1,this.numFaces=1,this.mipMapCount=1,this.metaDataSize=0,this.gl=t}return PvrParse.prototype.parse=function(t){var e=new Uint8Array(t);t=null;var a=new gd3d.io.binTool;if(a.writeUint8Array(e),this.version=a.readUInt32(),55727696===this.version){var r=this.parseV3(a);return a.dispose(),r}if(1347834371!==this.version)return console.error("pvr parse error!:"+this.version),null;console.error("v2")},PvrParse.prototype.parseV3=function(t){this.flags=t.readUInt32(),0==this.flags?this.gl.pixelStorei(this.gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0):this.gl.pixelStorei(this.gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1),this.pixelFormatH=t.readUInt32(),this.pixelFormatL=t.readUInt32(),t.readBytes(4),this.channelType=t.readUInt32(),this.height=t.readUInt32(),this.width=t.readUInt32(),this.depth=t.readUInt32(),t.readBytes(4),this.numFaces=t.readUInt32(),this.mipMapCount=t.readUInt32(),this.metaDataSize=t.readUInt32(),t.readBytes(this.metaDataSize);var e,a,r=new gd3d.render.glTexture2D(this.gl);switch(this.pixelFormatH){case 0:a=r.ext.COMPRESSED_RGB_PVRTC_2BPPV1_IMG,e=gd3d.render.TextureFormatEnum.PVRTC2_RGB;break;case 1:a=r.ext.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG,e=gd3d.render.TextureFormatEnum.PVRTC2_RGBA;break;case 2:a=r.ext.COMPRESSED_RGB_PVRTC_4BPPV1_IMG,e=gd3d.render.TextureFormatEnum.PVRTC4_RGB;break;case 3:a=r.ext.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG,e=gd3d.render.TextureFormatEnum.PVRTC4_RGBA;break;default:a=this.gl.RGB,e=gd3d.render.TextureFormatEnum.RGB,console.log("unknow pixel format::"+this.pixelFormatH)}switch(r.format=e,this.channelType){case ChannelTypes.UnsignedByteNorm:this.gl.UNSIGNED_BYTE;break;case ChannelTypes.UnsignedShortNorm:}var i=this.gl.TEXTURE_2D;this.numFaces>1&&(i=this.gl.TEXTURE_CUBE_MAP),this.gl.pixelStorei(this.gl.UNPACK_ALIGNMENT,1),this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,0),this.gl.activeTexture(this.gl.TEXTURE0),this.gl.bindTexture(i,r.texture),this.numFaces>1&&(i=this.gl.TEXTURE_CUBE_MAP_POSITIVE_X);for(var o=this.width,n=this.height,s=0;s<this.mipMapCount;++s){var l=function textureLevelSize(t,e,a){switch(t){case r.ext.COMPRESSED_RGB_S3TC_DXT1_EXT:case r.ext.COMPRESSED_RGB_ATC_WEBGL:case r.ext.COMPRESSED_RGB_ETC1_WEBGL:return(e+3>>2)*(a+3>>2)*8;case r.ext.COMPRESSED_RGBA_S3TC_DXT3_EXT:case r.ext.COMPRESSED_RGBA_S3TC_DXT5_EXT:case r.ext.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL:case r.ext.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL:return(e+3>>2)*(a+3>>2)*16;case r.ext.COMPRESSED_RGB_PVRTC_4BPPV1_IMG:case r.ext.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:return Math.floor((Math.max(e,8)*Math.max(a,8)*4+7)/8);case r.ext.COMPRESSED_RGB_PVRTC_2BPPV1_IMG:case r.ext.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:return Math.floor((Math.max(e,16)*Math.max(a,8)*2+7)/8);default:return 0}}(a,o,n),h=t.readBytes(l);this.gl.compressedTexImage2D(this.gl.TEXTURE_2D,s,a,o,n,0,h),(o>>=1)<1&&(o=1),(n>>=1)<1&&(n=1),l}return this.mipMapCount>1?(this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR_MIPMAP_NEAREST)):(this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR)),r},PvrParse}(),ChannelTypes;!function(t){t[t.UnsignedByteNorm=0]="UnsignedByteNorm",t[t.SignedByteNorm=1]="SignedByteNorm",t[t.UnsignedByte=2]="UnsignedByte",t[t.SignedByte=3]="SignedByte",t[t.UnsignedShortNorm=4]="UnsignedShortNorm",t[t.SignedShortNorm=5]="SignedShortNorm",t[t.UnsignedShort=6]="UnsignedShort",t[t.SignedShort=7]="SignedShort",t[t.UnsignedIntegerNorm=8]="UnsignedIntegerNorm",t[t.SignedIntegerNorm=9]="SignedIntegerNorm",t[t.UnsignedInteger=10]="UnsignedInteger",t[t.SignedInteger=11]="SignedInteger",t[t.SignedFloat=12]="SignedFloat",t[t.Float=12]="Float",t[t.UnsignedFloat=13]="UnsignedFloat"}(ChannelTypes||(ChannelTypes={}));var gd3d;!function(t){!function(t){var e=function(){function defmaterial(){}return defmaterial.initDefaultMaterial=function(e){var a=new t.material,r=e.getShader("shader/defui");a.setShader(r),e.mapMaterial[r.getName()]=a},defmaterial}();t.defmaterial=e}(t.framework||(t.framework={}))}(gd3d||(gd3d={}));var gd3d;!function(t){!function(e){var a=function(){function defMesh(){}return defMesh.initDefaultMesh=function(e){e.mapDefaultMesh.cube=t.framework.defMesh.createDefaultMesh("cube",t.render.meshData.genBoxCCW(1),e.webgl),e.mapDefaultMesh.quad=t.framework.defMesh.createDefaultMesh("circleline",t.render.meshData.genQuad(1),e.webgl),e.mapDefaultMesh.quad_particle=t.framework.defMesh.createDefaultMesh("quad_particle",t.render.meshData.genQuad_forparticle(1),e.webgl),e.mapDefaultMesh.plane=t.framework.defMesh.createDefaultMesh("plane",t.render.meshData.genPlaneCCW(10),e.webgl),e.mapDefaultMesh.sphere=t.framework.defMesh.createDefaultMesh("sphere",t.render.meshData.genSphereCCW(),e.webgl),e.mapDefaultMesh.sphere_quality=t.framework.defMesh.createDefaultMesh("sphere_quality",t.render.meshData.genSphereCCW(2.58,40,40),e.webgl),e.mapDefaultMesh.pyramid=t.framework.defMesh.createDefaultMesh("pyramid",t.render.meshData.genPyramid(2,.5),e.webgl),e.mapDefaultMesh.cylinder=t.framework.defMesh.createDefaultMesh("cylinder",t.render.meshData.genCylinderCCW(2,.5),e.webgl),e.mapDefaultMesh.circleline=t.framework.defMesh.createDefaultMesh("circleline",t.render.meshData.genCircleLineCCW(1),e.webgl)},defMesh.createDefaultMesh=function(e,a,r){var i=new t.framework.mesh(e+".mesh.bin");i.defaultAsset=!0,i.data=a;var o=t.render.VertexFormatMask.Position|t.render.VertexFormatMask.Normal|t.render.VertexFormatMask.Tangent|t.render.VertexFormatMask.Color|t.render.VertexFormatMask.UV0;i.data.originVF=o;var n=i.data.genVertexDataArray(o),s=i.data.genIndexDataArray();i.glMesh=new t.render.glMesh,i.glMesh.initBuffer(r,o,i.data.pos.length),i.glMesh.uploadVertexData(r,n),i.glMesh.addIndex(r,s.length),i.glMesh.uploadIndexData(r,0,s),i.submesh=[];var l=new t.framework.subMeshInfo;return l.matIndex=0,l.useVertexIndex=0,l.start=0,l.size=s.length,l.line=!1,i.submesh.push(l),i},defMesh}();e.defMesh=a}(t.framework||(t.framework={}))}(gd3d||(gd3d={}));var gd3d;!function(t){!function(e){var a=function(){function defShader(){}return defShader.initDefaultShader=function(a){var r=a.shaderPool;r.compileVS(a.webgl,"def",defShader.vscode),r.compileFS(a.webgl,"def",defShader.fscode),r.compileFS(a.webgl,"def2",defShader.fscode2),r.compileFS(a.webgl,"defui",defShader.fscodeui),r.compileVS(a.webgl,"defuifont",defShader.vscodeuifont),r.compileFS(a.webgl,"defuifont",defShader.fscodeuifont),r.compileVS(a.webgl,"diffuse",defShader.vsdiffuse),r.compileFS(a.webgl,"diffuse",defShader.fsdiffuse),r.compileVS(a.webgl,"line",defShader.vsline),r.compileFS(a.webgl,"line",defShader.fsline),r.compileVS(a.webgl,"materialcolor",defShader.vsmaterialcolor),r.compileVS(a.webgl,"defUIMaskVS",defShader.vsUiMaskCode),r.compileFS(a.webgl,"defUIMaskFS",defShader.fscodeMaskUi),r.compileVS(a.webgl,"defuifontMaskVS",defShader.vscodeuifontmask),r.compileFS(a.webgl,"defuifontMaskFS",defShader.fscodeuifontmask);var i=r.linkProgram(a.webgl,"def","def"),o=r.linkProgram(a.webgl,"def","defui"),n=r.linkProgram(a.webgl,"defuifont","defuifont"),s=r.linkProgram(a.webgl,"diffuse","diffuse"),l=r.linkProgram(a.webgl,"line","line"),h=r.linkProgram(a.webgl,"materialcolor","line"),c=r.linkProgram(a.webgl,"defUIMaskVS","defUIMaskFS"),u=r.linkProgram(a.webgl,"defuifontMaskVS","defuifontMaskFS");(d=new e.shader("shader/def")).defaultAsset=!0,d.passes.base=[],(m=new t.render.glDrawPass).setProgram(i),d.passes.base.push(m),d.fillUnDefUniform(m),m.state_ztest=!0,m.state_ztest_method=t.render.webglkit.LEQUAL,m.state_zwrite=!0,m.state_showface=t.render.ShowFaceStateEnum.CCW,m.setAlphaBlend(t.render.BlendModeEnum.Close),a.mapShader[d.getName()]=d,(d=new e.shader("shader/def3dbeforeui")).defaultAsset=!0,d.passes.base=[],(m=new t.render.glDrawPass).setProgram(s),d.passes.base.push(m),d.fillUnDefUniform(m),m.state_ztest=!1,m.state_ztest_method=t.render.webglkit.LEQUAL,m.state_zwrite=!1,m.state_showface=t.render.ShowFaceStateEnum.CCW,m.setAlphaBlend(t.render.BlendModeEnum.Close),a.mapShader[d.getName()]=d,(d=new e.shader("shader/def2")).defaultAsset=!0,d.passes.base=[],(m=new t.render.glDrawPass).setProgram(o),d.passes.base.push(m),d.fillUnDefUniform(m),m.state_showface=t.render.ShowFaceStateEnum.ALL,m.state_ztest=!1,m.state_ztest_method=t.render.webglkit.LEQUAL,m.setAlphaBlend(t.render.BlendModeEnum.Close),a.mapShader[d.getName()]=d,(d=new e.shader("shader/defui")).defaultAsset=!0,d.passes.base=[],(m=new t.render.glDrawPass).setProgram(o),d.passes.base.push(m),d.fillUnDefUniform(m),m.state_showface=t.render.ShowFaceStateEnum.ALL,m.state_ztest=!1,m.state_zwrite=!1,m.state_ztest_method=t.render.webglkit.LEQUAL,m.setAlphaBlend(t.render.BlendModeEnum.Blend_PreMultiply),a.mapShader[d.getName()]=d,(d=new e.shader("shader/defuifont")).defaultAsset=!0,d.passes.base=[],(m=new t.render.glDrawPass).setProgram(n),d.passes.base.push(m),d.fillUnDefUniform(m),m.state_showface=t.render.ShowFaceStateEnum.ALL,m.state_ztest=!1,m.state_zwrite=!1,m.state_ztest_method=t.render.webglkit.LEQUAL,m.setAlphaBlend(t.render.BlendModeEnum.Blend_PreMultiply),a.mapShader[d.getName()]=d,(d=new e.shader("shader/line")).defaultAsset=!0,d.passes.base=[];m=new t.render.glDrawPass;d.passes.base.push(m),m.setProgram(l),d.fillUnDefUniform(m),m.state_ztest=!0,m.state_ztest_method=t.render.webglkit.LEQUAL,m.state_zwrite=!0,m.state_showface=t.render.ShowFaceStateEnum.ALL,m.setAlphaBlend(t.render.BlendModeEnum.Close),a.mapShader[d.getName()]=d,(d=new e.shader("shader/materialcolor")).defaultAsset=!0,d.passes.base=[];m=new t.render.glDrawPass;d.passes.base.push(m),m.setProgram(h),d.fillUnDefUniform(m),m.state_ztest=!1,m.state_showface=t.render.ShowFaceStateEnum.ALL,m.setAlphaBlend(t.render.BlendModeEnum.Blend),d.layer=e.RenderLayerEnum.Overlay,a.mapShader[d.getName()]=d,(d=new e.shader("shader/defmaskui")).defaultAsset=!0,d.passes.base=[];m=new t.render.glDrawPass;d.passes.base.push(m),d._parseProperties(a,JSON.parse(this.uishader).properties),m.setProgram(c),d.fillUnDefUniform(m),m.state_showface=t.render.ShowFaceStateEnum.ALL,m.state_ztest=!1,m.state_zwrite=!1,m.state_ztest_method=t.render.webglkit.LEQUAL,m.setAlphaBlend(t.render.BlendModeEnum.Blend_PreMultiply),a.mapShader[d.getName()]=d;var d=new e.shader("shader/defmaskfont");d.defaultAsset=!0,d.passes.base=[];var m=new t.render.glDrawPass;d.passes.base.push(m),d._parseProperties(a,JSON.parse(this.shaderuifront).properties),m.setProgram(u),d.fillUnDefUniform(m),m.state_showface=t.render.ShowFaceStateEnum.ALL,m.state_ztest=!1,m.state_zwrite=!1,m.state_ztest_method=t.render.webglkit.LEQUAL,m.setAlphaBlend(t.render.BlendModeEnum.Blend_PreMultiply),a.mapShader[d.getName()]=d},defShader.shader0="{            \"properties\": [              \"_MainTex('MainTex',Texture)='white'{}\"            ]          }",defShader.vscode="        attribute vec4 _glesVertex;           attribute vec4 _glesColor;                          attribute vec4 _glesMultiTexCoord0;                 uniform highp mat4 glstate_matrix_mvp;              varying lowp vec4 xlv_COLOR;                        varying highp vec2 xlv_TEXCOORD0;                   void main()                                             {                                                           highp vec4 tmpvar_1;                                    tmpvar_1.w = 1.0;                                       tmpvar_1.xyz = _glesVertex.xyz;                         xlv_COLOR = _glesColor;                                 xlv_TEXCOORD0 = _glesMultiTexCoord0.xy;                 gl_Position = (glstate_matrix_mvp * tmpvar_1);          }",defShader.vsUiMaskCode="        attribute vec4 _glesVertex;           attribute vec4 _glesColor;                          attribute vec4 _glesMultiTexCoord0;                 uniform highp mat4 glstate_matrix_mvp;              uniform lowp float MaskState;              varying lowp vec4 xlv_COLOR;                        varying highp vec2 xlv_TEXCOORD0;                   varying highp vec2 mask_TEXCOORD;                   void main()                                             {                                                           highp vec4 tmpvar_1;                                    tmpvar_1.w = 1.0;                                       tmpvar_1.xyz = _glesVertex.xyz;                         xlv_COLOR = _glesColor;                                 xlv_TEXCOORD0 = vec2(_glesMultiTexCoord0.x,1.0-_glesMultiTexCoord0.y);                 if(MaskState != 0.0){                    mask_TEXCOORD.x = (_glesVertex.x - 1.0)/-2.0;                mask_TEXCOORD.y = (_glesVertex.y - 1.0)/-2.0;            }            gl_Position = (glstate_matrix_mvp * tmpvar_1);          }",defShader.fscodeMaskUi="                 uniform sampler2D _MainTex;                                                         uniform highp vec4 _maskRect;                                                         uniform lowp float MaskState;              varying lowp vec4 xlv_COLOR;                                                         varying highp vec2 xlv_TEXCOORD0;           varying highp vec2 mask_TEXCOORD;                   bool CalcuCut(){               highp float l;            highp float t;            highp float r;            highp float b;            highp vec2 texc1;            bool beCut;            l = _maskRect.x;            t = _maskRect.y;            r = _maskRect.z + l;            b = _maskRect.w + t;            texc1 = mask_TEXCOORD;            if(texc1.x >(1.0 - l) || texc1.x <(1.0 - r) || texc1.y <t || texc1.y>b){                 beCut = true;             }else{                beCut = false;            }            return beCut;        }                   void main()         {            if(MaskState != 0.0 && CalcuCut()) discard;            lowp vec4 tmpvar_3;            tmpvar_3 = (xlv_COLOR * texture2D(_MainTex, xlv_TEXCOORD0));            gl_FragData[0] = tmpvar_3 ;        }        ",defShader.fscode="                 uniform sampler2D _MainTex;                                                         varying lowp vec4 xlv_COLOR;                                                         varying highp vec2 xlv_TEXCOORD0;           void main()         {            lowp vec4 col_1;                mediump vec4 prev_2;            lowp vec4 tmpvar_3;            tmpvar_3 = (xlv_COLOR * texture2D(_MainTex, xlv_TEXCOORD0));            prev_2 = tmpvar_3;            mediump vec4 tmpvar_4;            tmpvar_4 = mix(vec4(1.0, 1.0, 1.0, 1.0), prev_2, prev_2.wwww);            col_1 = tmpvar_4;            col_1.x =xlv_TEXCOORD0.x;            col_1.y =xlv_TEXCOORD0.y;            gl_FragData[0] = col_1;        }        ",defShader.fscode2="                 void main()         {            gl_FragData[0] = vec4(1.0, 1.0, 1.0, 1.0);        }        ",defShader.uishader="{            \"properties\": [              \"_MainTex('MainTex',Texture)='white'{}\",              \"_MaskTex('MaskTex',Texture)='white'{}\"            ]            }",defShader.fscodeui="                 uniform sampler2D _MainTex;                                                         varying lowp vec4 xlv_COLOR;                                                         varying highp vec2 xlv_TEXCOORD0;           void main()         {            lowp vec4 tmpvar_3;            tmpvar_3 = (xlv_COLOR * texture2D(_MainTex, xlv_TEXCOORD0));            gl_FragData[0] = tmpvar_3;        }        ",defShader.shaderuifront="{            \"properties\": [              \"_MainTex('MainTex',Texture)='white'{}\"            ]            }",defShader.vscodeuifont="        attribute vec4 _glesVertex;           attribute vec4 _glesColor;                          attribute vec4 _glesColorEx;                          attribute vec4 _glesMultiTexCoord0;                 uniform highp mat4 glstate_matrix_mvp;              varying lowp vec4 xlv_COLOR;                        varying lowp vec4 xlv_COLOREx;                                                         varying highp vec2 xlv_TEXCOORD0;                   void main()                                             {                                                           highp vec4 tmpvar_1;                                    tmpvar_1.w = 1.0;                                       tmpvar_1.xyz = _glesVertex.xyz;                         xlv_COLOR = _glesColor;                                 xlv_COLOREx = _glesColorEx;                                 xlv_TEXCOORD0 = vec2(_glesMultiTexCoord0.x,1.0-_glesMultiTexCoord0.y);                 gl_Position = (glstate_matrix_mvp * tmpvar_1);          }",defShader.fscodeuifont="        precision mediump float ;        uniform sampler2D _MainTex;        varying lowp vec4 xlv_COLOR;        varying lowp vec4 xlv_COLOREx;        varying highp vec2 xlv_TEXCOORD0;            void main()          {             float scale = 10.0;               float d = (texture2D(_MainTex, xlv_TEXCOORD0).r - 0.5)*scale;           float bd = (texture2D(_MainTex, xlv_TEXCOORD0).r - 0.34)*scale;                   float c=xlv_COLOR.a * clamp ( d,0.0,1.0);          float bc=xlv_COLOREx.a * clamp ( bd,0.0,1.0);          bc =min(1.0-c,bc);                                 gl_FragData[0] =xlv_COLOR*c + xlv_COLOREx*bc;     }",defShader.vscodeuifontmask="        attribute vec4 _glesVertex;           attribute vec4 _glesColor;                          attribute vec4 _glesColorEx;                          attribute vec4 _glesMultiTexCoord0;                 uniform highp mat4 glstate_matrix_mvp;              uniform lowp float MaskState;              varying lowp vec4 xlv_COLOR;                        varying lowp vec4 xlv_COLOREx;                                                         varying highp vec2 xlv_TEXCOORD0;                   varying highp vec2 mask_TEXCOORD;                   void main()                                             {                                                           highp vec4 tmpvar_1;                                    tmpvar_1.w = 1.0;                                       tmpvar_1.xyz = _glesVertex.xyz;                         xlv_COLOR = _glesColor;                                 xlv_COLOREx = _glesColorEx;                                 xlv_TEXCOORD0 = vec2(_glesMultiTexCoord0.x,1.0-_glesMultiTexCoord0.y);                 if(MaskState != 0.0){                    mask_TEXCOORD.x = (_glesVertex.x - 1.0)/-2.0;                mask_TEXCOORD.y = (_glesVertex.y - 1.0)/-2.0;            }            gl_Position = (glstate_matrix_mvp * tmpvar_1);          }",defShader.fscodeuifontmask="        precision mediump float;            uniform sampler2D _MainTex;              uniform lowp float MaskState;                  uniform highp vec4 _maskRect;                   varying lowp vec4 xlv_COLOR;             varying lowp vec4 xlv_COLOREx;             varying highp vec2 xlv_TEXCOORD0;                varying highp vec2 mask_TEXCOORD;                 bool CalcuCut(){                   highp float l;                highp float t;                highp float r;                highp float b;                highp vec2 texc1;                bool beCut;                l = _maskRect.x;                t = _maskRect.y;                r = _maskRect.z + l;                b = _maskRect.w + t;                texc1 = mask_TEXCOORD;                if(texc1.x >(1.0 - l) || texc1.x <(1.0 - r) || texc1.y <t || texc1.y>b){                     beCut = true;                 }else{                    beCut = false;                }                return beCut;            }                        void main()              {                 if(MaskState != 0.0 && CalcuCut())  discard;            float scale = 10.0;               float d = (texture2D(_MainTex, xlv_TEXCOORD0).r - 0.5)*scale;              float bd = (texture2D(_MainTex, xlv_TEXCOORD0).r - 0.34)*scale;                          float c=xlv_COLOR.a * clamp ( d,0.0,1.0);              float bc=xlv_COLOREx.a * clamp ( bd,0.0,1.0);              bc =min(1.0-c,bc);             lowp vec4 final =  xlv_COLOR*c + xlv_COLOREx*bc ;            gl_FragData[0] = final ;            }",defShader.diffuseShader="{            \"properties\": [              \"_MainTex('MainTex',Texture)='white'{}\",              \"_AlphaCut('AlphaCut',Range(0.0,1.0)) = 0.5\"            ]            }",defShader.vsdiffuse="        attribute vec4 _glesVertex;        attribute vec4 _glesMultiTexCoord0;        uniform highp mat4 glstate_matrix_mvp;        varying highp vec2 xlv_TEXCOORD0;        void main()        {            highp vec4 tmpvar_1;            tmpvar_1.w = 1.0;            tmpvar_1.xyz = _glesVertex.xyz;            xlv_TEXCOORD0 = _glesMultiTexCoord0.xy;            gl_Position = (glstate_matrix_mvp * tmpvar_1);        }",defShader.fsdiffuse="        uniform sampler2D _MainTex;        uniform lowp float _AlphaCut;        varying highp vec2 xlv_TEXCOORD0;        void main()         {            lowp vec4 tmpvar_3 = texture2D(_MainTex, xlv_TEXCOORD0);            if(tmpvar_3.a < _AlphaCut)                discard;            gl_FragData[0] = tmpvar_3;        }",defShader.vsline="        attribute vec4 _glesVertex;        attribute vec4 _glesColor;        uniform highp mat4 glstate_matrix_mvp;        varying lowp vec4 xlv_COLOR;        void main()        {            highp vec4 tmpvar_1;            tmpvar_1.w = 1.0;            tmpvar_1.xyz = _glesVertex.xyz;            xlv_COLOR = _glesColor;            gl_Position = (glstate_matrix_mvp * tmpvar_1);        }",defShader.fsline="        varying lowp vec4 xlv_COLOR;        void main()        {            gl_FragData[0] = xlv_COLOR;        }",defShader.materialShader='{            "properties": [              "_Color(\'Color\',Vector) = (1,1,1,1)",              "_Alpha(\'Alpha\', Range(0.0, 1.0)) = 1.0"            ]            }',defShader.vsmaterialcolor="        attribute vec4 _glesVertex;        uniform vec4 _Color;        uniform float _Alpha;        uniform highp mat4 glstate_matrix_mvp;        varying lowp vec4 xlv_COLOR;        void main()        {            highp vec4 tmpvar_1;            tmpvar_1.w = 1.0;            tmpvar_1.xyz = _glesVertex.xyz;            xlv_COLOR = _Color;            xlv_COLOR.a = xlv_COLOR.a * _Alpha;            gl_Position = (glstate_matrix_mvp * tmpvar_1);        }",defShader}();e.defShader=a}(t.framework||(t.framework={}))}(gd3d||(gd3d={}));var gd3d;!function(t){!function(e){var a=function(){function defsprite(){}return defsprite.initDefaultSprite=function(a){var r=new e.sprite("white_sprite");r.texture=a.getDefaultTexture("white"),r.defaultAsset=!0,r.rect=new t.math.rect(0,0,r.texture.glTexture.width,r.texture.glTexture.height),a.mapDefaultSprite.white_sprite=r;var i=new e.sprite("gray_sprite");i.texture=a.getDefaultTexture("gray"),i.defaultAsset=!0,i.rect=new t.math.rect(0,0,i.texture.glTexture.width,i.texture.glTexture.height),a.mapDefaultSprite.gray_sprite=i;var o=new e.sprite("grid_sprite");o.texture=a.getDefaultTexture("grid"),o.defaultAsset=!0,o.rect=new t.math.rect(0,0,o.texture.glTexture.width,o.texture.glTexture.height),a.mapDefaultSprite.grid_sprite=o},defsprite}();e.defsprite=a}(t.framework||(t.framework={}))}(gd3d||(gd3d={}));var gd3d;!function(t){!function(e){var a=function(){function defTexture(){}return defTexture.initDefaultTexture=function(a){var r=new e.texture("white");r.glTexture=t.render.glTexture2D.staticTexture(a.webgl,"white"),r.defaultAsset=!0,a.mapDefaultTexture.white=r,(r=new e.texture("gray")).glTexture=t.render.glTexture2D.staticTexture(a.webgl,"gray"),r.defaultAsset=!0,a.mapDefaultTexture.gray=r,(r=new e.texture("normal")).glTexture=t.render.glTexture2D.staticTexture(a.webgl,"normal"),r.defaultAsset=!0,a.mapDefaultTexture.normal=r,(r=new e.texture("grid")).glTexture=t.render.glTexture2D.staticTexture(a.webgl,"grid"),r.defaultAsset=!0,a.mapDefaultTexture.grid=r,defTexture.initDefaultCubeTexture(a)},defTexture.initDefaultCubeTexture=function(a){var r=a.mapDefaultTexture.white,i=new e.texture("white");i.glTexture=new t.render.glTextureCube(a.app.webgl),i.glTexture.uploadImages(r,r,r,r,r,r),i.defaultAsset=!0,a.mapDefaultCubeTexture.white=i},defTexture}();e.defTexture=a}(t.framework||(t.framework={}))}(gd3d||(gd3d={}));var gd3d;!function(t){!function(e){var a=function(){function AssetFactory_Aniclip(){}return AssetFactory_Aniclip.prototype.newAsset=function(){return null},AssetFactory_Aniclip.prototype.load=function(a,r,i,o,n){var s=e.getFileName(a);i.resstate[s]=new e.ResourceState,t.io.loadArrayBuffer(a,function(t,l){if(!e.AssetFactoryTools.catchError(l,r,i)){var h=n||new e.animationClip(s);h.Parse(t).then(function(){e.AssetFactoryTools.useAsset(o,r,i,h,a)})}},function(t,a){e.AssetFactoryTools.onProgress(t,a,r,i,s)})},AssetFactory_Aniclip.prototype.loadByPack=function(t,a,r,i,o,n){var s=e.getFileName(a);i.resstate[s]=new e.ResourceState;var l=t[s],h=n||new e.animationClip(s);h.Parse(l).then(function(){e.AssetFactoryTools.useAsset(o,r,i,h,a)})},AssetFactory_Aniclip}();e.AssetFactory_Aniclip=a}(t.framework||(t.framework={}))}(gd3d||(gd3d={}));var gd3d;!function(t){!function(e){var a=function(){function AssetFactory_Atlas(){}return AssetFactory_Atlas.prototype.newAsset=function(){return null},AssetFactory_Atlas.prototype.load=function(a,r,i,o,n){var s=e.getFileName(a);i.resstate[s]=new e.ResourceState,t.io.loadText(a,function(t,l){if(!e.AssetFactoryTools.catchError(l,r,i)){var h=n||new e.atlas(s);h.Parse(t,o),e.AssetFactoryTools.useAsset(o,r,i,h,a)}},function(t,a){e.AssetFactoryTools.onProgress(t,a,r,i,s)})},AssetFactory_Atlas.prototype.loadByPack=function(t,a,r,i,o,n){var s=e.getFileName(a);i.resstate[s]=new e.ResourceState;var l=t[s],h=n||new e.atlas(s);h.Parse(l,o),e.AssetFactoryTools.useAsset(o,r,i,h,a)},AssetFactory_Atlas}();e.AssetFactory_Atlas=a}(t.framework||(t.framework={}))}(gd3d||(gd3d={}));var gd3d;!function(t){!function(e){var a=function(){function AssetFactory_DDS(){}return AssetFactory_DDS.prototype.newAsset=function(){return null},AssetFactory_DDS.prototype.loadByPack=function(t,e,a,r,i,o){},AssetFactory_DDS.prototype.load=function(a,r,i,o,n){var s=e.getFileName(a);i.resstate[s]=new e.ResourceState,t.io.loadArrayBuffer(a,function(l,h){if(!e.AssetFactoryTools.catchError(h,r,i)){var c=n||new e.texture(s);o.webgl.pixelStorei(o.webgl.UNPACK_FLIP_Y_WEBGL,1),new WebGLTextureUtil(o.webgl,!0).loadDDS(a,null,function(e,a,r){var i=new t.render.glTexture2D(o.webgl);i.format=t.render.TextureFormatEnum.PVRTC2_RGB,i.texture=e,c.glTexture=i}),e.AssetFactoryTools.useAsset(o,r,i,c,a)}},function(t,a){e.AssetFactoryTools.onProgress(t,a,r,i,s)})},AssetFactory_DDS}();e.AssetFactory_DDS=a}(t.framework||(t.framework={}))}(gd3d||(gd3d={}));var gd3d;!function(t){!function(e){var a=function(){function AssetFactory_f14eff(){}return AssetFactory_f14eff.prototype.newAsset=function(){return null},AssetFactory_f14eff.prototype.load=function(a,r,i,o,n){var s=e.getFileName(i.url),l=e.getFileName(a);i.resstate[l]=new e.ResourceState,t.io.loadText(a,function(t,h){if(!e.AssetFactoryTools.catchError(h,r,i)){var c=n||new e.f14eff(l);c.assetbundle=s,c.Parse(t,o).then(function(){e.AssetFactoryTools.useAsset(o,r,i,c,a)})}},function(t,a){e.AssetFactoryTools.onProgress(t,a,r,i,l)})},AssetFactory_f14eff.prototype.loadByPack=function(t,a,r,i,o,n){var s=e.getFileName(i.url),l=e.getFileName(a);i.resstate[l]=new e.ResourceState;var h=t[l],c=n||new e.f14eff(l);c.assetbundle=s,c.Parse(h,o).then(function(){e.AssetFactoryTools.useAsset(o,r,i,c,a)})},AssetFactory_f14eff}();e.AssetFactory_f14eff=a}(t.framework||(t.framework={}))}(gd3d||(gd3d={}));var gd3d;!function(t){!function(e){var a=function(){function AssetFactory_Font(){}return AssetFactory_Font.prototype.newAsset=function(t){return null},AssetFactory_Font.prototype.load=function(a,r,i,o,n){var s=e.getFileName(a);i.resstate[s]=new e.ResourceState,t.io.loadText(a,function(t,l){if(!e.AssetFactoryTools.catchError(l,r,i)){var h=n||new e.font(s);h.Parse(t,o),e.AssetFactoryTools.useAsset(o,r,i,h,a)}},function(t,a){e.AssetFactoryTools.onProgress(t,a,r,i,s)})},AssetFactory_Font.prototype.loadByPack=function(t,a,r,i,o,n){var s=e.getFileName(a);i.resstate[s]=new e.ResourceState;var l=t[s],h=n||new e.font(s);h.Parse(l,o),e.AssetFactoryTools.useAsset(o,r,i,h,a)},AssetFactory_Font}();e.AssetFactory_Font=a}(t.framework||(t.framework={}))}(gd3d||(gd3d={}));var gd3d;!function(t){!function(e){var a=function(){function AssetFactory_GLFragmentShader(){}return AssetFactory_GLFragmentShader.prototype.newAsset=function(){return null},AssetFactory_GLFragmentShader.prototype.load=function(a,r,i,o,n){var s=e.getFileName(a),l=s.substring(0,s.indexOf("."));i.resstate[s]=new e.ResourceState,t.io.loadText(a,function(t,a){e.AssetFactoryTools.catchError(a,r,i)||(i.resstate[s].state=1,i.logs.push("load a glshader:"+s),o.shaderPool.mapFSString[l]=t,r(i))},function(t,a){e.AssetFactoryTools.onProgress(t,a,r,i,s)})},AssetFactory_GLFragmentShader.prototype.loadByPack=function(t,a,r,i,o,n){var s=e.getFileName(a),l=s.substring(0,s.indexOf("."));i.resstate[s]=new e.ResourceState;var h=t[s];h=decodeURI(h),i.resstate[s].state=1,i.logs.push("load a glshader:"+s),o.shaderPool.mapFSString[l]=h,r(i)},AssetFactory_GLFragmentShader}();e.AssetFactory_GLFragmentShader=a}(t.framework||(t.framework={}))}(gd3d||(gd3d={}));var gd3d;!function(t){!function(e){var a=function(){function AssetFactory_GLVertexShader(){}return AssetFactory_GLVertexShader.prototype.newAsset=function(){return null},AssetFactory_GLVertexShader.prototype.load=function(a,r,i,o,n){var s=e.getFileName(a),l=s.substring(0,s.indexOf("."));i.resstate[s]=new e.ResourceState,t.io.loadText(a,function(t,a){e.AssetFactoryTools.catchError(a,r,i)||(i.resstate[s].state=1,i.logs.push("load a glshader:"+s),o.shaderPool.mapVSString[l]=t,r(i))},function(t,a){e.AssetFactoryTools.onProgress(t,a,r,i,s)})},AssetFactory_GLVertexShader.prototype.loadByPack=function(t,a,r,i,o,n){var s=e.getFileName(a),l=s.substring(0,s.indexOf("."));i.resstate[s]=new e.ResourceState;var h=t[s];h=decodeURI(h),i.resstate[s].state=1,i.logs.push("load a glshader:"+s),o.shaderPool.mapVSString[l]=h,r(i)},AssetFactory_GLVertexShader}();e.AssetFactory_GLVertexShader=a}(t.framework||(t.framework={}))}(gd3d||(gd3d={}));var gd3d;!function(t){!function(t){function getFileName(t){var e=t.lastIndexOf("/");return t.substr(e+1)}var e=function(){function AssetFactoryTools(){}return AssetFactoryTools.catchError=function(t,e,a){return null!=t&&(a.iserror=!0,a.errs.push(new Error(t.message)),e(a),!0)},AssetFactoryTools.useAsset=function(t,e,a,r,i){var o=getFileName(i);t.setAssetUrl(r,i),t.use(r),a.resstate[o].state=1,a.resstate[o].res=r,e(a)},AssetFactoryTools.onProgress=function(t,e,a,r,i){r.resstate[i].loadedLength=t,r.progressCall=!0,a(r)},AssetFactoryTools.onRefProgress=function(t,e,a,r,i){r.resstate[i].refLoadedLength=t,r.progressCall=!0,a(r)},AssetFactoryTools}();t.AssetFactoryTools=e,t.getFileName=getFileName}(t.framework||(t.framework={}))}(gd3d||(gd3d={}));var gd3d;!function(t){!function(e){var a=function(){function assetfactory_keyFrameAniClip(){}return assetfactory_keyFrameAniClip.prototype.newAsset=function(){return null},assetfactory_keyFrameAniClip.prototype.load=function(a,r,i,o,n){var s=e.getFileName(a);i.resstate[s]=new e.ResourceState,t.io.loadText(a,function(t,l){if(!e.AssetFactoryTools.catchError(l,r,i)){var h=n||new e.keyFrameAniClip(s);h.Parse(t),e.AssetFactoryTools.useAsset(o,r,i,h,a)}},function(t,a){e.AssetFactoryTools.onProgress(t,a,r,i,s)})},assetfactory_keyFrameAniClip.prototype.loadByPack=function(t,a,r,i,o,n){var s=e.getFileName(a);i.resstate[s]=new e.ResourceState;var l=t[s],h=n||new e.keyFrameAniClip(s);h.Parse(l),e.AssetFactoryTools.useAsset(o,r,i,h,a)},assetfactory_keyFrameAniClip}();e.assetfactory_keyFrameAniClip=a}(t.framework||(t.framework={}))}(gd3d||(gd3d={}));var gd3d;!function(t){!function(e){var a=function(){function AssetFactory_Material(){}return AssetFactory_Material.prototype.newAsset=function(t){return null},AssetFactory_Material.prototype.load=function(a,r,i,o,n){var s=e.getFileName(a),l=e.getFileName(i.url);i.resstate[s]=new e.ResourceState,t.io.loadText(a,function(t,h){if(!e.AssetFactoryTools.catchError(h,r,i)){var c=n||new e.material(s);c.Parse(o,JSON.parse(t),l),e.AssetFactoryTools.useAsset(o,r,i,c,a)}},function(t,a){e.AssetFactoryTools.onProgress(t,a,r,i,s)})},AssetFactory_Material.prototype.loadByPack=function(t,a,r,i,o,n){var s=e.getFileName(a),l=e.getFileName(i.url);i.resstate[s]=new e.ResourceState;var h=t[s],c=n||new e.material(s);c.Parse(o,JSON.parse(h),l),e.AssetFactoryTools.useAsset(o,r,i,c,a)},AssetFactory_Material}();e.AssetFactory_Material=a}(t.framework||(t.framework={}))}(gd3d||(gd3d={}));var gd3d;!function(t){!function(e){var a=function(){function AssetFactory_Mesh(){}return AssetFactory_Mesh.prototype.newAsset=function(){return null},AssetFactory_Mesh.prototype.load=function(a,r,i,o,n){var s=e.getFileName(a);i.resstate[s]=new e.ResourceState,t.io.loadArrayBuffer(a,function(t,l){if(!e.AssetFactoryTools.catchError(l,r,i)){var h=n||new e.mesh(s);h.Parse(t,o.webgl).then(function(){e.AssetFactoryTools.useAsset(o,r,i,h,a)})}},function(t,a){e.AssetFactoryTools.onProgress(t,a,r,i,s)})},AssetFactory_Mesh.prototype.loadByPack=function(t,a,r,i,o,n){var s=e.getFileName(a);i.resstate[s]=new e.ResourceState;var l=t[s],h=n||new e.mesh(s);h.Parse(l,o.webgl).then(function(){e.AssetFactoryTools.useAsset(o,r,i,h,a)})},AssetFactory_Mesh}();e.AssetFactory_Mesh=a}(t.framework||(t.framework={}))}(gd3d||(gd3d={}));var gd3d;!function(t){!function(e){var a=function(){function AssetFactory_PathAsset(){}return AssetFactory_PathAsset.prototype.newAsset=function(){return null},AssetFactory_PathAsset.prototype.load=function(a,r,i,o,n){var s=e.getFileName(a);i.resstate[s]=new e.ResourceState,t.io.loadText(a,function(t,l){if(!e.AssetFactoryTools.catchError(l,r,i)){var h=n||new e.pathasset(s);h.Parse(JSON.parse(t)),e.AssetFactoryTools.useAsset(o,r,i,h,a)}},function(t,a){e.AssetFactoryTools.onProgress(t,a,r,i,s)})},AssetFactory_PathAsset.prototype.loadByPack=function(t,a,r,i,o,n){var s=e.getFileName(a);i.resstate[s]=new e.ResourceState;var l=t[s],h=n||new e.pathasset(s);h.Parse(JSON.parse(l)),e.AssetFactoryTools.useAsset(o,r,i,h,a)},AssetFactory_PathAsset}();e.AssetFactory_PathAsset=a}(t.framework||(t.framework={}))}(gd3d||(gd3d={}));var gd3d;!function(t){!function(e){var a=function(){function AssetFactory_Prefab(){}return AssetFactory_Prefab.prototype.newAsset=function(){return null},AssetFactory_Prefab.prototype.load=function(a,r,i,o,n){var s=e.getFileName(i.url),l=e.getFileName(a);i.resstate[l]=new e.ResourceState,t.io.loadText(a,function(t,h){if(!e.AssetFactoryTools.catchError(h,r,i)){var c=n||new e.prefab(l);c.assetbundle=s,c.Parse(t,o),c.Parse(t,o).then(function(){e.AssetFactoryTools.useAsset(o,r,i,c,a)})}},function(t,a){e.AssetFactoryTools.onProgress(t,a,r,i,l)})},AssetFactory_Prefab.prototype.loadByPack=function(t,a,r,i,o,n){var s=e.getFileName(i.url),l=e.getFileName(a);i.resstate[l]=new e.ResourceState;var h=t[l],c=n||new e.prefab(l);c.assetbundle=s,c.Parse(h,o).then(function(){e.AssetFactoryTools.useAsset(o,r,i,c,a)})},AssetFactory_Prefab}();e.AssetFactory_Prefab=a}(t.framework||(t.framework={}))}(gd3d||(gd3d={}));var gd3d;!function(t){!function(e){var a=function(){function AssetFactory_PVR(){}return AssetFactory_PVR.prototype.newAsset=function(){return null},AssetFactory_PVR.prototype.load=function(a,r,i,o,n){var s=e.getFileName(a);i.resstate[s]=new e.ResourceState,t.io.loadArrayBuffer(a,function(t,l){if(!e.AssetFactoryTools.catchError(l,r,i)){var h=n||new e.texture(s),c=new PvrParse(o.webgl);h.glTexture=c.parse(t),e.AssetFactoryTools.useAsset(o,r,i,h,a)}},function(t,a){e.AssetFactoryTools.onProgress(t,a,r,i,s)})},AssetFactory_PVR.prototype.loadByPack=function(t,e,a,r,i,o){},AssetFactory_PVR}();e.AssetFactory_PVR=a}(t.framework||(t.framework={}))}(gd3d||(gd3d={}));var gd3d;!function(t){!function(e){var a=function(){function AssetFactory_Scene(){}return AssetFactory_Scene.prototype.newAsset=function(){return null},AssetFactory_Scene.prototype.load=function(a,r,i,o,n){var s=e.getFileName(i.url),l=e.getFileName(a);i.resstate[l]=new e.ResourceState,t.io.loadText(a,function(t,h){if(!e.AssetFactoryTools.catchError(h,r,i)){var c=n||new e.rawscene(l);c.assetbundle=s,c.Parse(t,o).then(function(){e.AssetFactoryTools.useAsset(o,r,i,c,a)})}},function(t,a){e.AssetFactoryTools.onProgress(t,a,r,i,l)})},AssetFactory_Scene.prototype.loadByPack=function(t,a,r,i,o,n){var s=e.getFileName(i.url),l=e.getFileName(a);i.resstate[l]=new e.ResourceState;var h=t[l],c=n||new e.rawscene(l);c.assetbundle=s,c.Parse(h,o).then(function(){e.AssetFactoryTools.useAsset(o,r,i,c,a)})},AssetFactory_Scene}();e.AssetFactory_Scene=a}(t.framework||(t.framework={}))}(gd3d||(gd3d={}));var gd3d;!function(t){!function(e){var a=function(){function AssetFactory_Shader(){}return AssetFactory_Shader.prototype.newAsset=function(){return null},AssetFactory_Shader.prototype.load=function(a,r,i,o,n){var s=e.getFileName(a);i.resstate[s]=new e.ResourceState,t.io.loadText(a,function(t,n){if(!e.AssetFactoryTools.catchError(n,r,i)){var l=new e.shader(s);try{l.parse(o,JSON.parse(t))}catch(t){throw console.error("error  filename :"+s),new Error("shader on parse")}o.setAssetUrl(l,a),o.mapShader[s]=l,i.resstate[s].state=1,r(i)}},function(t,a){e.AssetFactoryTools.onProgress(t,a,r,i,s)})},AssetFactory_Shader.prototype.loadByPack=function(t,a,r,i,o,n){var s=e.getFileName(a);s.substring(0,s.indexOf("."));i.resstate[s]=new e.ResourceState;var l=t[s];i.resstate[s].state=1;var h=new e.shader(s);try{h.parse(o,JSON.parse(l))}catch(t){throw console.error("error  filename :"+s),new Error("shader on parse")}o.setAssetUrl(h,a),o.mapShader[s]=h,r(i)},AssetFactory_Shader}();e.AssetFactory_Shader=a}(t.framework||(t.framework={}))}(gd3d||(gd3d={}));var gd3d;!function(t){!function(e){var a=function(){function AssetFactory_TextAsset(){}return AssetFactory_TextAsset.prototype.newAsset=function(){return null},AssetFactory_TextAsset.prototype.load=function(a,r,i,o,n){var s=e.getFileName(a);i.resstate[s]=new e.ResourceState,t.io.loadText(a,function(t,l){if(!e.AssetFactoryTools.catchError(l,r,i)){var h=n||new e.textasset(s);h.content=t,e.AssetFactoryTools.useAsset(o,r,i,h,a)}},function(t,a){e.AssetFactoryTools.onProgress(t,a,r,i,s)})},AssetFactory_TextAsset.prototype.loadByPack=function(t,a,r,i,o,n){var s=e.getFileName(a);i.resstate[s]=new e.ResourceState;var l=t[s],h=n||new e.textasset(s);h.content=l,e.AssetFactoryTools.useAsset(o,r,i,h,a)},AssetFactory_TextAsset}();e.AssetFactory_TextAsset=a}(t.framework||(t.framework={}))}(gd3d||(gd3d={}));var gd3d;!function(t){!function(e){var a=function(){function AssetFactory_Texture(){}return AssetFactory_Texture.prototype.newAsset=function(){return null},AssetFactory_Texture.prototype.load=function(a,r,i,o,n){var s=e.getFileName(a);i.resstate[s]=new e.ResourceState,t.io.loadImg(a,function(l,h){if(!e.AssetFactoryTools.catchError(h,r,i)){var c=n||new e.texture(s),u=t.render.TextureFormatEnum.RGBA,d=new t.render.glTexture2D(o.webgl,u);d.uploadImage(l,!0,!0,!0,!0),c.glTexture=d,e.AssetFactoryTools.useAsset(o,r,i,c,a)}},function(t,a){e.AssetFactoryTools.onProgress(t,a,r,i,s)})},AssetFactory_Texture.prototype.loadByPack=function(t,e,a,r,i,o){},AssetFactory_Texture}();e.AssetFactory_Texture=a}(t.framework||(t.framework={}))}(gd3d||(gd3d={}));var gd3d;!function(t){!function(e){var a=function(){function AssetFactory_TextureDesc(){}return AssetFactory_TextureDesc.prototype.newAsset=function(){return null},AssetFactory_TextureDesc.prototype.load=function(a,r,i,o,n){var s=e.getFileName(a);i.resstate[s]=new e.RefResourceState,t.io.loadText(a,function(l,h){if(!e.AssetFactoryTools.catchError(h,r,i)){var c=JSON.parse(l),u=c.name,d=c.filterMode,m=c.format,p=c.mipmap,f=c.wrap,g=c.premultiplyAlpha;void 0==g&&(g=!0);var v=t.render.TextureFormatEnum.RGBA;"RGB"==m?v=t.render.TextureFormatEnum.RGB:"Gray"==m&&(v=t.render.TextureFormatEnum.Gray);var y=!0;d.indexOf("linear")<0&&(y=!1);var _=!1;f.indexOf("Repeat")>=0&&(_=!0);var b=a.replace(s,u);b.indexOf(".pvr.bin")>=0?t.io.loadArrayBuffer(b,function(t,l){if(!e.AssetFactoryTools.catchError(l,r,i)){var h=n||new e.texture(s),c=new PvrParse(o.webgl);h.glTexture=c.parse(t),e.AssetFactoryTools.useAsset(o,r,i,h,a)}},function(t,a){e.AssetFactoryTools.onRefProgress(t,a,r,i,s)}):b.indexOf(".dds.bin")>=0?t.io.loadArrayBuffer(b,function(l,h){if(!e.AssetFactoryTools.catchError(h,r,i)){var c=n||new e.texture(s);o.webgl.pixelStorei(o.webgl.UNPACK_FLIP_Y_WEBGL,1),new WebGLTextureUtil(o.webgl,!0).loadDDS(b,null,function(e,a,r){var i=new t.render.glTexture2D(o.webgl);i.format=t.render.TextureFormatEnum.PVRTC2_RGB,i.texture=e,c.glTexture=i}),e.AssetFactoryTools.useAsset(o,r,i,c,a)}},function(t,a){e.AssetFactoryTools.onProgress(t,a,r,i,s)}):t.io.loadImg(b,function(l,h){if(!e.AssetFactoryTools.catchError(h,r,i)){var c=n||new e.texture(s);c.realName=u;var d=new t.render.glTexture2D(o.webgl,v);d.uploadImage(l,p,y,g,_),c.glTexture=d,e.AssetFactoryTools.useAsset(o,r,i,c,a)}},function(t,a){e.AssetFactoryTools.onRefProgress(t,a,r,i,s)})}},function(t,a){e.AssetFactoryTools.onProgress(t,a,r,i,s)})},AssetFactory_TextureDesc.prototype.loadByPack=function(a,r,i,o,n,s){var l=e.getFileName(r),h=a[l],c=JSON.parse(h),u=c.name,d=c.filterMode,m=c.format,p=c.mipmap,f=c.wrap,g=c.premultiplyAlpha;void 0==g&&(g=!0);var v=t.render.TextureFormatEnum.RGBA;"RGB"==m?v=t.render.TextureFormatEnum.RGB:"Gray"==m&&(v=t.render.TextureFormatEnum.Gray);var y=!0;d.indexOf("linear")<0&&(y=!1);var _=!1;f.indexOf("Repeat")>=0&&(_=!0);var b=r.replace(l,u);o.resstate[l]=new e.ResourceState,b.indexOf(".pvr.bin")>=0?t.io.loadArrayBuffer(b,function(t,a){if(!e.AssetFactoryTools.catchError(a,i,o)){var h=s||new e.texture(l),c=new PvrParse(n.webgl);console.log(b),h.glTexture=c.parse(t),e.AssetFactoryTools.useAsset(n,i,o,h,r)}},function(t,a){e.AssetFactoryTools.onProgress(t,a,i,o,l)}):b.indexOf(".dds.bin")>=0?t.io.loadArrayBuffer(b,function(a,h){if(!e.AssetFactoryTools.catchError(h,i,o)){var c=s||new e.texture(l);n.webgl.pixelStorei(n.webgl.UNPACK_FLIP_Y_WEBGL,1),new WebGLTextureUtil(n.webgl,!0).loadDDS(b,null,function(e,a,r){var i=new t.render.glTexture2D(n.webgl);i.format=t.render.TextureFormatEnum.PVRTC2_RGB,i.texture=e,c.glTexture=i}),e.AssetFactoryTools.useAsset(n,i,o,c,r)}},function(t,a){e.AssetFactoryTools.onProgress(t,a,i,o,l)}):t.io.loadImg(b,function(a,h){if(!e.AssetFactoryTools.catchError(h,i,o)){var c=s||new e.texture(l);c.realName=u;var d=new t.render.glTexture2D(n.webgl,v);d.uploadImage(a,p,y,g,_),c.glTexture=d,e.AssetFactoryTools.useAsset(n,i,o,c,r)}},function(t,a){e.AssetFactoryTools.onProgress(t,a,i,o,l)})},AssetFactory_TextureDesc}();e.AssetFactory_TextureDesc=a}(t.framework||(t.framework={}))}(gd3d||(gd3d={}));var gd3d;!function(t){!function(e){var a=function(){function animationClip(t){void 0===t&&(t=null),this.id=new e.resID,this.defaultAsset=!1,this.frames={},t||(t="animationClip_"+this.getGUID()),this.name=new e.constText(t)}return animationClip.prototype.getName=function(){return this.name.getText()},animationClip.prototype.getGUID=function(){return this.id.getID()},animationClip.prototype.use=function(){e.sceneMgr.app.getAssetMgr().use(this)},animationClip.prototype.unuse=function(t){void 0===t&&(t=!1),e.sceneMgr.app.getAssetMgr().unuse(this,t)},animationClip.prototype.dispose=function(){this.bones.length=0,this.subclips.length=0,delete this.frames},animationClip.prototype.caclByteLength=function(){var e=0;for(var a in this.bones)e+=t.math.caclStringByteLength(this.bones[a]);for(var a in this.frames)e+=this.frames[a].byteLength,e+=t.math.caclStringByteLength(a);return e+=i.caclByteLength()*this.subclips.length},animationClip.prototype.Parse=function(e){var a=this;return new t.threading.gdPromise(function(r){t.threading.thread.Instance.Call("animiclipHandle",e,function(t){for(var e in t)a[e]=t[e];r()})})},Object.defineProperty(animationClip.prototype,"time",{get:function(){return this.frameCount&&this.fps?this.frameCount/this.fps:0},enumerable:!0,configurable:!0}),__decorate([t.reflect.Field("constText"),__metadata("design:type",e.constText)],animationClip.prototype,"name",void 0),animationClip=__decorate([t.reflect.SerializeType,__metadata("design:paramtypes",[String])],animationClip)}();e.animationClip=a;var r=function(){function PoseBoneMatrix(){}return e=PoseBoneMatrix,PoseBoneMatrix.caclByteLength=function(){return 28},PoseBoneMatrix.prototype.Clone=function(){var a=new e;return a.t=new t.math.vector3,a.r=new t.math.quaternion,t.math.vec3Clone(this.t,a.t),t.math.quatClone(this.r,a.r),a},PoseBoneMatrix.prototype.load=function(e){var a=e.readSingle(),r=e.readSingle(),i=e.readSingle(),o=e.readSingle();this.r=new t.math.quaternion(a,r,i,o);var a=e.readSingle(),r=e.readSingle(),i=e.readSingle();this.t=new t.math.vector3(a,r,i)},PoseBoneMatrix.createDefault=function(){var a=new e;return a.r=new t.math.quaternion(0,0,0,1),a.t=new t.math.vector3(0,0,0),a},PoseBoneMatrix.prototype.copyFrom=function(t){this.r.rawData.set(t.r.rawData),this.t.rawData.set(t.t.rawData)},PoseBoneMatrix.prototype.copyFromData=function(t,e){this.r.x=t[e+0],this.r.y=t[e+1],this.r.z=t[e+2],this.r.w=t[e+3],this.t.x=t[e+4],this.t.y=t[e+5],this.t.z=t[e+6]},PoseBoneMatrix.prototype.invert=function(){t.math.quatInverse(this.r,this.r),t.math.quatTransformVector(this.r,this.t,this.t),this.t.x*=-1,this.t.y*=-1,this.t.z*=-1},PoseBoneMatrix.prototype.lerpInWorld=function(t,a,r,i){var o=e.sMultiply(a,t),n=e.sMultiply(r,t),s=e.sLerp(o,n,i),l=t.Clone();l.invert(),e.sMultiply(s,l,this)},PoseBoneMatrix.prototype.lerpInWorldWithData=function(t,a,r,i,o){var n=e.sMultiply(a,t),s=e.sMultiplyDataAndMatrix(r,i,t),l=e.sLerp(n,s,o),h=t.Clone();h.invert(),e.sMultiply(l,h,this)},PoseBoneMatrix.sMultiply=function(a,r,i){void 0===i&&(i=null),null==i&&(i=e.createDefault());var o=t.math.pool.new_vector3();t.math.vec3Clone(r.t,o);var n=t.math.pool.new_vector3();return t.math.quatTransformVector(a.r,o,n),i.t.x=n.x+a.t.x,i.t.y=n.y+a.t.y,i.t.z=n.z+a.t.z,t.math.quatMultiply(a.r,r.r,i.r),t.math.pool.delete_vector3(o),t.math.pool.delete_vector3(n),i},PoseBoneMatrix.sMultiplyDataAndMatrix=function(a,r,i,o){void 0===o&&(o=null),null==o&&(o=e.createDefault());var n=t.math.pool.new_vector3();t.math.vec3Clone(i.t,n);var s=t.math.pool.new_vector3();return t.math.quatTransformVectorDataAndQuat(a,r+0,n,s),o.t.x=s.x+a[r+4],o.t.y=s.y+a[r+5],o.t.z=s.z+a[r+6],t.math.quatMultiplyDataAndQuat(a,r+0,i.r,o.r),t.math.pool.delete_vector3(n),t.math.pool.delete_vector3(s),o},PoseBoneMatrix.sLerp=function(a,r,i,o){return void 0===o&&(o=null),null==o&&(o=e.createDefault()),o.t.x=a.t.x*(1-i)+r.t.x*i,o.t.y=a.t.y*(1-i)+r.t.y*i,o.t.z=a.t.z*(1-i)+r.t.z*i,t.math.quatLerp(a.r,r.r,o.r,i),o},__decorate([t.reflect.Field("vector3"),__metadata("design:type",t.math.vector3)],PoseBoneMatrix.prototype,"t",void 0),__decorate([t.reflect.Field("quaternion"),__metadata("design:type",t.math.quaternion)],PoseBoneMatrix.prototype,"r",void 0),PoseBoneMatrix=e=__decorate([t.reflect.SerializeType],PoseBoneMatrix);var e}();e.PoseBoneMatrix=r;var i=function(){function subClip(){}return subClip.caclByteLength=function(){var e=0;return e+=t.math.caclStringByteLength(name),e+=1,e+=8},subClip}();e.subClip=i}(t.framework||(t.framework={}))}(gd3d||(gd3d={}));var gd3d;!function(t){!function(e){var a=function(){function atlas(t){void 0===t&&(t=null),this.id=new e.resID,this.sprites={},t||(t="atlas_"+this.getGUID()),this.name=new e.constText(t)}return atlas.prototype.getName=function(){return this.name.getText()},atlas.prototype.getGUID=function(){return this.id.getID()},atlas.prototype.use=function(){e.sceneMgr.app.getAssetMgr().use(this)},atlas.prototype.unuse=function(t){void 0===t&&(t=!1),e.sceneMgr.app.getAssetMgr().unuse(this,t)},atlas.prototype.dispose=function(){for(var t in this.sprites)this.sprites[t].unuse();this.texture.unuse(),delete this.sprites},atlas.prototype.caclByteLength=function(){var e=0;for(var a in this.sprites)e+=this.sprites[a].caclByteLength(),e+=t.math.caclStringByteLength(a);return e},Object.defineProperty(atlas.prototype,"texture",{get:function(){return this._texture},set:function(t){null!=this._texture&&this._texture.unuse(),this._texture=t,this._texture.use()},enumerable:!0,configurable:!0}),atlas.prototype.Parse=function(a,r){var i=JSON.parse(a),o=i.t;this.texturewidth=i.w,this.textureheight=i.h;var n=i.s;this.texture=r.getAssetByName(o),null==this.texture&&console.log("atlas的图片名字不对");for(var s in n){var l=n[s],h=l[0],c=new e.sprite(this.getName()+"_"+h);r.use(c),this.texture&&(c.texture=this.texture),c.rect=new t.math.rect(l[1],l[2],l[3],l[4]),c.border=new t.math.border(0,0,0,0),c.atlas=this.getName(),this.sprites[h]=c}},__decorate([t.reflect.Field("constText"),__metadata("design:type",e.constText)],atlas.prototype,"name",void 0),atlas=__decorate([t.reflect.SerializeType,__metadata("design:paramtypes",[String])],atlas)}();e.atlas=a}(t.framework||(t.framework={}))}(gd3d||(gd3d={}));var gd3d;!function(t){!function(e){var a=function(){return function f14node(){}}();e.f14node=a;var r=function(){function f14eff(t){void 0===t&&(t=null),this.defaultAsset=!1,this.name=null,this.id=new e.resID,this.assetbundle=null,t||(t="f14eff_"+this.getGUID()),this.name=new e.constText(t)}return f14eff.prototype.getName=function(){return void 0==this.name?null:this.name.getText()},f14eff.prototype.getGUID=function(){return this.id.getID()},f14eff.prototype.use=function(){},f14eff.prototype.unuse=function(t){},f14eff.prototype.dispose=function(){},f14eff.prototype.caclByteLength=function(){return 0},f14eff.prototype.Parse=function(t,a){var r=JSON.parse(t);return this.data=new e.F14EffectData,this.data.parsejson(r,a,this.assetbundle)},f14eff.prototype.getDependents=function(){if(this.data&&this.data.layers){var t=[];return this.doSearch(this.data.layers,t),t}},f14eff.prototype.doSearch=function(t,a){var r=this;if(t)if((t instanceof e.material||t instanceof e.mesh||t instanceof e.texture)&&a.push(t),t instanceof Array)t.forEach(function(t){t&&"object"==typeof t&&r.doSearch(t,a)});else for(var i=Reflect.ownKeys(t),o=0;o<i.length;o++)"object"==typeof t[i[o]]&&this.doSearch(t[i[o]],a)},f14eff=__decorate([t.reflect.SerializeType,__metadata("design:paramtypes",[String])],f14eff)}();e.f14eff=r}(t.framework||(t.framework={}))}(gd3d||(gd3d={}));var gd3d;!function(t){!function(e){var a=function(){function font(t){void 0===t&&(t=null),this.id=new e.resID,t||(t="font_"+this.getGUID()),this.name=new e.constText(t)}return font.prototype.getName=function(){return this.name.getText()},font.prototype.getGUID=function(){return this.id.getID()},font.prototype.use=function(){e.sceneMgr.app.getAssetMgr().use(this)},font.prototype.unuse=function(t){void 0===t&&(t=!1),e.sceneMgr.app.getAssetMgr().unuse(this,t)},font.prototype.dispose=function(){this.texture&&this.texture.unuse(!0),delete this.cmap},font.prototype.caclByteLength=function(){var e=0;for(var a in this.cmap)e+=t.math.caclStringByteLength(a),e+=r.caclByteLength();return e},Object.defineProperty(font.prototype,"texture",{get:function(){return this._texture},set:function(t){null!=this._texture&&this._texture.unuse(),this._texture=t,this._texture.use()},enumerable:!0,configurable:!0}),font.prototype.Parse=function(t,e){var a=(new Date).valueOf(),i=JSON.parse(t),o=i.font;this.fontname=o[0];var n=o[1];this.texture=e.getAssetByName(n),this.pointSize=o[2],this.padding=o[3],this.lineHeight=o[4],this.baseline=o[5],this.atlasWidth=o[6],this.atlasHeight=o[7],this.cmap={};var s=i.map;for(var l in s){var h=new r;this.cmap[l]=h,h.x=(s[l][0]-.5)/this.atlasWidth,h.y=(s[l][1]-.5)/this.atlasHeight,h.w=(s[l][2]+1)/this.atlasWidth,h.h=(s[l][3]+1)/this.atlasHeight,h.xSize=s[l][2],h.ySize=s[l][3],h.xOffset=s[l][4],h.yOffset=s[l][5],h.xAddvance=s[l][6]}s=null,i=null;(new Date).valueOf()},font=__decorate([t.reflect.SerializeType,__metadata("design:paramtypes",[String])],font)}();e.font=a;var r=function(){function charinfo(){this.xOffset=0,this.yOffset=0}return charinfo.caclByteLength=function(){return 36},charinfo}();e.charinfo=r}(t.framework||(t.framework={}))}(gd3d||(gd3d={}));var gd3d;!function(t){!function(e){var a=function(){function transform(){this.name="noname",this.insId=new r,this.prefab="",this.aabbdirty=!0,this.aabbchilddirty=!0,this.aabbchild=new t.framework.aabb(t.math.pool.vector3_zero,t.math.pool.vector3_zero),this.helperLocalPos=new t.math.vector3,this.helperLocalSca=new t.math.vector3,this.helperLocalRot=new t.math.quaternion,this._needremakeLocalMtx=!0,this.dirty=!0,this.dirtyChild=!0,this.hasComponent=!1,this.hasComponentChild=!1,this.hasRendererComp=!1,this.hasRendererCompChild=!1,this.needWorldDecompose=!0,this.localRotate=new t.math.quaternion,this.localTranslate=new t.math.vector3(0,0,0),this.localScale=new t.math.vector3(1,1,1),this.localMatrix=new t.math.matrix,this._localEulerAngles=new t.math.vector3(0,0,0),this.worldMatrix=new t.math.matrix,this.worldRotate=new t.math.quaternion,this.worldTranslate=new t.math.vector3(0,0,0),this.worldScale=new t.math.vector3(1,1,1),this._beDispose=!1}return Object.defineProperty(transform.prototype,"scene",{get:function(){if(null==this._scene){if(null==this.parent)return null;this._scene=this.parent.scene}return this._scene},set:function(t){this._scene=t},enumerable:!0,configurable:!0}),transform.prototype.markAABBDirty=function(){this.aabbdirty=!0,this.markAABBChildDirty();for(var t=this.parent;null!=t;)t.markAABBChildDirty(),t=t.parent},transform.prototype.markAABBChildDirty=function(){this.aabbchilddirty=!0},transform.prototype.caclAABB=function(){null!=this.gameObject.components&&(null==this.aabb&&(this.aabb=this.buildAABB(),this.aabb.cloneTo(this.aabbchild)),this.aabb.update(this.worldMatrix))},transform.prototype.caclAABBChild=function(){if(null!=this.aabb&&(this.aabb.cloneTo(this.aabbchild),null!=this.children))for(var t=0;t<this.children.length;t++)this.aabbchild.addAABB(this.children[t].aabbchild)},transform.prototype.buildAABB=function(){var a=new t.math.vector3,r=new t.math.vector3,i=this.gameObject.getComponent("meshFilter");if(null!=i&&null!=i.mesh&&null!=i.mesh.data&&null!=i.mesh.data.pos){var o=i.mesh.data;t.math.vec3SetByFloat(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,a),t.math.vec3SetByFloat(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE,r);for(l=0;l<o.pos.length;l++)t.math.vec3Max(o.pos[l],r,r),t.math.vec3Min(o.pos[l],a,a)}else{var n=this.gameObject.getComponent("skinnedMeshRenderer");if(null!=n&&null!=n.mesh&&null!=n.mesh.data&&null!=n.mesh.data.pos){var s=n.mesh.data;t.math.vec3SetByFloat(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,a),t.math.vec3SetByFloat(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE,r);for(var l=0;l<s.pos.length;l++)t.math.vec3Max(s.pos[l],r,r),t.math.vec3Min(s.pos[l],a,a)}else a.x=-1,a.y=-1,a.z=-1,r.x=1,r.y=1,r.z=1}return new e.aabb(a,r)},transform.prototype.addChild=function(t){null!=t.parent&&t.parent.removeChild(t),null==this.children&&(this.children=[]),this.children.push(t),t.scene=this.scene,t.parent=this,e.sceneMgr.app.markNotify(t,e.NotifyType.AddChild),(t.hasComponent||t.hasComponentChild)&&this.markHaveComponent(),(t.hasRendererComp||t.hasRendererCompChild)&&this.markHaveRendererComp()},transform.prototype.addChildAt=function(t,a){a<0||(null!=t.parent&&t.parent.removeChild(t),null==this.children&&(this.children=[]),this.children.splice(a,0,t),t.scene=this.scene,t.parent=this,e.sceneMgr.app.markNotify(t,e.NotifyType.AddChild),(t.hasComponent||t.hasComponentChild)&&this.markHaveComponent(),(t.hasRendererComp||t.hasRendererCompChild)&&this.markHaveRendererComp())},transform.prototype.removeAllChild=function(){if(void 0!=this.children)for(;this.children.length>0;)this.removeChild(this.children[0])},transform.prototype.removeChild=function(t){if(t.parent!=this||null==this.children)throw new Error("not my child.");var a=this.children.indexOf(t);a>=0&&(this.children.splice(a,1),e.sceneMgr.app.markNotify(t,e.NotifyType.RemoveChild),t.parent=null)},transform.prototype.find=function(t){if(this.name==t)return this;if(void 0!=this.children)for(var e in this.children){var a=this.children[e].find(t);if(null!=a)return a}return null},transform.prototype.checkImpactTran=function(t){return null!=this.gameObject.collider&&this.gameObject.collider.intersectsTransform(t)},transform.prototype.checkImpact=function(){var t=new Array;return this.doImpact(this.scene.getRoot(),t),t},transform.prototype.doImpact=function(t,e){if(t!=this&&(null!=t.gameObject&&null!=t.gameObject.collider&&this.checkImpactTran(t)&&e.push(t),null!=t.children))for(var a=0;a<t.children.length;a++)this.doImpact(t.children[a],e)},transform.prototype.markDirty=function(){this.dirty=!0;for(var t=this.parent;null!=t;)t.dirtyChild=!0,t=t.parent},transform.prototype.markHaveComponent=function(){this.hasComponent=!0;for(var t=this.parent;null!=t;)t.dirtyChild=!0,t.hasComponentChild=!0,t=t.parent},transform.prototype.markHaveRendererComp=function(){this.hasRendererComp=!0;for(var t=this.parent;null!=t;)t.dirtyChild=!0,t.hasRendererCompChild=!0,t=t.parent},Object.defineProperty(transform.prototype,"needremakeLocalMtx",{get:function(){return this._needremakeLocalMtx||(t.math.vec3Equal(this.localTranslate,this.helperLocalPos,Number.MIN_VALUE)&&t.math.vec3Equal(this.localScale,this.helperLocalSca,Number.MIN_VALUE)?t.math.quatEqual(this.localRotate,this.helperLocalRot,Number.MIN_VALUE)||(this._needremakeLocalMtx=!0):this._needremakeLocalMtx=!0),this._needremakeLocalMtx},enumerable:!0,configurable:!0}),transform.prototype.refreshHelper=function(){t.math.vec3Clone(this.localTranslate,this.helperLocalPos),t.math.vec3Clone(this.localScale,this.helperLocalSca),t.math.quatClone(this.localRotate,this.helperLocalRot)},transform.prototype.refreshlocalMtx=function(){this.needremakeLocalMtx&&(t.math.matrixMakeTransformRTS(this.localTranslate,this.localScale,this.localRotate,this.localMatrix),this.refreshHelper(),this._needremakeLocalMtx=!1)},transform.prototype.refreshMtxs=function(e){void 0===e&&(e=!1);var a=this.needremakeLocalMtx;this.refreshlocalMtx(),(e||a)&&(this.parent?t.math.matrixMultiply(this.parent.getWorldMatrix(),this.localMatrix,this.worldMatrix):t.math.matrixClone(this.localMatrix,this.worldMatrix),this.needWorldDecompose=!0,this.markAABBDirty())},transform.prototype.refreshWorldRTS=function(){this.refreshMtxs(),this.needWorldDecompose&&(t.math.matrixDecompose(this.worldMatrix,this.worldScale,this.worldRotate,this.worldTranslate),this.needWorldDecompose=!1)},transform.prototype.updateTran=function(t){if(0!=this.dirtyChild||0!=this.dirty||0!=t){if(this.refreshHelper(),this.refreshMtxs(),null!=this.children)for(var e=0;e<this.children.length;e++)this.children[e].updateTran(t||this.dirty);this.dirty=!1,this.dirtyChild=!1,this.aabbdirty&&(this.caclAABB(),this.aabbdirty=!1)}},transform.prototype.updateWorldTran=function(){var t=this.parent,e=[];for(e.push(this);null!=t;)t.dirty&&e.push(t),t=t.parent;e.pop().updateTran(!1)},transform.prototype.updateAABBChild=function(){if(this.aabbchilddirty){if(null!=this.children)for(var t=0;t<this.children.length;t++)this.children[t].updateAABBChild();this.caclAABBChild(),this.aabbchilddirty=!1}},Object.defineProperty(transform.prototype,"localPosition",{get:function(){return this.localTranslate},set:function(t){this.localTranslate=t},enumerable:!0,configurable:!0}),Object.defineProperty(transform.prototype,"localEulerAngles",{get:function(){return t.math.quatToEulerAngles(this.localRotate,this._localEulerAngles),this._localEulerAngles},set:function(e){t.math.quatFromEulerAngles(e.x,e.y,e.z,this.localRotate)},enumerable:!0,configurable:!0}),transform.prototype.getWorldTranslate=function(){return this.refreshWorldRTS(),this.worldTranslate},transform.prototype.getWorldScale=function(){return this.refreshWorldRTS(),this.worldScale},transform.prototype.getWorldRotate=function(){return this.refreshWorldRTS(),this.worldRotate},transform.prototype.getLocalMatrix=function(){return this.refreshlocalMtx(),this.localMatrix},transform.prototype.getWorldMatrix=function(){return this.refreshMtxs(),this.worldMatrix},transform.prototype.getForwardInWorld=function(e){var a=t.math.pool.new_vector3();a.x=0,a.y=0,a.z=1,t.math.matrixTransformNormal(a,this.getWorldMatrix(),e),t.math.vec3Normalize(e,e),t.math.pool.delete_vector3(a)},transform.prototype.getRightInWorld=function(e){var a=t.math.pool.new_vector3();a.x=1,a.y=0,a.z=0,t.math.matrixTransformNormal(a,this.getWorldMatrix(),e),t.math.vec3Normalize(e,e),t.math.pool.delete_vector3(a)},transform.prototype.getUpInWorld=function(e){var a=t.math.pool.new_vector3();a.x=0,a.y=1,a.z=0,t.math.matrixTransformNormal(a,this.getWorldMatrix(),e),t.math.vec3Normalize(e,e),t.math.pool.delete_vector3(a)},transform.prototype.setWorldMatrix=function(e){var a=t.math.pool.new_matrix();null!=this.parent?t.math.matrixClone(this.parent.worldMatrix,a):t.math.matrixMakeIdentity(a);var r=t.math.pool.new_matrix();t.math.matrixInverse(a,r),t.math.matrixClone(e,this.worldMatrix),t.math.matrixMultiply(r,this.worldMatrix,this.localMatrix),t.math.matrixDecompose(this.localMatrix,this.localScale,this.localRotate,this.localTranslate),this.needWorldDecompose=!0,t.math.pool.delete_matrix(a),t.math.pool.delete_matrix(r)},transform.prototype.setWorldPosition=function(e){var a=t.math.pool.clone_vector3(e),r=t.math.pool.new_vector3();t.math.vec3Subtract(a,this.getWorldTranslate(),r),t.math.vec3Add(this.localTranslate,r,this.localTranslate),t.math.vec3Clone(a,this.worldTranslate),this.worldMatrix.rawData[12]=e.x,this.worldMatrix.rawData[13]=e.y,this.worldMatrix.rawData[14]=e.z;var i=this.getLocalMatrix();i.rawData[12]=this.localTranslate.x,i.rawData[13]=this.localTranslate.y,i.rawData[14]=this.localTranslate.z,t.math.pool.delete_vector3(a),t.math.pool.delete_vector3(r)},transform.prototype.setWorldRotate=function(e){var a=t.math.pool.new_quaternion();null!=this.parent?t.math.quatClone(this.parent.getWorldRotate(),a):t.math.quatIdentity(a);var r=t.math.pool.new_quaternion();t.math.quatInverse(a,r),t.math.quatMultiply(r,e,this.localRotate),t.math.quatClone(e,this.worldRotate),this.refreshMtxs(),t.math.pool.delete_quaternion(a),t.math.pool.delete_quaternion(r)},transform.prototype.lookat=function(t){this.calcLookAt(t.getWorldTranslate())},transform.prototype.lookatPoint=function(t){this.calcLookAt(t)},transform.prototype.calcLookAt=function(e){var a=this.getWorldTranslate(),r=e,i=t.math.pool.new_quaternion();t.math.quatLookat(a,r,i),this.setWorldRotate(i),t.math.pool.delete_quaternion(i)},Object.defineProperty(transform.prototype,"gameObject",{get:function(){return null==this._gameObject&&(this._gameObject=new e.gameObject,this._gameObject.transform=this),this._gameObject},enumerable:!0,configurable:!0}),transform.prototype.clone=function(){return t.io.cloneObj(this)},Object.defineProperty(transform.prototype,"beDispose",{get:function(){return this._beDispose},enumerable:!0,configurable:!0}),transform.prototype.dispose=function(){if(!this._beDispose){if(this.parent&&this.parent.removeChild(this),this.children)for(var t in this.children)this.children[t].dispose();this._gameObject.dispose(),this._beDispose=!0,this.onDispose&&this.onDispose()}},transform.prototype.destroy=function(){this.dispose()},__decorate([t.reflect.Field("string"),__metadata("design:type",String)],transform.prototype,"name",void 0),__decorate([t.reflect.Field("string"),__metadata("design:type",String)],transform.prototype,"prefab",void 0),__decorate([t.reflect.Field("transform[]"),__metadata("design:type",Array)],transform.prototype,"children",void 0),__decorate([t.reflect.Field("quaternion"),__metadata("design:type",t.math.quaternion)],transform.prototype,"localRotate",void 0),__decorate([t.reflect.Field("vector3",new t.math.vector3(0,0,0)),__metadata("design:type",t.math.vector3)],transform.prototype,"localTranslate",void 0),__decorate([t.reflect.Field("vector3",new t.math.vector3(1,1,1)),__metadata("design:type",t.math.vector3)],transform.prototype,"localScale",void 0),__decorate([t.reflect.Field("gameObject"),__metadata("design:type",Object),__metadata("design:paramtypes",[])],transform.prototype,"gameObject",null),transform=__decorate([t.reflect.SerializeType],transform)}();e.transform=a;var r=function(){function insID(){this.id=insID.next()}return insID.next=function(){var t=insID.idAll;return insID.idAll++,t},insID.prototype.getInsID=function(){return this.id},insID.idAll=1,insID}();e.insID=r}(t.framework||(t.framework={}))}(gd3d||(gd3d={}));var gd3d;!function(t){!function(e){var a=function(){function boxcollider(){this._colliderVisible=!1}return boxcollider.prototype.getBound=function(){return this.obb},Object.defineProperty(boxcollider.prototype,"matrix",{get:function(){return this.gameObject?this.gameObject.transform.getWorldMatrix():new t.math.matrix},enumerable:!0,configurable:!0}),boxcollider.prototype.start=function(){this.filter=this.gameObject.getComponent("meshFilter"),this.build()},boxcollider.prototype.onPlay=function(){},boxcollider.prototype.update=function(t){this.obb&&this.obb.update(this.matrix)},Object.defineProperty(boxcollider.prototype,"colliderVisible",{get:function(){return this._colliderVisible},set:function(t){this._colliderVisible=t,this.subTran&&(this.subTran.gameObject.visible=this._colliderVisible)},enumerable:!0,configurable:!0}),boxcollider.prototype.intersectsTransform=function(t){if(null==t.gameObject.collider)return!1;if(null==this.obb||null==t.gameObject.collider.getBound())return!1;var e=t.gameObject.collider.getBound();return this.obb.intersects(e)},boxcollider.prototype.build=function(){if(this.obb=new e.obb,this.center&&this.size)this.obb.buildByCenterSize(this.center,this.size);else{var a=new t.math.vector3,r=new t.math.vector3;if(this.filter){var i=this.filter.getMeshOutput().data;t.math.vec3SetByFloat(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,a),t.math.vec3SetByFloat(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE,r);for(var o=0;o<i.pos.length;o++)t.math.vec3Max(i.pos[o],r,r),t.math.vec3Min(i.pos[o],a,a);console.log("add obb filter "+a+"  "+r)}else a.x=-1,a.y=-1,a.z=-1,r.x=1,r.y=1,r.z=1;this.obb.buildByMaxMin(a,r)}this.buildMesh()},boxcollider.prototype.buildMesh=function(){this.subTran=new t.framework.transform,this.subTran.gameObject.hideFlags=e.HideFlags.DontSave|e.HideFlags.HideInHierarchy,this.subTran.name="boxcollider",this.subTran.gameObject.addComponent("meshFilter").mesh=this.getColliderMesh();this.subTran.gameObject.addComponent("meshRenderer");this.subTran.gameObject.visible=this._colliderVisible,this.gameObject.transform.addChild(this.subTran),this.gameObject.transform.markDirty(),this.subTran.markDirty(),this.gameObject.transform.updateWorldTran()},boxcollider.prototype.getColliderMesh=function(){var a=new e.mesh;a.data=t.render.meshData.genBoxByArray_Quad(this.obb.vectors);var r=t.render.VertexFormatMask.Position|t.render.VertexFormatMask.Normal,i=a.data.genVertexDataArray(r),o=a.data.genIndexDataArrayQuad2Line(),n=this.gameObject.getScene().webgl;a.glMesh=new t.render.glMesh,a.glMesh.initBuffer(n,r,a.data.pos.length),a.glMesh.uploadVertexData(n,i),a.glMesh.addIndex(n,o.length),a.glMesh.uploadIndexData(n,0,o),a.submesh=[];var s=new e.subMeshInfo;return s.matIndex=0,s.useVertexIndex=0,s.start=0,s.size=o.length,s.line=!0,a.submesh.push(s),a},boxcollider.prototype.remove=function(){this.subTran&&this.subTran.dispose(),this.obb&&this.obb.dispose()},boxcollider.prototype.clone=function(){},__decorate([t.reflect.Field("vector3"),__metadata("design:type",t.math.vector3)],boxcollider.prototype,"center",void 0),__decorate([t.reflect.Field("vector3"),__metadata("design:type",t.math.vector3)],boxcollider.prototype,"size",void 0),boxcollider=__decorate([t.reflect.nodeComponent,t.reflect.nodeBoxCollider],boxcollider)}();e.boxcollider=a}(t.framework||(t.framework={}))}(gd3d||(gd3d={}));var gd3d;!function(t){!function(e){var a=function(){function meshcollider(){this._colliderVisible=!1}return meshcollider.prototype.getBound=function(){return this.mesh},meshcollider.prototype.start=function(){var t=this.gameObject.getComponent("meshFilter");null!=t&&(this.mesh=t.getMeshOutput(),this.buildMesh())},meshcollider.prototype.onPlay=function(){},meshcollider.prototype.update=function(t){},Object.defineProperty(meshcollider.prototype,"colliderVisible",{get:function(){return this._colliderVisible},set:function(t){this._colliderVisible=t,this.subTran&&(this.subTran.gameObject.visible=this._colliderVisible)},enumerable:!0,configurable:!0}),meshcollider.prototype.intersectsTransform=function(t){return!1},meshcollider.prototype.buildMesh=function(){this.subTran=new t.framework.transform,this.subTran.gameObject.hideFlags=e.HideFlags.DontSave|e.HideFlags.HideInHierarchy,this.subTran.name="meshcollider",this.subTran.gameObject.addComponent("meshFilter").mesh=this.getColliderMesh();this.subTran.gameObject.addComponent("meshRenderer");this.subTran.gameObject.visible=this._colliderVisible,this.gameObject.transform.addChild(this.subTran),this.gameObject.transform.markDirty(),this.subTran.markDirty(),this.gameObject.transform.updateWorldTran()},meshcollider.prototype.getColliderMesh=function(){var a=new e.mesh;a.data=this.mesh.data;var r=t.render.VertexFormatMask.Position|t.render.VertexFormatMask.Normal,i=a.data.genVertexDataArray(r),o=a.data.genIndexDataArrayTri2Line(),n=this.gameObject.getScene().webgl;a.glMesh=new t.render.glMesh,a.glMesh.initBuffer(n,r,a.data.pos.length),a.glMesh.uploadVertexData(n,i),a.glMesh.addIndex(n,o.length),a.glMesh.uploadIndexData(n,0,o),a.submesh=[];var s=new e.subMeshInfo;return s.matIndex=0,s.useVertexIndex=0,s.start=0,s.size=o.length,s.line=!0,a.submesh.push(s),a},meshcollider.prototype.remove=function(){this.subTran&&this.subTran.dispose()},meshcollider.prototype.clone=function(){},__decorate([t.reflect.Field("boolean"),__metadata("design:type",Boolean)],meshcollider.prototype,"_colliderVisible",void 0),meshcollider=__decorate([t.reflect.nodeComponent,t.reflect.nodeMeshCollider],meshcollider)}();e.meshcollider=a}(t.framework||(t.framework={}))}(gd3d||(gd3d={}));var gd3d;!function(t){!function(e){var a=function(){function meshFilter(){}return meshFilter.prototype.start=function(){},meshFilter.prototype.onPlay=function(){},meshFilter.prototype.update=function(t){},Object.defineProperty(meshFilter.prototype,"mesh",{get:function(){return this._mesh},set:function(t){null!=this._mesh&&this._mesh.unuse(),this._mesh=t,null!=this._mesh&&this._mesh.use()},enumerable:!0,configurable:!0}),meshFilter.prototype.getMeshOutput=function(){return this._mesh},meshFilter.prototype.remove=function(){this.mesh&&this.mesh.unuse(!0)},meshFilter.prototype.clone=function(){},__decorate([t.reflect.Field("mesh"),t.reflect.UIStyle("WidgetDragSelect"),__metadata("design:type",Object),__metadata("design:paramtypes",[e.mesh])],meshFilter.prototype,"mesh",null),meshFilter=__decorate([t.reflect.nodeComponent],meshFilter)}();e.meshFilter=a}(t.framework||(t.framework={}))}(gd3d||(gd3d={}));var gd3d;!function(t){!function(e){var a=function(){function meshRenderer(){this.materials=[],this.useGlobalLightMap=!0,this.lightmapIndex=-1,this.lightmapScaleOffset=new t.math.vector4(1,1,0,0),this.layer=e.RenderLayerEnum.Common,this.issetq=!1,this._queue=0}return Object.defineProperty(meshRenderer.prototype,"renderLayer",{get:function(){return this.gameObject.layer},set:function(t){this.gameObject.layer=t},enumerable:!0,configurable:!0}),Object.defineProperty(meshRenderer.prototype,"queue",{get:function(){return this._queue},set:function(t){this._queue=t,this.issetq=!0},enumerable:!0,configurable:!0}),meshRenderer.prototype.start=function(){this.filter=this.gameObject.getComponent("meshFilter"),this.refreshLayerAndQue(),-2==this.lightmapIndex&&(this.useGlobalLightMap=!1)},meshRenderer.prototype.onPlay=function(){},meshRenderer.prototype.refreshLayerAndQue=function(){if(null==this.materials||0==this.materials.length){this.materials=[];var t=new e.material;t.use(),this.materials.push(t),this.materials[0].setShader(e.sceneMgr.app.getAssetMgr().getShader("shader/def"))}this.layer=this.materials[0].getLayer(),this.issetq||(this._queue=this.materials[0].getQueue())},meshRenderer.prototype.update=function(t){if(null!=this.materials&&this.materials.length>0){var e=this.materials[0];e&&(this.layer=e.getLayer(),this.issetq||(this._queue=e.getQueue()))}null==this.filter&&(this.filter=this.gameObject.getComponent("meshFilter"))},meshRenderer.prototype.render=function(a,r,i){if(e.DrawCallInfo.inc.currentState=e.DrawCallEnum.Meshrender,a.updateLightMask(this.gameObject.layer),a.updateModel(this.gameObject.transform),null!=this.filter){var o=this.filter.getMeshOutput();if(null!=o&&(o.glMesh.bindVboBuffer(a.webgl),null!=o.submesh))for(var n=0;n<o.submesh.length;n++){var s=o.submesh[n],l=o.submesh[n].matIndex,h=this.materials[l],c=this.gameObject.transform.scene.fog?"base_fog":"base";this.lightmapIndex>=0?(c=this.gameObject.transform.scene.fog?"lightmap_fog":"lightmap",this.gameObject.transform.scene.lightmaps.length>this.lightmapIndex&&(a.lightmap=this.gameObject.transform.scene.lightmaps[this.lightmapIndex],a.lightmapOffset=this.lightmapScaleOffset,a.lightmapUV=o.glMesh.vertexFormat&t.render.VertexFormatMask.UV1?1:0)):this.useGlobalLightMap||(c=this.gameObject.transform.scene.fog?"lightmap_fog":"lightmap",a.lightmap=h.statedMapUniforms._LightmapTex,a.lightmapOffset=this.lightmapScaleOffset,a.lightmapUV=o.glMesh.vertexFormat&t.render.VertexFormatMask.UV1?1:0),this.gameObject.transform.scene.fog&&(a.fog=this.gameObject.transform.scene.fog),null!=h&&h.draw(a,o,s,c,this.useGlobalLightMap)}}},meshRenderer.prototype.remove=function(){this.materials.forEach(function(t){t&&t.unuse()}),this.materials.length=0},meshRenderer.prototype.clone=function(){},__decorate([t.reflect.Field("material[]"),__metadata("design:type",Array)],meshRenderer.prototype,"materials",void 0),__decorate([t.reflect.Field("number"),__metadata("design:type",Number)],meshRenderer.prototype,"lightmapIndex",void 0),__decorate([t.reflect.Field("vector4"),__metadata("design:type",t.math.vector4)],meshRenderer.prototype,"lightmapScaleOffset",void 0),__decorate([t.reflect.Field("number"),__metadata("design:type",Number)],meshRenderer.prototype,"layer",void 0),meshRenderer=__decorate([t.reflect.nodeRender,t.reflect.nodeComponent,__metadata("design:paramtypes",[])],meshRenderer)}();e.meshRenderer=a}(t.framework||(t.framework={}))}(gd3d||(gd3d={}));var gd3d;!function(t){!function(e){var a=function(){function skinnedMeshRenderer(){this.layer=e.RenderLayerEnum.Common,this.issetq=!1,this._queue=0,this.maxBoneCount=0,this._skintype=0,this._efficient=!0}return a=skinnedMeshRenderer,Object.defineProperty(skinnedMeshRenderer.prototype,"renderLayer",{get:function(){return this.gameObject.layer},set:function(t){this.gameObject.layer=t},enumerable:!0,configurable:!0}),Object.defineProperty(skinnedMeshRenderer.prototype,"queue",{get:function(){return this._queue},set:function(t){this._queue=t,this.issetq=!0},enumerable:!0,configurable:!0}),Object.defineProperty(skinnedMeshRenderer.prototype,"player",{get:function(){return null==this._player&&(this._player=this.gameObject.getComponentInParent("aniplayer")),this._player},enumerable:!0,configurable:!0}),Object.defineProperty(skinnedMeshRenderer.prototype,"mesh",{get:function(){return this._mesh},set:function(t){null!=this._mesh&&this._mesh.unuse(),this._mesh=t,null!=this._mesh&&this._mesh.use()},enumerable:!0,configurable:!0}),skinnedMeshRenderer.prototype.start=function(){},skinnedMeshRenderer.prototype.onPlay=function(){},skinnedMeshRenderer.prototype.getMatByIndex=function(e){var a=this.mesh.data;if(a.blendIndex[e].v0>=this.maxBoneCount||a.blendIndex[e].v1>=this.maxBoneCount||a.blendIndex[e].v2>=this.maxBoneCount||a.blendIndex[e].v3>=this.maxBoneCount)return null;var r=new t.math.matrix;if(this._efficient){var i=t.math.pool.new_vector4(),o=t.math.pool.new_vector3();i.x=this._skeletonMatrixData[8*a.blendIndex[e].v0+0],i.y=this._skeletonMatrixData[8*a.blendIndex[e].v0+1],i.z=this._skeletonMatrixData[8*a.blendIndex[e].v0+2],i.w=this._skeletonMatrixData[8*a.blendIndex[e].v0+3],o.x=this._skeletonMatrixData[8*a.blendIndex[e].v0+4],o.y=this._skeletonMatrixData[8*a.blendIndex[e].v0+5],o.z=this._skeletonMatrixData[8*a.blendIndex[e].v0+6];var n=t.math.pool.new_vector4(),s=t.math.pool.new_vector3();n.x=this._skeletonMatrixData[8*a.blendIndex[e].v1+0],n.y=this._skeletonMatrixData[8*a.blendIndex[e].v1+1],n.z=this._skeletonMatrixData[8*a.blendIndex[e].v1+2],n.w=this._skeletonMatrixData[8*a.blendIndex[e].v1+3],s.x=this._skeletonMatrixData[8*a.blendIndex[e].v1+4],s.y=this._skeletonMatrixData[8*a.blendIndex[e].v1+5],s.z=this._skeletonMatrixData[8*a.blendIndex[e].v1+6];var l=t.math.pool.new_vector4(),h=t.math.pool.new_vector3();l.x=this._skeletonMatrixData[8*a.blendIndex[e].v2+0],l.y=this._skeletonMatrixData[8*a.blendIndex[e].v2+1],l.z=this._skeletonMatrixData[8*a.blendIndex[e].v2+2],l.w=this._skeletonMatrixData[8*a.blendIndex[e].v2+3],h.x=this._skeletonMatrixData[8*a.blendIndex[e].v2+4],h.y=this._skeletonMatrixData[8*a.blendIndex[e].v2+5],h.z=this._skeletonMatrixData[8*a.blendIndex[e].v2+6];var c=t.math.pool.new_vector4(),u=t.math.pool.new_vector3();c.x=this._skeletonMatrixData[8*a.blendIndex[e].v3+0],c.y=this._skeletonMatrixData[8*a.blendIndex[e].v3+1],c.z=this._skeletonMatrixData[8*a.blendIndex[e].v3+2],c.w=this._skeletonMatrixData[8*a.blendIndex[e].v3+3],u.x=this._skeletonMatrixData[8*a.blendIndex[e].v3+4],u.y=this._skeletonMatrixData[8*a.blendIndex[e].v3+5],u.z=this._skeletonMatrixData[8*a.blendIndex[e].v3+6];var d=t.math.pool.new_matrix(),m=t.math.pool.new_matrix(),p=t.math.pool.new_matrix(),f=t.math.pool.new_matrix();t.math.matrixMakeTransformRTS(o,t.math.pool.vector3_one,i,d),t.math.matrixMakeTransformRTS(s,t.math.pool.vector3_one,n,m),t.math.matrixMakeTransformRTS(h,t.math.pool.vector3_one,l,p),t.math.matrixMakeTransformRTS(u,t.math.pool.vector3_one,c,f),t.math.matrixScaleByNum(a.blendWeight[e].v0,d),t.math.matrixScaleByNum(a.blendWeight[e].v1,m),t.math.matrixScaleByNum(a.blendWeight[e].v2,p),t.math.matrixScaleByNum(a.blendWeight[e].v3,f),t.math.matrixAdd(d,m,r),t.math.matrixAdd(r,p,r),t.math.matrixAdd(r,f,r),t.math.pool.delete_vector4(i),t.math.pool.delete_vector4(n),t.math.pool.delete_vector4(l),t.math.pool.delete_vector4(c),t.math.pool.delete_vector3(o),t.math.pool.delete_vector3(s),t.math.pool.delete_vector3(h),t.math.pool.delete_vector3(u),t.math.pool.delete_matrix(d),t.math.pool.delete_matrix(m),t.math.pool.delete_matrix(p),t.math.pool.delete_matrix(f)}else(d=t.math.pool.new_matrix()).rawData=this._skeletonMatrixData.slice(16*a.blendIndex[e].v0,16*a.blendIndex[e].v0+16),(m=t.math.pool.new_matrix()).rawData=this._skeletonMatrixData.slice(16*a.blendIndex[e].v1,16*a.blendIndex[e].v1+16),(p=t.math.pool.new_matrix()).rawData=this._skeletonMatrixData.slice(16*a.blendIndex[e].v2,16*a.blendIndex[e].v2+16),(f=t.math.pool.new_matrix()).rawData=this._skeletonMatrixData.slice(16*a.blendIndex[e].v3,16*a.blendIndex[e].v3+16),t.math.matrixScaleByNum(a.blendWeight[e].v0,d),t.math.matrixScaleByNum(a.blendWeight[e].v1,m),t.math.matrixScaleByNum(a.blendWeight[e].v2,p),t.math.matrixScaleByNum(a.blendWeight[e].v3,f),t.math.matrixAdd(d,m,r),t.math.matrixAdd(r,p,r),t.math.matrixAdd(r,f,r),t.math.pool.delete_matrix(d),t.math.pool.delete_matrix(m),t.math.pool.delete_matrix(p),t.math.pool.delete_matrix(f);return r},skinnedMeshRenderer.prototype.intersects=function(e,a){for(var r=!1,i=Number.MAX_VALUE,o=this.player.gameObject.transform.getWorldMatrix(),n=this.mesh.data,s=0;s<this.mesh.submesh.length;s++){for(var l=this.mesh.submesh[s],h=t.math.pool.new_vector3(),c=t.math.pool.new_vector3(),u=t.math.pool.new_vector3(),d=l.start;d<l.size;d+=3){var m=n.trisindex[d],p=n.trisindex[d+1],f=n.trisindex[d+2],g=n.pos[m],v=n.pos[p],y=n.pos[f],_=this.getMatByIndex(m),b=this.getMatByIndex(p),w=this.getMatByIndex(f);if(null!=_&&null!=b&&null!=w){var x=t.math.pool.new_matrix();t.math.matrixMultiply(o,_,x);var D=t.math.pool.new_matrix();t.math.matrixMultiply(o,b,D);var E=t.math.pool.new_matrix();t.math.matrixMultiply(o,w,E),t.math.matrixTransformVector3(g,x,h),t.math.matrixTransformVector3(v,D,c),t.math.matrixTransformVector3(y,E,u);var T=t.math.pool.new_pickInfo();if(e.intersectsTriangle(h,c,u,T)){if(T.distance<0)continue;if(i>T.distance){r=!0,a.cloneFrom(T),i=a.distance,a.faceId=d/3,a.subMeshId=s;var M=t.math.pool.new_vector3();t.math.vec3ScaleByNum(e.direction,a.distance,M),t.math.vec3Add(e.origin,M,a.hitposition),t.math.pool.delete_vector3(M)}}t.math.pool.delete_pickInfo(T)}}t.math.pool.delete_vector3(h),t.math.pool.delete_vector3(c),t.math.pool.delete_vector3(u)}return r},skinnedMeshRenderer.prototype.update=function(t){if(null==this._skeletonMatrixData&&(this._skintype=this.useBoneShader(this.materials[0]),1==this._skintype?(this.maxBoneCount=24,this._skeletonMatrixData=new Float32Array(16*this.maxBoneCount),this._efficient=!1):2==this._skintype&&(this.maxBoneCount=55,this._skeletonMatrixData=new Float32Array(8*this.maxBoneCount),this._efficient=!0)),null!=this.materials&&this.materials.length>0){var r=this.materials[0];r&&(this.layer=r.getLayer(),this.issetq||(this._queue=r.getQueue()))}if(null!=this.player){if(this.player.isCache&&!this.player.mix){var i=this.player.cacheKey+"_"+this.mesh.getGUID(),o=a.dataCaches[i];if(o)return void(this.cacheData=o);var n=e.aniplayer.playerCaches[this.player.cacheKey];if(n){var s=this._efficient?8:16;return o=new Float32Array(this.maxBoneCount*s),n.fillPoseData(o,this.bones,this._efficient),a.dataCaches[i]=o,void(this.cacheData=o)}}this.cacheData=null,null!=this._skeletonMatrixData&&this.player.fillPoseData(this._skeletonMatrixData,this.bones,this._efficient)}},skinnedMeshRenderer.prototype.render=function(t,a,r){e.DrawCallInfo.inc.currentState=e.DrawCallEnum.SKinrender,null!=this.player&&(t.updateLightMask(this.gameObject.layer),t.updateModel(this.player.gameObject.transform));for(var i=0;i<this.materials.length;i++)null!=this.materials[i]&&(null!=this.cacheData&&this._skintype>0?this._efficient?t.vec4_bones=this.cacheData:t.matrix_bones=this.cacheData:null!=this._skeletonMatrixData&&this._skintype>0&&(this._efficient?t.vec4_bones=this._skeletonMatrixData:t.matrix_bones=this._skeletonMatrixData));if(this._mesh&&this.mesh.glMesh&&(this._mesh.glMesh.bindVboBuffer(t.webgl),null!=this._mesh.submesh))for(var o=0;o<this._mesh.submesh.length;o++){var n=this._mesh.submesh[o],s=this._mesh.submesh[o].matIndex,l=this.materials[s];null!=l&&(this.gameObject.transform.scene.fog?(t.fog=this.gameObject.transform.scene.fog,l.draw(t,this._mesh,n,"skin_fog")):l.draw(t,this._mesh,n,"skin"))}},skinnedMeshRenderer.prototype.remove=function(){this.materials.forEach(function(t){t&&t.unuse()}),this.mesh&&this.mesh.unuse(!0),this.bones.length=0},skinnedMeshRenderer.prototype.clone=function(){},skinnedMeshRenderer.prototype.useBoneShader=function(t){var e=t.getShader().passes.skin;return null==e||0==e.length?0:null!=e[0].mapuniforms.glstate_vec4_bones?2:null!=e[0].mapuniforms.glstate_matrix_bones?1:0},skinnedMeshRenderer.dataCaches=[],__decorate([t.reflect.Field("material[]"),__metadata("design:type",Array)],skinnedMeshRenderer.prototype,"materials",void 0),__decorate([t.reflect.Field("mesh"),__metadata("design:type",Object),__metadata("design:paramtypes",[e.mesh])],skinnedMeshRenderer.prototype,"mesh",null),__decorate([t.reflect.Field("transform[]"),__metadata("design:type",Array)],skinnedMeshRenderer.prototype,"bones",void 0),__decorate([t.reflect.Field("transform"),__metadata("design:type",e.transform)],skinnedMeshRenderer.prototype,"rootBone",void 0),skinnedMeshRenderer=a=__decorate([t.reflect.nodeRender,t.reflect.nodeComponent,__metadata("design:paramtypes",[])],skinnedMeshRenderer);var a}();e.skinnedMeshRenderer=a}(t.framework||(t.framework={}))}(gd3d||(gd3d={}));var gd3d;!function(t){!function(e){!function(t){t[t.Default=0]="Default",t[t.Once=1]="Once",t[t.Clamp=1]="Clamp",t[t.Loop=2]="Loop",t[t.PingPong=4]="PingPong",t[t.ClampForever=8]="ClampForever"}(e.WrapMode||(e.WrapMode={}));var a=function(){function keyFrameAniClip(t){void 0===t&&(t=null),this.id=new e.resID,this.defaultAsset=!1,this.length=0,this.frameRate=0,this.curves=[],t||(t="keyFrameAniClip_"+this.getGUID()),this.name=new e.constText(t)}return keyFrameAniClip.prototype.getName=function(){return this.name.getText()},keyFrameAniClip.prototype.getGUID=function(){return this.id.getID()},keyFrameAniClip.prototype.use=function(){e.sceneMgr.app.getAssetMgr().use(this)},keyFrameAniClip.prototype.unuse=function(t){void 0===t&&(t=!1),e.sceneMgr.app.getAssetMgr().unuse(this,t)},keyFrameAniClip.prototype.dispose=function(){this.curves.length=0},keyFrameAniClip.prototype.caclByteLength=function(){return 0},keyFrameAniClip.prototype.Parse=function(t){var e=JSON.parse(t);e.tag;this.length=e.length,this._wrapMode=e.wrapMode,this.frameRate=e.frameRate;for(var a=e.curves,n=0;n<a.length;n++){var s=new r,l=a[n],h=l.keyFrames;s.path=l.path,s.propertyName=o.converUnityTypeProperty(l.type,l.propertyName),s.type=o.converUnityType(l.type);for(var c=0;c<h.length;c++){var u=h[c],d=new i;"string"==typeof u.inTangent?d.inTangent=Number(u.inTangent):d.inTangent=u.inTangent,"string"==typeof u.outTangent?d.outTangent=Number(u.outTangent):d.outTangent=u.outTangent,d.tangentMode=u.tangentMode,d.time=u.time,d.value=u.value,s.keyFrames.push(d)}this.curves.push(s)}},Object.defineProperty(keyFrameAniClip.prototype,"wrapMode",{get:function(){return this._wrapMode},enumerable:!0,configurable:!0}),Object.defineProperty(keyFrameAniClip.prototype,"fps",{get:function(){return this.frameRate},enumerable:!0,configurable:!0}),Object.defineProperty(keyFrameAniClip.prototype,"time",{get:function(){return this.length},enumerable:!0,configurable:!0}),Object.defineProperty(keyFrameAniClip.prototype,"frameCount",{get:function(){return Math.floor(this.frameRate*this.length)},enumerable:!0,configurable:!0}),__decorate([t.reflect.Field("constText"),__metadata("design:type",e.constText)],keyFrameAniClip.prototype,"name",void 0),keyFrameAniClip=__decorate([t.reflect.SerializeType,__metadata("design:paramtypes",[String])],keyFrameAniClip)}();e.keyFrameAniClip=a;var r=function(){return function AnimationCurve(){this.keyFrames=[]}}();e.AnimationCurve=r;var i=function(){return function keyFrame(){}}();e.keyFrame=i;var o=function(){function kFAniClipUtil(){}return Object.defineProperty(kFAniClipUtil,"typePair",{get:function(){return kFAniClipUtil._typePair||(kFAniClipUtil._typePair=kFAniClipUtil.regType()),kFAniClipUtil._typePair},enumerable:!0,configurable:!0}),kFAniClipUtil.isUnityExp=function(t){return!e.StringUtil.isNullOrEmptyObject(t)&&-1!=t.indexOf("unity")},kFAniClipUtil.converUnityType=function(t){var a="";if(e.StringUtil.isNullOrEmptyObject(t))return a;if(-1==t.indexOf("UnityEngine"))return t;var r=t.split(".");if(r.length<1||!r[r.length-1])return a;var i=r[r.length-1],o=kFAniClipUtil._typePair[i];return null!=o&&(a=o.type),a},kFAniClipUtil.converUnityTypeProperty=function(t,a){var r=a;if(e.StringUtil.isNullOrEmptyObject(a))return"";if(-1!=t.indexOf("UnityEngine")){var i=t.split(".");t=i[i.length-1]}var o=kFAniClipUtil._typePair[t],n=a;if(-1!=a.lastIndexOf(".")&&(n=a.substr(0,a.lastIndexOf("."))),o&&o[kFAniClipUtil.propTag]&&o[kFAniClipUtil.propTag][n]){var s=o[kFAniClipUtil.propTag][n];r=a.replace(n,s)}return r},kFAniClipUtil.regType=function(){var t={};return t.Transform={type:e.transform.name},t.BoxCollider={type:e.boxcollider.name},t.MeshRenderer={type:e.meshRenderer.name},t.MeshFilter={type:e.meshFilter.name},t.SkinnedMeshRenderer={type:e.skinnedMeshRenderer.name},kFAniClipUtil.regProperty(t),t},kFAniClipUtil.regProperty=function(t){kFAniClipUtil.assemblyProp(t,"Transform","m_LocalPosition","localTranslate"),kFAniClipUtil.assemblyProp(t,"Transform","m_LocalScale","localScale"),kFAniClipUtil.assemblyProp(t,"Transform","m_LocalRotation","localRotate")},kFAniClipUtil.assemblyProp=function(t,e,a,r){t.Transform[kFAniClipUtil.propTag]||(t.Transform[kFAniClipUtil.propTag]={}),t.Transform[kFAniClipUtil.propTag][a]=r},kFAniClipUtil.propTag="__prop__",kFAniClipUtil._typePair=kFAniClipUtil.regType(),kFAniClipUtil}()}(t.framework||(t.framework={}))}(gd3d||(gd3d={}));var gd3d;!function(t){!function(e){var a=function(){function UniformData(t,e,a){void 0===a&&(a=null),this.type=t,this.value=e,this.defaultValue=a}return __decorate([t.reflect.Field("number"),t.reflect.UIStyle("UniformTypeEnum"),__metadata("design:type",Number)],UniformData.prototype,"type",void 0),__decorate([t.reflect.Field("any"),__metadata("design:type",Object)],UniformData.prototype,"value",void 0),UniformData=__decorate([t.reflect.SerializeType,__metadata("design:paramtypes",[Number,Object,Object])],UniformData)}();e.UniformData=a;var r=function(){function material(a){void 0===a&&(a=null),this.name=null,this.id=new e.resID,this.defaultAsset=!1,this.queue=0,this.statedMapUniforms={},a||(a="material_"+this.getGUID()),this.name=new e.constText(a),t.io.enumMgr.enumMap.UniformTypeEnum=t.render.UniformTypeEnum}return a=material,material.prototype.getName=function(){return void 0==this.name?null:this.name.getText()},material.prototype.getGUID=function(){return this.id.getID()},material.prototype.dispose=function(){for(var e in this.statedMapUniforms)switch(this.defaultMapUniform[e].type){case t.render.UniformTypeEnum.Texture:case t.render.UniformTypeEnum.CubeTexture:null!=this.statedMapUniforms[e]&&this.statedMapUniforms[e].unuse(!0)}delete this.statedMapUniforms},material.prototype.use=function(){e.sceneMgr.app.getAssetMgr().use(this)},material.prototype.unuse=function(t){void 0===t&&(t=!1),e.sceneMgr.app.getAssetMgr().unuse(this,t)},material.prototype.caclByteLength=function(){var e=0;this.shader&&(e+=this.shader.caclByteLength());for(var a in this.statedMapUniforms){var r=this.defaultMapUniform[a].type,i=this.statedMapUniforms[a].value,o=this.defaultMapUniform[a].value;switch(r){case t.render.UniformTypeEnum.Float:e+=4;break;case t.render.UniformTypeEnum.Floatv:e+=i.byteLength;break;case t.render.UniformTypeEnum.Float4:e+=16;break;case t.render.UniformTypeEnum.Float4v:e+=i.byteLength;break;case t.render.UniformTypeEnum.Float4x4:e+=64;break;case t.render.UniformTypeEnum.Float4x4v:e+=i.byteLength;break;case t.render.UniformTypeEnum.Texture:case t.render.UniformTypeEnum.CubeTexture:null!=i?e+=i.caclByteLength():null!=o&&(e+=o.caclByteLength())}}return e},material.prototype.uploadUnifoms=function(a,r){t.render.shaderUniform.texindex=0;for(var i in a.mapuniforms){var o=a.mapuniforms[i],n=t.render.shaderUniform.applyuniformFunc[o.type],s=void 0;null!=e.uniformSetter.autoUniformDic[o.name]?s=(0,e.uniformSetter.autoUniformDic[o.name])(r):null!=this.statedMapUniforms[o.name]?s=this.statedMapUniforms[o.name]:this.defaultMapUniform[o.name]?s=this.defaultMapUniform[o.name].value:console.error("Uniform don't be setted or have def value. uniform:"+o.name+"mat:"+this.getName()),n(o.location,s)}},material.prototype.setShader=function(t){this.shader=t,this.defaultMapUniform=t.defaultMapUniform},material.prototype.getLayer=function(){return this.shader.layer},material.prototype.getQueue=function(){return this.queue},material.prototype.setQueue=function(t){this.queue=t},material.prototype.getShader=function(){return this.shader},material.prototype.setFloat=function(e,a){null!=this.defaultMapUniform[e]&&this.defaultMapUniform[e].type==t.render.UniformTypeEnum.Float?this.statedMapUniforms[e]=a:console.log("Set wrong uniform value. Mat Name: "+this.getName()+" Unifom :"+e)},material.prototype.setFloatv=function(e,a){null!=this.defaultMapUniform[e]&&this.defaultMapUniform[e].type==t.render.UniformTypeEnum.Floatv?this.statedMapUniforms[e]=a:console.log("Set wrong uniform value. Mat Name: "+this.getName()+" Unifom :"+e)},material.prototype.setVector4=function(e,a){null!=this.defaultMapUniform[e]&&this.defaultMapUniform[e].type==t.render.UniformTypeEnum.Float4?this.statedMapUniforms[e]=a:console.log("Set wrong uniform value. Mat Name: "+this.getName()+" Unifom :"+e)},material.prototype.setVector4v=function(e,a){null!=this.defaultMapUniform[e]&&this.defaultMapUniform[e].type==t.render.UniformTypeEnum.Float4v?this.statedMapUniforms[e]=a:console.log("Set wrong uniform value. Mat Name: "+this.getName()+" Unifom :"+e)},material.prototype.setMatrix=function(e,a){null!=this.defaultMapUniform[e]&&this.defaultMapUniform[e].type==t.render.UniformTypeEnum.Float4x4?this.statedMapUniforms[e]=a:console.log("Set wrong uniform value. Mat Name: "+this.getName()+" Unifom :"+e)},material.prototype.setMatrixv=function(e,a){null!=this.defaultMapUniform[e]&&this.defaultMapUniform[e].type==t.render.UniformTypeEnum.Float4x4v?this.statedMapUniforms[e]=a:console.log("Set wrong uniform value. Mat Name: "+this.getName()+" Unifom :"+e)},material.prototype.setTexture=function(e,a,r){if(void 0===r&&(r=""),null!=this.defaultMapUniform[e]&&this.defaultMapUniform[e].type==t.render.UniformTypeEnum.Texture||"_LightmapTex"==e){if(null==this.statedMapUniforms[e]||this.statedMapUniforms[e].defaultAsset||this.statedMapUniforms[e].unuse(),this.statedMapUniforms[e]=a,null!=a){a.getName(),a.defaultAsset||a.use();var i=e+"_TexelSize",o=a.glTexture;null!=o&&null!=this.defaultMapUniform[i]&&this.setVector4(i,new t.math.vector4(1/o.width,1/o.height,o.width,o.height))}}else console.log("Set wrong uniform value. Mat Name: "+this.getName()+" Unifom :"+e)},material.prototype.setCubeTexture=function(e,a){if(null!=this.defaultMapUniform[e]&&this.defaultMapUniform[e].type==t.render.UniformTypeEnum.CubeTexture){if(null==this.statedMapUniforms[e]||this.statedMapUniforms[e].defaultAsset||this.statedMapUniforms[e].unuse(),this.statedMapUniforms[e]=a,null!=a){a.defaultAsset||a.use();var r=e+"_TexelSize",i=a.glTexture;null!=i&&this.setVector4(r,new t.math.vector4(1/i.width,1/i.height,i.width,i.height))}}else console.log("Set wrong uniform value. Mat Name: "+this.getName()+" Unifom :"+e)},material.prototype.draw=function(t,a,r,i,o){void 0===i&&(i="base"),void 0===o&&(o=!0);var n=this.shader.passes[i+t.drawtype];if(void 0!=n||(i=-1!=i.indexOf("fog")?"base_fog":"base",void 0!=(n=this.shader.passes[i+t.drawtype])||void 0!=(n=this.shader.passes["base"+t.drawtype])))for(var s=0;s<n.length;s++){var l=n[s];l.use(t.webgl),this.uploadUnifoms(l,t),a.glMesh.bind(t.webgl,l.program,r.useVertexIndex),e.DrawCallInfo.inc.add(),r.useVertexIndex<0?r.line?a.glMesh.drawArrayLines(t.webgl,r.start,r.size):a.glMesh.drawArrayTris(t.webgl,r.start,r.size):r.line?a.glMesh.drawElementLines(t.webgl,r.start,r.size):a.glMesh.drawElementTris(t.webgl,r.start,r.size)}},material.prototype.Parse=function(a,r,i){void 0===i&&(i=null);var o=r.shader,n=a.getShader(o);null==n&&console.error("shader 为空！shadername："+o+" bundleName: "+i),this.setShader(n);var s=r.queue;s&&(this.queue=s);var l=r.mapUniform;for(var h in l){var c=l[h],u=c.type;if(null!=u)switch(u){case t.render.UniformTypeEnum.Texture:case t.render.UniformTypeEnum.CubeTexture:var d=c.value,m=a.getAssetByName(d,i);null==m?console.error("Material Mapuniform Texture 无效("+d+")！shadername："+o+" bundleName: "+i):this.setTexture(h,m,d);break;case t.render.UniformTypeEnum.Float:d=c.value;this.setFloat(h,parseFloat(d));break;case t.render.UniformTypeEnum.Float4:var p=c.value;try{var f=p.match(e.RegexpUtil.vector4Regexp);if(null!=f){var g=new t.math.vector4(parseFloat(f[1]),parseFloat(f[2]),parseFloat(f[3]),parseFloat(f[4]));this.setVector4(h,g)}}catch(t){console.error("Material Mapuniform float4 无效:value ("+p+")！shadername："+o+" bundleName: "+i)}break;default:console.error("Material Mapuniform 无效: 未识别类型("+c.type+")！shadername："+o+" bundleName: "+i)}}},material.prototype.clone=function(){var e=new a(this.getName());e.setShader(this.shader);for(var r in this.statedMapUniforms){var i=this.defaultMapUniform[r].type,o=this.statedMapUniforms[r];switch(i){case t.render.UniformTypeEnum.Texture:e.setTexture(r,o);break;case t.render.UniformTypeEnum.CubeTexture:e.setCubeTexture(r,o);break;case t.render.UniformTypeEnum.Float:e.setFloat(r,o);break;case t.render.UniformTypeEnum.Float4:e.setVector4(r,o)}}return e},material.prototype.save=function(){var e={};e.shader=this.shader.getName(),e.srcshader="",e.mapUniform={};for(var a in this.statedMapUniforms){var r=this.defaultMapUniform[a].type,i=this.statedMapUniforms,o={};switch(o.type=r,r){case t.render.UniformTypeEnum.CubeTexture:case t.render.UniformTypeEnum.Texture:o.value=""+i[a].name.name;break;case t.render.UniformTypeEnum.Float4:o.value="("+i[a].x+","+i[a].y+","+i[a].z+","+i[a].w+")";break;case t.render.UniformTypeEnum.Float:o.value=i[a];break;default:console.warn("无法存储未解析类型:"+r+","+a);continue}e.mapUniform[a]=o}return JSON.stringify(e)},__decorate([t.reflect.Field("constText"),__metadata("design:type",e.constText)],material.prototype,"name",void 0),__decorate([t.reflect.Field("shader"),__metadata("design:type",e.shader)],material.prototype,"shader",void 0),material=a=__decorate([t.reflect.SerializeType,__metadata("design:paramtypes",[String])],material);var a}();e.material=r}(t.framework||(t.framework={}))}(gd3d||(gd3d={}));var gd3d;!function(t){!function(e){var a=function(){function mesh(t){void 0===t&&(t=null),this.id=new e.resID,this.defaultAsset=!1,this.updateByEffect=!1,this.submesh=[],t||(t="mesh_"+this.getGUID()),this.name=new e.constText(t)}return a=mesh,mesh.prototype.getName=function(){return this.name?this.name.getText():null},mesh.prototype.getGUID=function(){return this.id.getID()},mesh.prototype.use=function(){e.sceneMgr.app.getAssetMgr().use(this)},mesh.prototype.unuse=function(t){void 0===t&&(t=!1),e.sceneMgr.app.getAssetMgr().unuse(this,t)},mesh.prototype.dispose=function(){this.glMesh.dispose(e.sceneMgr.app.getAssetMgr().webgl),this.data=null,delete this.submesh},mesh.prototype.caclByteLength=function(){var t=0;return t+=this.glMesh.caclByteLength(),this.data&&(t+=this.data.caclByteLength()),t},mesh.prototype.Parse=function(a,r){var i=this;return new t.threading.gdPromise(function(o){t.threading.thread.Instance.Call("meshDataHandle",a,function(a){var n=a.objVF,s=a.meshData;s.originVF=n.vf,i.data=new t.render.meshData;for(var l in s)i.data[l]=s[l];i.submesh=a.subMesh,i.glMesh=new t.render.glMesh;var h=i.data.genVertexDataArray(n.vf),c=i.data.genIndexDataArray();e.sceneMgr.app.getAssetMgr().webgl;i.glMesh.initBuffer(r,n.vf,i.data.pos.length),i.glMesh.uploadVertexData(r,h),i.glMesh.addIndex(r,c.length),i.glMesh.uploadIndexData(r,0,c),o()})})},mesh.prototype.intersects=function(e,a,r){var i=!1;if(!this.submesh)return i;for(var o=Number.MAX_VALUE,n=0;n<this.submesh.length;n++){var s=this.submesh[n];if(s.line);else if(s.useVertexIndex<0);else{for(var l=t.math.pool.new_vector3(),h=t.math.pool.new_vector3(),c=t.math.pool.new_vector3(),u=s.start;u<s.size;u+=3){var d=this.data.pos[this.data.trisindex[u]],m=this.data.pos[this.data.trisindex[u+1]],p=this.data.pos[this.data.trisindex[u+2]];t.math.matrixTransformVector3(d,a,l),t.math.matrixTransformVector3(m,a,h),t.math.matrixTransformVector3(p,a,c);var f=t.math.pool.new_pickInfo();if(e.intersectsTriangle(l,h,c,f)){if(f.distance<0)continue;if(o>f.distance){i=!0,r.cloneFrom(f),o=r.distance,r.faceId=u/3,r.subMeshId=n;var g=t.math.pool.new_vector3();t.math.vec3ScaleByNum(e.direction,r.distance,g),t.math.vec3Add(e.origin,g,r.hitposition),t.math.pool.delete_vector3(g)}}t.math.pool.delete_pickInfo(f)}t.math.pool.delete_vector3(l),t.math.pool.delete_vector3(h),t.math.pool.delete_vector3(c)}}return i},mesh.prototype.clone=function(){var i=new a(this.getName()),o=this.glMesh.vertexFormat,n=new t.render.meshData;if(void 0!=this.data.pos){n.pos=[];for(var s=0,l=this.data.pos;s<l.length;s++){var h=l[s],c=new t.math.vector3;c.rawData.set(h.rawData),n.pos.push(c)}}if(void 0!=this.data.color){n.color=[];for(var u=0,d=this.data.color;u<d.length;u++){var h=d[u],m=new t.math.color;m.rawData.set(h.rawData),n.color.push(m)}}if(void 0!=this.data.normal){n.normal=[];for(var p=0,f=this.data.normal;p<f.length;p++){var h=f[p],g=new t.math.vector3;g.rawData.set(h.rawData),n.normal.push(g)}}if(void 0!=this.data.uv){n.uv=[];for(var v=0,y=this.data.uv;v<y.length;v++){h=y[v];(w=new t.math.vector2).rawData.set(h.rawData),n.uv.push(w)}}if(void 0!=this.data.uv2){n.uv2=[];for(var _=0,b=this.data.uv2;_<b.length;_++){var h=b[_],w=new t.math.vector2;w.rawData.set(w.rawData),n.uv2.push(w)}}if(void 0!=this.data.tangent){n.tangent=[];for(var x=0,D=this.data.tangent;x<D.length;x++){var h=D[x],E=new t.math.vector3;E.rawData.set(h.rawData),n.tangent.push(E)}}if(void 0!=this.data.blendIndex){n.blendIndex=[];for(var T=0,M=this.data.blendIndex.length;T<M;++T){var h=this.data.blendIndex[T],A=new t.render.number4;A.v0=h.v0,A.v1=h.v1,A.v2=h.v2,A.v3=h.v3,n.blendIndex.push(A)}}if(void 0!=this.data.blendWeight){n.blendWeight=[];for(var S=0,M=this.data.blendWeight.length;S<M;++S){var h=this.data.blendWeight[S],C=new t.render.number4;C.v0=h.v0,C.v1=h.v1,C.v2=h.v2,C.v3=h.v3,n.blendWeight.push(C)}}i.submesh=[];for(var F=0;F<this.submesh.length;F++){var R=new r;R.start=this.submesh[F].start,R.size=this.submesh[F].size,R.matIndex=F,i.submesh.push(R)}n.trisindex=this.data.trisindex.slice(),i.data=n,i.glMesh=new t.render.glMesh;var k=i.data.genVertexDataArray(o),P=i.data.genIndexDataArray();return i.glMesh.initBuffer(e.sceneMgr.app.getAssetMgr().webgl,o,this.data.pos.length),i.glMesh.uploadVertexData(e.sceneMgr.app.getAssetMgr().webgl,k),i.glMesh.addIndex(e.sceneMgr.app.getAssetMgr().webgl,P.length),i.glMesh.uploadIndexData(e.sceneMgr.app.getAssetMgr().webgl,0,P),i},mesh=a=__decorate([t.reflect.SerializeType,__metadata("design:paramtypes",[String])],mesh);var a}();e.mesh=a;var r=function(){return function subMeshInfo(){this.matIndex=0,this.useVertexIndex=0,this.line=!1,this.start=0,this.size=0}}();e.subMeshInfo=r}(t.framework||(t.framework={}))}(gd3d||(gd3d={}));var gd3d;!function(t){!function(e){var a=function(){function pathasset(t){void 0===t&&(t=null),this.id=new e.resID,this.defaultAsset=!1,this.paths=[],this.items=[],this.lines=[],t||(t="path_"+this.getGUID()),this.name=new e.constText(t)}return pathasset.prototype.getName=function(){return this.name.getText()},pathasset.prototype.getGUID=function(){return this.id.getID()},pathasset.prototype.use=function(){e.sceneMgr.app.getAssetMgr().use(this)},pathasset.prototype.unuse=function(){e.sceneMgr.app.getAssetMgr().unuse(this)},pathasset.prototype.dispose=function(){this.paths.length=0},pathasset.prototype.caclByteLength=function(){if(this.paths)return 12*this.paths.length},pathasset.prototype.Parse=function(e){switch(e.type){case"once":this.type=r.once;break;case"loop":this.type=r.loop;break;case"pingpong":this.type=r.pingpong}this.instertPointcount=e.insertPointcount;var a=e.path;for(var n in a){var s=new o,l=a[n];switch(l.type){case"VertexPoint":s.type=i.VertexPoint;break;case"ControlPoint":s.type=i.ControlPoint}var h=l.point.split(",");s.point=new t.math.vector3(parseFloat(h[0]),parseFloat(h[1]),parseFloat(h[2])),this.items.push(s)}this.getpaths(),this.items.length=0;for(var c=0;c<this.lines.length;c++)this.lines[c].length=0;this.lines.length=0},pathasset.prototype.getpaths=function(){for(var t=new Array,e=0;e<this.items.length;e++){var a=this.items[e];0==e?(t.push(a.point),this.lines.push(t)):e==this.items.length-1?this.type==r.loop?a.type==i.VertexPoint?(t.push(a.point),(t=new Array).push(a.point),t.push(this.items[0].point),this.lines.push(t)):(t.push(a.point),t.push(this.items[0].point)):t.push(a.point):a.type==i.VertexPoint?(t.push(a.point),(t=new Array).push(a.point),this.lines.push(t)):t.push(a.point)}for(var o=this.lines.length,n=0,e=0;e<o;e++)if(e==o-1)for(s=0;s<this.instertPointcount;s++){l=s/(this.instertPointcount-1);this.paths[n]=this.getBeisaierPointAlongCurve(this.lines[e],l),n++}else for(var s=0;s<this.instertPointcount;s++){var l=s/this.instertPointcount;this.paths[n]=this.getBeisaierPointAlongCurve(this.lines[e],l),n++}},pathasset.prototype.getBeisaierPointAlongCurve=function(e,a,r){void 0===r&&(r=!1);var i=e.length;{if(!(e.length<2)){if(2==i){var o=new t.math.vector3;return this.vec3Lerp(e[0],e[1],a,o),r&&(e.length=0),o}for(var n=[],s=0;s<i-1;s++){var l=t.math.pool.new_vector3();this.vec3Lerp(e[s],e[s+1],a,l),n[s]=l}return r&&(e.length=0),this.getBeisaierPointAlongCurve(n,a,!0)}console.log("計算貝塞爾需要超過2個點")}},pathasset.prototype.vec3Lerp=function(e,a,r,i){t.math.vec3Subtract(a,e,i),t.math.vec3ScaleByNum(i,r,i),t.math.vec3Add(e,i,i)},__decorate([t.reflect.Field("constText"),__metadata("design:type",e.constText)],pathasset.prototype,"name",void 0),pathasset=__decorate([t.reflect.SerializeType,__metadata("design:paramtypes",[String])],pathasset)}();e.pathasset=a;var r;!function(t){t[t.once=0]="once",t[t.loop=1]="loop",t[t.pingpong=2]="pingpong"}(r=e.pathtype||(e.pathtype={}));var i;!function(t){t[t.VertexPoint=0]="VertexPoint",t[t.ControlPoint=1]="ControlPoint"}(i=e.epointtype||(e.epointtype={}));var o=function(){return function pointitem(){}}();e.pointitem=o}(t.framework||(t.framework={}))}(gd3d||(gd3d={}));var gd3d;!function(t){!function(e){var a=function(){function prefab(t){void 0===t&&(t=null),this.id=new e.resID,this.defaultAsset=!1,this.assetbundle=null,t||(t="prefab_"+this.getGUID()),this.name=new e.constText(t)}return prefab.prototype.getName=function(){return this.name.getText()},prefab.prototype.getGUID=function(){return this.id.getID()},prefab.prototype.use=function(){e.sceneMgr.app.getAssetMgr().use(this)},prefab.prototype.unuse=function(t){void 0===t&&(t=!1),e.sceneMgr.app.getAssetMgr().unuse(this,t)},prefab.prototype.dispose=function(){this.trans.dispose(),this.jsonstr=null},prefab.prototype.caclByteLength=function(){return 0},prefab.prototype.getCloneTrans=function(){var a=t.io.cloneObj(this.trans);if(a instanceof e.transform)return a},prefab.prototype.getCloneTrans2D=function(){var a=t.io.cloneObj(this.trans);if(a instanceof e.transform2D)return a},prefab.prototype.apply=function(t){this.trans=t},prefab.prototype.Parse=function(a,r){var i=this;return new t.threading.gdPromise(function(o){i.jsonstr=a;var n=JSON.parse(a),s=n.type;switch(s){case"transform":i.trans=new e.transform;break;case"transform2D":i.trans=new e.transform2D}null!=s&&t.io.deSerialize(n,i.trans,r,i.assetbundle),o()})},prefab=__decorate([t.reflect.SerializeType,__metadata("design:paramtypes",[String])],prefab)}();e.prefab=a}(t.framework||(t.framework={}))}(gd3d||(gd3d={}));var gd3d;!function(t){!function(e){var a=function(){function rawscene(t){void 0===t&&(t=null),this.id=new e.resID,this.defaultAsset=!1,this.assetbundle=null,t||(t="rawscene_"+this.getGUID()),this.name=new e.constText(t)}return rawscene.prototype.getName=function(){return this.name.getText()},rawscene.prototype.getGUID=function(){return this.id.getID()},rawscene.prototype.use=function(){e.sceneMgr.app.getAssetMgr().use(this)},rawscene.prototype.unuse=function(t){void 0===t&&(t=!1),e.sceneMgr.app.getAssetMgr().unuse(this,t)},rawscene.prototype.caclByteLength=function(){return 0},rawscene.prototype.resetLightMap=function(t){this.lightmaps.length=0;for(var e=this.lightmapData.length,a=0;a<e;a++)if(null==this.lightmapData[a])this.lightmaps.push(null);else{var r=this.lightmapData[a].name,i=t.getAssetByName(r);i&&i.use(),this.lightmaps.push(i)}},rawscene.prototype.Parse=function(a,i){var o=this;return new t.threading.gdPromise(function(n){var s=JSON.parse(a);o.rootNode=new e.transform,o.rootNode.name=o.getName(),t.io.deSerialize(s.rootNode,o.rootNode,i,o.assetbundle),o.lightmaps=[],o.lightmapData=s.lightmap;for(var l=o.lightmapData.length,h=0;h<l;h++)if(null==o.lightmapData[h])o.lightmaps.push(null);else{var c=o.lightmapData[h].name,u=i.getAssetByName(c,o.assetbundle);u&&u.use(),o.lightmaps.push(u)}var d=s.fog;if(void 0!=d){o.fog=new r,o.fog._Start=d._Start,o.fog._End=d._End;var m=d._Color;if("string"==typeof m){var p=m.split(",");o.fog._Color=new t.math.vector4(parseFloat(p[0]),parseFloat(p[1]),parseFloat(p[2]),parseFloat(p[3]))}else o.fog._Color=m;o.fog._Density=d._Density}var f=s.navmesh;void 0!=f&&null!=f.data&&(o.navMeshJson=f.data),n()})},rawscene.prototype.getSceneRoot=function(){return t.io.cloneObj(this.rootNode)},rawscene.prototype.useLightMap=function(t){t.lightmaps.length=0;for(var e=0;e<this.lightmaps.length;e++)t.lightmaps.push(this.lightmaps[e])},rawscene.prototype.useFog=function(t){t.fog=this.fog},rawscene.prototype.useNavMesh=function(t){var a=!1;return null==this.navMeshJson||""==this.navMeshJson?a:(e.NavMeshLoadManager.Instance.loadNavMeshByDate(this.navMeshJson,t.app,function(){a=!0}),a)},rawscene.prototype.dispose=function(){this.rootNode&&this.rootNode.dispose();for(var t in this.lightmaps)this.lightmaps[t].unuse(!0)},rawscene=__decorate([t.reflect.SerializeType,__metadata("design:paramtypes",[String])],rawscene)}();e.rawscene=a;var r=function(){return function Fog(){}}();e.Fog=r}(t.framework||(t.framework={}))}(gd3d||(gd3d={}));var gd3d;!function(t){!function(e){var a=function(){function shader(t){void 0===t&&(t=null),this.name=null,this.id=new e.resID,this.defaultAsset=!1,this.passes={},this.defaultMapUniform={},this.layer=e.RenderLayerEnum.Common,t||(t="shader_"+this.getGUID()),this.name=new e.constText(t)}return shader.prototype.getName=function(){return this.name.getText()},shader.prototype.getGUID=function(){return this.id.getID()},shader.prototype.use=function(){e.sceneMgr.app.getAssetMgr().use(this)},shader.prototype.unuse=function(t){void 0===t&&(t=!1),e.sceneMgr.app.getAssetMgr().unuse(this,t)},shader.prototype.dispose=function(){},shader.prototype.caclByteLength=function(){return 0},shader.prototype.parse=function(t,a){if(this._parseProperties(t,a.properties),a.layer){var r=a.layer;"transparent"==r?this.layer=e.RenderLayerEnum.Transparent:"overlay"==r?this.layer=e.RenderLayerEnum.Overlay:"common"==r&&(this.layer=e.RenderLayerEnum.Common)}var i=a.passes;this.passes={};for(var o in i){var n=i[o];if("base"==o||"lightmap"==o||"skin"==o||"quad"==o);else if(0!=o.indexOf("base_")&&0!=o.indexOf("lightmap_")&&0!=o.indexOf("skin_"))continue;this.passes[o]=[];for(var s=0;s<n.length;s++)this.passes[o].push(this._parsePass(t,n[s],o))}if(void 0==this.passes.base)throw new Error("do not have base passgroup.");this.fillUnDefUniform(this.passes.base[0])},shader.prototype._parseProperties=function(a,r){this.defaultMapUniform={};for(var i in r){var o=r[i],n=o.match(e.RegexpUtil.floatRegexp);if(null==n&&(n=o.match(e.RegexpUtil.rangeRegexp)),null==n&&(n=o.match(e.RegexpUtil.vectorRegexp)),null==n&&(n=o.match(e.RegexpUtil.textureRegexp)),null==n)return void alert(this.getName()+" property error! info:\n"+o);if(null!=n&&n.length>=4){var s=n[1],l=(n[2],n[3].toLowerCase());switch(l){case"float":this.defaultMapUniform[s]={type:t.render.UniformTypeEnum.Float,value:parseFloat(n[4])};break;case"range":this.defaultMapUniform[s]={type:t.render.UniformTypeEnum.Float,value:parseFloat(n[6]),min:parseFloat(n[4]),max:parseFloat(n[5])};break;case"vector":var h=new t.math.vector4(parseFloat(n[4]),parseFloat(n[5]),parseFloat(n[6]),parseFloat(n[7]));this.defaultMapUniform[s]={type:t.render.UniformTypeEnum.Float4,value:h};break;case"color":var c=new t.math.vector4(parseFloat(n[4]),parseFloat(n[5]),parseFloat(n[6]),parseFloat(n[7]));this.defaultMapUniform[s]={type:t.render.UniformTypeEnum.Float4,value:c,becolor:!0};break;case"texture":this.defaultMapUniform[s]={type:t.render.UniformTypeEnum.Texture,value:a.getDefaultTexture(n[4])};break;default:alert(this.getName()+" property error! unknown type : "+l)}}}},shader.prototype._parsePass=function(a,r,i){var o=new t.render.glDrawPass,n=r.vs,s=r.fs;switch(r.showface){case"cw":o.state_showface=t.render.ShowFaceStateEnum.CW;break;case"ccw":o.state_showface=t.render.ShowFaceStateEnum.CCW;break;default:o.state_showface=t.render.ShowFaceStateEnum.ALL}var l=t.render.BlendModeEnum.Close;switch(r.zwrite){case"off":o.state_zwrite=!1;break;case"on":default:o.state_zwrite=!0}switch(o.state_ztest=!0,r.ztest){case"greater":o.state_ztest_method=t.render.webglkit.GREATER;break;case"gequal":o.state_ztest_method=t.render.webglkit.GEQUAL;break;case"less":o.state_ztest_method=t.render.webglkit.LESS;break;case"equal":o.state_ztest_method=t.render.webglkit.EQUAL;break;case"notequal":o.state_ztest_method=t.render.webglkit.NOTEQUAL;break;case"always":case"off":o.state_ztest=!1;break;case"never":o.state_ztest_method=t.render.webglkit.NEVER;break;case"lequal":default:o.state_ztest_method=t.render.webglkit.LEQUAL}switch(r.blendmode){case"add":l=t.render.BlendModeEnum.Add;break;case"addpremult":l=t.render.BlendModeEnum.Add_PreMultiply;break;case"blend":l=t.render.BlendModeEnum.Blend;break;case"blendpremult":l=t.render.BlendModeEnum.Blend_PreMultiply}o.setAlphaBlend(l);var h=a.shaderPool.linkProgrambyPassType(a.webgl,i,n,s);return o.setProgram(h),this.layer==e.RenderLayerEnum.Overlay&&(o.state_ztest=!0,o.state_zwrite=!0,o.state_ztest_method=t.render.webglkit.ALWAYS),o},shader.prototype.fillUnDefUniform=function(a){for(var r in a.mapuniforms){var i=a.mapuniforms[r];if(null==e.uniformSetter.autoUniformDic[i.name]&&null==this.defaultMapUniform[i.name])switch(i.type){case t.render.UniformTypeEnum.Float:this.defaultMapUniform[i.name]={type:t.render.UniformTypeEnum.Float,value:0};break;case t.render.UniformTypeEnum.Floatv:this.defaultMapUniform[i.name]={type:t.render.UniformTypeEnum.Float4x4v,value:null};break;case t.render.UniformTypeEnum.Float4:i.name.indexOf("_ST")>=0||i.name.indexOf("_st")>=0?this.defaultMapUniform[i.name]={type:t.render.UniformTypeEnum.Float4,value:new t.math.vector4(1,1,0,0)}:this.defaultMapUniform[i.name]={type:t.render.UniformTypeEnum.Float4,value:new t.math.vector4(1,1,1,1)};break;case t.render.UniformTypeEnum.Float4v:this.defaultMapUniform[i.name]={type:t.render.UniformTypeEnum.Float4v,value:null};break;case t.render.UniformTypeEnum.Float4x4:this.defaultMapUniform[i.name]={type:t.render.UniformTypeEnum.Float4x4,value:null};break;case t.render.UniformTypeEnum.Float4x4v:this.defaultMapUniform[i.name]={type:t.render.UniformTypeEnum.Float4x4v,value:null};break;case t.render.UniformTypeEnum.Texture:var o=e.sceneMgr.app.getAssetMgr().getDefaultTexture("white");this.defaultMapUniform[i.name]={type:t.render.UniformTypeEnum.Texture,value:o};break;case t.render.UniformTypeEnum.CubeTexture:var n=e.sceneMgr.app.getAssetMgr().getDefaultCubeTexture("white");this.defaultMapUniform[i.name]={type:t.render.UniformTypeEnum.CubeTexture,value:n}}}},__decorate([t.reflect.Field("constText"),__metadata("design:type",e.constText)],shader.prototype,"name",void 0),shader=__decorate([t.reflect.SerializeType,__metadata("design:paramtypes",[String])],shader)}();e.shader=a}(t.framework||(t.framework={}))}(gd3d||(gd3d={}));var gd3d;!function(t){!function(e){var a=function(){function sprite(a){void 0===a&&(a=null),this.id=new e.resID,this.border=new t.math.border,a||(a="sprite_"+this.getGUID()),this.name=new e.constText(a)}return sprite.prototype.getName=function(){return this.name.getText()},sprite.prototype.getGUID=function(){return this.id.getID()},sprite.prototype.use=function(){e.sceneMgr.app.getAssetMgr().use(this)},sprite.prototype.unuse=function(t){void 0===t&&(t=!1),e.sceneMgr.app.getAssetMgr().unuse(this,t)},sprite.prototype.dispose=function(){null!=this.texture&&this.texture.unuse(!0)},sprite.prototype.caclByteLength=function(){var t=0;return this._texture&&(t+=this._texture.caclByteLength()),t},Object.defineProperty(sprite.prototype,"texture",{get:function(){return this._texture},set:function(t){null!=this._texture&&this._texture.unuse(),this._texture=t,this._texture.use()},enumerable:!0,configurable:!0}),Object.defineProperty(sprite.prototype,"urange",{get:function(){return null==this._urange&&(this._urange=new t.math.vector2,this._urange.x=this.rect.x/this._texture.glTexture.width,this._urange.y=(this.rect.x+this.rect.w)/this._texture.glTexture.width),this._urange},enumerable:!0,configurable:!0}),Object.defineProperty(sprite.prototype,"vrange",{get:function(){return null==this._vrange&&(this._vrange=new t.math.vector2,this._vrange.x=this.rect.y/this._texture.glTexture.height,this._vrange.y=(this.rect.y+this.rect.h)/this._texture.glTexture.height),this._vrange},enumerable:!0,configurable:!0}),sprite=__decorate([t.reflect.SerializeType,__metadata("design:paramtypes",[String])],sprite)}();e.sprite=a}(t.framework||(t.framework={}))}(gd3d||(gd3d={}));var gd3d;!function(t){!function(e){var a=function(){function textasset(t){void 0===t&&(t=null),this.id=new e.resID,this.defaultAsset=!1,t||(t="texture_"+this.getGUID()),this.name=new e.constText(t)}return textasset.prototype.getName=function(){return this.name.getText()},textasset.prototype.getGUID=function(){return this.id.getID()},textasset.prototype.use=function(){e.sceneMgr.app.getAssetMgr().use(this)},textasset.prototype.unuse=function(){e.sceneMgr.app.getAssetMgr().unuse(this)},textasset.prototype.dispose=function(){this.content},textasset.prototype.caclByteLength=function(){if(this.content)return t.math.caclStringByteLength(this.content)},__decorate([t.reflect.Field("constText"),__metadata("design:type",e.constText)],textasset.prototype,"name",void 0),textasset=__decorate([t.reflect.SerializeType,__metadata("design:paramtypes",[String])],textasset)}();e.textasset=a}(t.framework||(t.framework={}))}(gd3d||(gd3d={}));var gd3d;!function(t){!function(e){var a=function(){function texture(t){void 0===t&&(t=null),this.id=new e.resID,this.defaultAsset=!1,t||(t="texture_"+this.getGUID()),this.name=new e.constText(t)}return texture.prototype.getName=function(){return this.name.getText()},texture.prototype.getGUID=function(){return this.id.getID()},texture.prototype.use=function(){e.sceneMgr.app.getAssetMgr().use(this)},texture.prototype.unuse=function(t){void 0===t&&(t=!1),e.sceneMgr.app.getAssetMgr().unuse(this,t)},texture.prototype.dispose=function(){this&&this.glTexture&&this.glTexture.dispose(e.sceneMgr.app.getAssetMgr().webgl)},texture.prototype.caclByteLength=function(){if(this.glTexture)return this.glTexture.caclByteLength()},Object.defineProperty(texture.prototype,"realName",{get:function(){return this._realName},set:function(t){this._realName=t},enumerable:!0,configurable:!0}),__decorate([t.reflect.Field("constText"),__metadata("design:type",e.constText)],texture.prototype,"name",void 0),texture=__decorate([t.reflect.SerializeType,__metadata("design:paramtypes",[String])],texture)}();e.texture=a}(t.framework||(t.framework={}))}(gd3d||(gd3d={}));var gd3d;!function(t){!function(t){var e=function(){function AudioEx(){try{var t=window.AudioContext||window.webkitAudioContext||window.mozAudioContext||window.msAudioContext;this.audioContext=new t,console.log("audio Context inited")}catch(t){console.error("!Your browser does not support AudioContext")}}return AudioEx.instance=function(){return null==AudioEx.g_this&&(AudioEx.g_this=new AudioEx),AudioEx.g_this},AudioEx.prototype.clickInit=function(){if(this.isAvailable()&&null!=this.audioContext){var t=this.audioContext.createBuffer(1,1,22050),e=this.audioContext.createBufferSource();e.buffer=t,e.connect(this.audioContext.destination),e.start()}},AudioEx.prototype.loadAudioBufferFromArrayBuffer=function(t,e){this.audioContext.decodeAudioData(t,function(t){e(t,null)})},AudioEx.prototype.loadAudioBuffer=function(t,e){var a=this;AudioEx.loadArrayBuffer(t,function(t,r){null!=r?e(null,r):a.audioContext.decodeAudioData(t,function(t){e(t,null)})})},AudioEx.prototype.isAvailable=function(){return!!this.audioContext},AudioEx.prototype.createAudioChannel=function(t){if(this.audioContext){var e=new a;return e.source=this.audioContext.createBufferSource(),e.gainNode=this.audioContext.createGain(),e.source.connect(e.gainNode),t?(e.pannerNode=this.audioContext.createPanner(),e.gainNode.connect(e.pannerNode),e.pannerNode.connect(this.audioContext.destination)):e.gainNode.connect(this.audioContext.destination),e.gainNode.gain.value=1,e}},AudioEx.loadArrayBuffer=function(t,e){var a=new XMLHttpRequest;a.open("GET",t),a.responseType="arraybuffer",a.onreadystatechange=function(){4==a.readyState&&(404==a.status?e(null,new Error("onerr 404")):e(a.response,null))},a.onerror=function(){e(null,new Error("onerr in req:"))},a.send()},AudioEx}();t.AudioEx=e;var a=function(){function AudioChannel(){}return Object.defineProperty(AudioChannel.prototype,"volume",{get:function(){return this.gainNode.gain.value},set:function(t){t=(t=t>1?1:t)<=0?0:t,this.gainNode.gain.value=t},enumerable:!0,configurable:!0}),AudioChannel.prototype.stop=function(){null!=this.source&&(this.source.stop(),this.source=null),this.isplay=!1},AudioChannel}();t.AudioChannel=a}(t.framework||(t.framework={}))}(gd3d||(gd3d={}));var gd3d;!function(t){!function(e){var a=function(){function aniplayer(){this._clipnameCount=0,this._clipnames=null,this.autoplay=!0,this.playIndex=0,this._playClip=null,this.tpose={},this.nowpose={},this.lerppose={},this.carelist={},this._playFrameid=0,this._playTimer=0,this.speed=1,this.crossdelta=0,this.crossspeed=0,this.beRevert=!1,this.playStyle=i.NormalPlay,this.percent=0,this.mix=!1,this.isCache=!1,this._playCount=0,this.clipHasPlay=!1}return a=aniplayer,Object.defineProperty(aniplayer.prototype,"clipnames",{get:function(){if(null==this._clipnames||this._clipnameCount!=this.clips.length){this._clipnameCount=this.clips.length,this._clipnames={};for(var t in this.clips)this.clips[t]&&(this.clipnames[this.clips[t].getName()]=parseInt(t))}return this._clipnames},enumerable:!0,configurable:!0}),Object.defineProperty(aniplayer.prototype,"playingClip",{get:function(){return this._playClip?this._playClip.getName():""},enumerable:!0,configurable:!0}),Object.defineProperty(aniplayer.prototype,"PlayFrameID",{get:function(){return this._playFrameid},enumerable:!0,configurable:!0}),Object.defineProperty(aniplayer.prototype,"playCount",{get:function(){return this._playCount},enumerable:!0,configurable:!0}),Object.defineProperty(aniplayer.prototype,"cacheKey",{get:function(){return this._playClip?this._playClip.getGUID()+"_"+this._playFrameid:this._playFrameid},enumerable:!0,configurable:!0}),aniplayer.prototype.init=function(){for(var t=0;t<this.bones.length;t++){var a=this.bones[t],r=a.name,i=new e.PoseBoneMatrix;i.r=a.tposeq,i.t=a.tposep,i.invert(),this.tpose[r]=i,this.nowpose[r]=this.startPos[t].Clone()}var o=this.gameObject.getComponentsInChildren("asbone");for(var n in o)this.care(o[n].gameObject.transform);this.autoplay&&null!=this.clips&&this.clips.length>0&&this.playByIndex(this.playIndex)},aniplayer.prototype.start=function(){null!=this.bones&&this.init()},aniplayer.prototype.onPlay=function(){},aniplayer.prototype.update=function(r){if(null!=this._playClip&&(this.checkFrameId(r),this._playClip)){this.clipHasPlay=!0,this.mix=!1,this.crossdelta>0&&(this.crossdelta-=r/this.speed*this.crossspeed,this.mix=!0);var i=!1;if(!this.isCache||this.mix||!a.playerCaches[this.cacheKey]||(i=!0,!e.StringUtil.isNullOrEmptyObject(this.carelist))){for(var o=0;o<this._playClip.boneCount;o++){var n=this._playClip.bones[o];if(!i||this.carelist[n]){var s;if(null==this._playClip||null==this._playClip.frames)return void console.warn("is null of animationclip.frames! ");s=this._playClip.frames[this._playFrameid];var l=7*o+1,h=this.nowpose[n],c=this.tpose[n];if(void 0!=h||null==s)if(this.mix){var u=this.lerppose[n];void 0!=u?h.lerpInWorldWithData(c,u,s,l,1-this.crossdelta):h.copyFromData(s,l)}else h.copyFromData(s,l);var d=this.carelist[n];if(void 0!=d){var m=e.PoseBoneMatrix.sMultiply(h,c),p=t.math.pool.new_matrix();t.math.matrixMakeTransformRTS(m.t,t.math.pool.vector3_one,m.r,p);var f=t.math.pool.new_matrix();t.math.matrixMultiply(this.gameObject.transform.getWorldMatrix(),p,f),d.setWorldMatrix(f),d.updateTran(!1),t.math.pool.delete_matrix(p),t.math.pool.delete_matrix(f)}}}i||(a.playerCaches[this.cacheKey]=this)}}},aniplayer.prototype.playByIndex=function(t,e,a){void 0===e&&(e=1),void 0===a&&(a=!1),this.playIndex=t,this.clips.length<=t?console.error("animIndex out Array of clips"):(this.playAniamtion(t.toString(),e,a),this.crossdelta=0)},aniplayer.prototype.playCrossByIndex=function(t,e,a,r){void 0===a&&(a=1),void 0===r&&(r=!1),this.playIndex=t,this.clips.length<=t?console.error("animIndex out Array of clips"):(this.playAniamtion(t.toString(),a,r),this.crossspeed=1/e,this.crossdelta=1)},aniplayer.prototype.play=function(t,e,a){void 0===e&&(e=1),void 0===a&&(a=!1),null!=this.clipnames[t]?this.playByIndex(this.clipnames[t],e,a):console.error("animclip "+this.gameObject.transform.name+"  "+t+" is not exist")},aniplayer.prototype.getPlayName=function(){if(this.isPlay())return this._playClip.getName()},aniplayer.prototype.playCross=function(t,e,a,r){void 0===a&&(a=1),void 0===r&&(r=!1),null!=this.clipnames[t]?e<=0?this.playByIndex(this.clipnames[t],a,r):this.playCrossByIndex(this.clipnames[t],e,a,r):console.error("animclip "+this.gameObject.transform.name+"  "+t+" is not exist")},aniplayer.prototype.playAniamtion=function(t,e,a){if(void 0===e&&(e=1),void 0===a&&(a=!1),void 0!=this.clips[t]){var r=this.isPlay(),o=r?this._playClip.getName():"";this._playClip=null,this.onPlayEnd&&r&&(this.clipHasPlay=!1,this.onPlayEnd(o)),this._playClip=this.clips[t],this._playTimer=0,this._playFrameid=0,this._playCount,this.speed=e,this.beRevert=a,this.playStyle=i.NormalPlay,this.speed=e,this.lerppose={};for(var n in this.nowpose){var s=this.nowpose[n];this.lerppose[n]=s.Clone()}this.clipHasPlay=!1}},aniplayer.prototype.updateAnimation=function(a,r){if(this.clips&&!(a>=this.clips.length)){var i=this.clips[a];if(i){for(var o=0;o<i.boneCount;o++){var n=i.bones[o],s=i.frames[r],l=7*o+1,h=this.nowpose[n],c=this.tpose[n];void 0!=h&&h.copyFromData(s,l);var u=this.carelist[n];if(void 0!=u){var d=e.PoseBoneMatrix.sMultiply(h,c),m=t.math.pool.new_matrix();t.math.matrixMakeTransformRTS(d.t,t.math.pool.vector3_one,d.r,m);var p=t.math.pool.new_matrix();t.math.matrixMultiply(this.gameObject.transform.getWorldMatrix(),m,p),u.setWorldMatrix(p),u.updateTran(!1),t.math.pool.delete_matrix(m),t.math.pool.delete_matrix(p)}}var f=this.gameObject.getComponentsInChildren(e.StringUtil.COMPONENT_SKINMESHRENDER);for(var g in f)f[g].update(0)}}},aniplayer.prototype.stop=function(){var t=this.isPlay(),e=t?this._playClip.getName():"";this._playClip=null,this.onPlayEnd&&t&&this.onPlayEnd(e)},aniplayer.prototype.isPlay=function(){return this._playClip&&this.clipHasPlay},aniplayer.prototype.isStop=function(){return null==this._playClip||this.playStyle==i.NormalPlay&&(!this._playClip.loop&&this._playFrameid==this._playClip.frameCount-1)},aniplayer.prototype.remove=function(){this.clips&&this.clips.forEach(function(t){t&&t.unuse()}),this.clips.length=0,this.bones.length=0,this.startPos.length=0,this._playClip=null,delete this.tpose,delete this.nowpose,delete this.lerppose,delete this.carelist,delete this._clipnames},aniplayer.prototype.clone=function(){},aniplayer.prototype.addFinishedEventListener=function(t,e){this.finishCallBack=t,this.thisObject=e},aniplayer.prototype.checkFrameId=function(t){if(this.playStyle==i.NormalPlay?(this._playTimer+=t*this.speed,this._playFrameid=this._playClip.fps*this._playTimer|0,this._playClip.loop?(this._playCount+=Math.floor(this._playFrameid/this._playClip.frameCount),this._playFrameid%=this._playClip.frameCount):this._playFrameid>this._playClip.frameCount-1&&(this._playFrameid=this._playClip.frameCount-1),this.beRevert&&(this._playFrameid=this._playClip.frameCount-this._playFrameid-1)):this.playStyle==i.FramePlay&&(this._playFrameid=this._playClip.frameCount*this.percent-1,this._playFrameid=Math.round(this._playFrameid)),this._playFrameid<0&&(this._playFrameid=0),this._playFrameid>this._playClip.frameCount-1&&(this._playFrameid=this._playClip.frameCount-1),this.isStop()){var e=this.isPlay(),a=e?this._playClip.getName():"";this._playClip=null,this.onPlayEnd&&e&&this.onPlayEnd(a),this.finishCallBack&&(this.finishCallBack(this.thisObject),this.finishCallBack=null,this.thisObject=null)}},aniplayer.prototype.fillPoseData=function(e,a,r){void 0===r&&(r=!0);var i=0;for(var o in a){var n=a[o].name,s=this.nowpose[n];if(void 0==s)r?(e[8*i+0]=0,e[8*i+1]=0,e[8*i+2]=0,e[8*i+3]=1,e[8*i+4]=0,e[8*i+5]=0,e[8*i+6]=0,e[8*i+7]=1):(e[16*i+0]=1,e[16*i+1]=0,e[16*i+2]=0,e[16*i+3]=0,e[16*i+4]=0,e[16*i+5]=1,e[16*i+6]=0,e[16*i+7]=0,e[16*i+8]=0,e[16*i+9]=0,e[16*i+10]=1,e[16*i+11]=0,e[16*i+12]=0,e[16*i+13]=0,e[16*i+14]=0,e[16*i+15]=1);else{var l=t.math.pool.new_matrix();if(r)e[8*i+0]=s.r.x,e[8*i+1]=s.r.y,e[8*i+2]=s.r.z,e[8*i+3]=s.r.w,e[8*i+4]=s.t.x,e[8*i+5]=s.t.y,e[8*i+6]=s.t.z,e[8*i+7]=1;else{t.math.matrixMakeTransformRTS(s.t,t.math.pool.vector3_one,s.r,l);for(var h=0;h<16;h++)e[16*i+h]=l.rawData[h]}t.math.pool.delete_matrix(l)}i++}},aniplayer.prototype.care=function(t){for(var e=t;;){if(void 0!=this.nowpose[e.name])return void(this.carelist[e.name]=e);if(!e.parent)return;e=e.parent}},aniplayer.playerCaches=[],__decorate([t.reflect.Field("animationClip[]"),__metadata("design:type",Array)],aniplayer.prototype,"clips",void 0),__decorate([t.reflect.Field("boolean"),__metadata("design:type",Boolean)],aniplayer.prototype,"autoplay",void 0),__decorate([t.reflect.Field("tPoseInfo[]"),__metadata("design:type",Array)],aniplayer.prototype,"bones",void 0),__decorate([t.reflect.Field("PoseBoneMatrix[]"),__metadata("design:type",Array)],aniplayer.prototype,"startPos",void 0),aniplayer=a=__decorate([t.reflect.nodeComponent],aniplayer);var a}();e.aniplayer=a;var r=function(){function tPoseInfo(){}return __decorate([t.reflect.Field("string"),__metadata("design:type",String)],tPoseInfo.prototype,"name",void 0),__decorate([t.reflect.Field("vector3"),__metadata("design:type",t.math.vector3)],tPoseInfo.prototype,"tposep",void 0),__decorate([t.reflect.Field("quaternion"),__metadata("design:type",t.math.quaternion)],tPoseInfo.prototype,"tposeq",void 0),tPoseInfo=__decorate([t.reflect.SerializeType],tPoseInfo)}();e.tPoseInfo=r;var i;!function(t){t[t.NormalPlay=0]="NormalPlay",t[t.FramePlay=1]="FramePlay",t[t.PingPang=2]="PingPang"}(i=e.PlayStyle||(e.PlayStyle={}))}(t.framework||(t.framework={}))}(gd3d||(gd3d={}));var gd3d;!function(t){!function(e){var a=function(){function asbone(){}return asbone.prototype.start=function(){},asbone.prototype.onPlay=function(){},asbone.prototype.update=function(t){},asbone.prototype.remove=function(){},asbone.prototype.clone=function(){},asbone=__decorate([t.reflect.nodeComponent,__metadata("design:paramtypes",[])],asbone)}();e.asbone=a}(t.framework||(t.framework={}))}(gd3d||(gd3d={}));var gd3d;!function(t){!function(e){var a=function(){function AudioListener(){this.lastX=0,this.lastY=0,this.lastZ=0}return AudioListener.prototype.start=function(){this.listener=e.AudioEx.instance().audioContext.listener},AudioListener.prototype.onPlay=function(){},AudioListener.prototype.update=function(t){this.curPos=this.gameObject.transform.getWorldTranslate(),this.curPos.x==this.lastX&&this.curPos.y==this.lastY&&this.curPos.z==this.lastZ||(this.listener.setPosition(this.curPos.x,this.curPos.y,this.curPos.z),this.lastX=this.curPos.x,this.lastY=this.curPos.y,this.lastZ=this.curPos.z)},AudioListener.prototype.remove=function(){},AudioListener.prototype.clone=function(){},AudioListener=__decorate([t.reflect.nodeComponent],AudioListener)}();e.AudioListener=a}(t.framework||(t.framework={}))}(gd3d||(gd3d={}));var gd3d;!function(t){!function(e){var a=function(){function AudioPlayer(){this.be3DSound=!0,this.lastX=0,this.lastY=0,this.lastZ=0}return AudioPlayer.prototype.play=function(t,a,r,i){if(void 0===a&&(a=!1),void 0===r&&(r=0),null!=this.audioChannel&&(this.audioChannel.isplay&&this.stop(),this.audioChannel=null),this.audioChannel=e.AudioEx.instance().createAudioChannel(this.be3DSound)){this.buffer=t,this.volume=r;var o=this.audioChannel;o.source.loop=this.beLoop,o.source.buffer=this.buffer,o.volume=this.volume,o.source.start(),o.isplay=!0,this.beLoop||(o.source.onended=function(){o.isplay=!1,o.source=null,void 0!=i&&i()})}},AudioPlayer.prototype.stop=function(){null!=this.audioChannel&&this.audioChannel.stop()},Object.defineProperty(AudioPlayer.prototype,"volume",{get:function(){return null==this.audioChannel?-1:this.audioChannel.volume},set:function(t){null==this.audioChannel||(this.audioChannel.volume=t)},enumerable:!0,configurable:!0}),AudioPlayer.prototype.isPlaying=function(){return void 0!=this.audioChannel&&this.audioChannel.isplay},AudioPlayer.prototype.start=function(){this.audioChannel=e.AudioEx.instance().createAudioChannel(this.be3DSound)},AudioPlayer.prototype.onPlay=function(){},AudioPlayer.prototype.update=function(t){this.curPos=this.gameObject.transform.getWorldTranslate(),!this.audioChannel||this.curPos.x==this.lastX&&this.curPos.y==this.lastY&&this.curPos.z==this.lastZ||(this.audioChannel.pannerNode.setPosition(this.curPos.x,this.curPos.y,this.curPos.z),this.lastX=this.curPos.x,this.lastY=this.curPos.y,this.lastZ=this.curPos.z)},AudioPlayer.prototype.remove=function(){},AudioPlayer.prototype.clone=function(){},AudioPlayer=__decorate([t.reflect.nodeComponent],AudioPlayer)}();e.AudioPlayer=a}(t.framework||(t.framework={}))}(gd3d||(gd3d={}));var gd3d;!function(t){!function(e){var a=function(){function BeBillboard(){this.beActive=!0,this.target=null}return BeBillboard.prototype.start=function(){},BeBillboard.prototype.onPlay=function(){},BeBillboard.prototype.update=function(t){this.beActive&&null!=this.target&&this.gameObject.transform.lookat(this.target)},BeBillboard.prototype.remove=function(){},BeBillboard.prototype.clone=function(){},BeBillboard.prototype.setActive=function(t){this.beActive=t},BeBillboard.prototype.setTarget=function(t){this.target=t},BeBillboard=__decorate([t.reflect.nodeComponent],BeBillboard)}();e.BeBillboard=a}(t.framework||(t.framework={}))}(gd3d||(gd3d={}));var gd3d;!function(t){!function(t){var e=function(){function behaviour(){}return behaviour.prototype.start=function(){},behaviour.prototype.onPlay=function(){},behaviour.prototype.update=function(t){},behaviour.prototype.remove=function(){},behaviour.prototype.clone=function(){},behaviour}();t.behaviour=e}(t.framework||(t.framework={}))}(gd3d||(gd3d={}));var gd3d;!function(t){!function(e){var a=function(){function bloomctr(){this._bloomIntensity=1.4,this._bloomThreshold=.5,this._blurSpread=3,this.tag="__bloomtag__",this._init=!1}return Object.defineProperty(bloomctr.prototype,"bloomThreshold",{get:function(){return this._bloomThreshold},set:function(t){this._bloomThreshold=t,this.material&&this.material_1&&this.material_2&&this.material.setFloat("_bloomThreshold",this._bloomThreshold)},enumerable:!0,configurable:!0}),Object.defineProperty(bloomctr.prototype,"bloomIntensity",{get:function(){return this._bloomIntensity},set:function(t){this._bloomIntensity=t,this.material&&this.material_3&&this.material_3.setFloat("_bloomIntensity",this._bloomIntensity)},enumerable:!0,configurable:!0}),Object.defineProperty(bloomctr.prototype,"blurSpread",{get:function(){return this._blurSpread},set:function(e){if(this._blurSpread=e,this.material_1&&this.material_2){var a=t.math.pool.new_vector4(),r=t.math.pool.new_vector4();a.x=e,a.y=0,r.x=0,r.y=e,this.material_1.setVector4("_blurSpread",a),this.material_2.setVector4("_blurSpread",r)}},enumerable:!0,configurable:!0}),bloomctr.prototype.init=function(){var a=this.scene.app.getAssetMgr().getShader("bloom.shader.json");if(a){var r=new e.cameraPostQueue_Color;r[this.tag]=!0,r.renderTarget=new t.render.glRenderTarget(this.scene.webgl,1024,1024,!0,!1),this.camera.postQueues||(this.camera.postQueues=[]),this.camera.postQueues.push(r);var i=new e.texture("_color");i.glTexture=r.renderTarget;var o=new e.cameraPostQueue_Quad;o.renderTarget=new t.render.glRenderTarget(this.scene.webgl,1024,1024,!0,!1),o[this.tag]=!0,this.material=o.material,this.material.use(),o.material.setShader(a),o.material.setTexture("_MainTex",i),o.material.setTexture("_BlurTex",i),o.material.setFloat("_bloomIntensity",1.2),o.material.setFloat("_bloomThreshold",this._bloomThreshold),o.material.setVector4("_blurSpread",new t.math.vector4(0,0,0,0)),o.material.setVector4("_MainTex_TexelSize",new t.math.vector4(1/1024,1/1024,1024,1024)),this.camera.postQueues.push(o);var n=new e.texture("_threshold");n.glTexture=o.renderTarget,(o=new e.cameraPostQueue_Quad).renderTarget=new t.render.glRenderTarget(this.scene.webgl,1024,1024,!0,!1),o[this.tag]=!0,this.material_1=o.material,this.material_1.use(),o.material.setShader(a),o.material.setTexture("_MainTex",n),o.material.setTexture("_BlurTex",n),o.material.setFloat("_bloomIntensity",this._bloomIntensity),o.material.setFloat("_bloomThreshold",1),o.material.setVector4("_blurSpread",new t.math.vector4(this._blurSpread,0,0,0)),o.material.setVector4("_MainTex_TexelSize",new t.math.vector4(1/1024,1/1024,1024,1024)),this.camera.postQueues.push(o);var s=new e.texture("_blur0");s.glTexture=o.renderTarget,(o=new e.cameraPostQueue_Quad).renderTarget=new t.render.glRenderTarget(this.scene.webgl,1024,1024,!0,!1),o[this.tag]=!0,this.material_2=o.material,this.material_2.use(),o.material.setShader(a),o.material.setTexture("_MainTex",s),o.material.setTexture("_BlurTex",s),o.material.setFloat("_bloomIntensity",this._bloomIntensity),o.material.setFloat("_bloomThreshold",1),o.material.setVector4("_blurSpread",new t.math.vector4(0,this._blurSpread,0,0)),o.material.setVector4("_MainTex_TexelSize",new t.math.vector4(1/1024,1/1024,1024,1024)),this.camera.postQueues.push(o);var l=new e.texture("_blur1");l.glTexture=o.renderTarget,(o=new e.cameraPostQueue_Quad)[this.tag]=!0,this.material_3=o.material,o.material.use(),o.material.setShader(a),o.material.setTexture("_MainTex",i),o.material.setTexture("_BlurTex",l),o.material.setFloat("_bloomIntensity",this._bloomIntensity),o.material.setFloat("_bloomThreshold",.5),o.material.setVector4("_blurSpread",new t.math.vector4(.5,.5,0,0)),o.material.setVector4("_MainTex_TexelSize",new t.math.vector4(1/1024,1/1024,1024,1024)),this.camera.postQueues.push(o),this._init=!0}else console.warn("bloom.shader.json not find")},bloomctr.prototype.start=function(){this.app=this.gameObject.transform.scene.app,this.scene=this.app.getScene()},bloomctr.prototype.onPlay=function(){},bloomctr.prototype.update=function(t){this._init||(this.camera||(this.camera=this.gameObject.getComponent("camera")),this.camera&&this.init())},bloomctr.prototype.remove=function(){if(this._init=!1,this.camera){for(var t=this.camera.postQueues,e=[],a=0;a<t.length;a++){var r=t[a];r[this.tag]&&e.push(r)}e.forEach(function(e){if(e){var a=t.indexOf(e);-1!=a&&t.splice(a,1)}})}this.material&&(this.material.unuse(),this.material=null),this.material_1&&(this.material_1.unuse(),this.material_1=null),this.material_2&&(this.material_2.unuse(),this.material_2=null),this.material_3&&(this.material_3.unuse(),this.material_3=null)},bloomctr.prototype.clone=function(){},__decorate([t.reflect.Field("number"),__metadata("design:type",Object),__metadata("design:paramtypes",[Number])],bloomctr.prototype,"bloomThreshold",null),__decorate([t.reflect.Field("number"),__metadata("design:type",Object),__metadata("design:paramtypes",[Number])],bloomctr.prototype,"bloomIntensity",null),bloomctr=__decorate([t.reflect.nodeComponent],bloomctr)}();e.bloomctr=a}(t.framework||(t.framework={}))}(gd3d||(gd3d={}));var gd3d;!function(t){!function(e){var a=function(){function cameraPostQueue_Depth(){this.renderTarget=null}return cameraPostQueue_Depth.prototype.render=function(e,a,r){r._targetAndViewport(this.renderTarget,e,a,!0),a.webgl.depthMask(!0),t.render.glDrawPass.lastZWrite=!0,r._renderOnce(e,a,"_depth"),a.webgl.clearColor(0,0,0,0),a.webgl.clearDepth(1),a.webgl.clear(a.webgl.COLOR_BUFFER_BIT|a.webgl.DEPTH_BUFFER_BIT),t.render.glRenderTarget.useNull(a.webgl)},cameraPostQueue_Depth}();e.cameraPostQueue_Depth=a;var r=function(){function cameraPostQueue_Quad(){this.renderTarget=null,this.material=new e.material}return cameraPostQueue_Quad.prototype.render=function(e,a,r){r._targetAndViewport(this.renderTarget,e,a,!0),a.webgl.depthMask(!0),t.render.glDrawPass.lastZWrite=!0,a.webgl.clearColor(0,.3,0,0),a.webgl.clearDepth(1),a.webgl.clear(a.webgl.COLOR_BUFFER_BIT|a.webgl.DEPTH_BUFFER_BIT);var i=e.app.getAssetMgr().getDefaultMesh("quad");a.drawtype="",i.glMesh.bindVboBuffer(a.webgl),this.material.draw(a,i,i.submesh[0],"quad")},cameraPostQueue_Quad}();e.cameraPostQueue_Quad=r;var i=function(){function cameraPostQueue_Color(){this.renderTarget=null}return cameraPostQueue_Color.prototype.render=function(e,a,r){r._targetAndViewport(this.renderTarget,e,a,!1),r._renderOnce(e,a,""),t.render.glRenderTarget.useNull(a.webgl)},cameraPostQueue_Color}();e.cameraPostQueue_Color=i;var o=function(){function camera(){this._near=.01,this._far=1e3,this.CullingMask=e.CullingMask.everything^e.CullingMask.editor,this._contextIdx=-1,this.clearOption_Color=!0,this.clearOption_Depth=!0,this.backgroundColor=new t.math.color(.5,.8,1,1),this.viewport=new t.math.rect(0,0,1,1),this.renderTarget=null,this.order=0,this.overlays=[],this.matView=new t.math.matrix,this.matProjP=new t.math.matrix,this.matProjO=new t.math.matrix,this.matProj=new t.math.matrix,this.frameVecs=[],this.fov=60*Math.PI/180,this.size=2,this._opvalue=1,this.postQueues=[]}return Object.defineProperty(camera.prototype,"near",{get:function(){return this._near},set:function(t){this.opvalue>0&&t<.01&&(t=.01),t>=this.far&&(t=this.far-.01),this._near=t},enumerable:!0,configurable:!0}),Object.defineProperty(camera.prototype,"far",{get:function(){return this._far},set:function(t){t<=this.near&&(t=this.near+.01),this._far=t},enumerable:!0,configurable:!0}),Object.defineProperty(camera.prototype,"CurrContextIndex",{get:function(){return this._contextIdx},enumerable:!0,configurable:!0}),camera.prototype.markDirty=function(){},camera.prototype.start=function(){},camera.prototype.onPlay=function(){},camera.prototype.update=function(t){for(var e=0;e<this.overlays.length;e++)this.overlays[e].init||(this.overlays[e].start(this),this.overlays[e].init=!0),this.overlays[e].update(t)},camera.prototype.addOverLay=function(t){this.overlays.push(t),this.sortOverLays(this.overlays)},camera.prototype.getOverLays=function(){return this.overlays},camera.prototype.removeOverLay=function(t){if(null!=this.overlays){var e=this.overlays.indexOf(t);e>=0&&this.overlays.splice(e,1),this.sortOverLays(this.overlays)}},camera.prototype.sortOverLays=function(t){!t||t.length<1||t.sort(function(t,e){return t.sortOrder-e.sortOrder})},camera.prototype.calcViewMatrix=function(e){var a=this.gameObject.transform.getWorldMatrix();t.math.matrixInverse(a,this.matView),t.math.matrixClone(this.matView,e)},camera.prototype.calcViewPortPixel=function(t,e){var a,r;null==this.renderTarget?(a=t.width,r=t.height):(a=this.renderTarget.width,r=this.renderTarget.height),e.x=a*this.viewport.x,e.y=r*this.viewport.y,e.w=a*this.viewport.w,e.h=r*this.viewport.h},camera.prototype.calcProjectMatrix=function(e,a){this.opvalue>0&&t.math.matrixProject_PerspectiveLH(this.fov,e,this.near,this.far,this.matProjP),this.opvalue<1&&t.math.matrixProject_OrthoLH(this.size*e,this.size,this.near,this.far,this.matProjO),0==this.opvalue?t.math.matrixClone(this.matProjO,this.matProj):1==this.opvalue?t.math.matrixClone(this.matProjP,this.matProj):t.math.matrixLerp(this.matProjO,this.matProjP,this.opvalue,this.matProj),t.math.matrixClone(this.matProj,a)},camera.prototype.creatRayByScreen=function(e,a){var r=t.math.pool.new_vector3();r.x=e.x,r.y=e.y,r.z=0;var i=t.math.pool.new_vector3();i.x=e.x,i.y=e.y,i.z=1;var o=t.math.pool.new_vector3(),n=t.math.pool.new_vector3();this.calcWorldPosFromScreenPos(a,r,o),this.calcWorldPosFromScreenPos(a,i,n);var s=t.math.pool.new_vector3();t.math.vec3Subtract(n,o,s),t.math.vec3Normalize(s,s);var l=new t.framework.ray(o,s);return t.math.pool.delete_vector3(r),t.math.pool.delete_vector3(i),t.math.pool.delete_vector3(o),t.math.pool.delete_vector3(n),t.math.pool.delete_vector3(s),l},camera.prototype.calcWorldPosFromScreenPos=function(e,a,r){var i=new t.math.rect;this.calcViewPortPixel(e,i);var o=new t.math.vector2(a.x/i.w*2-1,1-a.y/i.h*2),n=new t.math.matrix,s=new t.math.matrix,l=i.w/i.h;this.calcViewMatrix(n),this.calcProjectMatrix(l,s);var h=new t.math.matrix,c=new t.math.matrix;t.math.matrixMultiply(s,n,h),t.math.matrixInverse(h,c);var u=new t.math.vector3(o.x,o.y,a.z);t.math.matrixTransformVector3(u,c,r)},camera.prototype.calcScreenPosFromWorldPos=function(e,a,r){var i=new t.math.rect;this.calcViewPortPixel(e,i);var o=new t.math.matrix,n=new t.math.matrix,s=i.w/i.h;this.calcViewMatrix(o),this.calcProjectMatrix(s,n);var l=new t.math.matrix;t.math.matrixMultiply(n,o,l);var h=t.math.pool.new_vector3();t.math.matrixTransformVector3(a,l,h),r.x=(h.x+1)*i.w/2,r.y=(1-h.y)*i.h/2},camera.prototype.calcCameraFrame=function(e){var a=new t.math.rect;this.calcViewPortPixel(e,a);var r=this.near*Math.tan(.5*this.fov),i=a.w/a.h,o=r*i,n=new t.math.vector3(-o,r,this.near),s=new t.math.vector3(-o,-r,this.near),l=new t.math.vector3(o,r,this.near),h=new t.math.vector3(o,-r,this.near),c=this.far*Math.tan(.5*this.fov),u=c*i,d=new t.math.vector3(-u,c,this.far),m=new t.math.vector3(-u,-c,this.far),p=new t.math.vector3(u,c,this.far),f=new t.math.vector3(u,-c,this.far),g=this.gameObject.transform.getWorldMatrix();t.math.matrixTransformVector3(m,g,m),t.math.matrixTransformVector3(s,g,s),t.math.matrixTransformVector3(f,g,f),t.math.matrixTransformVector3(h,g,h),t.math.matrixTransformVector3(d,g,d),t.math.matrixTransformVector3(n,g,n),t.math.matrixTransformVector3(p,g,p),t.math.matrixTransformVector3(l,g,l),this.frameVecs.length=0,this.frameVecs.push(m),this.frameVecs.push(s),this.frameVecs.push(f),this.frameVecs.push(h),this.frameVecs.push(d),this.frameVecs.push(n),this.frameVecs.push(p),this.frameVecs.push(l)},Object.defineProperty(camera.prototype,"opvalue",{get:function(){return this._opvalue},set:function(t){t>0&&this._near<.01&&(this._near=.01,this._far<=this._near&&(this._far=this._near+.01)),this._opvalue=t},enumerable:!0,configurable:!0}),camera.prototype.getPosAtXPanelInViewCoordinateByScreenPos=function(e,a,r,i){var o=new t.math.rect;this.calcViewPortPixel(a,o);var n=new t.math.vector3;n.z=-this.near,n.x=e.x-.5*o.w,n.y=.5*o.h-e.y;var s=new t.math.vector3;s.z=-this.far,s.x=this.far*n.x/this.near,s.y=this.far*n.y/this.near;var l=(n.z-r)/(n.z-s.z);i.x=n.x-(n.x-s.x)*l,i.y=n.y-(n.y-s.y)*l},camera.prototype.fillRenderer=function(t){t.renderList.clear(),t.app.isFrustumCulling&&this.calcCameraFrame(t.app),this._fillRenderer(t,t.getRoot())},camera.prototype._fillRenderer=function(t,e){if((0!=e.hasRendererComp||0!=e.hasRendererCompChild)&&(!t.app.isFrustumCulling||this.testFrustumCulling(t,e))&&(null!=e.gameObject&&null!=e.gameObject.renderer&&e.gameObject.visible&&t.renderList.addRenderer(e.gameObject.renderer),null!=e.children&&e.gameObject.visible))for(var a=0;a<e.children.length;a++)this._fillRenderer(t,e.children[a])},camera.prototype.testFrustumCulling=function(t,e){if(!e.gameObject.getComponent("frustumculling"))return!0;var a=e.gameObject.getComponent("spherecollider");e.getWorldTranslate();return!!a.caclPlaneInDir(this.frameVecs[0],this.frameVecs[1],this.frameVecs[5])&&(!!a.caclPlaneInDir(this.frameVecs[1],this.frameVecs[3],this.frameVecs[7])&&(!!a.caclPlaneInDir(this.frameVecs[3],this.frameVecs[2],this.frameVecs[6])&&(!!a.caclPlaneInDir(this.frameVecs[2],this.frameVecs[0],this.frameVecs[4])&&(!!a.caclPlaneInDir(this.frameVecs[5],this.frameVecs[7],this.frameVecs[6])&&!!a.caclPlaneInDir(this.frameVecs[0],this.frameVecs[2],this.frameVecs[3])))))},camera.prototype._targetAndViewport=function(e,a,r,i){var o,n;null==e?(o=a.app.width,n=a.app.height,t.render.glRenderTarget.useNull(r.webgl)):(o=e.width,n=e.height,e.use(r.webgl)),r.webgl.viewport(o*this.viewport.x,n*this.viewport.y,o*this.viewport.w,n*this.viewport.h),r.webgl.depthRange(0,1),0==i&&(this.clearOption_Color&&this.clearOption_Depth?(r.webgl.depthMask(!0),t.render.glDrawPass.lastZWrite=!0,a.fog?r.webgl.clearColor(a.fog._Color.x,a.fog._Color.y,a.fog._Color.z,a.fog._Color.w):r.webgl.clearColor(this.backgroundColor.r,this.backgroundColor.g,this.backgroundColor.b,this.backgroundColor.a),r.webgl.clearDepth(1),r.webgl.clear(r.webgl.COLOR_BUFFER_BIT|r.webgl.DEPTH_BUFFER_BIT)):this.clearOption_Depth?(r.webgl.depthMask(!0),t.render.glDrawPass.lastZWrite=!0,r.webgl.clearDepth(1),r.webgl.clear(r.webgl.DEPTH_BUFFER_BIT)):this.clearOption_Color&&(a.fog?r.webgl.clearColor(a.fog._Color.x,a.fog._Color.y,a.fog._Color.z,a.fog._Color.w):r.webgl.clearColor(this.backgroundColor.r,this.backgroundColor.g,this.backgroundColor.b,this.backgroundColor.a),r.webgl.clear(r.webgl.COLOR_BUFFER_BIT)))},camera.prototype._renderOnce=function(t,e,a){e.drawtype=a;for(var r=t.app.getAssetMgr(),i=0,o=t.renderList.renderLayers;i<o.length;i++)for(var n=0,s=o[i].list;n<s.length;n++){var l=s[n];1==l.gameObject.visible&&this.CullingMask&1<<l.renderLayer&&l.gameObject&&1==l.gameObject.visible&&l.render(e,r,this)}},camera.prototype.renderScene=function(e,a){this._contextIdx=e.renderContext.indexOf(a);for(var r=0;r<e.renderList.renderLayers.length;r++){var i=e.renderList.renderLayers[r],o=i.list;i.needSort&&o.length>1&&o.sort(function(e,r){if(e.queue!=r.queue)return e.queue-r.queue;var i=a.matrixView,o=t.math.pool.new_vector3(),n=t.math.pool.new_vector3();t.math.matrixTransformVector3(e.gameObject.transform.getWorldTranslate(),i,o),t.math.matrixTransformVector3(r.gameObject.transform.getWorldTranslate(),i,n);var s=n.z-o.z;return t.math.pool.delete_vector3(o),t.math.pool.delete_vector3(n),s})}if(0==this.postQueues.length)this._targetAndViewport(this.renderTarget,e,a,!1),this._renderOnce(e,a,"");else{for(var n=0,s=this.postQueues;n<s.length;n++)s[n].render(e,a,this);a.webgl.flush()}},camera.prototype.remove=function(){},camera.prototype.clone=function(){},__decorate([t.reflect.UIStyle("rangeFloat",1,1e3,2),t.reflect.Field("number"),__metadata("design:type",Number),__metadata("design:paramtypes",[Number])],camera.prototype,"near",null),__decorate([t.reflect.UIStyle("rangeFloat",1,1e3,999),t.reflect.Field("number"),__metadata("design:type",Number),__metadata("design:paramtypes",[Number])],camera.prototype,"far",null),__decorate([t.reflect.Field("number"),__metadata("design:type",Number)],camera.prototype,"CullingMask",void 0),__decorate([t.reflect.compCall({use:"dirty",display:"刷新camera"}),__metadata("design:type",Function),__metadata("design:paramtypes",[]),__metadata("design:returntype",void 0)],camera.prototype,"markDirty",null),__decorate([t.reflect.Field("IOverLay[]"),__metadata("design:type",Array)],camera.prototype,"overlays",void 0),__decorate([t.reflect.Field("number"),__metadata("design:type",Number)],camera.prototype,"fov",void 0),__decorate([t.reflect.Field("number"),__metadata("design:type",Number)],camera.prototype,"size",void 0),__decorate([t.reflect.Field("number"),__metadata("design:type",Number),__metadata("design:paramtypes",[Number])],camera.prototype,"opvalue",null),camera=__decorate([t.reflect.nodeComponent,t.reflect.nodeCamera],camera)}();e.camera=o}(t.framework||(t.framework={}))}(gd3d||(gd3d={}));var gd3d;!function(t){!function(e){var a=function(){function canvascontainer(){this.isCanvasinit=!1,this._lastMode=r.ScreenSpaceOverlay,this._renderMode=r.ScreenSpaceOverlay}return Object.defineProperty(canvascontainer.prototype,"canvas",{get:function(){if(this._overlay2d&&this._overlay2d.canvas)return this._overlay2d.canvas},enumerable:!0,configurable:!0}),canvascontainer.prototype.setOverLay=function(t){this._overlay2d=t,this.canvasInit()},canvascontainer.prototype.getOverLay=function(){return this._overlay2d},Object.defineProperty(canvascontainer.prototype,"sortOrder",{get:function(){return this._overlay2d?this._overlay2d.sortOrder:0},set:function(t){this._overlay2d&&(this._overlay2d.sortOrder=t)},enumerable:!0,configurable:!0}),canvascontainer.prototype.canvasInit=function(){this.gameObject&&this.gameObject.transform&&this.gameObject.transform.scene&&this._overlay2d&&this._overlay2d.canvas&&(this._overlay2d.canvas.scene=this.gameObject.transform.scene,this._overlay2d.canvas.assetmgr=this._overlay2d.canvas.scene.app.getAssetMgr(),this.isCanvasinit=!0)},Object.defineProperty(canvascontainer.prototype,"renderMode",{get:function(){return this._renderMode},set:function(t){this._renderMode!=t&&(this._lastMode=this._renderMode,this._renderMode=t,this.styleToMode())},enumerable:!0,configurable:!0}),canvascontainer.prototype.styleToMode=function(){switch(this._renderMode){case r.ScreenSpaceOverlay:if(!this._overlay2d)return;this.gameObject.getScene().addScreenSpaceOverlay(this._overlay2d)}},canvascontainer.prototype.start=function(){this.styleToMode()},canvascontainer.prototype.onPlay=function(){},canvascontainer.prototype.update=function(t){this.isCanvasinit||this.canvasInit()},canvascontainer.prototype.remove=function(){this.gameObject.getScene()&&this.gameObject.getScene().removeScreenSpaceOverlay(this._overlay2d)},canvascontainer.prototype.clone=function(){},__decorate([t.reflect.Field("reference"),__metadata("design:type",e.overlay2D)],canvascontainer.prototype,"_overlay2d",void 0),__decorate([t.reflect.Field("number"),__metadata("design:type",Object),__metadata("design:paramtypes",[Number])],canvascontainer.prototype,"renderMode",null),canvascontainer=__decorate([t.reflect.nodeComponent,__metadata("design:paramtypes",[])],canvascontainer)}();e.canvascontainer=a;var r;!function(t){t[t.ScreenSpaceOverlay=0]="ScreenSpaceOverlay",t[t.ScreenSpaceCamera=1]="ScreenSpaceCamera",t[t.WorldSpace=2]="WorldSpace"}(r=e.canvasRenderMode||(e.canvasRenderMode={}))}(t.framework||(t.framework={}))}(gd3d||(gd3d={}));var gd3d;!function(t){!function(e){var a=function(){function effectSystem(){this.layer=e.RenderLayerEnum.Transparent,this.queue=0,this.autoplay=!0,this.state=e.EffectPlayStateEnum.None,this.curFrameId=-1,this.playTimer=0,this.speed=1,this.parser=new t.framework.EffectParser,this.vf=t.render.VertexFormatMask.Position|t.render.VertexFormatMask.Normal|t.render.VertexFormatMask.Tangent|t.render.VertexFormatMask.Color|t.render.VertexFormatMask.UV0,this.effectBatchers=[],this.matDataGroups=[],this.particleElementDic={},this.delayElements=[],this.refElements=[],this.beExecuteNextFrame=!0}return a=effectSystem,Object.defineProperty(effectSystem.prototype,"renderLayer",{get:function(){return this.gameObject.layer},set:function(t){this.gameObject.layer=t},enumerable:!0,configurable:!0}),Object.defineProperty(effectSystem.prototype,"jsonData",{get:function(){return this._textasset},set:function(t){this._textasset=t,this.setJsonDataStr(this.jsonData.content)},enumerable:!0,configurable:!0}),effectSystem.prototype.setJsonData=function(t){this._textasset=t,this.setJsonDataStr(this.jsonData.content)},effectSystem.prototype.setJsonDataStr=function(e){this.webgl=t.framework.sceneMgr.app.webgl,this.data=this.parser.Parse(e,t.framework.sceneMgr.app.getAssetMgr())},effectSystem.prototype.updateJsonData=function(t){this.jsonData=t,this.updateJsonDataStr(this.jsonData.content)},effectSystem.prototype.updateJsonDataStr=function(e){this.remove(),this.data=this.parser.Parse(e,t.framework.sceneMgr.app.getAssetMgr()),console.warn("开始解析特效")},Object.defineProperty(effectSystem.prototype,"data",{get:function(){return this._data},set:function(t){this._data=t},enumerable:!0,configurable:!0}),effectSystem.prototype.init=function(){this._data&&this.addElements()},Object.defineProperty(effectSystem.prototype,"totalFrameCount",{get:function(){return this.data.life*a.fps},enumerable:!0,configurable:!0}),effectSystem.prototype.start=function(){this.init()},effectSystem.prototype.onPlay=function(){},effectSystem.prototype.update=function(t){null!=this.gameObject.getScene()&&void 0!=this.gameObject.getScene()&&(this.state==e.EffectPlayStateEnum.Play||this.state==e.EffectPlayStateEnum.Pause?(this.state==e.EffectPlayStateEnum.Play&&(this.playTimer+=t*this.speed),this.beLoop||this.playTimer>=this.data.life&&this.stop(),this._update(t)):this.state==e.EffectPlayStateEnum.BeReady&&(this.autoplay?(this.play(),this._update(t)):(this.gameObject.visible=!1,this.gameObject.transform.markDirty())))},effectSystem.prototype._update=function(t){if(this.delayElements.length>0){this.refElements.length>0&&(this.refElements=[]);for(e=this.delayElements.length-1;e>=0;e--)this.delayElements[e].delayTime<=this.playTimer&&(this.addElement(this.delayElements[e]),this.delayElements.splice(e,1))}if(void 0!=this.particles&&this.particles.updateForEmission(t),this.checkFrameId()){for(var e in this.effectBatchers){var r=this.effectBatchers[e];for(var i in r.effectElements){var o=r.effectElements[i];void 0==o.delayTime||o.delayTime<=this.playTimer?r.mesh.submesh[0].size=o.endEboIndex:r.mesh.submesh[0].size>o.startEboIndex&&(r.mesh.submesh[0].size=o.startEboIndex);var n=(this.curFrameId-this.getDelayFrameCount(o.delayTime))%o.loopFrame;if(n=Math.floor(n),o.active&&(o.actionActive=!1,this.mergeLerpAttribData(o.curAttrData,o.timelineFrame[n]),void 0!=o.actions)){o.actionActive=!0;for(var s in o.actions)o.actions[s].update(n)}o.update(),o.isCurFrameNeedRefresh(n)&&this.updateEffectBatcher(o.effectBatcher,o.curAttrData,o.data.initFrameData,o.startVboIndex)}}void 0!=this.particles&&this.particles.update(1/a.fps)}},effectSystem.prototype.mergeLerpAttribData=function(e,a){if(void 0!=a&&void 0!=e)for(var r in a.attrsData)if(void 0!=a.attrsData[r]&&void 0!=e[r]){var i=a.attrsData.getAttribute(r);if(null==i)continue;(i instanceof t.math.vector3||i instanceof t.math.vector2||"number"==typeof i)&&"renderModel"!=r&&(e[r]=i)}},effectSystem.prototype.updateEffectBatcher=function(e,a,r,i){var o=a.mesh;if(void 0==o&&(o=r.attrsData.mesh),void 0!=o){void 0==a.meshdataVbo&&(a.meshdataVbo=o.data.genVertexDataArray(this.vf));for(var n=o.data.pos.length,s=a.meshdataVbo,l=e.vertexSize,h=0;h<n;h++){var c=t.math.pool.new_vector3();c.x=s[h*l+0],c.y=s[h*l+1],c.z=s[h*l+2],t.math.matrixTransformVector3(c,a.matrix,c),e.dataForVbo[(i+h)*l+0]=c.x,e.dataForVbo[(i+h)*l+1]=c.y,e.dataForVbo[(i+h)*l+2]=c.z,t.math.pool.delete_vector3(c);var u=s[h*l+9],d=s[h*l+10],m=s[h*l+11],p=s[h*l+12];void 0!=a.color&&(u=a.color.x,d=a.color.y,m=a.color.z),void 0!=a.alpha&&(p*=a.alpha),void 0!=a.colorRate&&(u*=a.colorRate,d*=a.colorRate,m*=a.colorRate,p*=a.colorRate),u=t.math.floatClamp(u,0,3),d=t.math.floatClamp(d,0,3),m=t.math.floatClamp(m,0,3),p=t.math.floatClamp(p,0,3),e.dataForVbo[15*(i+h)+9]=u,e.dataForVbo[15*(i+h)+10]=d,e.dataForVbo[15*(i+h)+11]=m,e.dataForVbo[15*(i+h)+12]=p,e.dataForVbo[(i+h)*l+13]=s[h*l+13]*a.tilling.x+a.uv.x,e.dataForVbo[(i+h)*l+14]=s[h*l+14]*a.tilling.y+a.uv.y}}},effectSystem.prototype.render=function(t,a,r){if(r.CullingMask&1<<this.renderLayer&&(this.state==e.EffectPlayStateEnum.Play||this.state==e.EffectPlayStateEnum.Pause)){t.updateModel(this.gameObject.transform);for(var i in this.effectBatchers){var o=this.effectBatchers[i],n=o.mesh;o.state===e.EffectBatcherState.NotInitedStateType?(n.glMesh.initBuffer(t.webgl,this.vf,o.curTotalVertexCount),0==n.glMesh.ebos.length?n.glMesh.addIndex(t.webgl,o.dataForEbo.length):n.glMesh.resetEboSize(t.webgl,0,o.dataForEbo.length),n.glMesh.uploadIndexData(t.webgl,0,o.dataForEbo),n.submesh[0].size=o.dataForEbo.length,o.state=e.EffectBatcherState.InitedStateType):o.state===e.EffectBatcherState.ResizeCapacityStateType&&(n.glMesh.resetEboSize(t.webgl,0,o.dataForEbo.length),n.submesh[0].size=o.dataForEbo.length,n.glMesh.uploadIndexData(t.webgl,0,o.dataForEbo),n.glMesh.resetVboSize(t.webgl,o.curTotalVertexCount*o.vertexSize),o.state=e.EffectBatcherState.InitedStateType),n.glMesh.uploadVertexData(t.webgl,o.dataForVbo),this.gameObject.getScene().fog?(t.fog=this.gameObject.getScene().fog,o.mat.draw(t,n,n.submesh[0],"base_fog")):o.mat.draw(t,n,n.submesh[0],"base")}void 0!=this.particles&&this.particles.render(t,a,r)}},effectSystem.prototype.clone=function(){var t=new a;return this.jsonData&&(t.jsonData=this.jsonData),this.data&&(t.data=this.data.clone()),t.autoplay=this.autoplay,t.beLoop=this.beLoop,t},effectSystem.prototype.play=function(t){void 0===t&&(t=1),this.state!=e.EffectPlayStateEnum.Pause&&this.stop(),this.speed=t,this.state=e.EffectPlayStateEnum.Play,this.gameObject.visible=!0,this.gameObject.transform.markDirty()},effectSystem.prototype.pause=function(){this.state=e.EffectPlayStateEnum.Pause},effectSystem.prototype.stop=function(){this.reset(),this.state=e.EffectPlayStateEnum.Stop},effectSystem.prototype.reset=function(t,a){void 0===t&&(t=!0),void 0===a&&(a=!0),this.state=e.EffectPlayStateEnum.BeReady,this.gameObject.visible=!1,this.playTimer=0,this.resetSingleMesh(),this.resetparticle()},effectSystem.prototype.resetSingleMesh=function(){for(var t in this.effectBatchers){var e=this.effectBatchers[t];for(var a in e.effectElements){var r=e.effectElements[a];r.setActive(!0),void 0!=r.data.initFrameData&&(r.curAttrData=r.data.initFrameData.attrsData.copyandinit())}}},effectSystem.prototype.resetparticle=function(){void 0!=this.particles&&this.particles.dispose();for(var t in this.particleElementDic){var a=this.data.elementDic[t];a.delayTime>0?this.delayElements.push(a):void 0==a.refFrom?(void 0==this.particles&&(this.particles=new e.Particles(this)),this.particles.addEmission(a)):this.refElements.push(a)}},effectSystem.prototype.addElements=function(){for(var t in this.data.elementDic){var a=this.data.elementDic[t];a.delayTime>0?this.delayElements.push(a):this.addElement(a)}this.state=e.EffectPlayStateEnum.BeReady,this.beLoop=this.data.beLoop},effectSystem.prototype.addElement=function(t){t.type==e.EffectElementTypeEnum.EmissionType?(void 0==this.particles&&(this.particles=new e.Particles(this)),this.particles.addEmission(t),this.particleElementDic[t.name]=t):t.type==e.EffectElementTypeEnum.SingleMeshType&&this.addInitFrame(t)},effectSystem.prototype.addInitFrame=function(a){var r=new e.EffectElement(a);r.transform=this.gameObject.transform;var i=r.data.initFrameData;if(void 0!=i&&void 0!=i.attrsData&&void 0!=i.attrsData.mesh){var o=-1;if(null!=i.attrsData.mat)for(var n=0;n<this.matDataGroups.length;n++)if(e.EffectMatData.beEqual(this.matDataGroups[n],i.attrsData.mat)){o=n;break}var s=0,l=i.attrsData.mesh.data.pos.length,h=(i.attrsData.mesh.data.genIndexDataArray,null);if(o>=0)s=(h=this.effectBatchers[o]).curTotalVertexCount,h.curTotalVertexCount+=l,h.state==e.EffectBatcherState.InitedStateType&&(h.state=e.EffectBatcherState.ResizeCapacityStateType);else{(h=new e.EffectBatcher(this.vf)).curTotalVertexCount=l,h.mesh=new e.mesh,h.mesh.data=new t.render.meshData,h.mesh.glMesh=new t.render.glMesh,h.mat=new e.material,h.mesh.submesh=[];var c=new e.subMeshInfo;c.matIndex=0,c.useVertexIndex=0,c.start=0,c.size=0,c.line=!1,h.mesh.submesh.push(c),s=0,o=0,null==i.attrsData.mat.shader?(h.mat.setShader(e.sceneMgr.app.getAssetMgr().getShader("diffuse.shader.json")),console.error("特效{0}shader为空",a.name)):h.mat.setShader(i.attrsData.mat.shader),void 0!=i.attrsData.mat.alphaCut&&h.mat.setFloat("_AlphaCut",i.attrsData.mat.alphaCut),null!=i.attrsData.mat.diffuseTexture&&h.mat.setTexture("_MainTex",i.attrsData.mat.diffuseTexture),null!=i.attrsData.mat.alphaTexture&&h.mat.setTexture("_AlphaTex",i.attrsData.mat.alphaTexture),this.effectBatchers.push(h),this.matDataGroups.push(i.attrsData.mat)}r.effectBatcher=h,r.startVboIndex=s,r.curAttrData=a.initFrameData.attrsData.copyandinit();var u=h.vertexSize,d=i.attrsData.mesh.data.genVertexDataArray(this.vf);r.update(),h.effectElements.push(r);for(var m=0;m<l;m++){var p=t.math.pool.new_vector3();p.x=d[m*u+0],p.y=d[m*u+1],p.z=d[m*u+2],t.math.matrixTransformVector3(p,r.curAttrData.matrix,p),h.dataForVbo[(s+m)*u+0]=p.x,h.dataForVbo[(s+m)*u+1]=p.y,h.dataForVbo[(s+m)*u+2]=p.z,t.math.pool.delete_vector3(p),h.dataForVbo[(s+m)*u+3]=d[m*u+3],h.dataForVbo[(s+m)*u+4]=d[m*u+4],h.dataForVbo[(s+m)*u+5]=d[m*u+5],h.dataForVbo[(s+m)*u+6]=d[m*u+6],h.dataForVbo[(s+m)*u+7]=d[m*u+7],h.dataForVbo[(s+m)*u+8]=d[m*u+8];var f=t.math.floatClamp(r.curAttrData.color.x,0,1),g=t.math.floatClamp(r.curAttrData.color.y,0,1),v=t.math.floatClamp(r.curAttrData.color.z,0,1),y=t.math.floatClamp(d[m*u+12]*r.curAttrData.alpha,0,1);h.dataForVbo[15*(s+m)+9]=f,h.dataForVbo[15*(s+m)+10]=g,h.dataForVbo[15*(s+m)+11]=v,h.dataForVbo[15*(s+m)+12]=y,h.dataForVbo[(s+m)*u+13]=d[m*u+13]*r.curAttrData.tilling.x,h.dataForVbo[(s+m)*u+14]=d[m*u+14]*r.curAttrData.tilling.y}var _=i.attrsData.mesh.data.genIndexDataArray(),b=h.indexStartIndex;r.startEboIndex=b,h.indexStartIndex+=_.length,r.endEboIndex=h.indexStartIndex;for(var w=0;w<_.length;w++)h.dataForEbo[b+w]=_[w]+s}},effectSystem.prototype.setFrameId=function(t){this.state==e.EffectPlayStateEnum.Pause&&t>=0&&t<this.totalFrameCount&&(this.curFrameId=t)},effectSystem.prototype.getDelayFrameCount=function(t){return t*a.fps},effectSystem.prototype.checkFrameId=function(){var t=a.fps*this.playTimer|0;return t!=this.curFrameId&&(this.state==e.EffectPlayStateEnum.Play&&(this.curFrameId=t),this.beExecuteNextFrame=!0,!0)},effectSystem.prototype.remove=function(){for(this.state=e.EffectPlayStateEnum.Dispose,this.data&&this.data.dispose();this.effectBatchers.length>0;)this.effectBatchers[0].dispose(),this.effectBatchers.splice(0,1);for(;this.matDataGroups.length>0;)this.matDataGroups.splice(0,1);this.particles&&this.particles.dispose(),this.curFrameId=-1,this.playTimer=0},Object.defineProperty(effectSystem.prototype,"leftLifeTime",{get:function(){return null!=this.data?this.data.life-this.playTimer:9999999999},enumerable:!0,configurable:!0}),effectSystem.fps=30,__decorate([t.reflect.Field("boolean"),__metadata("design:type",Boolean)],effectSystem.prototype,"autoplay",void 0),__decorate([t.reflect.Field("boolean"),__metadata("design:type",Boolean)],effectSystem.prototype,"beLoop",void 0),__decorate([t.reflect.Field("textasset"),__metadata("design:type",e.textasset),__metadata("design:paramtypes",[e.textasset])],effectSystem.prototype,"jsonData",null),effectSystem=a=__decorate([t.reflect.nodeRender,t.reflect.nodeComponent],effectSystem);var a}();e.effectSystem=a}(t.framework||(t.framework={}))}(gd3d||(gd3d={}));var gd3d;!function(t){!function(e){var a=function(){function TestEffectSystem(){this.layer=e.RenderLayerEnum.Transparent,this.queue=0,this.autoplay=!0,this.state=e.EffectPlayStateEnum.None,this.curFrameId=-1,this.playTimer=0,this.speed=1,this.parser=new t.framework.EffectParser,this.vf=t.render.VertexFormatMask.Position|t.render.VertexFormatMask.Normal|t.render.VertexFormatMask.Tangent|t.render.VertexFormatMask.Color|t.render.VertexFormatMask.UV0,this.effectBatchers=[],this.matDataGroups=[],this.particleElementDic={},this.delayElements=[],this.refElements=[],this.beExecuteNextFrame=!0}return Object.defineProperty(TestEffectSystem.prototype,"renderLayer",{get:function(){return this.gameObject.layer},set:function(t){this.gameObject.layer=t},enumerable:!0,configurable:!0}),TestEffectSystem.prototype.setJsonData=function(e){this.webgl=t.framework.sceneMgr.app.webgl,this.jsonData=e,this.data=this.parser.Parse(this.jsonData.content,t.framework.sceneMgr.app.getAssetMgr())},Object.defineProperty(TestEffectSystem.prototype,"data",{get:function(){return this._data},set:function(t){this._data=t},enumerable:!0,configurable:!0}),TestEffectSystem.prototype.init=function(){this._data&&this.addElements()},Object.defineProperty(TestEffectSystem.prototype,"totalFrameCount",{get:function(){return this.data.life*e.effectSystem.fps},enumerable:!0,configurable:!0}),TestEffectSystem.prototype.start=function(){this.init()},TestEffectSystem.prototype.onPlay=function(){},TestEffectSystem.prototype.update=function(t){null!=this.gameObject.getScene()&&void 0!=this.gameObject.getScene()&&(this.state==e.EffectPlayStateEnum.Play||this.state==e.EffectPlayStateEnum.Pause?(this.state==e.EffectPlayStateEnum.Play&&(this.playTimer+=t*this.speed),this.beLoop||this.playTimer>=this.data.life&&this.stop(),this._update(t)):this.state==e.EffectPlayStateEnum.BeReady&&(this.autoplay?(this.play(),this._update(t)):(this.gameObject.visible=!1,this.gameObject.transform.markDirty())))},TestEffectSystem.prototype._update=function(t){if(this.delayElements.length>0){this.refElements.length>0&&(this.refElements=[]);for(var a=this.delayElements.length-1;a>=0;a--)this.delayElements[a].delayTime<=this.playTimer&&(this.addElement(this.delayElements[a]),this.delayElements.splice(a,1))}if(this.checkFrameId()&&null!=this.emissionElement)for(var r=0;r<this.emissionElement.length;r++)this.emissionElement[r].update(1/e.effectSystem.fps)},TestEffectSystem.prototype.render=function(t,a,r){if(r.CullingMask&1<<this.renderLayer&&this.state==e.EffectPlayStateEnum.Play&&(t.updateModel(this.gameObject.transform),null!=this.emissionElement))for(var i=0;i<this.emissionElement.length;i++)this.emissionElement[i].render(t,a,r)},TestEffectSystem.prototype.clone=function(){var t=new e.effectSystem;return t.data=this.data.clone(),t},TestEffectSystem.prototype.play=function(t){void 0===t&&(t=1),this.speed=t,this.state=e.EffectPlayStateEnum.Play,this.gameObject.visible=!0,this.gameObject.transform.markDirty()},TestEffectSystem.prototype.pause=function(){this.state=e.EffectPlayStateEnum.Pause},TestEffectSystem.prototype.stop=function(){this.reset(),this.state=e.EffectPlayStateEnum.Stop},TestEffectSystem.prototype.reset=function(t,a){void 0===t&&(t=!0),void 0===a&&(a=!0),this.state=e.EffectPlayStateEnum.BeReady,this.gameObject.visible=!1,this.playTimer=0,this.resetSingleMesh()},TestEffectSystem.prototype.resetSingleMesh=function(){for(var t in this.effectBatchers){var e=this.effectBatchers[t];for(var a in e.effectElements){var r=e.effectElements[a];r.setActive(!0),void 0!=r.data.initFrameData&&(r.curAttrData=r.data.initFrameData.attrsData.copyandinit())}}},TestEffectSystem.prototype.addElements=function(){for(var t in this.data.elementDic){var a=this.data.elementDic[t];a.delayTime>0?this.delayElements.push(a):this.addElement(a)}this.state=e.EffectPlayStateEnum.BeReady,this.beLoop=this.data.beLoop},TestEffectSystem.prototype.addElement=function(t){},TestEffectSystem.prototype.addEmissionElement=function(t){void 0===t&&(t=null),null==this.emissionElement&&(this.emissionElement=[]);var a=new e.EffectElementEmission(this,t);this.emissionElement.push(a)},TestEffectSystem.prototype.setFrameId=function(t){this.state==e.EffectPlayStateEnum.Pause&&t>=0&&t<this.totalFrameCount&&(this.curFrameId=t)},TestEffectSystem.prototype.getDelayFrameCount=function(t){return t*e.effectSystem.fps},TestEffectSystem.prototype.checkFrameId=function(){var t=e.effectSystem.fps*this.playTimer|0;return t!=this.curFrameId&&(this.state==e.EffectPlayStateEnum.Play&&(this.curFrameId=t),this.beExecuteNextFrame=!0,!0)},TestEffectSystem.prototype.remove=function(){this.state=e.EffectPlayStateEnum.Dispose,this.data&&this.data.dispose();for(var t in this.effectBatchers)this.effectBatchers[t].dispose();this.particles&&this.particles.dispose()},Object.defineProperty(TestEffectSystem.prototype,"leftLifeTime",{get:function(){return null!=this.data?this.data.life-this.playTimer:9999999999},enumerable:!0,configurable:!0}),TestEffectSystem.fps=30,__decorate([t.reflect.Field("boolean"),__metadata("design:type",Boolean)],TestEffectSystem.prototype,"autoplay",void 0),__decorate([t.reflect.Field("boolean"),__metadata("design:type",Boolean)],TestEffectSystem.prototype,"beLoop",void 0),__decorate([t.reflect.Field("textasset"),__metadata("design:type",e.textasset)],TestEffectSystem.prototype,"jsonData",void 0),TestEffectSystem=__decorate([t.reflect.nodeRender,t.reflect.nodeComponent,t.reflect.selfClone],TestEffectSystem)}();e.TestEffectSystem=a}(t.framework||(t.framework={}))}(gd3d||(gd3d={}));var gd3d;!function(t){!function(e){var a=function(){function frustumculling(){}return frustumculling.prototype.start=function(){},frustumculling.prototype.onPlay=function(){},frustumculling.prototype.update=function(t){},frustumculling.prototype.remove=function(){},frustumculling.prototype.clone=function(){},frustumculling=__decorate([t.reflect.nodeComponent,__metadata("design:paramtypes",[])],frustumculling)}();e.frustumculling=a}(t.framework||(t.framework={}))}(gd3d||(gd3d={}));var gd3d;!function(t){!function(e){var a=function(){function guidpath(){this.speed=1,this.isactived=!1,this.datasafe=!1,this.folowindex=0,this.isloop=!1,this.lookforward=!1,this.loopCount=1,this.adjustDir=!1}return Object.defineProperty(guidpath.prototype,"pathasset",{get:function(){return this._pathasset},set:function(t){this._pathasset&&this._pathasset.unuse(),this._pathasset=t,this._pathasset&&this._pathasset.use()},enumerable:!0,configurable:!0}),guidpath.prototype.play=function(t){void 0===t&&(t=1),this.isactived=!0,this.loopCount=t},guidpath.prototype.pause=function(){this.isactived=!1},guidpath.prototype.stop=function(){this.isactived=!1,this.folowindex=0},guidpath.prototype.replay=function(t){void 0===t&&(t=1),this.isactived=!0,this.folowindex=0,this.loopCount=t},guidpath.prototype.setpathasset=function(e,a,r){void 0===a&&(a=1),void 0===r&&(r=null),this.pathasset=e,null!=e?(this.paths=e.paths,null!=this.paths[0]&&(t.math.vec3Clone(this.paths[0],this.gameObject.transform.localTranslate),this.gameObject.transform.markDirty(),this.datasafe=!0),this.mystrans=this.gameObject.transform,this.speed=a,this.oncomplete=r):console.log(this.gameObject.getName().toString+":are you sure set the right pathasset（error：null）")},guidpath.prototype.start=function(){},guidpath.prototype.onPlay=function(){},guidpath.prototype.update=function(t){this.isactived&&this.datasafe&&this.followmove(t)},guidpath.prototype.followmove=function(e){var a=t.math.vec3Distance(this.mystrans.localTranslate,this.paths[this.folowindex]);if(a<.01)if(this.folowindex<this.paths.length-1){r=new t.math.vector3;t.math.vec3Clone(this.paths[this.folowindex],this.mystrans.localTranslate),this.folowindex++,this.adjustDir=!0,this.mystrans.markDirty()}else this.folowindex=0,this.isloop||0==--this.loopCount&&(this.isactived=!1,this.loopCount=1,this.oncomplete&&this.oncomplete());else{var r=new t.math.vector3;if(t.math.vec3Subtract(this.paths[this.folowindex],this.mystrans.localTranslate,r),this.adjustDir){var i=this.paths[this.folowindex],o=this.mystrans.localTranslate,n=t.math.pool.new_quaternion();t.math.quatLookat(o,i,n),t.math.quatClone(n,this.mystrans.localRotate),t.math.pool.delete_quaternion(n),this.adjustDir=!1}var s=this.speed*e;s>a&&(s=a);var l=s/a;t.math.vec3SLerp(this.mystrans.localTranslate,this.paths[this.folowindex],l,this.mystrans.localTranslate),this.mystrans.markDirty()}},guidpath.prototype.remove=function(){this._pathasset&&this._pathasset.unuse()},guidpath.prototype.clone=function(){},guidpath=__decorate([t.reflect.nodeComponent],guidpath)}();e.guidpath=a}(t.framework||(t.framework={}))}(gd3d||(gd3d={}));var gd3d;!function(t){!function(e){var a=function(){function keyFrameAniPlayer(){this.nowTime=0,this.pathPropertyMap={}}return Object.defineProperty(keyFrameAniPlayer.prototype,"nowFrame",{get:function(){return this.nowClip?Math.floor(this.nowClip.fps*this.nowTime):0},enumerable:!0,configurable:!0}),keyFrameAniPlayer.prototype.start=function(){this.init()},keyFrameAniPlayer.prototype.onPlay=function(){},keyFrameAniPlayer.prototype.update=function(t){var e=this.nowClip;if(e){if(this.checkPlayEnd(e))return this.nowClip=null,void(this.nowTime=0);this.nowTime+=t;var a=this.nowTime%this.nowClip.time;this.displayByTime(e,a)}},keyFrameAniPlayer.prototype.displayByTime=function(t,e){var a=this.timeFilterCurves(t,e);if(a&&!(a.length<1))for(var r=0;r<a.length;r++){var i=a[r];this.refrasCurveProperty(i,e)}},keyFrameAniPlayer.prototype.calcValueByTime=function(t,e){var a=t.keyFrames;if(!a||a.length<1)return 0;if(1==a.length&&a[0])return a[0].value;for(var i,o,n=0;n<a.length;n++)if(o=a[n],a[n].time>e){n>0&&(i=a[n-1]);break}return r.calcValue(i,o,e)},keyFrameAniPlayer.prototype.refrasCurveProperty=function(t,a){if(!(a<0||!t||t.keyFrames.length<2||e.StringUtil.isNullOrEmptyObject(t.propertyName))){var r=t.path+"_"+t.type,i=this.pathPropertyMap[r];if(i)for(var o=i,n=t.propertyName.split(".");n.length>0;){if(1==n.length)return o[n[0]]=this.calcValueByTime(t,a),void(t.type==e.transform.name&&i instanceof e.transform&&i.markDirty());if(!(o=o[n.shift()]))return}}},keyFrameAniPlayer.prototype.timeFilterCurves=function(t,e){if(t&&!(t.curves.length<1)){for(var a=[],r=0;r<t.curves.length;r++){var i=t.curves[r],o=i.keyFrames;o.length<1||!o[o.length-1]||o[o.length-1].time<e||a.push(i)}return a}},keyFrameAniPlayer.prototype.checkPlayEnd=function(t){return!t||t._wrapMode!=e.WrapMode.Loop&&t._wrapMode!=e.WrapMode.PingPong&&(this.nowTime>=t.time||void 0)},keyFrameAniPlayer.prototype.init=function(){},keyFrameAniPlayer.prototype.isPlaying=function(t){return this.nowClip&&this.nowClip.getName()==t},keyFrameAniPlayer.prototype.playByName=function(t){if(this.clips&&!(this.clips.length<1))for(var e=0;e<this.clips.length;e++){var a=this.clips[e];a&&(a.getName()==t&&(this.nowClip=a,this.collectPathPropertyObj(this.nowClip,this.pathPropertyMap)))}},keyFrameAniPlayer.prototype.play=function(){!this.clips||this.clips.length<1||(this.nowClip=this.clips[0],this.nowClip&&this.collectPathPropertyObj(this.nowClip,this.pathPropertyMap))},keyFrameAniPlayer.prototype.stop=function(){this.nowClip=null},keyFrameAniPlayer.prototype.rewind=function(){this.nowClip&&(this.displayByTime(this.nowClip,0),this.nowTime=0)},keyFrameAniPlayer.prototype.collectPropertyObj=function(t){if(t)for(var a=0;a<t.curves.length;a++){var r=t.curves[a],i=this.gameObject.transform;e.StringUtil.isNullOrEmptyObject(r.path)||(i=this.pathPropertyMap[r.path]);r.type!=e.transform.prototype.name&&i.gameObject.getComponent(r.type)}},keyFrameAniPlayer.prototype.collectPathPropertyObj=function(t,a){if(t&&a)for(var r=0;r<t.curves.length;r++){var i=t.curves[r],o="",n=this.gameObject.transform;if(!e.StringUtil.isNullOrEmptyObject(i.path)){for(var s=i.path.split("/"),l=0;l<s.length&&(n=this.serchChild(s[r],n));l++);if(!n)continue}o=i.path+"_"+i.type;var h=n;i.type!=e.transform.name&&(h=n.gameObject.getComponent(i.type)),a[o]=h}},keyFrameAniPlayer.prototype.serchChild=function(t,e){if(e&&e.children&&!(e.children.length<1))for(var a=0;a<e.children.length;a++){var r=e.children[a];if(r&&r.name==t)return r}},keyFrameAniPlayer.prototype.clone=function(){},keyFrameAniPlayer.prototype.remove=function(){},__decorate([t.reflect.Field("keyFrameAniClip[]"),__metadata("design:type",Array)],keyFrameAniPlayer.prototype,"clips",void 0),keyFrameAniPlayer=__decorate([t.reflect.nodeComponent],keyFrameAniPlayer)}();e.keyFrameAniPlayer=a;var r=function(){function bezierCurveTool(){}return bezierCurveTool.calcValue=function(t,e,a){if(t.outTangent==1/0||e.inTangent==1/0)return t.value;var r=(a-t.time)/(e.time-t.time);return bezierCurveTool.converCalc(t.value,e.value,t.time,e.time,t.inTangent,e.outTangent,r).y},bezierCurveTool.converCalc=function(e,a,r,i,o,n,s){var l=t.math.pool.new_vector2(r,e),h=t.math.pool.new_vector2(),c=t.math.pool.new_vector2(),u=t.math.pool.new_vector2(i,a),d=t.math.pool.new_vector2(o<0?-1:1,Math.sqrt(1+o*o)),m=t.math.pool.new_vector2(n<0?-1:1,Math.sqrt(1+n*n));return t.math.vec2Add(l,d,h),t.math.vec2Add(u,m,c),bezierCurveTool.calcCurve(s,l,h,c,u,bezierCurveTool.cupV2),t.math.pool.delete_vector2Array([l,h,c,u,d,m]),bezierCurveTool.cupV2},bezierCurveTool.calcCurve=function(t,e,a,r,i,o){var n=function(t,e,a,r,i){return(1-t)*(1-t)*(1-t)*e+3*t*(1-t)*(1-t)*a+3*t*t*(1-t)*r+t*t*t*i};return o.x=n(t,e.x,a.x,r.x,i.x),o.y=n(t,e.y,a.y,r.y,i.y),o},bezierCurveTool.cupV2=new t.math.vector2,bezierCurveTool}()}(t.framework||(t.framework={}))}(gd3d||(gd3d={}));var gd3d;!function(t){!function(e){!function(t){t[t.Direction=0]="Direction",t[t.Point=1]="Point",t[t.Spot=2]="Spot"}(e.LightTypeEnum||(e.LightTypeEnum={}));var a=function(){function light(){this.spotAngelCos=.9,this.range=10,this.intensity=1,this.color=new t.math.color(1,1,1,1),this.cullingMask=e.CullingMask.everything}return light.prototype.start=function(){},light.prototype.onPlay=function(){},light.prototype.update=function(t){},light.prototype.remove=function(){},light.prototype.clone=function(){},__decorate([t.reflect.Field("number"),__metadata("design:type",Number)],light.prototype,"type",void 0),__decorate([t.reflect.Field("number"),__metadata("design:type",Number)],light.prototype,"range",void 0),__decorate([t.reflect.Field("number"),__metadata("design:type",Number)],light.prototype,"intensity",void 0),__decorate([t.reflect.Field("color"),__metadata("design:type",t.math.color)],light.prototype,"color",void 0),__decorate([t.reflect.Field("number"),__metadata("design:type",Number)],light.prototype,"cullingMask",void 0),light=__decorate([t.reflect.nodeComponent,t.reflect.nodeLight],light)}();e.light=a}(t.framework||(t.framework={}))}(gd3d||(gd3d={}));var gd3d;!function(t){!function(e){var a=function(){function spherestruct(e,a){this.center=t.math.pool.clone_vector3(e),this.srcradius=a,this.tempScale=new t.math.vector3}return spherestruct.prototype.update=function(e){t.math.matrixGetTranslation(e,this.center),t.math.matrixGetScale(e,this.tempScale),this.tempScale.x<this.tempScale.y&&(this.tempScale.x=this.tempScale.y),this.tempScale.x<this.tempScale.z&&(this.tempScale.x=this.tempScale.z),this.radius=this.srcradius*this.tempScale.x},spherestruct.prototype.intersects=function(a){if(a instanceof spherestruct)return!(t.math.vec3Distance(this.center,a.center)>this.radius+a.radius);e.obb},spherestruct}();e.spherestruct=a;var r=function(){function spherecollider(){this._worldCenter=new t.math.vector3,this._colliderVisible=!1}return Object.defineProperty(spherecollider.prototype,"worldCenter",{get:function(){return t.math.vec3Clone(this.center,this._worldCenter),t.math.matrixTransformVector3(this._worldCenter,this.gameObject.transform.getWorldMatrix(),this._worldCenter),this._worldCenter},enumerable:!0,configurable:!0}),spherecollider.prototype.getBound=function(){return this.spherestruct},Object.defineProperty(spherecollider.prototype,"matrix",{get:function(){return this.gameObject?this.gameObject.transform.getWorldMatrix():new t.math.matrix},enumerable:!0,configurable:!0}),spherecollider.prototype.start=function(){this.filter=this.gameObject.getComponent("meshFilter"),this.build()},spherecollider.prototype.onPlay=function(){},spherecollider.prototype.update=function(t){this.spherestruct&&this.spherestruct.update(this.matrix)},Object.defineProperty(spherecollider.prototype,"colliderVisible",{get:function(){return this._colliderVisible},set:function(t){this._colliderVisible=t,this.subTran&&(this.subTran.gameObject.visible=this._colliderVisible)},enumerable:!0,configurable:!0}),spherecollider.prototype.caclPlaneInDir=function(e,a,r){var i=t.math.pool.new_vector3(),o=t.math.pool.new_vector3(),n=t.math.pool.new_vector3(),s=t.math.pool.new_vector3();t.math.vec3Subtract(a,e,i),t.math.vec3Subtract(r,a,o),t.math.vec3Cross(i,o,n),t.math.calPlaneLineIntersectPoint(n,e,n,this.worldCenter,s);var l=t.math.pool.new_vector3();t.math.vec3Subtract(s,this.worldCenter,l);var h=t.math.vec3Dot(n,l);if(t.math.pool.delete_vector3(i),t.math.pool.delete_vector3(o),t.math.pool.delete_vector3(n),h<=0)return!0;var c=t.math.vec3Distance(this.worldCenter,s);return t.math.pool.delete_vector3(s),c<this.radius},spherecollider.prototype.intersectsTransform=function(t){if(null==t.gameObject.collider)return!1;if(null==this.spherestruct||null==t.gameObject.collider.getBound())return!1;var e=t.gameObject.collider.getBound();return this.spherestruct.intersects(e)},spherecollider.prototype.build=function(){this.center&&this.radius&&(this.spherestruct=new a(this.center,this.radius))},spherecollider.prototype.buildMesh=function(){this.subTran=new t.framework.transform,this.subTran.gameObject.hideFlags=e.HideFlags.DontSave|e.HideFlags.HideInHierarchy,this.subTran.name="spherecollider",this.subTran.gameObject.addComponent("meshFilter").mesh=this.getColliderMesh();this.subTran.gameObject.addComponent("meshRenderer");this.subTran.gameObject.visible=this._colliderVisible,this.gameObject.transform.addChild(this.subTran),this.gameObject.transform.markDirty(),this.subTran.markDirty(),this.gameObject.transform.updateWorldTran()},spherecollider.prototype.getColliderMesh=function(){return new e.mesh},spherecollider.prototype.remove=function(){this.subTran&&this.subTran.dispose()},spherecollider.prototype.clone=function(){},__decorate([t.reflect.Field("vector3"),__metadata("design:type",t.math.vector3)],spherecollider.prototype,"center",void 0),__decorate([t.reflect.Field("number"),__metadata("design:type",Number)],spherecollider.prototype,"radius",void 0),spherecollider=__decorate([t.reflect.nodeComponent,t.reflect.nodeSphereCollider],spherecollider)}();e.spherecollider=r}(t.framework||(t.framework={}))}(gd3d||(gd3d={}));var gd3d;!function(t){!function(e){var a=function(){function trailRender(){this.layer=e.RenderLayerEnum.Common,this.queue=0,this.width=1,this.vertexcount=24,this.active=!1,this.reInit=!1,this.extenedOneSide=!0,this.lookAtCamera=!1,this.speed=.5}return Object.defineProperty(trailRender.prototype,"renderLayer",{get:function(){return this.gameObject.layer},set:function(t){this.gameObject.layer=t},enumerable:!0,configurable:!0}),trailRender.prototype.start=function(){this.app=this.gameObject.getScene().app,this.webgl=this.app.webgl,this.initmesh()},trailRender.prototype.onPlay=function(){},trailRender.prototype.update=function(a){if(this.active){this.reInit&&(this.intidata(),this.reInit=!1);var r=this.gameObject.transform.getWorldTranslate();if(this.lookAtCamera){this.camerapositon=e.sceneMgr.app.getScene().mainCamera.gameObject.transform.getWorldTranslate();var i=t.math.pool.new_vector3();t.math.vec3Subtract(this.camerapositon,this.sticks[0].location,i),t.math.vec3Normalize(i,i);var o=t.math.pool.new_vector3();t.math.vec3Subtract(r,this.sticks[0].location,o),t.math.vec3Normalize(o,o),t.math.vec3Cross(i,o,this.sticks[0].updir),t.math.vec3ScaleByNum(this.sticks[0].updir,this.width,this.sticks[0].updir),t.math.pool.delete_vector3(o)}t.math.vec3Clone(r,this.sticks[0].location);for(var n=this.sticks.length,s=1;s<n;s++)t.math.vec3SLerp(this.sticks[s].location,this.sticks[s-1].location,this.speed,this.sticks[s].location);if(this.lookAtCamera)for(s=1;s<n;s++){var l=t.math.pool.new_vector3();t.math.vec3Subtract(this.camerapositon,this.sticks[s].location,l),t.math.vec3Normalize(l,l);var h=t.math.pool.new_vector3();t.math.vec3Subtract(this.sticks[s-1].location,this.sticks[s].location,h),t.math.vec3Normalize(h,h),t.math.vec3Cross(l,h,this.sticks[s].updir),t.math.vec3ScaleByNum(this.sticks[s].updir,this.width,this.sticks[s].updir),t.math.pool.delete_vector3(l)}else{this.gameObject.transform.getUpInWorld(this.sticks[0].updir),t.math.vec3ScaleByNum(this.sticks[0].updir,this.width,this.sticks[0].updir);for(s=1;s<n;s++)t.math.vec3SLerp(this.sticks[s].updir,this.sticks[s-1].updir,this.speed,this.sticks[s].updir)}this.updateTrailData()}},Object.defineProperty(trailRender.prototype,"material",{get:function(){if(void 0!=this._material)return this._material;var e=new t.framework.material;return e.setShader(this.app.getAssetMgr().getShader("shader/def")),this.material=e,this._material},set:function(t){this._material=t,this.layer=this.material.getLayer()},enumerable:!0,configurable:!0}),Object.defineProperty(trailRender.prototype,"color",{get:function(){return void 0==this._color&&(this._color=new t.math.color(1,1,1,1)),this._color},set:function(t){this._color=t},enumerable:!0,configurable:!0}),trailRender.prototype.setspeed=function(t){this.speed=t},trailRender.prototype.setWidth=function(t){this.width=t},trailRender.prototype.play=function(){this.reInit=!0,this.active=!0},trailRender.prototype.stop=function(){this.active=!1},trailRender.prototype.initmesh=function(){this.mesh=new t.framework.mesh,this.mesh.data=new t.render.meshData,this.mesh.glMesh=new t.render.glMesh,this.dataForVbo=new Float32Array(9*this.vertexcount),this.dataForEbo=new Uint16Array(6*(this.vertexcount/2-1));var a=t.render.VertexFormatMask.Position|t.render.VertexFormatMask.Color|t.render.VertexFormatMask.UV0;this.mesh.glMesh.initBuffer(this.webgl,a,this.vertexcount,t.render.MeshTypeEnum.Dynamic),this.mesh.glMesh.addIndex(this.webgl,this.dataForEbo.length),this.mesh.submesh=[];var r=new e.subMeshInfo;r.matIndex=0,r.useVertexIndex=0,r.start=0,r.size=this.dataForEbo.length,r.line=!1,this.mesh.submesh.push(r)},trailRender.prototype.intidata=function(){this.sticks=[];for(l=0;l<this.vertexcount/2;l++){var e=new r;this.sticks.push(e),e.location=new t.math.vector3,t.math.vec3Clone(this.gameObject.transform.getWorldTranslate(),e.location),e.updir=new t.math.vector3,this.gameObject.transform.getUpInWorld(e.updir),t.math.vec3ScaleByNum(e.updir,this.width,e.updir)}var a=this.vertexcount/2,i=t.math.pool.new_vector3();this.gameObject.transform.getUpInWorld(i),t.math.vec3ScaleByNum(i,this.width,i);var o=t.math.pool.new_vector3();t.math.vec3Clone(this.gameObject.transform.getWorldTranslate(),o);var n=t.math.pool.new_vector3();t.math.vec3Add(o,i,n);var s=t.math.pool.new_vector3();t.math.vec3Subtract(o,i,s);for(var l=0;l<a;l++)this.dataForVbo[2*l*9]=n.x,this.dataForVbo[2*l*9+1]=n.y,this.dataForVbo[2*l*9+2]=n.z,this.dataForVbo[2*l*9+3]=this.color.r,this.dataForVbo[2*l*9+4]=this.color.g,this.dataForVbo[2*l*9+5]=this.color.b,this.dataForVbo[2*l*9+6]=this.color.a,this.dataForVbo[2*l*9+7]=l/(a-1),this.dataForVbo[2*l*9+8]=0,this.dataForVbo[9*(2*l+1)]=s.x,this.dataForVbo[9*(2*l+1)+1]=s.y,this.dataForVbo[9*(2*l+1)+2]=s.z,this.dataForVbo[9*(2*l+1)+3]=this.color.r,this.dataForVbo[9*(2*l+1)+4]=this.color.g,this.dataForVbo[9*(2*l+1)+5]=this.color.b,this.dataForVbo[9*(2*l+1)+6]=this.color.a,this.dataForVbo[9*(2*l+1)+7]=l/(a-1),this.dataForVbo[9*(2*l+1)+8]=1;for(var h=0;h<a-1;h++)this.dataForEbo[6*h+0]=2*h,this.dataForEbo[6*h+1]=2*(h+1),this.dataForEbo[6*h+2]=2*h+1,this.dataForEbo[6*h+3]=2*h+1,this.dataForEbo[6*h+4]=2*(h+1),this.dataForEbo[6*h+5]=2*(h+1)+1;this.mesh.glMesh.uploadVertexData(this.webgl,this.dataForVbo),this.mesh.glMesh.uploadIndexData(this.webgl,0,this.dataForEbo),t.math.pool.delete_vector3(i),t.math.pool.delete_vector3(o),t.math.pool.delete_vector3(n),t.math.pool.delete_vector3(s)},trailRender.prototype.updateTrailData=function(){var t=this.vertexcount/2;if(this.extenedOneSide)for(r=0;r<t;r++){var e=this.sticks[r].location,a=this.sticks[r].updir;this.dataForVbo[2*r*9]=e.x,this.dataForVbo[2*r*9+1]=e.y,this.dataForVbo[2*r*9+2]=e.z,this.dataForVbo[9*(2*r+1)]=e.x+a.x,this.dataForVbo[9*(2*r+1)+1]=e.y+a.y,this.dataForVbo[9*(2*r+1)+2]=e.z+a.z}else for(var r=0;r<t;r++){var e=this.sticks[r].location,a=this.sticks[r].updir;this.dataForVbo[2*r*9]=e.x-a.x,this.dataForVbo[2*r*9+1]=e.y-a.y,this.dataForVbo[2*r*9+2]=e.z-a.z,this.dataForVbo[9*(2*r+1)]=e.x+a.x,this.dataForVbo[9*(2*r+1)+1]=e.y+a.y,this.dataForVbo[9*(2*r+1)+2]=e.z+a.z}},trailRender.prototype.render=function(t,e,a){this.active&&(t.updateModeTrail(),this.mesh.glMesh.uploadVertexData(t.webgl,this.dataForVbo),this.gameObject.getScene().fog?(t.fog=this.gameObject.getScene().fog,this.material.draw(t,this.mesh,this.mesh.submesh[0],"base_fog")):this.material.draw(t,this.mesh,this.mesh.submesh[0],"base"))},trailRender.prototype.clone=function(){},trailRender.prototype.remove=function(){},trailRender=__decorate([t.reflect.nodeRender,t.reflect.nodeComponent],trailRender)}();e.trailRender=a;var r=function(){return function trailStick(){}}();e.trailStick=r}(t.framework||(t.framework={}))}(gd3d||(gd3d={}));var gd3d;!function(t){!function(e){var a=function(){function trailRender_recorde(){this.layer=e.RenderLayerEnum.Common,this.queue=0,this._startWidth=1,this._endWidth=0,this.lifetime=.35,this.minStickDistance=.1,this.maxStickCout=12,this.nodes=[],this.interpolate=!1,this.interpNumber=3,this.interpPath=[],this.activeMaxpointlimit=!1,this.notRender=!1}return Object.defineProperty(trailRender_recorde.prototype,"renderLayer",{get:function(){return this.gameObject.layer},set:function(t){this.gameObject.layer=t},enumerable:!0,configurable:!0}),Object.defineProperty(trailRender_recorde.prototype,"material",{get:function(){if(void 0!=this._material)return this._material;var e=new t.framework.material;return e.setShader(this.app.getAssetMgr().getShader("shader/def")),this._material=e,this._material},set:function(t){this._material=t,this.layer=this._material.getLayer()},enumerable:!0,configurable:!0}),Object.defineProperty(trailRender_recorde.prototype,"startColor",{get:function(){return void 0==this._startColor&&(this._startColor=new t.math.color(1,1,1,1)),this._startColor},set:function(t){this._startColor=t},enumerable:!0,configurable:!0}),Object.defineProperty(trailRender_recorde.prototype,"endColor",{get:function(){return void 0==this._endColor&&(this._endColor=new t.math.color(this.startColor.r,this.startColor.g,this.startColor.b,0)),this._endColor},set:function(t){this._endColor=t},enumerable:!0,configurable:!0}),trailRender_recorde.prototype.setWidth=function(t,e){void 0===e&&(e=0),this._startWidth=t,this._endWidth=e},trailRender_recorde.prototype.setMaxpointcontroll=function(t){void 0===t&&(t=!1),this.activeMaxpointlimit=t},trailRender_recorde.prototype.start=function(){this.app=this.gameObject.getScene().app,this.webgl=this.app.webgl,this.mesh=new t.framework.mesh,this.mesh.data=new t.render.meshData,this.mesh.glMesh=new t.render.glMesh,this.dataForVbo=new Float32Array(128),this.dataForEbo=new Uint16Array(128);var a=t.render.VertexFormatMask.Position|t.render.VertexFormatMask.Color|t.render.VertexFormatMask.UV0;this.mesh.glMesh.initBuffer(this.webgl,a,128,t.render.MeshTypeEnum.Dynamic),this.mesh.glMesh.addIndex(this.webgl,this.dataForEbo.length),this.mesh.submesh=[];var r=new e.subMeshInfo;r.matIndex=0,r.useVertexIndex=0,r.start=0,r.size=this.dataForEbo.length,r.line=!1,this.mesh.submesh.push(r),this.interpolate?(this.maxStickCout*=this.interpNumber,this.targetPath=this.interpPath):this.targetPath=this.nodes},trailRender_recorde.prototype.onPlay=function(){},trailRender_recorde.prototype.update=function(t){var e=this.app.getTotalTime();this.refreshTrailNode(e),this.updateTrailData(e)},trailRender_recorde.prototype.remove=function(){},trailRender_recorde.prototype.refreshTrailNode=function(e){for(;this.targetPath.length>0&&e>this.targetPath[this.targetPath.length-1].time+this.lifetime;)this.targetPath.pop();var a=new t.math.vector3;if(t.math.vec3Clone(this.gameObject.transform.getWorldTranslate(),a),!(0!=this.targetPath.length&&t.math.vec3Distance(a,this.targetPath[0].location)<this.minStickDistance)){var i=new t.math.vector3;this.gameObject.transform.getUpInWorld(i);var o=new r(a,i,e);if(this.nodes.unshift(o),this.interpolate&&this.nodes.length>2){var n=new t.math.vector3;if(t.math.vec3Subtract(this.nodes[2].location,this.nodes[0].location,n),t.math.vec3Normalize(n,n),this.nodes[1].handle=n,void 0==this.nodes[2].handle){var s=new t.math.vector3;t.math.vec3Subtract(this.nodes[2].location,this.nodes[1].location,s),t.math.vec3Normalize(s,s),this.nodes[2].handle=s}for(var l=t.math.vec3Distance(this.nodes[2].location,this.nodes[1].location),h=0;h<this.interpNumber;h++){var c=(h+1)/(this.interpNumber+1),u=new t.math.vector3,d=t.math.pool.new_vector3(),m=t.math.pool.new_vector3();m.x=-this.nodes[2].handle.x,m.y=-this.nodes[2].handle.y,m.z=-this.nodes[2].handle.z,t.math.vec3ScaleByNum(m,l/2,m),t.math.vec3Add(m,this.nodes[2].location,m),t.math.vec3ScaleByNum(this.nodes[1].handle,l/2,d),t.math.vec3Add(d,this.nodes[1].location,d),t.math.GetPointAlongCurve(this.nodes[2].location,m,this.nodes[1].location,d,(h+1)/(this.interpNumber+1),u);var p=new t.math.vector3;t.math.vec3SLerp(this.nodes[1].updir,this.nodes[2].updir,c,p);var f=new r(u,p,e);this.interpPath.splice(1,0,f),t.math.pool.delete_vector3(d),t.math.pool.delete_vector3(m)}this.interpPath.unshift(o)}if(this.activeMaxpointlimit)for(;this.targetPath.length>this.maxStickCout;)this.targetPath.pop()}},trailRender_recorde.prototype.updateTrailData=function(e){if(this.nodes.length<2)this.notRender=!0;else{this.notRender=!1,this.checkBufferSize();for(var a=0;a<this.targetPath.length;a++){var r=this.targetPath[a],i=a/this.targetPath.length,o=(e-r.time)/this.lifetime,n=new t.math.vector3;t.math.vec3Clone(r.updir,n);var s=this._startWidth+(this._endWidth-this._startWidth)*o;t.math.vec3ScaleByNum(n,s,n);var l=t.math.pool.new_vector3();t.math.vec3Add(r.location,n,l),this.dataForVbo[2*a*9+0]=l.x,this.dataForVbo[2*a*9+1]=l.y,this.dataForVbo[2*a*9+2]=l.z;var h=t.math.pool.new_color();t.math.colorLerp(this.startColor,this.endColor,o,h),this.dataForVbo[2*a*9+3]=h.r,this.dataForVbo[2*a*9+4]=h.g,this.dataForVbo[2*a*9+5]=h.b,this.dataForVbo[2*a*9+6]=h.a,this.dataForVbo[2*a*9+7]=i,this.dataForVbo[2*a*9+8]=1,this.dataForVbo[9*(2*a+1)+0]=r.location.x,this.dataForVbo[9*(2*a+1)+1]=r.location.y,this.dataForVbo[9*(2*a+1)+2]=r.location.z,this.dataForVbo[9*(2*a+1)+3]=h.r,this.dataForVbo[9*(2*a+1)+4]=h.g,this.dataForVbo[9*(2*a+1)+5]=h.b,this.dataForVbo[9*(2*a+1)+6]=h.a;i=a/this.nodes.length;this.dataForVbo[9*(2*a+1)+7]=i,this.dataForVbo[9*(2*a+1)+8]=0,t.math.pool.delete_vector3(l),t.math.pool.delete_color(h)}for(var c=0;c<this.nodes.length-1;c++)this.dataForEbo[6*c+0]=2*c,this.dataForEbo[6*c+1]=2*(c+1),this.dataForEbo[6*c+2]=2*c+1,this.dataForEbo[6*c+3]=2*c+1,this.dataForEbo[6*c+4]=2*(c+1),this.dataForEbo[6*c+5]=2*(c+1)+1}},trailRender_recorde.prototype.checkBufferSize=function(){var t=this.targetPath.length;if(2*t*9>this.dataForVbo.length){e=this.dataForVbo.length;this.mesh.glMesh.resetVboSize(this.webgl,2*e),this.dataForVbo=new Float32Array(2*e)}if(6*(t-1)>this.dataForEbo.length){var e=this.dataForEbo.length;this.mesh.glMesh.resetEboSize(this.webgl,0,2*e),this.dataForEbo=new Uint16Array(2*e)}},trailRender_recorde.prototype.render=function(t,e,a){this.notRender||(t.updateModeTrail(),this.mesh.glMesh.uploadVertexData(t.webgl,this.dataForVbo),this.mesh.glMesh.uploadIndexData(t.webgl,0,this.dataForEbo),this.mesh.submesh[0].size=6*(this.targetPath.length-1),this.gameObject.getScene().fog?(t.fog=this.gameObject.getScene().fog,this.material.draw(t,this.mesh,this.mesh.submesh[0],"base_fog")):this.material.draw(t,this.mesh,this.mesh.submesh[0],"base"))},trailRender_recorde.prototype.clone=function(){},trailRender_recorde=__decorate([t.reflect.nodeRender,t.reflect.nodeComponent],trailRender_recorde)}();e.trailRender_recorde=a;var r=function(){return function trailNode(t,e,a){this.location=t,this.updir=e,this.time=a}}();e.trailNode=r}(t.framework||(t.framework={}))}(gd3d||(gd3d={}));var gd3d;!function(t){!function(e){var a=function(){function vignettingCtr(){this.tag="__vignettingtag__",this._init=!1}return vignettingCtr.prototype.init=function(){var a=this.scene.app.getAssetMgr().getShader("vignetting.shader.json");if(a){var r=new e.cameraPostQueue_Color;r[this.tag]=!0,r.renderTarget=new t.render.glRenderTarget(this.scene.webgl,1024,1024,!0,!1),this.camera.postQueues||(this.camera.postQueues=[]),this.camera.postQueues.push(r);var i=new e.texture("_color");i.glTexture=r.renderTarget;var o=new t.framework.cameraPostQueue_Quad;o.renderTarget=new t.render.glRenderTarget(this.scene.webgl,512,512,!0,!1),o.material.setShader(this.scene.app.getAssetMgr().getShader("separate_blur.shader.json")),o.material.setTexture("_MainTex",i),o.material.setVector4("sample_offsets",new t.math.vector4(0,1,0,-1)),o.material.setVector4("_MainTex_TexelSize",new t.math.vector4(1/512,1/512,512,512)),this.camera.postQueues.push(o);var n=new t.framework.texture("_blur0");n.glTexture=o.renderTarget;var s=new t.framework.cameraPostQueue_Quad;s.renderTarget=new t.render.glRenderTarget(this.scene.webgl,512,512,!0,!1),s.material.setShader(this.scene.app.getAssetMgr().getShader("separate_blur.shader.json")),s.material.setTexture("_MainTex",n),s.material.setVector4("sample_offsets",new t.math.vector4(1,0,-1,0)),s.material.setVector4("_MainTex_TexelSize",new t.math.vector4(1/512,1/512,512,512)),this.camera.postQueues.push(s);var l=new t.framework.texture("_blur0");l.glTexture=s.renderTarget;var h=new e.cameraPostQueue_Quad;this.material_1=h.material,h.material.use(),h.material.setShader(a),h.material.setTexture("_MainTex",i),h.material.setTexture("_BlurTex",l),h.material.setFloat("_Vignetting",.3),h.material.setFloat("_Blurred_Corners",3),h.material.setFloat("_Chromatic_Aberration",3),h.material.setVector4("_MainTex_TexelSize",new t.math.vector4(1/1024,1/1024,1024,1024)),this.camera.postQueues.push(h),this._init=!0}else console.warn("vignetting.shader.json not find")},vignettingCtr.prototype.start=function(){this.app=this.gameObject.transform.scene.app,this.scene=this.app.getScene()},vignettingCtr.prototype.onPlay=function(){},vignettingCtr.prototype.update=function(t){this._init||(this.camera||(this.camera=this.gameObject.getComponent("camera")),this.camera&&this.init())},vignettingCtr.prototype.remove=function(){if(this._init=!1,this.camera){for(var t=this.camera.postQueues,e=[],a=0;a<t.length;a++){var r=t[a];r[this.tag]&&e.push(r)}e.forEach(function(e){if(e){var a=t.indexOf(e);-1!=a&&t.splice(a,1)}})}this.material&&(this.material.unuse(),this.material=null),this.material_1&&(this.material_1.unuse(),this.material_1=null),this.material_2&&(this.material_2.unuse(),this.material_2=null),this.material_3&&(this.material_3.unuse(),this.material_3=null)},vignettingCtr.prototype.clone=function(){},vignettingCtr=__decorate([t.reflect.nodeComponent],vignettingCtr)}();e.vignettingCtr=a}(t.framework||(t.framework={}))}(gd3d||(gd3d={}));var gd3d;!function(t){!function(e){var a=function(){function f14EffectSystem(){this.layer=e.RenderLayerEnum.Transparent,this.queue=10,this.fps=30,this.layers=[],this.VF=t.render.VertexFormatMask.Position|t.render.VertexFormatMask.Color|t.render.VertexFormatMask.UV0,this._delayTime=0,this.elements=[],this.renderBatch=[],this.loopCount=0,this.allTime=0,this.renderActive=!1,this.beref=!1,this.mvpMat=new t.math.matrix,this.totalTime=0,this.totalFrame=0,this.playRate=1,this.enabletimeFlow=!1,this.enableDraw=!1}return Object.defineProperty(f14EffectSystem.prototype,"renderLayer",{get:function(){return this.gameObject.layer},set:function(t){this.gameObject.layer=t},enumerable:!0,configurable:!0}),f14EffectSystem.prototype.start=function(){this.data&&1==this.data.beloop&&this.play()},f14EffectSystem.prototype.onPlay=function(){},Object.defineProperty(f14EffectSystem.prototype,"f14eff",{get:function(){return this._f14eff},set:function(t){null!=this._f14eff&&this._f14eff.unuse(),this._f14eff=t,this.setData(t.data)},enumerable:!0,configurable:!0}),Object.defineProperty(f14EffectSystem.prototype,"delay",{get:function(){return this._delayTime},set:function(t){this._delayTime=t},enumerable:!0,configurable:!0}),f14EffectSystem.prototype.setData=function(a){this.webgl=t.framework.sceneMgr.app.webgl,this.data=a;for(var r=0,i=this.data.layers.length;r<i;r++){var o=this.data.layers[r];this.addF14layer(o.type,o)}for(r=0;r<this.renderBatch.length;r++)this.renderBatch[r].type==e.F14TypeEnum.SingleMeshType&&this.renderBatch[r].OnEndCollectElement()},Object.defineProperty(f14EffectSystem.prototype,"root",{get:function(){return this._root||this.gameObject.transform},enumerable:!0,configurable:!0}),f14EffectSystem.prototype.update=function(t){if(null!=this.data)if(this.renderActive=!0,this.enabletimeFlow){if(this.allTime+=t*this.playRate,this.totalTime=this.allTime-this._delayTime,this.totalTime<=0)return void(this.renderActive=!1);if(this.totalFrame=this.totalTime*this.fps,!this.data.beloop&&this.totalFrame>this.data.lifeTime)return this.renderActive=!1,this.enabletimeFlow=!1,void(this.onFinish&&this.onFinish());this.restartFrame=this.totalFrame%this.data.lifeTime,this.restartFrame=Math.floor(this.restartFrame);var e=Math.floor(this.totalFrame/this.data.lifeTime);e!=this.loopCount&&this.OnEndOnceLoop(),this.loopCount=e;for(var a=0;a<this.elements.length;a++)this.elements[a].update(t,this.totalFrame,this.fps)}else{if(this.totalTime<=0)return void(this.renderActive=!1);if(!this.data.beloop&&this.totalFrame>this.data.lifeTime)return void(this.renderActive=!1)}else this.renderActive=!1},f14EffectSystem.prototype.OnEndOnceLoop=function(){for(var t=0;t<this.elements.length;t++)this.elements[t].OnEndOnceLoop()},Object.defineProperty(f14EffectSystem.prototype,"renderCamera",{get:function(){return null!=this._renderCamera?this._renderCamera:t.framework.sceneMgr.app.getScene().mainCamera},enumerable:!0,configurable:!0}),f14EffectSystem.prototype.render=function(a,r,i,o){if(void 0===o&&(o=0),this.renderActive&&this.enableDraw){e.DrawCallInfo.inc.currentState=e.DrawCallEnum.EffectSystem,this._renderCamera=i;var n=0;a.updateModel(this.root),t.math.matrixClone(a.matrixModelViewProject,this.mvpMat);for(var s=0;s<this.renderBatch.length;s++)this.renderBatch[s].render(a,r,i,o+n),n+=this.renderBatch[s].getElementCount()}},f14EffectSystem.prototype.addF14layer=function(t,a){if(t==e.F14TypeEnum.SingleMeshType){var r=new e.F14Layer(this,a),i=new e.F14SingleMesh(this,r);r.element=i,this.layers.push(r),this.elements.push(i);s=a.elementdata;if(this.layers.length>1&&this.layers[this.layers.length-2].type==t)if((n=this.layers[this.layers.length-2].batch).type==e.F14TypeEnum.SingleMeshType&&n.canBatch(i))n.addElement(i),r.batch=n;else{var o=new e.F14SingleMeshBath(s.material,this);o.addElement(i),r.batch=o,this.renderBatch.push(o)}else(this.layers.length=1)&&((n=new e.F14SingleMeshBath(s.material,this)).addElement(i),r.batch=n,this.renderBatch.push(n));return r}if(t==e.F14TypeEnum.particlesType){var r=new e.F14Layer(this,a),i=new e.F14Emission(this,r);r.element=i,this.layers.push(r),this.elements.push(i);var n=new e.F14EmissionBatch(this,i);return r.batch=n,this.renderBatch.push(n),r}var r=new e.F14Layer(this,a),i=new e.F14RefElement(this,r),s=a.elementdata;r.element=i,this.layers.push(r),this.elements.push(i);var l=new e.F14RefElementBatch(this,i);return this.renderBatch.push(l),r.batch=l,r},f14EffectSystem.prototype.getElementCount=function(){for(var t=0,a=0;a<this.layers.length;a++)this.layers[a].type==e.F14TypeEnum.RefType?t+=this.layers[a].batch.getElementCount():t++;return t},f14EffectSystem.prototype.play=function(t,e){void 0===t&&(t=null),void 0===e&&(e=1),this.allTime>0&&this.reset(),this.enabletimeFlow=!0,this.enableDraw=!0,this.playRate=e,t&&(this.onFinish=t)},f14EffectSystem.prototype.stop=function(){this.enabletimeFlow=!1,this.enableDraw=!1,this.reset()},f14EffectSystem.prototype.pause=function(){this.enableDraw=!0,this.enabletimeFlow=!1},f14EffectSystem.prototype.changeColor=function(t){for(var e=0;e<this.elements.length;e++)this.elements[e].changeColor(t)},f14EffectSystem.prototype.reset=function(){this.allTime=0;for(var t in this.elements)this.elements[t].reset()},f14EffectSystem.prototype.clone=function(){},f14EffectSystem.prototype.remove=function(){this.data=null,this._f14eff=null,this.webgl=null,this._root=null,this._renderCamera=null,this.gameObject=null;for(var t in this.layers)this.layers[t].dispose();for(var t in this.elements)this.elements[t].dispose();for(var t in this.renderBatch)this.renderBatch[t].dispose();delete this.layers,delete this.elements,delete this.renderBatch},__decorate([t.reflect.Field("f14eff"),t.reflect.UIStyle("WidgetDragSelect"),__metadata("design:type",Object),__metadata("design:paramtypes",[e.f14eff])],f14EffectSystem.prototype,"f14eff",null),__decorate([t.reflect.Field("number"),__metadata("design:type",Object),__metadata("design:paramtypes",[Number])],f14EffectSystem.prototype,"delay",null),f14EffectSystem=__decorate([t.reflect.nodeRender,t.reflect.nodeComponent],f14EffectSystem)}();e.f14EffectSystem=a;!function(t){t[t.play=0]="play",t[t.beReady=1]="beReady",t[t.pause=2]="pause"}(e.PlayStateEnum||(e.PlayStateEnum={}))}(t.framework||(t.framework={}))}(gd3d||(gd3d={}));var gd3d;!function(t){!function(t){!function(t){t[t.SingleMeshType=0]="SingleMeshType",t[t.particlesType=1]="particlesType",t[t.RefType=2]="RefType"}(t.F14TypeEnum||(t.F14TypeEnum={}))}(t.framework||(t.framework={}))}(gd3d||(gd3d={}));var gd3d;!function(t){!function(e){var a=function(){function F14Layer(t,e){this.active=!0,this.frameList=[],this.frames={},this.Attlines={},this.effect=t,this.data=e,this.type=e.type;for(var a in this.data.frames){var r=this.data.frames[a];this.addFrame(r.frameindex,r)}}return F14Layer.prototype.addFrame=function(t,e){if(this.frames[t])return this.frames[t];var a=new r(this,e);return this.frameList.push(t),this.frameList.sort(function(t,e){return t-e}),this.frames[t]=a,a},F14Layer.prototype.removeFrame=function(t){if(this.frames[t]){delete this.frames[t];var e=this.frameList.indexOf(t);this.frameList.splice(e,1),delete this.data.frames[t]}for(var a in this.Attlines)this.Attlines[a].remove(t)},F14Layer.prototype.dispose=function(){this.data=null,this.effect=null,this.frameList.length=0,this.frames=null,this.Attlines=null,this.element=null,this.batch=null},F14Layer}();e.F14Layer=a;var r=function(){function F14Frame(t,e){this.layer=t,this.data=e,this.attDic=this.data.singlemeshAttDic;for(var a in this.data.singlemeshAttDic)this.setdata(a,this.data.singlemeshAttDic[a])}return F14Frame.prototype.setdata=function(e,a){null==this.layer.Attlines[e]&&(a instanceof t.math.vector3?this.layer.Attlines[e]=new i(e,t.math.vec3SLerp,t.math.vec3Clone):a instanceof t.math.vector4?this.layer.Attlines[e]=new i(e,t.math.vec4SLerp,t.math.vec4Clone):a instanceof t.math.color&&(this.layer.Attlines[e]=new i(e,t.math.colorLerp,t.math.colorClone))),this.layer.Attlines[e].addNode(this.data.frameindex,a),this.attDic[e]=a},F14Frame.prototype.removedata=function(t){delete this.attDic[t],this.layer.Attlines[t]&&this.layer.Attlines[t].remove(this.data.frameindex)},F14Frame.prototype.getdata=function(t){return this.attDic[t]},F14Frame}();e.F14Frame=r;var i=function(){function F14AttTimeLine(t,e,a){this.frameList=[],this.line={},this.name=t,this.lerpFunc=e,this.cloneFunc=a}return F14AttTimeLine.prototype.addNode=function(t,e){this.frameList.indexOf(t)<0&&(this.frameList.push(t),this.frameList.sort(function(t,e){return t-e})),this.line[t]=e},F14AttTimeLine.prototype.remove=function(t){if(this.line[t]){delete this.line[t];var e=this.frameList.indexOf(t);this.frameList.splice(e,1)}},F14AttTimeLine.prototype.getValue=function(t,e,a){if(0!=this.frameList.length)if(this.line[t])this.cloneFunc(this.line[t],a);else if(t<this.frameList[0]){var r=this.frameList[0],i=e[this.name],o=this.line[r],n=(t-e.firtstFrame)/r;this.lerpFunc(i,o,n,a)}else if(t>=this.frameList[this.frameList.length-1])this.cloneFunc(this.line[this.frameList[this.frameList.length-1]],a);else for(var s=0;s<this.frameList.length;s++)if(this.frameList[s]>t){var o=this.frameList[s],i=this.frameList[s-1];return void this.lerpFunc(this.line[i],this.line[o],(t-i)/(o-i),a)}},F14AttTimeLine}();e.F14AttTimeLine=i}(t.framework||(t.framework={}))}(gd3d||(gd3d={}));var gd3d;!function(t){!function(e){var a=function(){function F14EffectData(){this.beloop=!1,this.lifeTime=100,this.layers=[]}return F14EffectData.prototype.parsejson=function(e,a,i){var o=this;return new t.threading.gdPromise(function(t){o.beloop=e.beloop,o.lifeTime=e.lifeTime;for(var n=e.layers,s=0,l=0,h=n.length;l<h;++l)!function(e,l){var h=new r;h.parse(n[e],a,i).then(function(){++s>=l&&t()}),o.layers.push(h)}(l,h)})},F14EffectData}();e.F14EffectData=a;var r=function(){function F14LayerData(){this.Name="newLayer",this.type=e.F14TypeEnum.SingleMeshType,this.frames={}}return F14LayerData.prototype.parse=function(a,r,o){var n=this;return new t.threading.gdPromise(function(s){switch(n.Name=a.Name,a.type){case"particlesType":n.type=e.F14TypeEnum.particlesType,n.elementdata=new e.F14EmissionBaseData,n.elementdata.parse(a.emissiondata,r,o);break;case"SingleMeshType":n.type=e.F14TypeEnum.SingleMeshType,n.elementdata=new e.F14SingleMeshBaseData(a.frames[0].frameindex),n.elementdata.parse(a.singlemeshdata,r,o);break;case"RefType":n.type=e.F14TypeEnum.RefType,n.elementdata=new e.F14RefBaseData,n.elementdata.parse(a.RefData,r,o);break;default:return void console.log("f14Eff parse layerjson error!")}for(var l=0;l<a.frames.length;l++){var h=a.frames[l],c=h.frameindex,u=new i(c,n.type);switch(n.frames[c]=u,n.type){case e.F14TypeEnum.SingleMeshType:for(v=0;v<h.vec3Atts.length;v++){var d=h.vec3Atts[v].name,m=h.vec3Atts[v].value,p=new t.math.vector3;t.math.vec3FormJson(m,p),u.singlemeshAttDic[d]=p}for(v=0;v<h.vec4Atts.length;v++){var f=h.vec4Atts[v].name,m=h.vec4Atts[v].value,g=new t.math.vector4;t.math.vec4FormJson(m,g),u.singlemeshAttDic[f]=g}for(var v=0;v<h.colorAtts.length;v++){var y=h.colorAtts[v].name,m=h.colorAtts[v].value,_=new t.math.color;t.math.colorFormJson(m,_),u.singlemeshAttDic[y]=_}break;case e.F14TypeEnum.particlesType:var b=new e.F14EmissionBaseData;b.parse(h.emissionData,r,o),u.EmissionData=b}}s()})},F14LayerData}();e.F14LayerData=r;var i=function(){return function F14FrameData(t,a){this.frameindex=t,a==e.F14TypeEnum.SingleMeshType?this.singlemeshAttDic={}:this.EmissionData=new e.F14EmissionBaseData}}();e.F14FrameData=i}(t.framework||(t.framework={}))}(gd3d||(gd3d={}));var gd3d;!function(t){!function(e){var a=function(){function NumberData(t){void 0===t&&(t=0),this.isRandom=!1,this._value=0,this._valueLimitMin=0,this._valueLimitMax=0,this.beInited=!1,this._value=t}return NumberData.prototype.setValue=function(t){this._value=t},NumberData.prototype.setRandomValue=function(t,e){this._valueLimitMax=t,this._valueLimitMin=e,this.isRandom=!0},NumberData.prototype.getValue=function(t){return void 0===t&&(t=!1),this.isRandom&&(!t&&this.beInited||(this.key=Math.random(),this._value=this.key*(this._valueLimitMax-this._valueLimitMin)+this._valueLimitMin,this.beInited=!0)),this._value},NumberData.copyto=function(t,e){e.isRandom=t.isRandom,e._value=t._value,e._valueLimitMin=t._valueLimitMin,e._valueLimitMax=t._valueLimitMax},NumberData.FormJson=function(t,e){if(t.indexOf("~")<0)e.setValue(Number(t));else{var a=t.split("~");e.setRandomValue(Number(a[1]),Number(a[0]))}},NumberData}();e.NumberData=a;var r=function(){function Vector3Data(t,e,r){void 0===t&&(t=0),void 0===e&&(e=0),void 0===r&&(r=0),this.x=new a,this.y=new a,this.z=new a,this.x.setValue(t),this.y.setValue(e),this.z.setValue(r)}return Vector3Data.prototype.getValue=function(e){void 0===e&&(e=!1);var a=new t.math.vector3;return a.x=this.x.getValue(e),a.y=this.y.getValue(e),a.z=this.z.getValue(e),a},Vector3Data.copyto=function(t,e){a.copyto(t.x,e.x),a.copyto(t.y,e.y),a.copyto(t.z,e.z)},Vector3Data.FormJson=function(t,e){var r=t.split(",");a.FormJson(r[0],e.x),a.FormJson(r[1],e.y),a.FormJson(r[2],e.z)},Vector3Data}();e.Vector3Data=r;var i=function(){return function NumberKey(t,e){this.key=t,this.value=e}}();e.NumberKey=i;var o=function(){return function Vector3Key(t,e){this.key=t,this.value=e}}();e.Vector3Key=o;var n=function(){return function Vector2Key(t,e){this.key=t,this.value=e}}();e.Vector2Key=n}(t.framework||(t.framework={}))}(gd3d||(gd3d={}));var gd3d;!function(t){!function(e){var a=function(){function F14Emission(a,r){this.particlelist=[],this.deadParticles=[],this.frameLife=0,this.TotalTime=0,this.newStartDataTime=0,this.curTime=0,this.beover=!1,this.numcount=0,this.localMatrix=new t.math.matrix,this._worldMatrix=new t.math.matrix,this.localrot=new t.math.quaternion,this.worldRot=new t.math.quaternion,this.lastFrame=0,this.bursts=[],this.type=e.F14TypeEnum.particlesType,this.effect=a,this.layer=r,this.baseddata=r.data.elementdata,this.currentData=this.baseddata,this.newStartDataTime=this.baseddata.delayTime,this.initBycurrentdata(),this.vertexCount=this.currentData.mesh.data.pos.length,this.posArr=this.currentData.mesh.data.pos,this.colorArr=this.currentData.mesh.data.color,this.uvArr=this.currentData.mesh.data.uv,this.dataforebo=this.currentData.mesh.data.genIndexDataArray(),this.vertexLength=t.render.meshData.calcByteSize(this.effect.VF)/4,this.dataforvboLen=this.vertexCount*this.vertexLength}return F14Emission.prototype.update=function(t,e,a){this.TotalTime+=t,this.refreshByFrameData(a),this.updateLife();for(var r=0;r<this.particlelist.length;r++)this.particlelist[r].update(t)},F14Emission.prototype.refreshByFrameData=function(t){this.frameLife=Math.floor(this.baseddata.duration*t),0==this.frameLife&&(this.frameLife=1);var e=Math.floor(this.TotalTime*t)%this.frameLife;e!=this.lastFrame&&this.layer.frames[e]&&(e==this.layer.frameList[0]&&(this.currentData=this.baseddata),this.layer.frames[e].data.EmissionData!=this.currentData&&this.changeCurrentBaseData(this.layer.frames[e].data.EmissionData)),this.lastFrame=e},F14Emission.prototype.changeCurrentBaseData=function(t){this.currentData=t,this.newStartDataTime=this.TotalTime,this.numcount=0,this.initBycurrentdata()},F14Emission.prototype.initBycurrentdata=function(){t.math.quatFromEulerAngles(this.currentData.rotEuler.x,this.currentData.rotEuler.y,this.currentData.rotEuler.z,this.localrot),t.math.matrixMakeTransformRTS(this.currentData.rotPosition,this.currentData.rotScale,this.localrot,this.localMatrix)},F14Emission.prototype.getWorldMatrix=function(){var e=this.effect.root.getWorldMatrix();return t.math.matrixMultiply(e,this.localMatrix,this._worldMatrix),this._worldMatrix},F14Emission.prototype.getWorldRotation=function(){var e=this.effect.root.getWorldRotate();return t.math.quatMultiply(e,this.localrot,this.worldRot),this.worldRot},F14Emission.prototype.updateLife=function(){if(!this.beover&&(this.curTime=this.TotalTime-this.baseddata.delayTime,!(this.curTime<=0)&&(this.updateEmission(),this.curTime>this.baseddata.duration)))if(this.baseddata.beloop)switch(this.baseddata.loopenum){case e.LoopEnum.Restart:this.reInit();break;case e.LoopEnum.TimeContinue:this.beover=!0}else this.beover=!0},F14Emission.prototype.reInit=function(){this.currentData=this.baseddata,this.newStartDataTime=this.baseddata.delayTime,this.beover=!1,this.TotalTime=0,this.numcount=0,this.currentData.rateOverTime.getValue(!0),this.bursts=[]},F14Emission.prototype.updateEmission=function(){var t=Math.floor(this.currentData.rateOverTime.getValue()*(this.TotalTime-this.newStartDataTime))-this.numcount;if(t>0&&this.addParticle(t),this.numcount+=t,this.baseddata.bursts.length>0)for(var e=0;e<this.baseddata.bursts.length;e++)if(this.bursts.indexOf(this.baseddata.bursts[e].time)<0&&this.baseddata.bursts[e].time<=this.TotalTime){var a=this.baseddata.bursts[e].count.getValue(!0);this.baseddata.bursts[e].burst(),this.bursts.push(this.baseddata.bursts[e].time),this.addParticle(a)}},F14Emission.prototype.addParticle=function(t){void 0===t&&(t=1);for(var a=0;a<t;a++)if(this.deadParticles.length>0)(r=this.deadParticles.pop()).initByEmissionData(this.currentData);else{var r=new e.F14Particle(this,this.currentData);this.particlelist.push(r)}},F14Emission.prototype.reset=function(){this.reInit();for(var t=0;t<this.particlelist.length;t++)this.particlelist[t].actived&&(this.particlelist[t].actived=!1,this.deadParticles.push(this.particlelist[t]))},F14Emission.prototype.changeColor=function(t){this.currentData.startColor=new e.Vector3Data(t.r,t.g,t.b),this.currentData.startAlpha=new e.NumberData(t.a)},F14Emission.prototype.OnEndOnceLoop=function(){},F14Emission.prototype.dispose=function(){this.effect=null,this.baseddata=null,this.currentData=null,delete this.dataforebo,delete this.posArr,delete this.colorArr,delete this.uvArr,delete this.bursts;for(var t in this.particlelist)this.particlelist[t].dispose();for(var t in this.deadParticles)this.deadParticles[t].dispose()},F14Emission}();e.F14Emission=a}(t.framework||(t.framework={}))}(gd3d||(gd3d={}));var gd3d;!function(t){!function(e){var a;!function(t){t[t.None=0]="None",t[t.BillBoard=1]="BillBoard",t[t.StretchedBillBoard=2]="StretchedBillBoard",t[t.HorizontalBillBoard=3]="HorizontalBillBoard",t[t.VerticalBillBoard=4]="VerticalBillBoard",t[t.Mesh=5]="Mesh"}(a=e.RenderModelEnum||(e.RenderModelEnum={}));var r=function(){function F14EmissionBaseData(){this.loopenum=e.LoopEnum.Restart,this.rotPosition=new t.math.vector3,this.rotScale=new t.math.vector3(1,1,1),this.rotEuler=new t.math.vector3,this.rendermodel=a.Mesh,this.beloop=!0,this.lifeTime=new e.NumberData(20),this.simulateInLocalSpace=!0,this.startScaleRate=new e.NumberData(1),this.startScale=new e.Vector3Data(1,1,1),this.startEuler=new e.Vector3Data,this.startColor=new e.Vector3Data(1,1,1),this.startAlpha=new e.NumberData(1),this.colorRate=1,this.simulationSpeed=new e.NumberData(1),this.start_tex_st=new t.math.vector4(1,1,0,0),this.delayTime=0,this.duration=10,this.rateOverTime=new e.NumberData(1),this.bursts=[],this.shapeType=e.ParticleSystemShape.NORMAL,this.emitFrom=e.emitfromenum.base,this.enableVelocityOverLifetime=!1,this.moveSpeed=new e.Vector3Data(0),this.enableSizeOverLifetime=!1,this.sizeNodes=[],this.enableRotOverLifeTime=!1,this.angleSpeed=new e.NumberData(0),this.enableColorOverLifetime=!1,this.colorNodes=[],this.alphaNodes=[],this.enableTexAnimation=!1,this.uvType=e.UVTypeEnum.NONE}return F14EmissionBaseData.prototype.parse=function(r,o,n){switch(r.loopenum){case"Restart":this.loopenum=e.LoopEnum.Restart;break;case"TimeContinue":this.loopenum=e.LoopEnum.TimeContinue}switch(this.mesh=o.getAssetByName(r.mesh,n),this.material=o.getAssetByName(r.material,n),t.math.vec3FormJson(r.rotPosition,this.rotPosition),t.math.vec3FormJson(r.rotScale,this.rotScale),t.math.vec3FormJson(r.rotEuler,this.rotEuler),r.rendermodel){default:case"BillBoard":this.rendermodel=a.BillBoard;break;case"HorizontalBillBoard":this.rendermodel=a.HorizontalBillBoard;break;case"Mesh":this.rendermodel=a.Mesh;break;case"StretchedBillBoard":this.rendermodel=a.StretchedBillBoard;break;case"VerticalBillBoard":this.rendermodel=a.VerticalBillBoard;break;case"None":this.rendermodel=a.None}this.beloop=r.beloop,e.NumberData.FormJson(r.lifeTime,this.lifeTime),this.simulateInLocalSpace=r.simulateInLocalSpace,e.NumberData.FormJson(r.startScaleRate,this.startScaleRate),e.Vector3Data.FormJson(r.startScale,this.startScale),e.Vector3Data.FormJson(r.startEuler,this.startEuler),e.Vector3Data.FormJson(r.startColor,this.startColor),e.NumberData.FormJson(r.startAlpha,this.startAlpha),this.colorRate=r.colorRate,e.NumberData.FormJson(r.simulationSpeed,this.simulationSpeed),t.math.vec4FormJson(r.start_tex_st,this.start_tex_st),this.delayTime=r.delayTime,this.duration=r.duration,e.NumberData.FormJson(r.rateOverTime,this.rateOverTime);for(u=0;u<r.bursts.length;u++){var s=r.bursts[u],l=i.CreatformJson(s);this.bursts.push(l)}switch(r.shapeType){case"NORMAL":this.shapeType=e.ParticleSystemShape.NORMAL;break;case"BOX":this.shapeType=e.ParticleSystemShape.BOX,this.width=r.width,this.height=r.height,this.depth=r.depth;break;case"SPHERE":this.shapeType=e.ParticleSystemShape.SPHERE,this.radius=r.radius;break;case"HEMISPHERE":this.shapeType=e.ParticleSystemShape.HEMISPHERE,this.radius=r.radius;break;case"CONE":switch(this.shapeType=e.ParticleSystemShape.CONE,this.height=r.height,this.angle=r.angle,this.radius=r.radius,r.emitFrom){case"base_":this.emitFrom=e.emitfromenum.base;break;case"volume":this.emitFrom=e.emitfromenum.volume}break;case"CIRCLE":this.shapeType=e.ParticleSystemShape.CIRCLE;break;case"EDGE":this.shapeType=e.ParticleSystemShape.EDGE}if(this.enableVelocityOverLifetime=r.enableVelocityOverLifetime,this.enableVelocityOverLifetime&&e.Vector3Data.FormJson(r.moveSpeed,this.moveSpeed),this.enableSizeOverLifetime=r.enableSizeOverLifetime,this.enableSizeOverLifetime)for(u=0;u<r.sizeNodes.length;u++){var h=r.sizeNodes[u],s=new e.NumberKey(h.key,h.value);this.sizeNodes.push(s)}if(this.enableRotOverLifeTime=r.enableRotOverLifeTime,this.enableRotOverLifeTime&&e.NumberData.FormJson(r.angleSpeed,this.angleSpeed),this.enableColorOverLifetime=r.enableColorOverLifetime,this.enableColorOverLifetime){for(u=0;u<r.colorNodes.length;u++){var h=r.colorNodes[u],c=new t.math.vector3;t.math.vec3FormJson(h.value,c);s=new e.Vector3Key(h.key,c);this.colorNodes.push(s)}for(var u=0;u<r.alphaNodes.length;u++){var h=r.alphaNodes[u],s=new e.NumberKey(h.key,h.value);this.alphaNodes.push(s)}}if(this.enableTexAnimation=r.enableTexAnimation,this.enableTexAnimation)switch(r.uvType){case"UVRoll":this.uvType=e.UVTypeEnum.UVRoll,this.uSpeed=r.uSpeed,this.vSpeed=r.vSpeed;break;case"UVSprite":this.uvType=e.UVTypeEnum.UVSprite,this.row=r.row,this.column=r.column,this.count=r.count;break;case"NONE":this.uvType=e.UVTypeEnum.NONE}},F14EmissionBaseData.getRandomDirAndPosByZEmission=function(a,r,i){switch(a.shapeType){case e.ParticleSystemShape.NORMAL:t.math.vec3Clone(t.math.pool.vector3_zero,i),t.math.vec3Clone(t.math.pool.vector3_up,r);break;case e.ParticleSystemShape.SPHERE:var o=Math.random()*Math.PI*2,n=Math.random()*Math.PI;r.x=Math.sin(n)*Math.cos(o),r.y=Math.cos(n),r.z=Math.sin(n)*Math.sin(o);s=Math.random()*a.radius;t.math.vec3ScaleByNum(r,s,i);break;case e.ParticleSystemShape.HEMISPHERE:var o=Math.random()*Math.PI*2,n=Math.random()*Math.PI*.5,s=Math.random()*a.radius;r.x=Math.sin(n)*Math.cos(o),r.y=Math.cos(n),r.z=Math.sin(n)*Math.sin(o),t.math.vec3ScaleByNum(r,s,i);break;case e.ParticleSystemShape.BOX:i.x=e.ValueData.RandomRange(-a.width/2,a.width/2),i.y=e.ValueData.RandomRange(-a.height/2,a.height/2),i.z=e.ValueData.RandomRange(-a.depth/2,a.depth/2),t.math.vec3Normalize(i,r);break;case e.ParticleSystemShape.CONE:var l=Math.random()*Math.PI*2,h=Math.random()*a.height,c=h*Math.tan(a.angle*Math.PI/180)+a.radius,u=Math.random()*c,d=t.math.pool.new_vector3();d.x=a.radius*Math.cos(l),d.y=0,d.z=a.radius*Math.sin(l),a.emitFrom==e.emitfromenum.base?t.math.vec3Clone(d,i):a.emitFrom==e.emitfromenum.volume&&(i.x=u*Math.cos(l),i.z=u*Math.sin(l),i.y=h),r.x=Math.cos(l)*Math.sin(a.angle*Math.PI/180),r.z=Math.sin(l)*Math.sin(a.angle*Math.PI/180),r.y=Math.cos(a.angle*Math.PI/180)}},F14EmissionBaseData}();e.F14EmissionBaseData=r;var i=function(){function busrtInfo(){this.time=0,this.count=new e.NumberData(10),this._beburst=!1}return busrtInfo.prototype.beburst=function(){return this._beburst},busrtInfo.prototype.burst=function(t){void 0===t&&(t=!0),this._beburst=t},busrtInfo.CreatformJson=function(t){var a=new busrtInfo;return a.time=t.time,e.NumberData.FormJson(t.count,a.count),a},busrtInfo}();e.busrtInfo=i}(t.framework||(t.framework={}))}(gd3d||(gd3d={}));var gd3d;!function(t){!function(e){var a=function(){function F14EmissionBatch(a,r){this.curRealVboCount=0,this.curVertexcount=0,this.curIndexCount=0,this.vertexLength=0,this.type=e.F14TypeEnum.particlesType,this.effect=a,this.emission=r;var i=this.emission.baseddata.mesh;this.mesh=new e.mesh,this.mat=this.emission.baseddata.material,this.vertexLength=t.render.meshData.calcByteSize(this.effect.VF)/4;var o=this.getMaxParticleCount(),n=o*i.data.pos.length,s=o*i.data.trisindex.length;this.dataForVbo=new Float32Array(n*this.vertexLength),this.dataForEbo=new Uint16Array(s),this.mesh.glMesh=new t.render.glMesh,this.mesh.glMesh.initBuffer(this.effect.webgl,this.effect.VF,n,t.render.MeshTypeEnum.Dynamic),this.mesh.glMesh.addIndex(this.effect.webgl,this.dataForEbo.length),this.mesh.submesh=[];var l=new e.subMeshInfo;l.matIndex=0,l.useVertexIndex=0,l.start=0,l.size=this.dataForEbo.length,l.line=!1,this.mesh.submesh.push(l)}return F14EmissionBatch.prototype.getMaxParticleCount=function(){var t,e=this.emission.baseddata.rateOverTime;t=e.isRandom?e._valueLimitMax:e._value;var a=this.emission.baseddata.lifeTime,r=a.isRandom?a._valueLimitMax:a._value;if(!this.emission.baseddata.beloop){var i=this.emission.baseddata.duration;i<r&&(r=i)}for(var o in this.emission.layer.frameList){var n=this.emission.layer.frameList[o],s=this.emission.layer.frames[n].data.EmissionData.rateOverTime,l=s.isRandom?s._valueLimitMax:s._value;l>t&&(t=l)}for(var h=0,c=0;c<this.emission.baseddata.bursts.length;c++){var u=this.emission.baseddata.bursts[c];h+=u.count.isRandom?u.count._valueLimitMax:u.count._value}return Math.floor(t*r+h+2)},F14EmissionBatch.prototype.render=function(e,a,r,i){this.emission.baseddata.simulateInLocalSpace?t.math.matrixClone(this.effect.mvpMat,e.matrixModelViewProject):e.updateModeTrail(),this.mat.setQueue(i),this.curIndexCount=0,this.curVertexcount=0,this.curRealVboCount=0;for(var o=0,n=this.emission.particlelist.length;o<n;o++)this.emission.particlelist[o].uploadMeshdata();this.mesh.glMesh.uploadVertexData(e.webgl,this.dataForVbo),this.mesh.glMesh.uploadIndexData(e.webgl,0,this.dataForEbo),this.mesh.submesh[0].size=this.curIndexCount,this.mat.draw(e,this.mesh,this.mesh.submesh[0])},F14EmissionBatch.prototype.unRender=function(){},F14EmissionBatch.prototype.getElementCount=function(){return 1},F14EmissionBatch.prototype.dispose=function(){this.effect=null,this.emission=null,this.mesh=null,this.mat=null,delete this.dataForEbo,delete this.dataForVbo},F14EmissionBatch}();e.F14EmissionBatch=a}(t.framework||(t.framework={}))}(gd3d||(gd3d={}));var gd3d;!function(t){!function(e){var a=function(){function F14Particle(e,a){this.StartPos=new t.math.vector3,this.speedDir=new t.math.vector3,this.tex_ST=new t.math.vector4,this.rotationByEuler=new t.math.quaternion,this.rotationByShape=new t.math.quaternion,this.startRotation=new t.math.quaternion,this.rotAngle=0,this.localMatrix=new t.math.matrix,this.localTranslate=new t.math.vector3,this.localRotation=new t.math.quaternion,this.localScale=new t.math.vector3(1,1,1),this.color=new t.math.vector3(1,1,1),this.alpha=1,this.Color=new t.math.color,this.life01=0,this.actived=!1,this.tempos=t.math.pool.new_vector3(),this.temcolor=t.math.pool.new_color(),this.temUv=t.math.pool.new_vector2(),this.transformVertex=new t.math.matrix,this.angleRot=new t.math.quaternion,this.worldpos=new t.math.vector3,this.tarWorldpos=new t.math.vector3,this.worldspeeddir=new t.math.vector3,this.lookDir=new t.math.vector3,this.temptx=new t.math.vector3,this.worldRotation=new t.math.quaternion,this.invParWorldRot=new t.math.quaternion,this.worldStartPos=new t.math.vector3,this.data=a,this.element=e,this.initByEmissionData(a)}return F14Particle.prototype.getEmissionMatToWorld=function(){return this.data.simulateInLocalSpace?this.element.getWorldMatrix():this.emissionMatToWorld},F14Particle.prototype.getemissionWorldRotation=function(){return this.data.simulateInLocalSpace?this.element.getWorldRotation():this.emissionWorldRotation},F14Particle.prototype.initByEmissionData=function(a){this.actived=!0,this.curLife=0,this.totalLife=a.lifeTime.getValue(!0),this.simulateInLocalSpace=a.simulateInLocalSpace,this.simulationSpeed=a.simulationSpeed.getValue(!0),this.startScaleRate=a.startScaleRate.getValue(!0),this.startScale=a.startScale.getValue(!0),t.math.vec3ScaleByNum(this.startScale,this.startScaleRate,this.startScale),this.Starteuler=a.startEuler.getValue(!0),this.startColor=a.startColor.getValue(!0),this.startAlpha=a.startAlpha.getValue(!0),this.colorRate=a.colorRate,this.starTex_ST=a.start_tex_st,this.movespeed=a.moveSpeed.getValue(!0),this.sizeNodes=a.sizeNodes,this.eulerSpeed=a.angleSpeed.getValue(!0),this.colorNodes=a.colorNodes,this.alphaNodes=a.alphaNodes,this.uvType=a.uvType,this.getCurTex_ST(a),e.F14EmissionBaseData.getRandomDirAndPosByZEmission(a,this.speedDir,this.StartPos),t.math.quatFromEulerAngles(this.Starteuler.x,this.Starteuler.y,this.Starteuler.z,this.rotationByEuler),this.rotAngle=0,t.math.vec3Clone(this.startScale,this.localScale),t.math.vec3Clone(this.startColor,this.color),this.alpha=this.startAlpha,t.math.vec4Clone(this.starTex_ST,this.tex_ST),a.simulateInLocalSpace||(this.emissionMatToWorld=new t.math.matrix,this.emissionWorldRotation=new t.math.quaternion,t.math.matrixClone(this.element.getWorldMatrix(),this.emissionMatToWorld),t.math.quatClone(this.element.getWorldRotation(),this.emissionWorldRotation)),a.rendermodel==e.RenderModelEnum.StretchedBillBoard&&(this.emissionMatToWorld=this.getEmissionMatToWorld(),t.math.matrixTransformNormal(this.speedDir,this.emissionMatToWorld,this.worldspeeddir),t.math.vec3Normalize(this.worldspeeddir,this.worldspeeddir),t.math.matrixTransformVector3(this.StartPos,this.emissionMatToWorld,this.worldStartPos))},F14Particle.prototype.update=function(t){if(this.actived){if(this.curLife+=t,this.life01=this.curLife/this.totalLife,this.life01>1)return this.actived=!1,void this.element.deadParticles.push(this);this.updatePos(),this.updateSize(),this.updateEuler(),this.updateRot(),this.updateLocalMatrix(),this.updateColor(),this.updateUV()}},F14Particle.prototype.uploadMeshdata=function(){if(this.actived){for(var e=this.element.layer.batch,a=0;a<this.element.vertexCount;a++)t.math.matrixTransformVector3(this.element.posArr[a],this.transformVertex,this.tempos),e.dataForVbo[a*e.vertexLength+e.curRealVboCount+0]=this.tempos.x,e.dataForVbo[a*e.vertexLength+e.curRealVboCount+1]=this.tempos.y,e.dataForVbo[a*e.vertexLength+e.curRealVboCount+2]=this.tempos.z,this.element.colorArr?t.math.colorMultiply(this.element.colorArr[a],this.Color,this.temcolor):t.math.colorClone(this.Color,this.temcolor),e.dataForVbo[a*e.vertexLength+e.curRealVboCount+3]=this.temcolor.r,e.dataForVbo[a*e.vertexLength+e.curRealVboCount+4]=this.temcolor.g,e.dataForVbo[a*e.vertexLength+e.curRealVboCount+5]=this.temcolor.b,e.dataForVbo[a*e.vertexLength+e.curRealVboCount+6]=this.temcolor.a,this.temUv.x=this.element.uvArr[a].x*this.tex_ST.x+this.tex_ST.z,this.temUv.y=this.element.uvArr[a].y*this.tex_ST.y+this.tex_ST.w,e.dataForVbo[a*e.vertexLength+e.curRealVboCount+7]=this.temUv.x,e.dataForVbo[a*e.vertexLength+e.curRealVboCount+8]=this.temUv.y;for(a=0;a<this.element.dataforebo.length;a++)e.dataForEbo[a+e.curIndexCount]=this.element.dataforebo[a]+e.curVertexcount;e.curRealVboCount+=this.element.dataforvboLen,e.curIndexCount+=this.element.dataforebo.length,e.curVertexcount+=this.element.vertexCount}},F14Particle.prototype.updateLocalMatrix=function(){t.math.matrixMakeTransformRTS(this.localTranslate,this.localScale,this.localRotation,this.localMatrix),this.data.simulateInLocalSpace?t.math.matrixMultiply(this.element.localMatrix,this.localMatrix,this.transformVertex):t.math.matrixMultiply(this.emissionMatToWorld,this.localMatrix,this.transformVertex)},F14Particle.prototype.updatePos=function(){if(t.math.vec3ScaleByNum(this.speedDir,this.simulationSpeed*this.curLife,this.localTranslate),t.math.vec3Add(this.localTranslate,this.StartPos,this.localTranslate),this.data.enableVelocityOverLifetime){var e=t.math.pool.new_vector3();t.math.vec3ScaleByNum(this.movespeed,this.curLife,e),t.math.vec3Add(this.localTranslate,e,this.localTranslate),t.math.pool.delete_vector3(e)}},F14Particle.prototype.updateSize=function(){if(this.data.enableSizeOverLifetime&&this.sizeNodes.length>0){if(this.sizeNodes[0].key>this.life01){a=t.math.numberLerp(1,this.sizeNodes[0].value,this.life01/this.sizeNodes[0].key);return void t.math.vec3ScaleByNum(this.startScale,a,this.localScale)}for(var e=0;e<this.sizeNodes.length-1;e++)if(this.sizeNodes[e].key<=this.life01&&this.sizeNodes[e+1].key>=this.life01){var a=t.math.numberLerp(this.sizeNodes[e].value,this.sizeNodes[e+1].value,(this.life01-this.sizeNodes[e].key)/(this.sizeNodes[e+1].key-this.sizeNodes[e].key));t.math.vec3ScaleByNum(this.startScale,a,this.localScale);break}}},F14Particle.prototype.updateEuler=function(){this.data.enableRotOverLifeTime&&(this.rotAngle=this.eulerSpeed*this.curLife)},F14Particle.prototype.updateRot=function(){if(this.data.rendermodel==e.RenderModelEnum.Mesh)t.math.quatFromAxisAngle(t.math.pool.vector3_up,this.rotAngle,this.angleRot),t.math.quatMultiply(this.rotationByEuler,this.angleRot,this.localRotation);else if(this.data.rendermodel==e.RenderModelEnum.BillBoard)this.emissionMatToWorld=this.getEmissionMatToWorld(),t.math.matrixTransformVector3(this.localTranslate,this.emissionMatToWorld,this.worldpos),this.tarWorldpos=this.element.effect.renderCamera.gameObject.transform.getWorldTranslate(),t.math.quatLookat(this.worldpos,this.tarWorldpos,this.worldRotation),this.emissionWorldRotation=this.getemissionWorldRotation(),t.math.quatInverse(this.emissionWorldRotation,this.invParWorldRot),t.math.quatMultiply(this.invParWorldRot,this.worldRotation,this.localRotation),t.math.quatFromAxisAngle(t.math.pool.vector3_forward,this.rotAngle+this.Starteuler.z,this.rotationByEuler),t.math.quatMultiply(this.localRotation,this.rotationByEuler,this.localRotation);else if(this.data.rendermodel==e.RenderModelEnum.HorizontalBillBoard)this.worldRotation.x=-.5,this.worldRotation.y=.5,this.worldRotation.z=.5,this.worldRotation.w=.5,this.emissionWorldRotation=this.getemissionWorldRotation(),t.math.quatInverse(this.emissionWorldRotation,this.invParWorldRot),t.math.quatMultiply(this.invParWorldRot,this.worldRotation,this.localRotation),t.math.quatFromAxisAngle(t.math.pool.vector3_forward,this.rotAngle+this.Starteuler.z,this.rotationByEuler),t.math.quatMultiply(this.localRotation,this.rotationByEuler,this.localRotation);else if(this.data.rendermodel==e.RenderModelEnum.VerticalBillBoard){this.emissionMatToWorld=this.getEmissionMatToWorld(),t.math.matrixTransformVector3(this.localTranslate,this.emissionMatToWorld,this.worldpos);a=this.element.effect.renderCamera.gameObject.transform.getWorldTranslate();t.math.vec3Clone(a,this.tarWorldpos),this.tarWorldpos.y=this.worldpos.y,t.math.quatLookat(this.worldpos,this.tarWorldpos,this.worldRotation),this.emissionWorldRotation=this.getemissionWorldRotation(),t.math.quatInverse(this.emissionWorldRotation,this.invParWorldRot),t.math.quatMultiply(this.invParWorldRot,this.worldRotation,this.localRotation),t.math.quatFromAxisAngle(t.math.pool.vector3_forward,this.rotAngle+this.Starteuler.z,this.rotationByEuler),t.math.quatMultiply(this.localRotation,this.rotationByEuler,this.localRotation)}else if(this.data.rendermodel==e.RenderModelEnum.StretchedBillBoard){this.emissionMatToWorld=this.getEmissionMatToWorld(),t.math.matrixTransformVector3(this.localTranslate,this.emissionMatToWorld,this.worldpos);var a=this.element.effect.renderCamera.gameObject.transform.getWorldTranslate();t.math.vec3Subtract(a,this.worldpos,this.lookDir),t.math.vec3Normalize(this.lookDir,this.lookDir),t.math.vec3Cross(this.worldspeeddir,this.lookDir,this.temptx),t.math.vec3Cross(this.temptx,this.worldspeeddir,this.lookDir),t.math.unitxyzToRotation(this.temptx,this.worldspeeddir,this.lookDir,this.worldRotation),this.emissionWorldRotation=this.getemissionWorldRotation(),t.math.quatInverse(this.emissionWorldRotation,this.invParWorldRot),t.math.quatMultiply(this.invParWorldRot,this.worldRotation,this.localRotation)}},F14Particle.prototype.updateColor=function(){if(this.data.enableColorOverLifetime){if(this.colorNodes.length>0)if(this.colorNodes[0].key>this.life01)t.math.vec3SLerp(this.startColor,this.colorNodes[0].value,this.life01/this.colorNodes[0].key,this.color);else for(e=0;e<this.colorNodes.length-1;e++)if(this.colorNodes[e].key<=this.life01&&this.colorNodes[e+1].key>=this.life01){t.math.vec3SLerp(this.colorNodes[e].value,this.colorNodes[e+1].value,(this.life01-this.colorNodes[e].key)/(this.colorNodes[e+1].key-this.colorNodes[e].key),this.color);break}if(this.alphaNodes.length>0)if(this.alphaNodes[0].key>this.life01)this.alpha=t.math.numberLerp(this.startAlpha,this.alphaNodes[0].value,this.life01/this.alphaNodes[0].key);else for(var e=0;e<this.alphaNodes.length-1;e++)if(this.alphaNodes[e].key<=this.life01&&this.alphaNodes[e+1].key>=this.life01){this.alpha=t.math.numberLerp(this.alphaNodes[e].value,this.alphaNodes[e+1].value,(this.life01-this.alphaNodes[e].key)/(this.alphaNodes[e+1].key-this.alphaNodes[e].key));break}}this.Color.r=this.color.x,this.Color.g=this.color.y,this.Color.b=this.color.z,this.Color.a=this.alpha},F14Particle.prototype.updateUV=function(){this.getCurTex_ST(this.data)},F14Particle.prototype.getCurTex_ST=function(a){if(a.enableTexAnimation)if(a.uvType==e.UVTypeEnum.UVRoll)this.tex_ST.x=1,this.tex_ST.y=1,this.tex_ST.z=a.uSpeed*this.curLife,this.tex_ST.w=a.vSpeed*this.curLife;else{var r=Math.floor(this.life01*a.count);r>=a.count&&(r=a.count-1),t.math.spriteAnimation(a.row,a.column,r,this.tex_ST)}},F14Particle.prototype.dispose=function(){this.data=null,this.element=null,delete this.sizeNodes,delete this.colorNodes,delete this.alphaNodes},F14Particle}();e.F14Particle=a}(t.framework||(t.framework={}))}(gd3d||(gd3d={}));var gd3d;!function(t){!function(t){var e=function(){function F14RefElementBatch(e,a){this.type=t.F14TypeEnum.RefType,this.effect=e,this.element=a}return F14RefElementBatch.prototype.unRender=function(){},F14RefElementBatch.prototype.getElementCount=function(){return this.element.RefEffect.getElementCount()},F14RefElementBatch.prototype.render=function(t,e,a,r){this.element.drawActive&&this.element.RefEffect.render(t,e,a,r)},F14RefElementBatch.prototype.dispose=function(){this.effect=null,this.element=null},F14RefElementBatch}();t.F14RefElementBatch=e}(t.framework||(t.framework={}))}(gd3d||(gd3d={}));var gd3d;!function(t){!function(e){var a=function(){function F14RefBaseData(){this.beLoop=!1,this.localPos=new t.math.vector3,this.localEuler=new t.math.vector3,this.localScale=new t.math.vector3(1,1,1)}return F14RefBaseData.prototype.parse=function(e,a,r){this.beLoop=e.beLoop,this.refdataName=e.F14EffectData,t.math.vec3FormJson(e.localPos,this.localPos),t.math.vec3FormJson(e.localEuler,this.localEuler),t.math.vec3FormJson(e.localScale,this.localScale)},F14RefBaseData}();e.F14RefBaseData=a}(t.framework||(t.framework={}))}(gd3d||(gd3d={}));var gd3d;!function(t){!function(e){var a=function(){function F14RefElement(a,r){this.type=e.F14TypeEnum.RefType,this.effect=a,this.baseddata=r.data.elementdata,this.layer=r;var i=e.sceneMgr.app.getAssetMgr().getAssetByName(this.baseddata.refdataName);if(i){this.refreshStartEndFrame(),this.RefEffect=new e.f14EffectSystem,this.RefEffect._root=new e.transform,this.RefEffect.enableDraw=!0,this.RefEffect.gameObject=this.RefEffect._root.gameObject;var o=r.data.elementdata;t.math.vec3Clone(o.localPos,this.RefEffect._root.localTranslate),t.math.vec3Clone(o.localScale,this.RefEffect._root.localScale),t.math.quatFromEulerAngles(o.localEuler.x,o.localEuler.y,o.localEuler.z,this.RefEffect._root.localRotate),this.RefEffect._root.markDirty(),this.RefEffect.beref=!0,this.baseddata.refData=i.data,this.RefEffect.setData(this.baseddata.refData)}}return F14RefElement.prototype.reset=function(){this.RefEffect.reset()},F14RefElement.prototype.refreshStartEndFrame=function(){0==this.layer.frameList.length?this.startFrame=0:this.startFrame=this.layer.frameList[0],this.layer.frameList.length>1?this.endFrame=this.layer.frameList[this.layer.frameList.length-1]:this.endFrame=this.effect.data.lifeTime},F14RefElement.prototype.update=function(t,a,r){if(this.RefEffect&&null==this.RefEffect._root.parent&&(this.effect.gameObject.transform.addChild(this.RefEffect._root),this.RefEffect._root.markDirty(),this.RefEffect._root.updateWorldTran()),0!=this.layer.frameList.length){if(this.effect.data.beloop&&(a=this.effect.restartFrame),a<this.startFrame||a>this.endFrame)return this.drawActive=!1,void(this.RefEffect.playState=e.PlayStateEnum.beReady);this.drawActive=!0,this.RefEffect.enabletimeFlow=!0,this.RefEffect.update(t)}else this.drawActive=!1},F14RefElement.prototype.OnEndOnceLoop=function(){},F14RefElement.prototype.changeColor=function(t){this.RefEffect.changeColor(t)},F14RefElement.prototype.dispose=function(){this.baseddata=null,this.RefEffect.remove(),this.RefEffect=null},F14RefElement}();e.F14RefElement=a}(t.framework||(t.framework={}))}(gd3d||(gd3d={}));var gd3d;!function(t){!function(e){var a=function(){function F14SingleMesh(a,r){this.position=new t.math.vector3,this.scale=new t.math.vector3,this.euler=new t.math.vector3,this.color=new t.math.color,this.tex_ST=new t.math.vector4,this.localRotate=new t.math.quaternion,this.targetMat=new t.math.matrix,this.tempos=t.math.pool.new_vector3(),this.temColor=t.math.pool.new_color(),this.temUv=t.math.pool.new_vector2(),this.eulerRot=new t.math.quaternion,this.worldpos=new t.math.vector3,this.worldRot=new t.math.quaternion,this.inverseRot=new t.math.quaternion,this.lookDir=new t.math.vector3,this.worldDirx=new t.math.vector3,this.worldDiry=new t.math.vector3,this.type=e.F14TypeEnum.SingleMeshType,this.effect=a,this.layer=r,this.baseddata=r.data.elementdata,t.math.vec3Clone(this.baseddata.position,this.position),t.math.vec3Clone(this.baseddata.scale,this.scale),t.math.vec3Clone(this.baseddata.euler,this.euler),t.math.quatFromEulerAngles(this.euler.x,this.euler.y,this.euler.z,this.localRotate),t.math.colorClone(this.baseddata.color,this.color),t.math.vec4Clone(this.baseddata.tex_ST,this.tex_ST),this.refreshStartEndFrame(),this.posArr=this.baseddata.mesh.data.pos,this.colorArr=this.baseddata.mesh.data.color,this.uvArr=this.baseddata.mesh.data.uv,this.vertexCount=this.posArr.length,this.dataforvbo=this.baseddata.mesh.data.genVertexDataArray(this.effect.VF),this.dataforebo=this.baseddata.mesh.data.genIndexDataArray()}return F14SingleMesh.prototype.refreshStartEndFrame=function(){0==this.layer.frameList.length?this.startFrame=0:this.startFrame=this.layer.frameList[0],this.layer.frameList.length>1?this.endFrame=this.layer.frameList[this.layer.frameList.length-1]:this.endFrame=this.effect.data.lifeTime},F14SingleMesh.prototype.update=function(t,a,r){if(0!=this.layer.frameList.length){if(this.effect.data.beloop)switch(this.baseddata.loopenum){case e.LoopEnum.Restart:a=this.effect.restartFrame;break;case e.LoopEnum.TimeContinue:}if(a<this.startFrame||a>this.endFrame)this.drawActive=!1;else{this.drawActive=!0;for(var i in this.layer.Attlines)this.layer.Attlines[i].getValue(a,this.baseddata,this[i]);this.baseddata.enableTexAnimation&&this.refreshCurTex_ST(a,t,r),this.updateRotByBillboard(),this.refreshTargetMatrix()}}else this.drawActive=!1},F14SingleMesh.prototype.OnEndOnceLoop=function(){this.reset()},F14SingleMesh.prototype.refreshTargetMatrix=function(){t.math.matrixMakeTransformRTS(this.position,this.scale,this.localRotate,this.targetMat)},F14SingleMesh.prototype.uploadMeshdata=function(){for(var e=this.layer.batch,a=0;a<this.vertexCount;a++)t.math.matrixTransformVector3(this.posArr[a],this.targetMat,this.tempos),e.dataForVbo[a*e.vertexLength+e.curRealVboCount+0]=this.tempos.x,e.dataForVbo[a*e.vertexLength+e.curRealVboCount+1]=this.tempos.y,e.dataForVbo[a*e.vertexLength+e.curRealVboCount+2]=this.tempos.z,this.colorArr?t.math.colorMultiply(this.colorArr[a],this.color,this.temColor):t.math.colorClone(this.color,this.temColor),e.dataForVbo[a*e.vertexLength+e.curRealVboCount+3]=this.temColor.r,e.dataForVbo[a*e.vertexLength+e.curRealVboCount+4]=this.temColor.g,e.dataForVbo[a*e.vertexLength+e.curRealVboCount+5]=this.temColor.b,e.dataForVbo[a*e.vertexLength+e.curRealVboCount+6]=this.temColor.a,this.temUv.x=this.uvArr[a].x*this.tex_ST.x+this.tex_ST.z,this.temUv.y=this.uvArr[a].y*this.tex_ST.y+this.tex_ST.w,e.dataForVbo[a*e.vertexLength+e.curRealVboCount+7]=this.temUv.x,e.dataForVbo[a*e.vertexLength+e.curRealVboCount+8]=this.temUv.y;for(a=0;a<this.dataforebo.length;a++)e.dataForEbo[a+e.curIndexCount]=this.dataforebo[a]+e.curVertexcount;e.curRealVboCount+=this.dataforvbo.length,e.curIndexCount+=this.dataforebo.length,e.curVertexcount+=this.vertexCount},F14SingleMesh.prototype.refreshCurTex_ST=function(a,r,i){if(this.baseddata.uvType==e.UVTypeEnum.UVRoll)this.tex_ST.z+=this.baseddata.uSpeed*r,this.tex_ST.w+=this.baseddata.vSpeed*r;else if(this.baseddata.uvType==e.UVTypeEnum.UVSprite){var o=(a-this.startFrame)/(this.endFrame+1-this.startFrame),n=Math.floor(o*this.baseddata.count);t.math.spriteAnimation(this.baseddata.row,this.baseddata.column,n,this.tex_ST)}},F14SingleMesh.prototype.updateRotByBillboard=function(){if(this.baseddata.beBillboard)if(this.baseddata.bindAxis==e.BindAxis.NONE){a=this.effect.root.getWorldMatrix();t.math.matrixTransformVector3(this.position,a,this.worldpos);r=this.effect.renderCamera.gameObject.transform.getWorldTranslate();t.math.quatLookat(this.worldpos,r,this.worldRot);i=this.effect.root.getWorldRotate();t.math.quatInverse(i,this.inverseRot),t.math.quatMultiply(this.inverseRot,this.worldRot,this.localRotate),t.math.quatFromAxisAngle(t.math.pool.vector3_forward,this.euler.z,this.eulerRot),t.math.quatMultiply(this.localRotate,this.eulerRot,this.localRotate)}else if(this.baseddata.bindAxis==e.BindAxis.X){a=this.effect.root.getWorldMatrix();t.math.matrixTransformVector3(this.position,a,this.worldpos);r=this.effect.renderCamera.gameObject.transform.getWorldTranslate();t.math.vec3Subtract(r,this.worldpos,this.lookDir),t.math.vec3Normalize(this.lookDir,this.lookDir),t.math.matrixMakeTransformRTS(this.baseddata.position,this.baseddata.scale,this.localRotate,this.targetMat),t.math.matrixMultiply(a,this.targetMat,this.targetMat),t.math.matrixTransformNormal(t.math.pool.vector3_right,this.targetMat,this.worldDirx),t.math.vec3Normalize(this.worldDirx,this.worldDirx),t.math.vec3Cross(this.lookDir,this.worldDirx,this.worldDiry),t.math.vec3Cross(this.worldDirx,this.worldDiry,this.lookDir),t.math.unitxyzToRotation(this.worldDirx,this.worldDiry,this.lookDir,this.worldRot);i=this.effect.root.getWorldRotate();t.math.quatInverse(i,this.inverseRot),t.math.quatMultiply(this.inverseRot,this.worldRot,this.localRotate)}else{var a=this.effect.root.getWorldMatrix();t.math.matrixTransformVector3(this.position,a,this.worldpos);var r=this.effect.renderCamera.gameObject.transform.getWorldTranslate();t.math.vec3Subtract(r,this.worldpos,this.lookDir),t.math.vec3Normalize(this.lookDir,this.lookDir),t.math.matrixMakeTransformRTS(this.position,this.scale,this.localRotate,this.targetMat),t.math.matrixMultiply(a,this.targetMat,this.targetMat),t.math.matrixTransformNormal(t.math.pool.vector3_up,this.targetMat,this.worldDiry),t.math.vec3Normalize(this.worldDiry,this.worldDiry),t.math.vec3Cross(this.worldDiry,this.lookDir,this.worldDirx),t.math.vec3Cross(this.worldDirx,this.worldDiry,this.lookDir),t.math.unitxyzToRotation(this.worldDirx,this.worldDiry,this.lookDir,this.worldRot);var i=this.effect.root.getWorldRotate();t.math.quatInverse(i,this.inverseRot),t.math.quatMultiply(this.inverseRot,this.worldRot,this.localRotate)}else t.math.quatFromEulerAngles(this.euler.x,this.euler.y,this.euler.z,this.localRotate)},F14SingleMesh.prototype.reset=function(){t.math.vec3Clone(this.baseddata.position,this.position),t.math.vec3Clone(this.baseddata.scale,this.scale),t.math.vec3Clone(this.baseddata.euler,this.euler),t.math.quatFromEulerAngles(this.euler.x,this.euler.y,this.euler.z,this.localRotate),t.math.colorClone(this.baseddata.color,this.color),t.math.vec4Clone(this.baseddata.tex_ST,this.tex_ST)},F14SingleMesh.prototype.changeColor=function(t){this.color=t},F14SingleMesh.prototype.dispose=function(){this.layer=null,this.RenderBatch=null,this.baseddata=null,this.effect=null,delete this.posArr,delete this.colorArr,delete this.uvArr,delete this.dataforvbo,delete this.dataforebo},F14SingleMesh}();e.F14SingleMesh=a}(t.framework||(t.framework={}))}(gd3d||(gd3d={}));var gd3d;!function(t){!function(e){var a=function(){function F14SingleMeshBath(a,r){this.meshlist=[],this.activemeshlist=[],this.mesh=new e.mesh,this.indices=[],this.vertices=[],this.colors=[],this.uv=[],this.curRealVboCount=0,this.curVertexcount=0,this.curIndexCount=0,this.vertexLength=0,this.noBatch=!1,this.mat=new t.math.matrix,this.defST=new t.math.vector4(1,1,0,0),this.temptColorv4=new t.math.vector4,this.uploadData=!1,this.type=e.F14TypeEnum.SingleMeshType,this.effect=r,this.ElementMat=a}return F14SingleMeshBath.prototype.OnEndCollectElement=function(){if(this.vertexLength=t.render.meshData.calcByteSize(this.effect.VF)/4,1==this.meshlist.length)return this.noBatch=!0,this.mesh.glMesh=new t.render.glMesh,this.dataForVbo=this.meshlist[0].baseddata.mesh.data.genVertexDataArray(this.effect.VF),this.dataForEbo=this.meshlist[0].baseddata.mesh.data.genIndexDataArray(),this.mesh.glMesh.initBuffer(this.effect.webgl,this.effect.VF,this.meshlist[0].baseddata.mesh.data.pos.length,t.render.MeshTypeEnum.Static),this.mesh.glMesh.uploadVertexData(this.effect.webgl,this.dataForVbo),this.mesh.glMesh.addIndex(this.effect.webgl,this.dataForEbo.length),this.mesh.glMesh.uploadIndexData(this.effect.webgl,0,this.dataForEbo),this.mesh.submesh=[],(n=new e.subMeshInfo).matIndex=0,n.useVertexIndex=0,n.start=0,n.size=this.dataForEbo.length,n.line=!1,void this.mesh.submesh.push(n);for(var a=0,r=0,i=0,o=this.meshlist.length;i<o;i++)a+=this.meshlist[i].baseddata.mesh.data.pos.length,r+=this.meshlist[i].baseddata.mesh.data.trisindex.length;this.dataForVbo=new Float32Array(a*this.vertexLength),this.dataForEbo=new Uint16Array(r),this.mesh.glMesh=new t.render.glMesh,this.mesh.glMesh.initBuffer(this.effect.webgl,this.effect.VF,a,t.render.MeshTypeEnum.Dynamic),this.mesh.glMesh.addIndex(this.effect.webgl,this.dataForEbo.length),this.mesh.submesh=[];var n=new e.subMeshInfo;n.matIndex=0,n.useVertexIndex=0,n.start=0,n.size=this.dataForEbo.length,n.line=!1,this.mesh.submesh.push(n)},F14SingleMeshBath.prototype.reInit=function(t,e){this.effect=e,this.ElementMat=t,this.meshlist.length=0},F14SingleMeshBath.prototype.addElement=function(t,e){void 0===e&&(e=!1),this.meshlist.push(t),t.layer.batch=this},F14SingleMeshBath.prototype.canBatch=function(t){return this.ElementMat==t.baseddata.material&&!(this.ElementMat.getShader().getName().indexOf("mask")>0)},F14SingleMeshBath.prototype.getElementCount=function(){return this.meshlist.length},F14SingleMeshBath.prototype.render=function(e,a,r,i){if(0!=this.meshlist.length){this.activemeshlist.length=0;for(var o=0,n=this.meshlist.length;o<n;o++)this.meshlist[o].drawActive&&this.activemeshlist.push(this.meshlist[o]);if(!(this.activemeshlist.length<1))if(this.ElementMat.setQueue(i),this.noBatch){t.math.matrixMultiply(this.effect.mvpMat,this.activemeshlist[0].targetMat,e.matrixModelViewProject);var s=this.activemeshlist[0].baseddata.mesh;if(0==s.updateByEffect){var l=new t.render.glMesh;l.initBuffer(this.effect.webgl,this.effect.VF,s.data.pos.length,t.render.MeshTypeEnum.Static),l.uploadVertexData(this.effect.webgl,this.activemeshlist[0].dataforvbo),l.ebos=s.glMesh.ebos,l.indexCounts=s.glMesh.indexCounts,s.glMesh=l,s.submesh[0].size=this.activemeshlist[0].dataforebo.length,s.updateByEffect=!0}this.temptColorv4.x=this.activemeshlist[0].color.r,this.temptColorv4.y=this.activemeshlist[0].color.g,this.temptColorv4.z=this.activemeshlist[0].color.b,this.temptColorv4.w=this.activemeshlist[0].color.a,this.ElementMat.setVector4("_Main_Color",this.temptColorv4),this.ElementMat.setVector4("_Main_Tex_ST",this.activemeshlist[0].tex_ST),s.glMesh.bindVboBuffer(e.webgl),this.ElementMat.draw(e,s,s.submesh[0])}else{t.math.matrixClone(this.effect.mvpMat,e.matrixModelViewProject),this.curIndexCount=0,this.curVertexcount=0,this.curRealVboCount=0;for(var o=0,n=this.activemeshlist.length;o<n;o++)this.activemeshlist[o].uploadMeshdata();this.mesh.glMesh.uploadVertexData(e.webgl,this.dataForVbo),this.mesh.glMesh.uploadIndexData(e.webgl,0,this.dataForEbo),this.mesh.submesh[0].size=this.curIndexCount,this.ElementMat.setVector4("_Main_Color",new t.math.vector4(1,1,1,1)),this.ElementMat.setVector4("_Main_Tex_ST",new t.math.vector4(1,1,0,0)),this.ElementMat.draw(e,this.mesh,this.mesh.submesh[0])}}},F14SingleMeshBath.prototype.unRender=function(){},F14SingleMeshBath.prototype.dispose=function(){this.effect=null,this.ElementMat=null,delete this.meshlist,delete this.activemeshlist,this.mesh.dispose(),delete this.mesh,delete this.indices,delete this.vertices,delete this.colors,delete this.uv,delete this.dataForEbo,delete this.dataForVbo},F14SingleMeshBath}();e.F14SingleMeshBath=a}(t.framework||(t.framework={}))}(gd3d||(gd3d={}));var gd3d;!function(t){!function(e){var a;!function(t){t[t.Restart=0]="Restart",t[t.TimeContinue=1]="TimeContinue"}(a=e.LoopEnum||(e.LoopEnum={}));var r;!function(t){t[t.X=0]="X",t[t.Y=1]="Y",t[t.NONE=2]="NONE"}(r=e.BindAxis||(e.BindAxis={}));var i=function(){function F14SingleMeshBaseData(i){this.loopenum=a.Restart,this.position=new t.math.vector3,this.scale=new t.math.vector3(1,1,1),this.euler=new t.math.vector3,this.color=new t.math.color(1,1,1,1),this.tex_ST=new t.math.vector4,this.enableTexAnimation=!1,this.uvType=e.UVTypeEnum.NONE,this.beBillboard=!1,this.bindAxis=r.NONE,this.firtstFrame=0,this.firtstFrame=i,this.mesh=t.framework.sceneMgr.app.getAssetMgr().getDefaultMesh("quad"),this.material=t.framework.sceneMgr.app.getAssetMgr().getDefParticleMat()}return F14SingleMeshBaseData.prototype.parse=function(i,o,n){switch(i.loopenum){case"Restart":this.loopenum=a.Restart;break;case"TimeContinue":this.loopenum=a.TimeContinue}if(this.mesh=o.getAssetByName(i.mesh,n),this.material=o.getAssetByName(i.material,n),t.math.vec3FormJson(i.position,this.position),t.math.vec3FormJson(i.scale,this.scale),t.math.vec3FormJson(i.euler,this.euler),t.math.colorFormJson(i.color,this.color),t.math.vec4FormJson(i.tex_ST,this.tex_ST),this.enableTexAnimation=i.enableTexAnimation,this.enableTexAnimation)switch(i.uvType){case"UVRoll":this.uvType=e.UVTypeEnum.UVRoll,this.uSpeed=i.uSpeed,this.vSpeed=i.vSpeed;break;case"UVSprite":this.uvType=e.UVTypeEnum.UVSprite,this.row=i.row,this.column=i.column,this.count=i.count;break;case"NONE":this.uvType=e.UVTypeEnum.NONE}if(null!=i.beBillboard)switch(this.beBillboard=i.beBillboard,i.bindAxis){case"NONE":this.bindAxis=r.NONE;break;case"X":this.bindAxis=r.X;break;case"Y":this.bindAxis=r.Y}},F14SingleMeshBaseData}();e.F14SingleMeshBaseData=i}(t.framework||(t.framework={}))}(gd3d||(gd3d={}));var gd3d;!function(t){!function(e){var a=function(){function starCamCtr(){this.moveDuration=1,this.minSpeed=5,this.relativelocation=new t.math.vector3(0,6,0),this.relativeEuler=new t.math.vector3(90,0,0),this.relativeRot=new t.math.quaternion,this.starteCamRot=new t.math.quaternion,this.targetCamPos=new t.math.vector3,this.targetCamRot=new t.math.quaternion,this.movedir=new t.math.vector3,this.active=!1,this.moveDis=new t.math.vector3}return starCamCtr.prototype.start=function(){},starCamCtr.prototype.onPlay=function(){},starCamCtr.prototype.update=function(e){if(this.active){var a=this.gameObject.transform.localTranslate,r=(this.gameObject.transform.localRotate,t.math.vec3Distance(a,this.targetCamPos)),i=this.moveSpeed*e;r>i?(t.math.vec3ScaleByNum(this.movedir,i,this.moveDis),t.math.vec3Add(a,this.moveDis,this.gameObject.transform.localTranslate),t.math.quatLerp(this.starteCamRot,this.targetCamRot,this.gameObject.transform.localRotate,(this.distance-r)/this.distance),this.gameObject.transform.markDirty(),this.gameObject.transform.updateWorldTran()):this.active=!1}},starCamCtr.prototype.remove=function(){},starCamCtr.prototype.clone=function(){},starCamCtr.prototype.moveTo=function(e){t.math.quatClone(this.gameObject.transform.localRotate,this.starteCamRot),t.math.quatFromEulerAngles(this.relativeEuler.x,this.relativeEuler.y,this.relativeEuler.z,this.relativeRot),t.math.quatTransformVector(e.localRotate,this.relativelocation,this.targetCamPos),t.math.vec3Add(e.localTranslate,this.targetCamPos,this.targetCamPos),t.math.quatMultiply(e.localRotate,this.relativeRot,this.targetCamRot);var a=t.math.pool.new_vector3();t.math.vec3Subtract(this.targetCamPos,this.gameObject.transform.localTranslate,a),t.math.vec3Normalize(a,this.movedir),this.distance=t.math.vec3Length(a),this.moveSpeed=this.distance/this.moveDuration,t.math.pool.delete_vector3(a),this.active=!0},starCamCtr=__decorate([t.reflect.nodeComponent],starCamCtr)}();e.starCamCtr=a}(t.framework||(t.framework={}))}(gd3d||(gd3d={}));var gd3d;!function(t){var e=function(){function AEvent(){this.events={}}return AEvent.prototype.On=function(t,e,a){var r,i=this.events[t];if(i)for(var o=0,n=i;o<n.length;o++){var s=n[o];if(s.func==e){r=s;break}}else i=this.events[t]=[];r?-1==r.thisArgs.lastIndexOf(a)&&r.thisArgs.push(a):i.push({func:e,thisArgs:[a]})},AEvent.prototype.Emit=function(t){for(var e=[],a=1;a<arguments.length;a++)e[a-1]=arguments[a];var r=this.events[t];if(r)for(var i=0,o=r;i<o.length;i++)for(var n=o[i],s=0,l=n.thisArgs;s<l.length;s++){var h=l[s];n.func.apply(h,e)}},AEvent.prototype.RemoveListener=function(t,e,a){var r=this.events[t];if(r)for(var i=0,o=r.length;i<o;++i)if(e==r[i].func){var n=r[i].thisArgs.lastIndexOf(a);if(-1!=n){r[i].thisArgs.splice(n,1),r[i].thisArgs.length<1&&r.splice(i,1),r.length<1&&delete this.events[t];break}}},AEvent.prototype.RemoveListenerAll=function(){this.events={}},AEvent}();t.AEvent=e}(gd3d||(gd3d={}));var gd3d;!function(t){!function(t){!function(t){t[t.PointerDown=0]="PointerDown",t[t.PointerUp=1]="PointerUp",t[t.PointerClick=2]="PointerClick",t[t.PointerEnter=3]="PointerEnter",t[t.PointerExit=4]="PointerExit"}(t.UIEventEnum||(t.UIEventEnum={}));!function(t){t[t.PointDown=0]="PointDown",t[t.PointHold=1]="PointHold",t[t.PointUp=2]="PointUp",t[t.PointMove=3]="PointMove",t[t.PointClick=4]="PointClick",t[t.MouseWheel=5]="MouseWheel"}(t.PointEventEnum||(t.PointEventEnum={}));!function(t){t[t.KeyDown=0]="KeyDown",t[t.KeyUp=1]="KeyUp"}(t.KeyEventEnum||(t.KeyEventEnum={}));!function(t){t[t.None=0]="None",t[t.Backspace=8]="Backspace",t[t.Tab=9]="Tab",t[t.Clear=12]="Clear",t[t.Return=13]="Return",t[t.Pause=19]="Pause",t[t.Escape=27]="Escape",t[t.Space=32]="Space",t[t.Exclaim=33]="Exclaim",t[t.DoubleQuote=34]="DoubleQuote",t[t.Hash=35]="Hash",t[t.Dollar=36]="Dollar",t[t.Ampersand=38]="Ampersand",t[t.Quote=39]="Quote",t[t.LeftParen=40]="LeftParen",t[t.RightParen=41]="RightParen",t[t.Asterisk=42]="Asterisk",t[t.Plus=43]="Plus",t[t.Comma=44]="Comma",t[t.Minus=45]="Minus",t[t.Period=46]="Period",t[t.Slash=47]="Slash",t[t.Alpha0=48]="Alpha0",t[t.Alpha1=49]="Alpha1",t[t.Alpha2=50]="Alpha2",t[t.Alpha3=51]="Alpha3",t[t.Alpha4=52]="Alpha4",t[t.Alpha5=53]="Alpha5",t[t.Alpha6=54]="Alpha6",t[t.Alpha7=55]="Alpha7",t[t.Alpha8=56]="Alpha8",t[t.Alpha9=57]="Alpha9",t[t.Colon=58]="Colon",t[t.Semicolon=59]="Semicolon",t[t.Less=60]="Less",t[t.Equals=61]="Equals",t[t.Greater=62]="Greater",t[t.Question=63]="Question",t[t.At=64]="At",t[t.LeftBracket=91]="LeftBracket",t[t.Backslash=92]="Backslash",t[t.RightBracket=93]="RightBracket",t[t.Caret=94]="Caret",t[t.Underscore=95]="Underscore",t[t.BackQuote=96]="BackQuote",t[t.A=97]="A",t[t.B=98]="B",t[t.C=99]="C",t[t.D=100]="D",t[t.E=101]="E",t[t.F=102]="F",t[t.G=103]="G",t[t.H=104]="H",t[t.I=105]="I",t[t.J=106]="J",t[t.K=107]="K",t[t.L=108]="L",t[t.M=109]="M",t[t.N=110]="N",t[t.O=111]="O",t[t.P=112]="P",t[t.Q=113]="Q",t[t.R=114]="R",t[t.S=115]="S",t[t.T=116]="T",t[t.U=117]="U",t[t.V=118]="V",t[t.W=119]="W",t[t.X=120]="X",t[t.Y=121]="Y",t[t.Z=122]="Z",t[t.Delete=127]="Delete",t[t.Keypad0=256]="Keypad0",t[t.Keypad1=257]="Keypad1",t[t.Keypad2=258]="Keypad2",t[t.Keypad3=259]="Keypad3",t[t.Keypad4=260]="Keypad4",t[t.Keypad5=261]="Keypad5",t[t.Keypad6=262]="Keypad6",t[t.Keypad7=263]="Keypad7",t[t.Keypad8=264]="Keypad8",t[t.Keypad9=265]="Keypad9",t[t.KeypadPeriod=266]="KeypadPeriod",t[t.KeypadDivide=267]="KeypadDivide",t[t.KeypadMultiply=268]="KeypadMultiply",t[t.KeypadMinus=269]="KeypadMinus",t[t.KeypadPlus=270]="KeypadPlus",t[t.KeypadEnter=271]="KeypadEnter",t[t.KeypadEquals=272]="KeypadEquals",t[t.UpArrow=273]="UpArrow",t[t.DownArrow=274]="DownArrow",t[t.RightArrow=275]="RightArrow",t[t.LeftArrow=276]="LeftArrow",t[t.Insert=277]="Insert",t[t.Home=278]="Home",t[t.End=279]="End",t[t.PageUp=280]="PageUp",t[t.PageDown=281]="PageDown",t[t.F1=282]="F1",t[t.F2=283]="F2",t[t.F3=284]="F3",t[t.F4=285]="F4",t[t.F5=286]="F5",t[t.F6=287]="F6",t[t.F7=288]="F7",t[t.F8=289]="F8",t[t.F9=290]="F9",t[t.F10=291]="F10",t[t.F11=292]="F11",t[t.F12=293]="F12",t[t.F13=294]="F13",t[t.F14=295]="F14",t[t.F15=296]="F15",t[t.Numlock=300]="Numlock",t[t.CapsLock=301]="CapsLock",t[t.ScrollLock=302]="ScrollLock",t[t.RightShift=303]="RightShift",t[t.LeftShift=304]="LeftShift",t[t.RightControl=305]="RightControl",t[t.LeftControl=306]="LeftControl",t[t.RightAlt=307]="RightAlt",t[t.LeftAlt=308]="LeftAlt",t[t.RightCommand=309]="RightCommand",t[t.RightApple=309]="RightApple",t[t.LeftCommand=310]="LeftCommand",t[t.LeftApple=310]="LeftApple",t[t.LeftWindows=311]="LeftWindows",t[t.RightWindows=312]="RightWindows",t[t.AltGr=313]="AltGr",t[t.Help=315]="Help",t[t.Print=316]="Print",t[t.SysReq=317]="SysReq",t[t.Break=318]="Break",t[t.Menu=319]="Menu",t[t.Mouse0=323]="Mouse0",t[t.Mouse1=324]="Mouse1",t[t.Mouse2=325]="Mouse2",t[t.Mouse3=326]="Mouse3",t[t.Mouse4=327]="Mouse4",t[t.Mouse5=328]="Mouse5",t[t.Mouse6=329]="Mouse6",t[t.JoystickButton0=330]="JoystickButton0",t[t.JoystickButton1=331]="JoystickButton1",t[t.JoystickButton2=332]="JoystickButton2",t[t.JoystickButton3=333]="JoystickButton3",t[t.JoystickButton4=334]="JoystickButton4",t[t.JoystickButton5=335]="JoystickButton5",t[t.JoystickButton6=336]="JoystickButton6",t[t.JoystickButton7=337]="JoystickButton7",t[t.JoystickButton8=338]="JoystickButton8",t[t.JoystickButton9=339]="JoystickButton9",t[t.JoystickButton10=340]="JoystickButton10",t[t.JoystickButton11=341]="JoystickButton11",t[t.JoystickButton12=342]="JoystickButton12",t[t.JoystickButton13=343]="JoystickButton13",t[t.JoystickButton14=344]="JoystickButton14",t[t.JoystickButton15=345]="JoystickButton15",t[t.JoystickButton16=346]="JoystickButton16",t[t.JoystickButton17=347]="JoystickButton17",t[t.JoystickButton18=348]="JoystickButton18",t[t.JoystickButton19=349]="JoystickButton19",t[t.Joystick1Button0=350]="Joystick1Button0",t[t.Joystick1Button1=351]="Joystick1Button1",t[t.Joystick1Button2=352]="Joystick1Button2",t[t.Joystick1Button3=353]="Joystick1Button3",t[t.Joystick1Button4=354]="Joystick1Button4",t[t.Joystick1Button5=355]="Joystick1Button5",t[t.Joystick1Button6=356]="Joystick1Button6",t[t.Joystick1Button7=357]="Joystick1Button7",t[t.Joystick1Button8=358]="Joystick1Button8",t[t.Joystick1Button9=359]="Joystick1Button9",t[t.Joystick1Button10=360]="Joystick1Button10",t[t.Joystick1Button11=361]="Joystick1Button11",t[t.Joystick1Button12=362]="Joystick1Button12",t[t.Joystick1Button13=363]="Joystick1Button13",t[t.Joystick1Button14=364]="Joystick1Button14",t[t.Joystick1Button15=365]="Joystick1Button15",t[t.Joystick1Button16=366]="Joystick1Button16",t[t.Joystick1Button17=367]="Joystick1Button17",t[t.Joystick1Button18=368]="Joystick1Button18",t[t.Joystick1Button19=369]="Joystick1Button19",t[t.Joystick2Button0=370]="Joystick2Button0",t[t.Joystick2Button1=371]="Joystick2Button1",t[t.Joystick2Button2=372]="Joystick2Button2",t[t.Joystick2Button3=373]="Joystick2Button3",t[t.Joystick2Button4=374]="Joystick2Button4",t[t.Joystick2Button5=375]="Joystick2Button5",t[t.Joystick2Button6=376]="Joystick2Button6",t[t.Joystick2Button7=377]="Joystick2Button7",t[t.Joystick2Button8=378]="Joystick2Button8",t[t.Joystick2Button9=379]="Joystick2Button9",t[t.Joystick2Button10=380]="Joystick2Button10",t[t.Joystick2Button11=381]="Joystick2Button11",t[t.Joystick2Button12=382]="Joystick2Button12",t[t.Joystick2Button13=383]="Joystick2Button13",t[t.Joystick2Button14=384]="Joystick2Button14",t[t.Joystick2Button15=385]="Joystick2Button15",t[t.Joystick2Button16=386]="Joystick2Button16",t[t.Joystick2Button17=387]="Joystick2Button17",t[t.Joystick2Button18=388]="Joystick2Button18",t[t.Joystick2Button19=389]="Joystick2Button19",t[t.Joystick3Button0=390]="Joystick3Button0",t[t.Joystick3Button1=391]="Joystick3Button1",t[t.Joystick3Button2=392]="Joystick3Button2",t[t.Joystick3Button3=393]="Joystick3Button3",t[t.Joystick3Button4=394]="Joystick3Button4",t[t.Joystick3Button5=395]="Joystick3Button5",t[t.Joystick3Button6=396]="Joystick3Button6",t[t.Joystick3Button7=397]="Joystick3Button7",t[t.Joystick3Button8=398]="Joystick3Button8",t[t.Joystick3Button9=399]="Joystick3Button9",t[t.Joystick3Button10=400]="Joystick3Button10",t[t.Joystick3Button11=401]="Joystick3Button11",t[t.Joystick3Button12=402]="Joystick3Button12",t[t.Joystick3Button13=403]="Joystick3Button13",t[t.Joystick3Button14=404]="Joystick3Button14",t[t.Joystick3Button15=405]="Joystick3Button15",t[t.Joystick3Button16=406]="Joystick3Button16",t[t.Joystick3Button17=407]="Joystick3Button17",t[t.Joystick3Button18=408]="Joystick3Button18",t[t.Joystick3Button19=409]="Joystick3Button19",t[t.Joystick4Button0=410]="Joystick4Button0",t[t.Joystick4Button1=411]="Joystick4Button1",t[t.Joystick4Button2=412]="Joystick4Button2",t[t.Joystick4Button3=413]="Joystick4Button3",t[t.Joystick4Button4=414]="Joystick4Button4",t[t.Joystick4Button5=415]="Joystick4Button5",t[t.Joystick4Button6=416]="Joystick4Button6",t[t.Joystick4Button7=417]="Joystick4Button7",t[t.Joystick4Button8=418]="Joystick4Button8",t[t.Joystick4Button9=419]="Joystick4Button9",t[t.Joystick4Button10=420]="Joystick4Button10",t[t.Joystick4Button11=421]="Joystick4Button11",t[t.Joystick4Button12=422]="Joystick4Button12",t[t.Joystick4Button13=423]="Joystick4Button13",t[t.Joystick4Button14=424]="Joystick4Button14",t[t.Joystick4Button15=425]="Joystick4Button15",t[t.Joystick4Button16=426]="Joystick4Button16",t[t.Joystick4Button17=427]="Joystick4Button17",t[t.Joystick4Button18=428]="Joystick4Button18",t[t.Joystick4Button19=429]="Joystick4Button19",t[t.Joystick5Button0=430]="Joystick5Button0",t[t.Joystick5Button1=431]="Joystick5Button1",t[t.Joystick5Button2=432]="Joystick5Button2",t[t.Joystick5Button3=433]="Joystick5Button3",t[t.Joystick5Button4=434]="Joystick5Button4",t[t.Joystick5Button5=435]="Joystick5Button5",t[t.Joystick5Button6=436]="Joystick5Button6",t[t.Joystick5Button7=437]="Joystick5Button7",t[t.Joystick5Button8=438]="Joystick5Button8",t[t.Joystick5Button9=439]="Joystick5Button9",t[t.Joystick5Button10=440]="Joystick5Button10",t[t.Joystick5Button11=441]="Joystick5Button11",t[t.Joystick5Button12=442]="Joystick5Button12",t[t.Joystick5Button13=443]="Joystick5Button13",t[t.Joystick5Button14=444]="Joystick5Button14",t[t.Joystick5Button15=445]="Joystick5Button15",t[t.Joystick5Button16=446]="Joystick5Button16",t[t.Joystick5Button17=447]="Joystick5Button17",t[t.Joystick5Button18=448]="Joystick5Button18",t[t.Joystick5Button19=449]="Joystick5Button19",t[t.Joystick6Button0=450]="Joystick6Button0",t[t.Joystick6Button1=451]="Joystick6Button1",t[t.Joystick6Button2=452]="Joystick6Button2",t[t.Joystick6Button3=453]="Joystick6Button3",t[t.Joystick6Button4=454]="Joystick6Button4",t[t.Joystick6Button5=455]="Joystick6Button5",t[t.Joystick6Button6=456]="Joystick6Button6",t[t.Joystick6Button7=457]="Joystick6Button7",t[t.Joystick6Button8=458]="Joystick6Button8",t[t.Joystick6Button9=459]="Joystick6Button9",t[t.Joystick6Button10=460]="Joystick6Button10",t[t.Joystick6Button11=461]="Joystick6Button11",t[t.Joystick6Button12=462]="Joystick6Button12",t[t.Joystick6Button13=463]="Joystick6Button13",t[t.Joystick6Button14=464]="Joystick6Button14",t[t.Joystick6Button15=465]="Joystick6Button15",t[t.Joystick6Button16=466]="Joystick6Button16",t[t.Joystick6Button17=467]="Joystick6Button17",t[t.Joystick6Button18=468]="Joystick6Button18",t[t.Joystick6Button19=469]="Joystick6Button19",t[t.Joystick7Button0=470]="Joystick7Button0",t[t.Joystick7Button1=471]="Joystick7Button1",t[t.Joystick7Button2=472]="Joystick7Button2",t[t.Joystick7Button3=473]="Joystick7Button3",t[t.Joystick7Button4=474]="Joystick7Button4",t[t.Joystick7Button5=475]="Joystick7Button5",t[t.Joystick7Button6=476]="Joystick7Button6",t[t.Joystick7Button7=477]="Joystick7Button7",t[t.Joystick7Button8=478]="Joystick7Button8",t[t.Joystick7Button9=479]="Joystick7Button9",t[t.Joystick7Button10=480]="Joystick7Button10",t[t.Joystick7Button11=481]="Joystick7Button11",t[t.Joystick7Button12=482]="Joystick7Button12",t[t.Joystick7Button13=483]="Joystick7Button13",t[t.Joystick7Button14=484]="Joystick7Button14",t[t.Joystick7Button15=485]="Joystick7Button15",t[t.Joystick7Button16=486]="Joystick7Button16",t[t.Joystick7Button17=487]="Joystick7Button17",t[t.Joystick7Button18=488]="Joystick7Button18",t[t.Joystick7Button19=489]="Joystick7Button19",t[t.Joystick8Button0=490]="Joystick8Button0",t[t.Joystick8Button1=491]="Joystick8Button1",t[t.Joystick8Button2=492]="Joystick8Button2",t[t.Joystick8Button3=493]="Joystick8Button3",t[t.Joystick8Button4=494]="Joystick8Button4",t[t.Joystick8Button5=495]="Joystick8Button5",t[t.Joystick8Button6=496]="Joystick8Button6",t[t.Joystick8Button7=497]="Joystick8Button7",t[t.Joystick8Button8=498]="Joystick8Button8",t[t.Joystick8Button9=499]="Joystick8Button9",t[t.Joystick8Button10=500]="Joystick8Button10",t[t.Joystick8Button11=501]="Joystick8Button11",t[t.Joystick8Button12=502]="Joystick8Button12",t[t.Joystick8Button13=503]="Joystick8Button13",t[t.Joystick8Button14=504]="Joystick8Button14",t[t.Joystick8Button15=505]="Joystick8Button15",t[t.Joystick8Button16=506]="Joystick8Button16",t[t.Joystick8Button17=507]="Joystick8Button17",t[t.Joystick8Button18=508]="Joystick8Button18",t[t.Joystick8Button19=509]="Joystick8Button19"}(t.KeyCode||(t.KeyCode={}))}(t.event||(t.event={}))}(gd3d||(gd3d={}));var gd3d;!function(t){!function(e){var a=function(t){function InputEvent(){return null!==t&&t.apply(this,arguments)||this}return __extends(InputEvent,t),InputEvent.prototype.OnEnum_key=function(t,a,r){this.On(e.KeyEventEnum[t],a,r)},InputEvent.prototype.EmitEnum_key=function(a){for(var r=[],i=1;i<arguments.length;i++)r[i-1]=arguments[i];t.prototype.Emit.call(this,e.KeyEventEnum[a],r)},InputEvent.prototype.OnEnum_point=function(t,a,r){this.On(e.PointEventEnum[t],a,r)},InputEvent.prototype.EmitEnum_point=function(a){for(var r=[],i=1;i<arguments.length;i++)r[i-1]=arguments[i];t.prototype.Emit.call(this,e.PointEventEnum[a],r)},InputEvent}(t.AEvent);e.InputEvent=a}(t.event||(t.event={}))}(gd3d||(gd3d={}));var gd3d;!function(t){!function(e){var a=function(t){function UIEvent(){return null!==t&&t.apply(this,arguments)||this}return __extends(UIEvent,t),UIEvent.prototype.OnEnum=function(t,a,r){this.On(e.UIEventEnum[t],a,r)},UIEvent.prototype.EmitEnum=function(a){for(var r=[],i=1;i<arguments.length;i++)r[i-1]=arguments[i];t.prototype.Emit.call(this,e.UIEventEnum[a],r)},UIEvent}(t.AEvent);e.UIEvent=a}(t.event||(t.event={}))}(gd3d||(gd3d={}));var gd3d;!function(t){!function(e){var a=function(){return function pointinfo(){this.touch=!1}}();e.pointinfo=a;var r=function(){function inputMgr(e){this._element=null,this._buttons=[!1,!1,!1],this._lastbuttons=[!1,!1,!1],this.eventer=new t.event.InputEvent,this.inputlast=null,this.keyboardMap={},this.handlers=[],this._wheel=0,this._point=new a,this._touches={},this.rMtr_90=new t.math.matrix3x2,this.rMtr_n90=new t.math.matrix3x2,this.moveTolerance=2,this.lastTouch=!1,this.hasPointDown=!1,this.hasPointUP=!1,this.hasPointMove=!1,this.downPoint=new t.math.vector2,this.lastPoint=new t.math.vector2,this.hasKeyDown=!1,this.hasKeyUp=!1,this.hasWheel=!1,this.lastWheel=0,this._contextMenu=function(t){t.preventDefault()},this.app=e,t.math.matrix3x2MakeRotate(90*Math.PI/180,this.rMtr_90),t.math.matrix3x2MakeRotate(-90*Math.PI/180,this.rMtr_n90),this.handlers.push(["touchstart",this._touchstart.bind(this)]),this.handlers.push(["touchmove",this._touchmove.bind(this)]),this.handlers.push(["touchend",this._touchend.bind(this)]),this.handlers.push(["touchcancel",this._touchcancel.bind(this)]),this.handlers.push(["mousedown",this._mousedown.bind(this)]),this.handlers.push(["mouseup",this._mouseup.bind(this)]),this.handlers.push(["mousemove",this._mousemove.bind(this)]),this.handlers.push(["mousewheel",this._mousewheel.bind(this)]),this.handlers.push(["DOMMouseScroll",this._mousewheel.bind(this)]),this.handlers.push(["keydown",this._keydown.bind(this)]),this.handlers.push(["keyup",this._keyup.bind(this)]),this.handlers.push(["blur",this._blur.bind(this)]),this.attach(e.webgl.canvas),this.disableContextMenu()}return Object.defineProperty(inputMgr.prototype,"wheel",{get:function(){return this._wheel},enumerable:!0,configurable:!0}),Object.defineProperty(inputMgr.prototype,"point",{get:function(){return this._point},enumerable:!0,configurable:!0}),Object.defineProperty(inputMgr.prototype,"touches",{get:function(){return this._touches},enumerable:!0,configurable:!0}),inputMgr.prototype.attach=function(t){var e=this;this._element&&this.detach(),this._element=t,this.handlers.forEach(function(t){t&&e._element.addEventListener(t[0],t[1],!1)})},inputMgr.prototype.detach=function(){var t=this;this._element&&(this.handlers.forEach(function(e){e&&t._element.removeEventListener(e[0],e[1],!1)}),this._element=null)},inputMgr.prototype._mousedown=function(t){this.CalcuPoint(t.offsetX,t.offsetY),this._buttons[t.button]=!0,this._point.touch=!0},inputMgr.prototype._mouseup=function(t){this._buttons[t.button]=!1,this._point.touch=!1},inputMgr.prototype._mousemove=function(t){this.CalcuPoint(t.offsetX,t.offsetY)},inputMgr.prototype._mousewheel=function(t){this.hasWheel=!0,t.detail?this.lastWheel=-1*t.detail:t.wheelDelta?this.lastWheel=t.wheelDelta/120:this.lastWheel=0},inputMgr.prototype._touchstart=function(t){this.CalcuPoint(t.touches[0].clientX,t.touches[0].clientY),this._point.touch=!0;for(var e=0;e<t.changedTouches.length;e++){var r=t.changedTouches[e],i=r.identifier;null==this._touches[i]&&(this._touches[i]=new a,this._touches[i].id=i),this._touches[i].touch=!0,this._touches[i].x=r.clientX,this._touches[i].y=r.clientY}},inputMgr.prototype._touchmove=function(t){for(var e=0;e<t.changedTouches.length;e++){var r=t.changedTouches[e],i=r.identifier;null==this._touches[i]&&(this._touches[i]=new a,this._touches[i].id=i),this._touches[i].touch=!0,this._touches[i].x=r.clientX,this._touches[i].y=r.clientY}var o=0,n=0,s=0;for(var l in this._touches)1==this._touches[l].touch&&(n+=this._touches[l].x,s+=this._touches[l].y,o++);this.CalcuPoint(n/o,s/o)},inputMgr.prototype._touchend=function(t){for(var e=0;e<t.changedTouches.length;e++){var r=t.changedTouches[e].identifier;null==this._touches[r]&&(this._touches[r]=new a,this._touches[r].id=r),this._touches[r].touch=!1}for(var i in this._touches)if(1==this._touches[i].touch)return;this._point.touch=!1},inputMgr.prototype._touchcancel=function(t){for(var e=0;e<t.changedTouches.length;e++){var r=t.changedTouches[e].identifier;null==this._touches[r]&&(this._touches[r]=new a,this._touches[r].id=r),this._touches[r].touch=!1}for(var i in this._touches)if(1==this._touches[i].touch)return;this._point.touch=!1},inputMgr.prototype._keydown=function(t){this.hasKeyDown=this.keyboardMap[t.keyCode]=!0},inputMgr.prototype._keyup=function(t){delete this.keyboardMap[t.keyCode],this.hasKeyUp=!0},inputMgr.prototype._blur=function(t){this._point.touch=!1},inputMgr.prototype.update=function(t){this._lastbuttons[0]=this._buttons[0],this._lastbuttons[1]=this._buttons[1],this._lastbuttons[2]=this._buttons[2],this._wheel=0,this.mouseWheelCk(),this.pointCk(),this.keyCodeCk()},inputMgr.prototype.pointCk=function(){var e=this._point;this.lastPoint.x==e.x&&this.lastPoint.y==e.y||this.eventer.EmitEnum_point(t.event.PointEventEnum.PointMove,e.x,e.y),!this.lastTouch&&e.touch?(this.hasPointDown=!0,this.downPoint.x=e.x,this.downPoint.y=e.y,this.eventer.EmitEnum_point(t.event.PointEventEnum.PointDown,e.x,e.y)):this.lastTouch&&!e.touch&&(this.hasPointUP=!0,this.eventer.EmitEnum_point(t.event.PointEventEnum.PointUp,e.x,e.y)),this.hasPointUP&&this.hasPointDown&&(Math.abs(this.downPoint.x-e.x)>this.moveTolerance||Math.abs(this.downPoint.y-e.y)>this.moveTolerance)&&(this.hasPointDown=this.hasPointUP=!1,this.eventer.EmitEnum_point(t.event.PointEventEnum.PointClick,e.x,e.y)),e.touch||(this.hasPointDown=!1),this.lastTouch=e.touch,this.lastPoint.x=e.x,this.lastPoint.y=e.y},inputMgr.prototype.keyCodeCk=function(){this.hasKeyDown&&this.eventer.EmitEnum_key(t.event.KeyEventEnum.KeyDown,null),this.hasKeyUp&&this.eventer.EmitEnum_key(t.event.KeyEventEnum.KeyUp,null),this.hasKeyDown=this.hasKeyUp=!1},inputMgr.prototype.mouseWheelCk=function(){this.hasWheel&&(this._wheel=this.lastWheel,this.eventer.EmitEnum_point(t.event.PointEventEnum.MouseWheel,null)),this.hasWheel=!1,this.lastWheel=0},inputMgr.prototype.isPressed=function(t){return this._buttons[t]},inputMgr.prototype.wasPressed=function(t){return this._buttons[t]&&!this._lastbuttons[t]},inputMgr.prototype.disableContextMenu=function(){this._element&&this._element.addEventListener("contextmenu",this._contextMenu)},inputMgr.prototype.enableContextMenu=function(){this._element&&this._element.removeEventListener("contextmenu",this._contextMenu)},inputMgr.prototype.addPointListener=function(t,e,a){this.eventer.OnEnum_point(t,e,a)},inputMgr.prototype.removePointListener=function(e,a,r){this.eventer.RemoveListener(t.event.PointEventEnum[e],a,r)},inputMgr.prototype.addKeyListener=function(t,e,a){this.eventer.OnEnum_key(t,e,a)},inputMgr.prototype.removeKeyListener=function(e,a,r){this.eventer.RemoveListener(t.event.KeyEventEnum[e],a,r)},inputMgr.prototype.anyKey=function(){if(this._point.touch)return!0;for(var t in this.keyboardMap)if(this.keyboardMap.hasOwnProperty(t)&&1==this.keyboardMap[t])return!0;return!1},inputMgr.prototype.GetKeyDown=function(e){if("number"==typeof e){if(null!=this.keyboardMap[e])return this.keyboardMap[e]}else if("string"==typeof e){var a=t.event.KeyCode[e];if(null!=a&&null!=this.keyboardMap[a])return this.keyboardMap[a]}return!1},inputMgr.prototype.GetKeyUP=function(e){if("number"==typeof e)return!this.keyboardMap[e];if("string"==typeof e){var a=t.event.KeyCode[e];if(null!=a)return!this.keyboardMap[a]}return!1},inputMgr.prototype.KeyDownCount=function(){var t=0;for(var e in this.keyboardMap)this.keyboardMap.hasOwnProperty(e)&&!0===this.keyboardMap[e]&&t++;return t},inputMgr.prototype.CalcuPoint=function(e,a){if(this.app&&!isNaN(e)&&!isNaN(a))if(this.tempV2_0||(this.tempV2_0=t.math.pool.new_vector2()),this.tempV2_1||(this.tempV2_1=t.math.pool.new_vector2()),this.tempV2_0.x=e/this.app.scaleFromPandding,this.tempV2_0.y=a/this.app.scaleFromPandding,t.math.vec2Clone(this.tempV2_0,this.tempV2_1),this.app.shouldRotate)switch(this.app.orientation){case t.framework.OrientationMode.PORTRAIT:t.math.matrix3x2TransformVector2(this.rMtr_90,this.tempV2_0,this.tempV2_1),this._point.x=this.tempV2_1.x+this.app.webgl.canvas.width,this._point.y=this.tempV2_1.y;break;case t.framework.OrientationMode.LANDSCAPE:t.math.matrix3x2TransformVector2(this.rMtr_n90,this.tempV2_0,this.tempV2_1),this._point.x=this.tempV2_1.x,this._point.y=this.tempV2_1.y+this.app.webgl.canvas.height;break;case t.framework.OrientationMode.LANDSCAPE_FLIPPED:t.math.matrix3x2TransformVector2(this.rMtr_90,this.tempV2_0,this.tempV2_1),this._point.x=this.tempV2_1.x+this.app.webgl.canvas.width,this._point.y=this.tempV2_1.y}else this._point.x=this.tempV2_0.x,this._point.y=this.tempV2_0.y},inputMgr}();e.inputMgr=r}(t.framework||(t.framework={}))}(gd3d||(gd3d={}));var gd3d;!function(t){!function(t){var e=function(){function converter(){}return converter.getApplyFun=function(t){return Array.prototype.concat.apply([],t)},converter.ULongToArray=function(t,e,a){void 0===e&&(e=null),void 0===a&&(a=0);var r=t%4294967296,i=t/4294967296|0;return converter.dataView.setUint32(0,r,!0),converter.dataView.setUint32(4,i,!0),new Uint8Array(converter.dataBuffer.subarray(0,8))},converter.LongToArray=function(t,e,a){void 0===e&&(e=null),void 0===a&&(a=0);var r=t%4294967296,i=t/4294967296|0;return converter.dataView.setInt32(0,r,!0),converter.dataView.setInt32(4,i,!0),new Uint8Array(converter.dataBuffer.subarray(0,8))},converter.Float64ToArray=function(t,e,a){return void 0===e&&(e=null),void 0===a&&(a=0),converter.dataView.setFloat64(0,t,!1),new Uint8Array(converter.dataBuffer.subarray(0,8))},converter.Float32ToArray=function(t,e,a){return void 0===e&&(e=null),void 0===a&&(a=0),converter.dataView.setFloat32(0,t,!0),new Uint8Array(converter.dataBuffer.subarray(0,4))},converter.Int32ToArray=function(t,e,a){return void 0===e&&(e=null),void 0===a&&(a=0),converter.dataView.setInt32(0,t,!0),new Uint8Array(converter.dataBuffer.subarray(0,4))},converter.Int16ToArray=function(t,e,a){return void 0===e&&(e=null),void 0===a&&(a=0),converter.dataView.setInt16(0,t,!0),new Uint8Array(converter.dataBuffer.subarray(0,2))},converter.Uint32toArray=function(t,e,a){return void 0===e&&(e=null),void 0===a&&(a=0),converter.dataView.setInt32(0,t,!0),new Uint8Array(converter.dataBuffer.subarray(0,4))},converter.Uint16ToArray=function(t,e,a){return void 0===e&&(e=null),void 0===a&&(a=0),converter.dataView.setUint16(0,t,!0),new Uint8Array(converter.dataBuffer.subarray(0,2))},converter.StringToUtf8Array=function(t){for(var e=[],a=0,r=t.length;a<r;++a){var i=t.charAt(a).charCodeAt(0);if(i>65535)throw new Error("InvalidCharacterError");if(i>128)if(i<2047){var o=i>>>6|192,n=63&i|128;e.push(o,n)}else{var o=i>>>12|224,n=i>>>6&63|128,s=63&i|128;e.push(o,n,s)}else e.push(i)}return new Uint8Array(e)},converter.ArrayToLong=function(t,e){void 0===e&&(e=0),converter.dataBuffer.set(t.subarray(e,e+4));var a=converter.dataView.getInt32(0,!0);return converter.dataBuffer.set(t.subarray(e+4,e+8)),a+=4294967296*converter.dataView.getInt32(4,!0)},converter.ArrayToULong=function(t,e){void 0===e&&(e=0),converter.dataBuffer.set(t.subarray(e,e+4));var a=converter.dataView.getUint32(0,!0);return converter.dataBuffer.set(t.subarray(e+4,e+8)),a+=4294967296*converter.dataView.getUint32(4,!0)},converter.ArrayToFloat64=function(t,e){return void 0===e&&(e=0),converter.dataBuffer.set(t.subarray(e,e+8)),converter.dataView.getFloat64(0,!0)},converter.ArrayToFloat32=function(t,e){return void 0===e&&(e=0),converter.dataBuffer.set(t.subarray(e,e+4)),converter.dataView.getFloat32(0,!0)},converter.ArrayToInt32=function(t,e){return void 0===e&&(e=0),converter.dataBuffer.set(t.subarray(e,e+4)),converter.dataView.getInt32(0,!0)},converter.ArrayToUint32=function(t,e){return void 0===e&&(e=0),converter.dataBuffer.set(t.subarray(e,e+4)),converter.dataView.getUint32(0,!0)},converter.ArrayToInt16=function(t,e){return void 0===e&&(e=0),converter.dataBuffer.set(t.subarray(e,e+2)),converter.dataView.getInt16(0,!0)},converter.ArrayToUint16=function(t,e){return void 0===e&&(e=0),converter.dataBuffer.set(t.subarray(e,e+2)),converter.dataView.getUint16(0,!0)},converter.ArrayToInt8=function(t,e){return void 0===e&&(e=0),t[e]},converter.ArrayToString=function(t,e){void 0===e&&(e=0);for(var a=[],r=0;r<t.length;r++){var i=t[r];if(0==i)break;var o=0;if(i>224)o=(15&i)<<12,o|=(63&(i=t[++r]))<<6,o|=63&(i=t[++r]),a.push(String.fromCharCode(o));else if(i>192)o=(31&i)<<6,o|=(63&(i=t[++r]))<<6,a.push(String.fromCharCode(o));else{if(i>128)return console.warn("InvalidCharacterError"),"";a.push(String.fromCharCode(t[r]))}}return a.join("")},converter.dataBuffer=new Uint8Array(8),converter.dataView=new DataView(converter.dataBuffer.buffer),converter}();t.converter=e;var a=function(){function binTool(t){void 0===t&&(t=void 0),this.r_offset=0,this.w_offset=0,this.buffer=r.Insance.newUint8Array()}return binTool.prototype.ckl=function(){if(this.r_offset>this.w_offset)throw Error("[binTool] 内存读取失败 请检查当前输入的内存")},binTool.prototype.readSingle=function(){this.ckl();var t=e.ArrayToFloat32(this.buffer,this.r_offset);return this.r_offset+=4,t},binTool.prototype.readLong=function(){this.ckl();var t=e.ArrayToLong(this.buffer,this.r_offset);return this.r_offset+=8,t},binTool.prototype.readULong=function(){this.ckl();var t=e.ArrayToULong(this.buffer,this.r_offset);return this.r_offset+=8,t},binTool.prototype.readDouble=function(){this.ckl();var t=e.ArrayToFloat64(this.buffer,this.r_offset);return this.r_offset+=8,t},binTool.prototype.readInt8=function(){this.ckl();var t=this.buffer[this.r_offset];return this.r_offset+=1,t},binTool.prototype.readUInt8=function(){this.ckl();var t=this.buffer[this.r_offset];return this.r_offset+=1,t},binTool.prototype.readInt16=function(){this.ckl();var t=e.ArrayToInt16(this.buffer,this.r_offset);return this.r_offset+=2,t},binTool.prototype.readUInt16=function(){this.ckl();var t=e.ArrayToUint16(this.buffer,this.r_offset);return this.r_offset+=2,t},binTool.prototype.readInt32=function(){this.ckl();var t=e.ArrayToInt32(this.buffer,this.r_offset);return this.r_offset+=4,t},binTool.prototype.readUInt32=function(){this.ckl();var t=e.ArrayToUint32(this.buffer,this.r_offset);return this.r_offset+=4,t},binTool.prototype.readBoolean=function(){this.ckl();var t=0!=this.buffer[this.r_offset];return this.r_offset+=1,t},binTool.prototype.readByte=function(){return this.readUInt8()},binTool.prototype.readUnsignedShort=function(){return this.readUInt16()},binTool.prototype.readUnsignedInt=function(){this.ckl();var t=e.ArrayToUint32(this.buffer,this.r_offset);return this.r_offset+=4,t},binTool.prototype.readFloat=function(){return this.readSingle()},binTool.prototype.readSymbolByte=function(){return this.readInt8()},binTool.prototype.readShort=function(){return this.readInt16()},binTool.prototype.readInt=function(){return this.readInt32()},binTool.prototype.readBytes=function(t){this.ckl();var e=this.buffer.subarray(this.r_offset,this.r_offset+t);return this.r_offset+=t,e},binTool.prototype.readStringUtf8=function(){this.ckl();var t=this.readInt8(),a=this.buffer.subarray(this.r_offset,this.r_offset+t);return this.r_offset+=t,e.ArrayToString(a)},binTool.prototype.readUTFBytes=function(){this.ckl();var t=this.readUInt16();return this.readUTFByLen(t)},binTool.prototype.readUTFByLen=function(t){this.ckl();var a=this.buffer.subarray(this.r_offset,this.r_offset+t);return this.r_offset+=t,e.ArrayToString(a)},binTool.prototype.readStringUtf8FixLength=function(t){this.ckl();var a=this.buffer.subarray(this.r_offset,this.r_offset+t);return this.r_offset+=t,e.ArrayToString(a)},binTool.prototype.readStringAnsi=function(){this.ckl();for(var t=this.readUInt8(),e="",a=0;a<t;a++)e+=String.fromCharCode(this.readByte());return e},binTool.prototype.getLength=function(){return this.w_offset},binTool.prototype.getBytesAvailable=function(){return this.w_offset},Object.defineProperty(binTool.prototype,"length",{get:function(){return this.w_offset},enumerable:!0,configurable:!0}),binTool.prototype.writeInt8=function(t){this.write(t)},binTool.prototype.writeUInt8=function(t){this.write(t)},binTool.prototype.writeInt16=function(t){this.write(e.Int16ToArray(t))},binTool.prototype.writeUInt16=function(t){this.write(e.Uint16ToArray(t))},binTool.prototype.writeInt32=function(t){this.write(e.Int32ToArray(t))},binTool.prototype.writeUInt32=function(t){this.write(e.Uint32toArray(t))},binTool.prototype.writeSingle=function(t){this.write(e.Float32ToArray(t))},binTool.prototype.writeLong=function(t){this.write(e.LongToArray(t))},binTool.prototype.writeULong=function(t){this.write(e.ULongToArray(t))},binTool.prototype.writeDouble=function(t){this.write(e.Float64ToArray(t))},binTool.prototype.writeStringAnsi=function(t){var e=t.length;this.writeUInt8(e);for(var a=0;a<e;a++)this.writeUInt8(t.charCodeAt(a))},binTool.prototype.writeStringUtf8=function(t){var a=e.StringToUtf8Array(t);this.writeUInt8(a.length),this.write(a)},binTool.prototype.writeStringUtf8DataOnly=function(t){var a=e.StringToUtf8Array(t);this.write(a)},binTool.prototype.writeByte=function(t){this.write(t)},binTool.prototype.writeBytes=function(t,e,a){void 0===e&&(e=0),void 0===a&&(a=-1),this.write(t,e,a)},binTool.prototype.writeUint8Array=function(t,e,a){void 0===e&&(e=0),void 0===a&&(a=-1),this.write(t,e,a)},binTool.prototype.writeUnsignedShort=function(t){this.write(e.Uint16ToArray(t))},binTool.prototype.writeUnsignedInt=function(t){this.write(e.Uint32toArray(t))},binTool.prototype.writeFloat=function(t){this.write(e.Float32ToArray(t))},binTool.prototype.writeUTFBytes=function(t){this.write(e.StringToUtf8Array(t))},binTool.prototype.writeSymbolByte=function(t){this.write(t)},binTool.prototype.writeShort=function(t){this.write(e.Int16ToArray(t))},binTool.prototype.writeInt=function(t){this.write(e.Int32ToArray(t))},binTool.prototype.write=function(t,e,a){if(void 0===e&&(e=0),void 0===a&&(a=-1),void 0!=t.byteLength)this.buffer.byteLength<t.length?this.buffer=t:this.buffer.length>t.length+this.w_offset?this.buffer.set(t,this.w_offset):((r=new Uint8Array(t.length+this.w_offset)).set(this.buffer),r.set(t,this.w_offset),this.buffer=r),this.w_offset+=t.byteLength;else if(void 0!=t.length){if(this.buffer.byteLength<t.length)this.buffer=new Uint8Array(t);else if(this.buffer.length>t.length+this.w_offset)this.buffer.set(t,this.w_offset);else{var r=new Uint8Array(t.length+this.w_offset);r.set(this.buffer),r.set(t,this.w_offset),this.buffer=r}this.w_offset+=t.length}else this.buffer[this.w_offset]=t,this.w_offset+=1},binTool.prototype.dispose=function(){1024==this.buffer.byteLength&&r.Insance.deleteUint8Array(this.buffer),this.buffer=null},binTool.prototype.getBuffer=function(){return new Uint8Array(this.buffer.subarray(0,this.w_offset))},binTool.prototype.getUint8Array=function(){return new Uint8Array(this.buffer.subarray(0,this.w_offset))},binTool}();t.binTool=a;var r=function(){function memoryPool(){this.pool=new Array}return Object.defineProperty(memoryPool,"Insance",{get:function(){return this.instnace||(this.instnace=new memoryPool),memoryPool.instnace},enumerable:!0,configurable:!0}),memoryPool.prototype.newUint8Array=function(){return this.pool.length>0?this.pool.shift():new Uint8Array(1024)},memoryPool.prototype.deleteUint8Array=function(t){this.pool.push(t)},memoryPool}()}(t.io||(t.io={}))}(gd3d||(gd3d={}));var gd3d;!function(t){!function(e){function fillCloneReference(e,a){var r,i=t.framework.HideFlags.None;if(e.__gdmeta__&&e.__gdmeta__.class&&(r=t.reflect.getClassName(e)),"transform"==r?i=e.gameObject.hideFlags:"transform2D"==r&&(i=e.hideFlags),i&t.framework.HideFlags.DontSaveInBuild||i&t.framework.HideFlags.DontSaveInEditor||i&t.framework.HideFlags.HideInHierarchy)return null;for(var o in e.__gdmeta__){var n=e.__gdmeta__[o];if(null!=n.custom&&(null!=n.custom.SerializeField||null!=n.custom.nodecomp||null!=n.custom["2dcomp"])){var s=n.custom.valueType;if(null!=s)switch(s.toLowerCase()){case"number":case"string":case"boolean":break;default:fillCloneReferenceTypeOrArray(e,a,o)}}}return a}function fillCloneReferenceTypeOrArray(t,e,a){if(t[a])if(t[a].__gdmeta__)fillCloneReferenceType(t,e,a);else if(t.__gdmeta__[a]&&t.__gdmeta__[a].custom&&t.__gdmeta__[a].custom.valueType){for(var r in t[a]){var i=t[a][r];if(i&&i.__gdmeta__){var o=i.__gdmeta__;o.class&&"UniformData"==o.class.typename&&3==i.type||fillCloneReferenceType(t[a],e[a],r,t,e,a)}}if(e.waitDelArray){for(var n=e[a],s=0,l=e.waitDelArray;s<l.length;s++){var h=l[s];n.splice(h,1)}delete e.waitDelArray}}}function fillCloneReferenceType(t,a,r,i,o,n){void 0===i&&(i=null),void 0===o&&(o=null),void 0===n&&(n="");var s=t[r].__gdmeta__;if(s.class&&s.class.custom&&(s.class.custom.SerializeType||s.class.custom.nodecomp||s.class.custom["2dcomp"])){var l=t instanceof Array,h=s.class.typename;if(e.isAsset(h));else{var c=!1,u=-1,d=void 0;(l&&i.__gdmeta__&&i.__gdmeta__.class&&i.__gdmeta__.class.custom&&(i.__gdmeta__.class.custom.nodecomp||i.__gdmeta__.class.custom["2dcomp"])||!l&&t.__gdmeta__&&t.__gdmeta__.class&&t.__gdmeta__.class.custom&&(t.__gdmeta__.class.custom.nodecomp||t.__gdmeta__.class.custom["2dcomp"]))&&(s.class.custom.nodecomp?(u=t[r].gameObject.transform.insId.getInsID(),c=!0,d=e.referenceInfo.oldmap[u].gameObject.getComponent(h)):s.class.custom["2dcomp"]?(u=t[r].transform.insId.getInsID(),c=!0,d=e.referenceInfo.oldmap[u].getComponent(h)):"transform"!=h&&"transform2D"!=h||(u=t[r].insId.getInsID(),c=!0,d=e.referenceInfo.oldmap[u])),c?l?a.push(d):a[r]=d:a[r]?fillCloneReference(t[r],a[r]):(o.waitDelArray||(o.waitDelArray=[]),o.waitDelArray.push(parseInt(r)))}}}function _cloneObj(a,r){if(void 0===r&&(r=void 0),void 0==r){var i=-1;r=t.reflect.createInstance(a,null),a.__gdmeta__.class.custom.nodecomp?i=a.gameObject.transform.insId.getInsID():a.__gdmeta__.class.custom["2dcomp"]?i=a.transform.insId.getInsID():"transform"!=a.__gdmeta__.class.typename&&"transform2D"!=a.__gdmeta__.class.typename||(i=a.insId.getInsID(),e.referenceInfo.oldmap[i]=r)}for(var o in a.__gdmeta__){var n=a.__gdmeta__[o];if(null!=n.custom&&(null!=n.custom.SerializeField||null!=n.custom.nodecomp||null!=n.custom["2dcomp"])){var s=n.custom.valueType;if(null!=s)switch(s.toLowerCase()){case"number":case"string":case"boolean":r[o]=a[o];break;default:cloneOtherTypeOrArray(a,r,o)}}}return r}function cloneOtherTypeOrArray(t,e,a){if(t[a])if(t[a].__gdmeta__)cloneOtherType(t,e,a);else if(t.__gdmeta__[a]&&t.__gdmeta__[a].custom&&t.__gdmeta__[a].custom.valueType){var r=t[a]instanceof Array;e[a]=r?[]:{};for(var i in t[a]){var o=t[a][i];if(o&&o.__gdmeta__){var n=o.__gdmeta__;n.class&&"UniformData"==n.class.typename&&3==o.type||cloneOtherType(t[a],e[a],i,t,e,a)}else if(!t[a].__gdmeta__)switch((typeof o).toLowerCase()){case"number":case"string":case"boolean":r?e[a].push(o):e[a][i]=o}}}}function cloneOtherType(a,r,i,o,n,s){void 0===o&&(o=null),void 0===n&&(n=null),void 0===s&&(s="");var l=a[i].__gdmeta__;if(l.class&&l.class.custom&&(l.class.custom.SerializeType||l.class.custom.nodecomp||l.class.custom["2dcomp"])){var h=a instanceof Array,c=l.class.typename;if(e.isAsset(c)){a[i].defaultAsset;a[i].use&&a[i].use(),h?r.push(a[i]):r[i]=a[i]}else{var u=!1;if((h&&o.__gdmeta__&&o.__gdmeta__.class&&o.__gdmeta__.class.custom&&(o.__gdmeta__.class.custom.nodecomp||o.__gdmeta__.class.custom["2dcomp"])||!h&&a.__gdmeta__&&a.__gdmeta__.class&&a.__gdmeta__.class.custom&&(a.__gdmeta__.class.custom.nodecomp||a.__gdmeta__.class.custom["2dcomp"]))&&(l.class.custom.nodecomp||l.class.custom["2dcomp"]||"transform"==c||"transform2D"==c)&&(u=!0),u);else{var d=void 0;null!=(d=l.class.custom.selfclone?a[i].clone():_cloneObj(a[i],r[i]))?h?"nodeComponent"==c&&"components"==s&&"gameObject"==t.reflect.getClassName(o)?n.addComponentDirect(d.comp):"transform"==c&&"children"==s&&"transform"==t.reflect.getClassName(o)?n.addChild(d):"C2DComponent"==c&&"components"==s&&"transform2D"==t.reflect.getClassName(o)?n.addComponentDirect(d.comp):"transform2D"==c&&"children"==s&&"transform2D"==t.reflect.getClassName(o)?n.addChild(d):r.push(d):r[i]=d:h&&r.push(null)}}}}e.cloneObj=function cloneObj(t,a){return void 0===a&&(a=void 0),e.referenceInfo.oldmap={},a=_cloneObj(t,a),e.referenceInfo.oldmap[t.insId.getInsID()]=a,fillCloneReference(t,a),a},e.fillCloneReference=fillCloneReference,e.fillCloneReferenceTypeOrArray=fillCloneReferenceTypeOrArray,e.fillCloneReferenceType=fillCloneReferenceType,e._cloneObj=_cloneObj,e.cloneOtherTypeOrArray=cloneOtherTypeOrArray,e.cloneOtherType=cloneOtherType}(t.io||(t.io={}))}(gd3d||(gd3d={}));var gd3d;!function(t){!function(t){function stringToUtf8Array(t){for(var e=[],a=0;a<t.length;a++){var r=t.charAt(a).charCodeAt(0);if(r>65535)throw new Error("InvalidCharacterError");if(r>128)if(r<2047){var i=r>>>6|192,o=63&r|128;e.push(i,o)}else{var i=r>>>12|224,o=r>>>6&63|128,n=63&r|128;e.push(i,o,n)}else e.push(r)}return e}t.stringToBlob=function stringToBlob(t){var e=new Uint8Array(stringToUtf8Array(t));return new Blob([e])},t.stringToUtf8Array=stringToUtf8Array}(t.io||(t.io={}))}(gd3d||(gd3d={}));var gd3d;!function(t){!function(e){function serializeObjForInspector(e,a,r){void 0===r&&(r=void 0);var i,n=t.framework.HideFlags.None;if(boolInNull(e))throw new Error("必须传入一个实例，用来赋值");if(e.__gdmeta__&&e.__gdmeta__.class&&(i=t.reflect.getClassName(e)),"transform"==i&&e.gameObject?n=e.gameObject.hideFlags:"transform2D"==i&&(n=e.hideFlags),n&t.framework.HideFlags.HideInInspector)return null;void 0==r&&(r={});for(var s in e.__gdmeta__)if("children"!=s){var l=e.__gdmeta__[s];if(!boolInNull(l)&&null!=l.custom&&(null!=l.custom.SerializeField||null!=l.custom.nodecomp||null!=l.custom["2dcomp"])){var h=l.custom.valueType;if(null!=h)switch(h.toLowerCase()){case"number":case"string":case"boolean":var c=new o(e[s],h);l.custom.FieldUIStyle&&(c.UIStyle=l.custom.FieldUIStyle),l.custom.defvalue&&(c.defvalue=l.custom.defvalue),l.custom.min&&(c.min=l.custom.min),l.custom.max&&(c.max=l.custom.max),r[s]=c;break;default:serializeOtherTypeOrArrayForInspector(e,r,s,a)}}}return r}function serializeOtherTypeOrArrayForInspector(t,e,a,r){if(boolInNull(t))throw new Error("必须传入一个实例，用来赋值");if(boolInNull(e))throw new Error("必须传入一个实例，用来赋值");if(t[a]){if(t[a].__gdmeta__)serializeOtherTypeForInspector(t,e,a,r);else if(t.__gdmeta__&&t.__gdmeta__[a]&&t.__gdmeta__[a].custom&&t.__gdmeta__[a].custom.valueType){var i=t[a]instanceof Array;e[a]=i?new o([],t.__gdmeta__[a].custom.valueType):new o({},t.__gdmeta__[a].custom.valueType);for(var n in t[a])if(null!=t[a][n]&&void 0!=t[a][n])if(t[a][n].__gdmeta__){var s=t[a][n].__gdmeta__;s.class&&"UniformData"==s.class.typename&&3==t[a][n].type||serializeOtherTypeForInspector(t[a],e[a].value,n,r,t)}else if(!t[a].__gdmeta__){var l=typeof t[a][n];switch(l.toLowerCase()){case"number":case"string":case"boolean":if(boolInNull(e[a].value))continue;var h=new o(t[a][n],l);i?e[a].value.push(h):e[a].value[n]=h}}}}else{var c=t instanceof Array;if(t.__gdmeta__&&t.__gdmeta__[a]&&t.__gdmeta__[a].custom){var u=t.__gdmeta__[a].custom;if(u.valueType){var d=new o(null,u.valueType);u.FieldUIStyle&&(d.UIStyle=u.FieldUIStyle),u.defvalue&&(d.defvalue=u.defvalue),u.min&&(d.min=u.min),u.max&&(d.max=u.max),c?e.push(d):e[a]=d}}}}function serializeOtherTypeForInspector(t,e,a,r,i){if(void 0===i&&(i=null),boolInNull(t))throw new Error("必须传入一个实例，用来赋值");if(boolInNull(e))throw new Error("必须传入一个实例，用来赋值");if(boolInNull(t[a])||boolInNull(t[a].__gdmeta__))throw new Error("必须传入一个实例，用来赋值");var s=t[a].__gdmeta__;if(s.class&&s.class.custom&&(s.class.custom.SerializeType||s.class.custom.nodecomp||s.class.custom["2dcomp"])){var l=t instanceof Array,h=s.class.typename;if(isAssetInspector(h)){var c=t[a].defaultAsset,u=t[a].getName();if(null!=u){c&&(u="SystemDefaultAsset-"+u);f=new o(u,h);l?e.push(f):e[a]=f}}else{var d=!1,m=-1;if(l&&i.__gdmeta__&&i.__gdmeta__.class&&i.__gdmeta__.class.custom&&(i.__gdmeta__.class.custom.nodecomp||i.__gdmeta__.class.custom["2dcomp"])||!l&&t.__gdmeta__&&t.__gdmeta__.class&&t.__gdmeta__.class.custom&&(t.__gdmeta__.class.custom.nodecomp||t.__gdmeta__.class.custom["2dcomp"]))if(r=!0,s.class.custom.nodecomp)m=t[a].gameObject.transform.insId.getInsID(),d=!0;else if(s.class.custom["2dcomp"])m=t[a].transform.insId.getInsID(),d=!0;else if("transform"==h||"transform2D"==h)m=t[a].insId.getInsID(),d=!0;else if(!n.isRegType(h))return;if(d){f=new o(m,h,"reference");if(t.__gdmeta__&&t.__gdmeta__[a]&&t.__gdmeta__[a].custom&&t.__gdmeta__[a].custom.FieldUIStyle){g=t.__gdmeta__[a].custom;f.UIStyle=t.__gdmeta__[a].custom.FieldUIStyle,g.defvalue&&(f.defvalue=g),g.min&&(f.min=g.min),g.max&&(f.max=g.max)}l?e.push(f):e[a]=f}else{if(!n.isRegType(h)&&r)return;var p=serializeObjForInspector(t[a],r,e[a]);if(null!=p){var f=new o(p,h);if(t.__gdmeta__&&t.__gdmeta__[a]&&t.__gdmeta__[a].custom&&t.__gdmeta__[a].custom.FieldUIStyle){var g=t.__gdmeta__[a].custom;f.UIStyle=g.FieldUIStyle,g.defvalue&&(f.defvalue=g),g.min&&(f.min=g.min),g.max&&(f.max=g.max)}l?e.push(f):e[a]=f}}}}}function serializeObj(e,a,r){if(void 0===a&&(a=void 0),void 0===r&&(r=null),boolInNull(e))throw new Error("必须传入一个实例，用来赋值");var o,n=t.framework.HideFlags.None;if(e.__gdmeta__&&e.__gdmeta__.class&&(o=t.reflect.getClassName(e)),"transform"==o?n=e.gameObject.hideFlags:"transform2D"==o&&(n=e.hideFlags),n&t.framework.HideFlags.DontSaveInBuild||n&t.framework.HideFlags.DontSaveInEditor||n&t.framework.HideFlags.HideInHierarchy)return null;void 0==a&&(a=new i({},o),void 0!=e.insId&&(a.insid=e.insId.getInsID()));for(var s in e.__gdmeta__){var l=e.__gdmeta__[s];if(null!=l&&(null!=l.custom&&(null!=l.custom.SerializeField||null!=l.custom.nodecomp||null!=l.custom["2dcomp"]))){var h=l.custom.valueType;if(null!=h)switch(h.toLowerCase()){case"number":case"string":case"boolean":var c=new i(e[s],h);a.value[s]=c;break;default:serializeOtherTypeOrArray(e,a.value,s,r)}}}return a}function serializeOtherTypeOrArray(t,e,a,r){if(void 0===r&&(r=null),boolInNull(t))throw new Error("必须传入一个实例，用来赋值");if(boolInNull(e))throw new Error("必须传入一个实例，用来赋值");if(t[a])if(t[a].__gdmeta__)serializeOtherType(t,e,a,null,r);else if(t.__gdmeta__&&t.__gdmeta__[a]&&t.__gdmeta__[a].custom&&t.__gdmeta__[a].custom.valueType){var o=t[a]instanceof Array;e[a]=o?new i([],t.__gdmeta__[a].custom.valueType):new i({},t.__gdmeta__[a].custom.valueType);for(var n in t[a])if(t[a][n]&&t[a][n].__gdmeta__){var s=t[a][n].__gdmeta__;s.class&&"UniformData"==s.class.typename&&3==t[a][n].type||serializeOtherType(t[a],e[a].value,n,t,r)}else if(!t[a].__gdmeta__){if(null==t[a][n]||void 0==t[a][n])continue;var l=typeof t[a][n];switch(l.toLowerCase()){case"number":case"string":case"boolean":var h=new i(t[a][n],l);e[a].value&&(o?e[a].value.push(h):e[a].value[n]=h)}}}}function serializeOtherType(t,e,a,o,n){if(void 0===o&&(o=null),void 0===n&&(n=null),boolInNull(t||boolInNull(e)))throw new Error("必须传入一个实例，用来赋值");if(boolInNull(t[a])||boolInNull(t[a].__gdmeta__))throw new Error("必须传入一个实例，用来赋值");var s=t[a].__gdmeta__;if(s.class&&s.class.custom&&(s.class.custom.SerializeType||s.class.custom.nodecomp||s.class.custom["2dcomp"])){var l=t instanceof Array,h=s.class.typename;if(isAsset(h)){var c=t[a].defaultAsset,u=t[a].getName();null!=u&&(c?u="SystemDefaultAsset-"+u:n&&r.GetAssetUrl(t[a],n),l?e.push(new i(u,h)):e[a]=new i(u,h))}else{var d=!1,m=-1;if((l&&o.__gdmeta__&&o.__gdmeta__.class&&o.__gdmeta__.class.custom&&(o.__gdmeta__.class.custom.nodecomp||o.__gdmeta__.class.custom["2dcomp"])||!l&&t.__gdmeta__&&t.__gdmeta__.class&&t.__gdmeta__.class.custom&&(t.__gdmeta__.class.custom.nodecomp||t.__gdmeta__.class.custom["2dcomp"]))&&(s.class.custom.nodecomp?(t[a]&&t[a].gameObject&&(m=t[a].gameObject.transform.insId.getInsID()),d=!0):s.class.custom["2dcomp"]?(t[a]&&t[a].transform&&(m=t[a].transform.insId.getInsID()),d=!0):"transform"!=h&&"transform2D"!=h||(t[a]&&(m=t[a].insId.getInsID()),d=!0)),d)l?e.push(new i(m,h,"reference")):e[a]=new i(m,h,"reference");else{var p=serializeObj(t[a],e[a],n);null!=p&&(l?e.push(p):e[a]=p)}}}}function fillReference(t,e){if(boolInNull(e)||boolInNull(e.__gdmeta__))throw new Error("必须传入一个实例，用来赋值");for(var a in e.__gdmeta__){var r=e.__gdmeta__[a];if(!boolInNull(r)&&(null!=r.custom&&(null!=r.custom.SerializeField||null!=r.custom.nodecomp||null!=r.custom["2dcomp"]))){var i=r.custom.valueType;if(null!=i)switch(i.toLowerCase()){case"number":case"string":case"boolean":break;default:dofillReferenceOrArray(t,e,a)}}}}function dofillReferenceOrArray(t,e,a){if(boolInNull(t)||boolInNull(e))throw new Error("必须传入一个实例，用来赋值");if(t[a])if(isArrayOrDic(t[a].type.toLowerCase())){var r=t[a].value instanceof Array;e[a]||(e[a]=r?[]:{});var i=null;if(boolInNull(e.__gdmeta__)&&boolInNull(e.__gdmeta__[a])&&boolInNull(e.__gdmeta__[a].custom)&&e.__gdmeta__[a].custom.valueType!=t[a].type)throw new Error("反序列化失败，类型不匹配："+e.__gdmeta__[a].custom.valueType+" as "+t[a].type);i=t[a].value;for(var o in i)if(!boolInNull(i[o]))switch(i[o].type.toLowerCase()){case"number":case"string":case"boolean":break;default:dofillReference(t[a].value,e[a],o)}}else dofillReference(t,e,a)}function dofillReference(e,a,r){if(boolInNull(a)||boolInNull(e)||boolInNull(e[r]))throw new Error("必须传入一个实例，用来赋值");var i=a instanceof Array,o=e[r].type;if(isAsset(o));else if("reference"==e[r].parse){var s=n.oldmap[e[r].value];"transform"==o||"transform2D"==o||(s instanceof t.framework.transform2D?s=s.getComponent(o):s instanceof t.framework.transform&&(s=s.gameObject.getComponent(o))),i?a.push(s):a[r]=s}else{if(!a[r])return console.warn(e[r].value.comp.type+" 填充值失败");fillReference(e[r].value,a[r])}}function deSerializeObj(t,e,a,r){if(void 0===r&&(r=null),void 0==e)throw new Error("必须传入一个实例，用来赋值");if(boolInNull(e.__gdmeta__))throw new Error("必须传入一个实例，用来赋值");for(var i in e.__gdmeta__){var o=e.__gdmeta__[i];if(!boolInNull(o)&&(null!=o.custom&&(null!=o.custom.SerializeField||null!=o.custom.nodecomp||null!=o.custom["2dcomp"]))){var n=o.custom.valueType;if(null!=n)switch(n.toLowerCase()){case"number":case"string":case"boolean":if(void 0==t[i]||n!=t[i].type)continue;e[i]=t[i].value;break;default:deSerializeOtherTypeOrArray(t,e,i,a,r)}}}}function deSerializeOtherTypeOrArray(e,a,r,i,o){if(void 0===o&&(o=null),boolInNull(e)||boolInNull(a))throw new Error("必须传入一个实例，用来赋值");if(e[r]){var n=e[r].type;if(null==n)throw new Error("必须传入一个实例，用来赋值");if(isArrayOrDic(n.toLowerCase())){var s=e[r].value instanceof Array;a[r]||(a[r]=s?[]:{});var l=null;if(boolInNull(a.__gdmeta__)&&boolInNull(a.__gdmeta__[r])&&boolInNull(a.__gdmeta__[r].custom)&&a.__gdmeta__[r].custom.valueType!=e[r].type)throw new Error("反序列化失败，类型不匹配："+a.__gdmeta__[r].custom.valueType+" as "+e[r].type);l=e[r].value;for(var h in l){var c=l[h].type;switch(c.toLowerCase()){case"number":case"string":case"boolean":if(c!=e[r].value[h].type)throw new Error("反序列化失败，类型不匹配："+c+" as "+e[r].value[h].type);s?a[r].push(e[r].value[h].value):a[r][h]=e[r].value[h].value;break;default:if("nodeComponent"==c&&"components"==r&&"gameObject"==t.reflect.getClassName(a)){d=[];deSerializeOtherType(e[r].value,d,h,i,o),d[0].comp&&a.addComponentDirect(d[0].comp)}else if("transform"==c&&"children"==r&&"transform"==t.reflect.getClassName(a)){var u=[];deSerializeOtherType(e[r].value,u,h,i,o),a.addChild(u[0])}else if("C2DComponent"==c&&"components"==r&&"transform2D"==t.reflect.getClassName(a)){var d=[];deSerializeOtherType(e[r].value,d,h,i,o),d[0].comp&&a.addComponentDirect(d[0].comp)}else if("transform2D"==c&&"children"==r&&"transform2D"==t.reflect.getClassName(a)){var m=[];deSerializeOtherType(e[r].value,m,h,i,o),a.addChild(m[0])}else deSerializeOtherType(e[r].value,a[r],h,i,o)}}}else deSerializeOtherType(e,a,r,i,o)}}function deSerializeOtherType(e,a,r,i,o){if(void 0===o&&(o=null),boolInNull(e)||boolInNull(a)||boolInNull(e[r]))throw new Error("必须传入一个实例，用来赋值");var s=a instanceof Array,l=e[r].type;if(isAsset(l)){var h=e[r].value,c=void 0;h.indexOf("SystemDefaultAsset-")>=0?(h=h.replace("SystemDefaultAsset-",""),"mesh"==l?(h=h.replace(".mesh.bin",""),c=i.getDefaultMesh(h)):"texture"==l&&(c=i.getDefaultTexture(h))):c=i.getAssetByName(h,o),null==c&&"animationClip"==l&&((c=i.getAssetByName(h))||(c=new t.framework.animationClip(h)).use()),a instanceof Array?a.push(c):a[r]=c}else if("reference"==e[r].parse);else{var u=void 0,d=t.gd3d_reflect_root.__gdmeta__[l];if(!d)return console.warn(a),console.warn("无法找到组件:"+t.gd3d_reflect_root.__gdmeta__[l]);"gameObject"==l&&"gameObject"==r&&"transform"==t.reflect.getClassName(a)?u=a.gameObject:"transform2D"==l&&"rootNode"==r&&"canvas"==t.reflect.getClassName(a)?(u=t.reflect.createInstance(d,null),a.rootNode=u,u.canvas=a):(u=t.reflect.createInstance(d,null),s?a.push(u):a[r]=u),deSerializeObj(e[r].value,u,i,o);var m=e[r].insid;m&&(n.oldmap[m]=u)}}function isArrayOrDic(t){return t.indexOf("[]")>0||t.indexOf("array")>=0||t.indexOf("dic")>=0}function isAsset(t){return"mesh"==t||"texture"==t||"shader"==t||"material"==t||"animationClip"==t||"atlas"==t||"keyFrameAniClip"==t||"font"==t||"prefab"==t||"sprite"==t||"textasset"==t||"f14eff"==t}function isAssetInspector(t){if("prefab"==t)return!0}function boolInNull(t){return null==t||void 0==t}var a;!function(t){t[t.FullUrl=0]="FullUrl",t[t.NameAndContent=1]="NameAndContent",t[t.DefaultAssets=2]="DefaultAssets"}(a=e.SaveAssetType||(e.SaveAssetType={}));var r=function(){function SerializeDependent(){}return SerializeDependent.GetAssetContent=function(e){if(e instanceof t.framework.material)return{name:e.getName().split(".")[0]+".mat.json",value:e.save(),type:a.NameAndContent}},SerializeDependent.GetAssetUrl=function(e,r){if(r&&e){var i=r.getAssetUrl(e);if(!i||e instanceof t.framework.material)SerializeDependent.resourseDatas.push(SerializeDependent.GetAssetContent(e));else if(SerializeDependent.resourseDatas.push({url:i,type:a.FullUrl}),e instanceof t.framework.f14eff){var o={};e.getDependents().forEach(function(e){if(e){var i=r.getAssetUrl(e);if(i){if(!o[i]&&(SerializeDependent.resourseDatas.push({url:i,type:a.FullUrl}),e instanceof t.framework.texture&&e.realName&&""!=e.realName)){var n=i.lastIndexOf("/");if(-1!=n){var s=i.substring(0,n+1);SerializeDependent.resourseDatas.push({url:s+e.realName,type:a.FullUrl})}}o[i]=!0}}})}if(e instanceof t.framework.material){var n=e;for(var s in n.statedMapUniforms)if(n.statedMapUniforms[s]&&n.defaultMapUniform[s].type==t.render.UniformTypeEnum.Texture){var l=n.statedMapUniforms[s];if(l)if(i=r.getAssetUrl(l))SerializeDependent.resourseDatas.push({url:i,type:a.FullUrl}),i.indexOf(".imgdesc.json")<0||l.realName&&(i=i.replace(l.getName(),l.realName),SerializeDependent.resourseDatas.push({url:i,type:a.FullUrl}));else{if(1==l.defaultAsset)continue;var h=SerializeDependent.GetAssetContent(l);h&&SerializeDependent.resourseDatas.push(h)}}}}},SerializeDependent.resourseDatas=[],SerializeDependent}();e.SerializeDependent=r,e.SerializeForInspector=function SerializeForInspector(t){return JSON.stringify(serializeObjForInspector(t,!1))},e.serializeObjForInspector=serializeObjForInspector,e.serializeOtherTypeOrArrayForInspector=serializeOtherTypeOrArrayForInspector,e.serializeOtherTypeForInspector=serializeOtherTypeForInspector,e.Serialize=function Serialize(t,e){return void 0===e&&(e=null),JSON.stringify(serializeObj(t,null,e))},e.serializeObj=serializeObj,e.serializeOtherTypeOrArray=serializeOtherTypeOrArray,e.serializeOtherType=serializeOtherType,e.deSerialize=function deSerialize(t,e,a,r){if(void 0===r&&(r=null),boolInNull(t))throw new Error("必须传入一个实例，用来赋值");n.oldmap={},deSerializeObj(t.value,e,a,r);var i=t.insid;i&&(n.oldmap[i]=e),fillReference(t.value,e)},e.fillReference=fillReference,e.dofillReferenceOrArray=dofillReferenceOrArray,e.dofillReference=dofillReference,e.deSerializeObj=deSerializeObj,e.deSerializeOtherTypeOrArray=deSerializeOtherTypeOrArray,e.deSerializeOtherType=deSerializeOtherType,e.isArray=function isArray(t){return t.indexOf("[]")>0||t.indexOf("array")>=0},e.isArrayOrDic=isArrayOrDic,e.isAsset=isAsset,e.isAssetInspector=isAssetInspector;var i=function(){return function valueInfo(t,e,a){void 0===a&&(a="direct"),isAsset(e)&&(a="nameonly","material"==e&&t.lastIndexOf(".mat.json")<0&&(t+=".mat.json")),this.value=t,this.type=e,this.parse=a}}(),o=function(){return function inspectorValueInfo(t,e,a){void 0===a&&(a="direct"),this.value=t,this.type=e,isAssetInspector(e)&&(a="nameonly"),this.parse=a}}(),n=function(){function referenceInfo(){}return referenceInfo.regDefaultType=function(){referenceInfo.regType("vector3"),referenceInfo.regType("vector4"),referenceInfo.regType("color"),referenceInfo.regType("border"),referenceInfo.regType("quaternion"),referenceInfo.regType("material"),referenceInfo.regType("gameObject"),referenceInfo.regType("transform2D"),referenceInfo.regType("shader"),referenceInfo.regType("atlas"),referenceInfo.regType("font"),referenceInfo.regType("sprite"),referenceInfo.regType("texture"),referenceInfo.regType("mesh"),referenceInfo.regType("animationclip"),referenceInfo.regType("keyFrameAniClip"),referenceInfo.regType("constText"),referenceInfo.regType("UniformData"),referenceInfo.regType("f14eff")},referenceInfo.regType=function(t){referenceInfo.regtypelist.push(t)},referenceInfo.isRegType=function(t){return this.regtypelist.indexOf(t)>=0},referenceInfo.oldmap={},referenceInfo.regtypelist=[],referenceInfo}();e.referenceInfo=n;var s=function(){function enumMgr(){}return enumMgr.enumMap={},enumMgr}();e.enumMgr=s}(t.io||(t.io={}))}(gd3d||(gd3d={}));var gd3d;!function(t){!function(t){var e=function(){function binReader(t,e){void 0===e&&(e=0),this._seek=e,this._data=new DataView(t,e)}return binReader.prototype.seek=function(t){this._seek=t},binReader.prototype.peek=function(){return this._seek},binReader.prototype.length=function(){return this._data.byteLength},binReader.prototype.canread=function(){return this._data.byteLength-this._seek},binReader.prototype.readStringAnsi=function(){var t=this._data.getUint8(this._seek);this._seek++;for(var e="",a=0;a<t;a++)e+=String.fromCharCode(this._data.getUint8(this._seek)),this._seek++;return e},binReader.utf8ArrayToString=function(t){for(var e=[],a=0;a<t.length;a++){var r=t[a];if(0==r)break;var i=0;if(r>224)i=(15&r)<<12,i|=(63&(r=t[++a]))<<6,i|=63&(r=t[++a]),e.push(String.fromCharCode(i));else if(r>192)i=(31&r)<<6,i|=(63&(r=t[++a]))<<6,e.push(String.fromCharCode(i));else{if(r>128)throw new Error("InvalidCharacterError");e.push(String.fromCharCode(t[a]))}}return e.join("")},binReader.prototype.readStringUtf8=function(){var t=this._data.getInt8(this._seek);this._seek++;var e=new Uint8Array(t);return this.readUint8Array(e),binReader.utf8ArrayToString(e)},binReader.prototype.readStringUtf8FixLength=function(t){var e=new Uint8Array(t);return this.readUint8Array(e),binReader.utf8ArrayToString(e)},binReader.prototype.readSingle=function(){var t=this._data.getFloat32(this._seek,!0);return this._seek+=4,t},binReader.prototype.readDouble=function(){var t=this._data.getFloat64(this._seek,!0);return this._seek+=8,t},binReader.prototype.readInt8=function(){var t=this._data.getInt8(this._seek);return this._seek+=1,t},binReader.prototype.readUInt8=function(){var t=this._data.getUint8(this._seek);return this._seek+=1,t},binReader.prototype.readInt16=function(){var t=this._data.getInt16(this._seek,!0);return this._seek+=2,t},binReader.prototype.readUInt16=function(){var t=this._data.getUint16(this._seek,!0);return this._seek+=2,t},binReader.prototype.readInt32=function(){var t=this._data.getInt32(this._seek,!0);return this._seek+=4,t},binReader.prototype.readUInt32=function(){var t=this._data.getUint32(this._seek,!0);return this._seek+=4,t},binReader.prototype.readUint8Array=function(t,e,a){void 0===t&&(t=null),void 0===e&&(e=0),void 0===a&&(a=-1),a<0&&(a=t.length);for(var r=0;r<a;r++)t[r]=this._data.getUint8(this._seek),this._seek++;return t},binReader.prototype.readUint8ArrayByOffset=function(t,e,a){void 0===a&&(a=0),a<0&&(a=t.length);for(var r=0;r<a;r++)t[r]=this._data.getUint8(e),e++;return t},Object.defineProperty(binReader.prototype,"position",{get:function(){return this.peek()},set:function(t){this.seek(t)},enumerable:!0,configurable:!0}),binReader.prototype.readBoolean=function(){return this.readUInt8()>0},binReader.prototype.readByte=function(){return this.readUInt8()},binReader.prototype.readBytes=function(t,e,a){return void 0===t&&(t=null),void 0===e&&(e=0),void 0===a&&(a=-1),this.readUint8Array(t,e,a)},binReader.prototype.readUnsignedShort=function(){return this.readUInt16()},binReader.prototype.readUnsignedInt=function(){return this.readUInt32()},binReader.prototype.readFloat=function(){return this.readSingle()},binReader.prototype.readUTFBytes=function(t){var e=new Uint8Array(t);return binReader.utf8ArrayToString(this.readUint8Array(e))},binReader.prototype.readSymbolByte=function(){return this.readInt8()},binReader.prototype.readShort=function(){return this.readInt16()},binReader.prototype.readInt=function(){return this.readInt32()},binReader}();t.binReader=e;var a=function(){function binWriter(){var t=new ArrayBuffer(1024);this._length=0,this._buf=new Uint8Array(t),this._data=new DataView(this._buf.buffer),this._seek=0}return binWriter.prototype.sureData=function(t){for(var e=this._buf.byteLength;e<this._length+t;)e+=1024;if(e!=this._buf.byteLength){for(var a=new Uint8Array(e),r=0;r<this._length;r++)a[r]=this._buf[r];this._buf=a,this._data=new DataView(this._buf.buffer)}this._length+=t},binWriter.prototype.getLength=function(){return length},binWriter.prototype.getBuffer=function(){return this._buf.buffer.slice(0,this._length)},binWriter.prototype.seek=function(t){this._seek=t},binWriter.prototype.peek=function(){return this._seek},binWriter.prototype.writeInt8=function(t){this.sureData(1),this._data.setInt8(this._seek,t),this._seek++},binWriter.prototype.writeUInt8=function(t){this.sureData(1),this._data.setUint8(this._seek,t),this._seek++},binWriter.prototype.writeInt16=function(t){this.sureData(2),this._data.setInt16(this._seek,t,!0),this._seek+=2},binWriter.prototype.writeUInt16=function(t){this.sureData(2),this._data.setUint16(this._seek,t,!0),this._seek+=2},binWriter.prototype.writeInt32=function(t){this.sureData(4),this._data.setInt32(this._seek,t,!0),this._seek+=4},binWriter.prototype.writeUInt32=function(t){this.sureData(4),this._data.setUint32(this._seek,t,!0),this._seek+=4},binWriter.prototype.writeSingle=function(t){this.sureData(4),this._data.setFloat32(this._seek,t,!0),this._seek+=4},binWriter.prototype.writeDouble=function(t){this.sureData(8),this._data.setFloat64(this._seek,t,!0),this._seek+=8},binWriter.prototype.writeStringAnsi=function(t){var e=t.length;this.sureData(e+1),this._data.setUint8(this._seek,e),this._seek++;for(var a=0;a<e;a++)this._data.setUint8(this._seek,t.charCodeAt(a)),this._seek++},binWriter.prototype.writeStringUtf8=function(t){var e=binWriter.stringToUtf8Array(t);this.writeUInt8(e.length),this.writeUint8Array(e)},binWriter.stringToUtf8Array=function(t){for(var e=[],a=0;a<t.length;a++){var r=t.charAt(a).charCodeAt(0);if(r>65535)throw new Error("InvalidCharacterError");if(r>128)if(r<2047){var i=r>>>6|192,o=63&r|128;e.push(i,o)}else{var i=r>>>12|224,o=r>>>6&63|128,n=63&r|128;e.push(i,o,n)}else e.push(r)}return e},binWriter.prototype.writeStringUtf8DataOnly=function(t){var e=binWriter.stringToUtf8Array(t);this.writeUint8Array(e)},binWriter.prototype.writeUint8Array=function(t,e,a){void 0===e&&(e=0),void 0===a&&(a=-1),a<0&&(a=t.length),this.sureData(a);for(var r=e;r<e+a;r++)this._data.setUint8(this._seek,t[r]),this._seek++},Object.defineProperty(binWriter.prototype,"length",{get:function(){return this._seek},enumerable:!0,configurable:!0}),binWriter.prototype.writeByte=function(t){this.writeUInt8(t)},binWriter.prototype.writeBytes=function(t,e,a){void 0===e&&(e=0),void 0===a&&(a=0),this.writeUint8Array(t,e,a)},binWriter.prototype.writeUnsignedShort=function(t){this.writeUInt16(t)},binWriter.prototype.writeUnsignedInt=function(t){this.writeUInt32(t)},binWriter.prototype.writeFloat=function(t){this.writeSingle(t)},binWriter.prototype.writeUTFBytes=function(t){var e=binWriter.stringToUtf8Array(t);this.writeUint8Array(e)},binWriter.prototype.writeSymbolByte=function(t){this.writeInt8(t)},binWriter.prototype.writeShort=function(t){this.writeInt16(t)},binWriter.prototype.writeInt=function(t){this.writeInt32(t)},binWriter}();t.binWriter=a}(t.io||(t.io={}))}(gd3d||(gd3d={}));var gd3d;!function(t){!function(t){t.colorSet_White=function colorSet_White(t){t.r=1,t.g=1,t.b=1,t.a=1},t.colorSet_Black=function colorSet_Black(t){t.r=0,t.g=0,t.b=0,t.a=1},t.colorSet_Gray=function colorSet_Gray(t){t.r=.5,t.g=.5,t.b=.5,t.a=1},t.colorMultiply=function colorMultiply(t,e,a){a.r=t.r*e.r,a.g=t.g*e.g,a.b=t.b*e.b,a.a=t.a*e.a},t.scaleToRef=function scaleToRef(t,e,a){a.r=t.r*e,a.g=t.g*e,a.b=t.b*e,a.a=t.a*e},t.colorClone=function colorClone(t,e){e.rawData[0]=t.rawData[0],e.rawData[1]=t.rawData[1],e.rawData[2]=t.rawData[2],e.rawData[3]=t.rawData[3]},t.colorLerp=function colorLerp(t,e,a,r){r.a=a*(e.a-t.a)+t.a,r.r=a*(e.r-t.r)+t.r,r.g=a*(e.g-t.g)+t.g,r.b=a*(e.b-t.b)+t.b}}(t.math||(t.math={}))}(gd3d||(gd3d={}));var gd3d;!function(t){!function(t){function Multiply(t,e,a){return(t.x-a.x)*(e.y-a.y)-(e.x-a.x)*(t.y-a.y)}t.calPlaneLineIntersectPoint=function calPlaneLineIntersectPoint(t,e,a,r,i){var o=t.x,n=t.y,s=t.z,l=e.x,h=e.y,c=e.z,u=a.x,d=a.y,m=a.z,p=r.x,f=r.y,g=r.z,v=u*o+d*n+m*s;if(0===v)i=null;else{var y=((l-p)*o+(h-f)*n+(c-g)*s)/v;i.x=p+u*y,i.y=f+d*y,i.z=g+m*y}},t.isContain=function isContain(t,e,a,r,i){return Multiply(i,t,e)*Multiply(i,r,a)<=0&&Multiply(i,r,t)*Multiply(i,a,e)<=0},t.Multiply=Multiply}(t.math||(t.math={}))}(gd3d||(gd3d={}));var gd3d;!function(t){!function(e){function matrix2Quaternion(t,e){var a,r=t.rawData,i=r[0],o=r[4],n=r[8],s=r[1],l=r[5],h=r[9],c=r[2],u=r[6],d=r[10],m=i+l+d;m>0?(a=.5/Math.sqrt(m+1),e.w=.25/a,e.x=(u-h)*a,e.y=(n-c)*a,e.z=(s-o)*a):i>l&&i>d?(a=2*Math.sqrt(1+i-l-d),e.w=(u-h)/a,e.x=.25*a,e.y=(o+s)/a,e.z=(n+c)/a):l>d?(a=2*Math.sqrt(1+l-i-d),e.w=(n-c)/a,e.x=(o+s)/a,e.y=.25*a,e.z=(h+u)/a):(a=2*Math.sqrt(1+d-i-l),e.w=(s-o)/a,e.x=(n+c)/a,e.y=(h+u)/a,e.z=.25*a)}function matrixMakeScale(t,e,a,r){r.rawData[0]=t,r.rawData[1]=0,r.rawData[2]=0,r.rawData[3]=0,r.rawData[4]=0,r.rawData[5]=e,r.rawData[6]=0,r.rawData[7]=0,r.rawData[8]=0,r.rawData[9]=0,r.rawData[10]=a,r.rawData[11]=0,r.rawData[12]=0,r.rawData[13]=0,r.rawData[14]=0,r.rawData[15]=1}function matrix3x2MakeScale(t,e,a){a.rawData[0]=t,a.rawData[1]=0,a.rawData[2]=0,a.rawData[3]=e,a.rawData[4]=0,a.rawData[5]=0}function matrix3x2MakeRotate(t,e){var a=Math.sin(t),r=Math.cos(t);e.rawData[0]=r,e.rawData[1]=a,e.rawData[2]=-a,e.rawData[3]=r,e.rawData[4]=0,e.rawData[5]=0}function matrixMultiply(t,e,a){var r=t.rawData[0],i=t.rawData[1],o=t.rawData[2],n=t.rawData[3],s=t.rawData[4],l=t.rawData[5],h=t.rawData[6],c=t.rawData[7],u=t.rawData[8],d=t.rawData[9],m=t.rawData[10],p=t.rawData[11],f=t.rawData[12],g=t.rawData[13],v=t.rawData[14],y=t.rawData[15],_=e.rawData[0],b=e.rawData[1],w=e.rawData[2],x=e.rawData[3];a.rawData[0]=_*r+b*s+w*u+x*f,a.rawData[1]=_*i+b*l+w*d+x*g,a.rawData[2]=_*o+b*h+w*m+x*v,a.rawData[3]=_*n+b*c+w*p+x*y,_=e.rawData[4],b=e.rawData[5],w=e.rawData[6],x=e.rawData[7],a.rawData[4]=_*r+b*s+w*u+x*f,a.rawData[5]=_*i+b*l+w*d+x*g,a.rawData[6]=_*o+b*h+w*m+x*v,a.rawData[7]=_*n+b*c+w*p+x*y,_=e.rawData[8],b=e.rawData[9],w=e.rawData[10],x=e.rawData[11],a.rawData[8]=_*r+b*s+w*u+x*f,a.rawData[9]=_*i+b*l+w*d+x*g,a.rawData[10]=_*o+b*h+w*m+x*v,a.rawData[11]=_*n+b*c+w*p+x*y,_=e.rawData[12],b=e.rawData[13],w=e.rawData[14],x=e.rawData[15],a.rawData[12]=_*r+b*s+w*u+x*f,a.rawData[13]=_*i+b*l+w*d+x*g,a.rawData[14]=_*o+b*h+w*m+x*v,a.rawData[15]=_*n+b*c+w*p+x*y}function matrix3x2Multiply(t,e,a){var r=t.rawData[0],i=t.rawData[1],o=t.rawData[2],n=t.rawData[3],s=t.rawData[4],l=t.rawData[5],h=e.rawData[0],c=e.rawData[1],u=0,d=h*r+c*o+u*s,m=h*i+c*n+u*l,p=(h=e.rawData[2])*r+(c=e.rawData[3])*o+(u=0)*s,f=h*i+c*n+u*l,g=(h=e.rawData[4])*r+(c=e.rawData[5])*o+(u=1)*s,v=h*i+c*n+u*l;a.rawData[0]=d,a.rawData[1]=m,a.rawData[2]=p,a.rawData[3]=f,a.rawData[4]=g,a.rawData[5]=v}e.matrixGetTranslation=function matrixGetTranslation(t,e){e.x=t.rawData[12],e.y=t.rawData[13],e.z=t.rawData[14]},e.matrixTranspose=function matrixTranspose(t,e){e.rawData[1]=t.rawData[4],e.rawData[2]=t.rawData[8],e.rawData[3]=t.rawData[12],e.rawData[4]=t.rawData[1],e.rawData[6]=t.rawData[9],e.rawData[7]=t.rawData[13],e.rawData[8]=t.rawData[2],e.rawData[9]=t.rawData[6],e.rawData[11]=t.rawData[14],e.rawData[12]=t.rawData[3],e.rawData[13]=t.rawData[7],e.rawData[14]=t.rawData[11]},e.matrixDecompose=function matrixDecompose(t,a,r,i){i.rawData.set(t.rawData.subarray(12,15));var o=e.sign(t.rawData[0]*t.rawData[1]*t.rawData[2]*t.rawData[3])<0?-1:1,n=e.sign(t.rawData[4]*t.rawData[5]*t.rawData[6]*t.rawData[7])<0?-1:1,s=e.sign(t.rawData[8]*t.rawData[9]*t.rawData[10]*t.rawData[11])<0?-1:1;if(a.x=o*Math.sqrt(t.rawData[0]*t.rawData[0]+t.rawData[1]*t.rawData[1]+t.rawData[2]*t.rawData[2]),a.y=n*Math.sqrt(t.rawData[4]*t.rawData[4]+t.rawData[5]*t.rawData[5]+t.rawData[6]*t.rawData[6]),a.z=s*Math.sqrt(t.rawData[8]*t.rawData[8]+t.rawData[9]*t.rawData[9]+t.rawData[10]*t.rawData[10]),0===a.x||0===a.y||0===a.z)return r.x=0,r.y=0,r.z=0,r.w=1,!1;var l=e.pool.new_matrix();return l.rawData[0]=t.rawData[0]/a.x,l.rawData[1]=t.rawData[1]/a.x,l.rawData[2]=t.rawData[2]/a.x,l.rawData[3]=0,l.rawData[4]=t.rawData[4]/a.y,l.rawData[5]=t.rawData[5]/a.y,l.rawData[6]=t.rawData[6]/a.y,l.rawData[7]=0,l.rawData[8]=t.rawData[8]/a.z,l.rawData[9]=t.rawData[9]/a.z,l.rawData[10]=t.rawData[10]/a.z,l.rawData[11]=0,matrix2Quaternion(l,r),!0};var a=function(){return function angelref(){}}();e.angelref=a,e.matrix3x2Decompose=function matrix3x2Decompose(t,e,a,r){if(r.x=t.rawData[4],r.y=t.rawData[5],e.x=Math.sqrt(t.rawData[0]*t.rawData[0]+t.rawData[1]*t.rawData[1]),e.y=Math.sqrt(t.rawData[2]*t.rawData[2]+t.rawData[3]*t.rawData[3]),0===e.x||0===e.y)return a.v=0,!1;var i=t.rawData[0]/e.x,o=Math.acos(i),n=t.rawData[1]/e.x;Math.asin(n);return n<0&&(o=2*Math.PI-o),a.v=o,!0},e.matrix2Quaternion=matrix2Quaternion,e.unitxyzToRotation=function unitxyzToRotation(t,e,a,r){var i,o=t.x,n=e.x,s=a.x,l=t.y,h=e.y,c=a.y,u=t.z,d=e.z,m=a.z,p=o+h+m;p>0?(i=.5/Math.sqrt(p+1),r.w=.25/i,r.x=(d-c)*i,r.y=(s-u)*i,r.z=(l-n)*i):o>h&&o>m?(i=2*Math.sqrt(1+o-h-m),r.w=(d-c)/i,r.x=.25*i,r.y=(n+l)/i,r.z=(s+u)/i):h>m?(i=2*Math.sqrt(1+h-o-m),r.w=(s-u)/i,r.x=(n+l)/i,r.y=.25*i,r.z=(c+d)/i):(i=2*Math.sqrt(1+m-o-h),r.w=(l-n)/i,r.x=(s+u)/i,r.y=(c+d)/i,r.z=.25*i)},e.matrixClone=function matrixClone(t,e){e.rawData.set(t.rawData)},e.matrix3x2Clone=function matrix3x2Clone(t,e){e.rawData.set(t.rawData)},e.matrixMakeIdentity=function matrixMakeIdentity(t){t.rawData[0]=1,t.rawData[1]=0,t.rawData[2]=0,t.rawData[3]=0,t.rawData[4]=0,t.rawData[5]=1,t.rawData[6]=0,t.rawData[7]=0,t.rawData[8]=0,t.rawData[9]=0,t.rawData[10]=1,t.rawData[11]=0,t.rawData[12]=0,t.rawData[13]=0,t.rawData[14]=0,t.rawData[15]=1},e.matrix3x2MakeIdentity=function matrix3x2MakeIdentity(t){t.rawData[0]=1,t.rawData[1]=0,t.rawData[2]=0,t.rawData[3]=1,t.rawData[4]=0,t.rawData[5]=0},e.matrixInverse=function matrixInverse(t,e){var a=t.rawData[0],r=t.rawData[1],i=t.rawData[2],o=t.rawData[3],n=t.rawData[4],s=t.rawData[5],l=t.rawData[6],h=t.rawData[7],c=t.rawData[8],u=t.rawData[9],d=t.rawData[10],m=t.rawData[11],p=t.rawData[12],f=t.rawData[13],g=t.rawData[14],v=t.rawData[15],y=d*v-m*g,_=u*v-m*f,b=u*g-d*f,w=c*v-m*p,x=c*g-d*p,D=c*f-u*p,E=s*y-l*_+h*b,T=-(n*y-l*w+h*x),M=n*_-s*w+h*D,A=-(n*b-s*x+l*D),S=1/(a*E+r*T+i*M+o*A),C=l*v-h*g,F=s*v-h*f,R=s*g-l*f,k=n*v-h*p,P=n*g-l*p,B=n*f-s*p,I=l*m-h*d,N=s*m-h*u,O=s*d-l*u,L=n*m-h*c,V=n*d-l*c,U=n*u-s*c;e.rawData[0]=E*S,e.rawData[4]=T*S,e.rawData[8]=M*S,e.rawData[12]=A*S,e.rawData[1]=-(r*y-i*_+o*b)*S,e.rawData[5]=(a*y-i*w+o*x)*S,e.rawData[9]=-(a*_-r*w+o*D)*S,e.rawData[13]=(a*b-r*x+i*D)*S,e.rawData[2]=(r*C-i*F+o*R)*S,e.rawData[6]=-(a*C-i*k+o*P)*S,e.rawData[10]=(a*F-r*k+o*B)*S,e.rawData[14]=-(a*R-r*P+i*B)*S,e.rawData[3]=-(r*I-i*N+o*O)*S,e.rawData[7]=(a*I-i*L+o*V)*S,e.rawData[11]=-(a*N-r*L+o*U)*S,e.rawData[15]=(a*O-r*V+i*U)*S},e.matrix3x2Inverse=function matrix3x2Inverse(t,e){var a=t.rawData[0],r=t.rawData[1],i=t.rawData[2],o=t.rawData[3],n=t.rawData[4],s=t.rawData[5],l=-(i*-s-o*-n),h=1/(a*o+r*-i);e.rawData[0]=o*h,e.rawData[2]=-i*h,e.rawData[4]=l*h,e.rawData[1]=-r*h,e.rawData[3]=a*h,e.rawData[5]=(a*-s-r*-n)*h},e.matrixMakeTransformRTS=function matrixMakeTransformRTS(a,r,i,o){var n=t.math.pool.new_matrix();matrixMakeScale(r.x,r.y,r.z,n);var s=t.math.pool.new_matrix();e.quatToMatrix(i,s),matrixMultiply(s,n,o),o.rawData[12]=a.x,o.rawData[13]=a.y,o.rawData[14]=a.z,o.rawData[15]=1,t.math.pool.delete_matrix(n),t.math.pool.delete_matrix(s)},e.matrix3x2MakeTransformRTS=function matrix3x2MakeTransformRTS(e,a,r,i){var o=t.math.pool.new_matrix3x2();matrix3x2MakeScale(a.x,a.y,o);var n=t.math.pool.new_matrix3x2();matrix3x2MakeRotate(r,n),matrix3x2Multiply(n,o,i),i.rawData[4]=e.x,i.rawData[5]=e.y,t.math.pool.delete_matrix3x2(o),t.math.pool.delete_matrix3x2(n)},e.matrixMakeTranslate=function matrixMakeTranslate(t,e,a,r){r.rawData[0]=1,r.rawData[1]=0,r.rawData[2]=0,r.rawData[3]=0,r.rawData[4]=0,r.rawData[5]=1,r.rawData[6]=0,r.rawData[7]=0,r.rawData[8]=0,r.rawData[9]=0,r.rawData[10]=1,r.rawData[11]=0,r.rawData[12]=t,r.rawData[13]=e,r.rawData[14]=a,r.rawData[15]=1},e.matrix3x2MakeTranslate=function matrix3x2MakeTranslate(t,e,a){a.rawData[0]=1,a.rawData[1]=0,a.rawData[2]=0,a.rawData[3]=1,a.rawData[4]=t,a.rawData[5]=e},e.matrixGetScale=function matrixGetScale(t,e){e.x=t.rawData[0],e.y=t.rawData[5],e.z=t.rawData[10]},e.matrixMakeScale=matrixMakeScale,e.matrix3x2TransformVector2=function matrix3x2TransformVector2(t,e,a){var r=e.x*t.rawData[0]+e.y*t.rawData[2]+t.rawData[4],i=e.x*t.rawData[1]+e.y*t.rawData[3]+t.rawData[5];a.x=r,a.y=i},e.matrix3x2TransformNormal=function matrix3x2TransformNormal(t,e,a){var r=e.x*t.rawData[0]+e.y*t.rawData[2],i=e.x*t.rawData[1]+e.y*t.rawData[3];a.x=r,a.y=i},e.matrix3x2MakeScale=matrix3x2MakeScale,e.matrixMakeRotateAxisAngle=function matrixMakeRotateAxisAngle(t,e,a){var r=t.x,i=t.y,o=t.z,n=Math.sqrt(r*r+i*i+o*o);if(n){1!==n&&(r*=n=1/n,i*=n,o*=n);var s=Math.sin(e),l=Math.cos(e),h=1-l,c=r*r*h+l,u=i*r*h+o*s,d=o*r*h-i*s,m=r*i*h-o*s,p=i*i*h+l,f=o*i*h+r*s,g=r*o*h+i*s,v=i*o*h-r*s,y=o*o*h+l;a.rawData[0]=c,a.rawData[1]=u,a.rawData[2]=d,a.rawData[3]=0,a.rawData[4]=m,a.rawData[5]=p,a.rawData[6]=f,a.rawData[7]=0,a.rawData[8]=g,a.rawData[9]=v,a.rawData[10]=y,a.rawData[11]=0,a.rawData[12]=0,a.rawData[13]=0,a.rawData[14]=0,a.rawData[15]=1}},e.matrix3x2MakeRotate=matrix3x2MakeRotate,e.matrixMultiply=matrixMultiply,e.matrix3x2Multiply=matrix3x2Multiply,e.matrixProject_PerspectiveLH=function matrixProject_PerspectiveLH(t,e,a,r,i){var o=1/Math.tan(.5*t);i.rawData[0]=o/e,i.rawData[1]=i.rawData[2]=i.rawData[3]=0,i.rawData[4]=i.rawData[6]=i.rawData[7]=0,i.rawData[5]=o,i.rawData[8]=i.rawData[9]=0,i.rawData[10]=-r/(a-r),i.rawData[11]=1,i.rawData[12]=i.rawData[13]=i.rawData[15]=0,i.rawData[14]=a*r/(a-r)},e.matrixProject_OrthoLH=function matrixProject_OrthoLH(t,e,a,r,i){var o=2/t,n=2/e,s=2/(r-a),l=(r+a)/(a-r);i.rawData[0]=o,i.rawData[1]=0,i.rawData[2]=0,i.rawData[3]=0,i.rawData[4]=0,i.rawData[5]=n,i.rawData[6]=0,i.rawData[7]=0,i.rawData[8]=0,i.rawData[9]=0,i.rawData[10]=s,i.rawData[11]=0,i.rawData[12]=0,i.rawData[13]=0,i.rawData[14]=l,i.rawData[15]=1},e.matrixLookatLH=function matrixLookatLH(t,a,r){var i=e.pool.new_vector3(-t.x,-t.y,-t.z);e.vec3Normalize(i,i);var o=e.pool.new_vector3();e.vec3Clone(a,o),e.vec3Normalize(o,o);var n=e.pool.new_vector3();e.vec3Cross(o,i,n),e.vec3SqrLength(n),0==e.vec3SqrLength(n)?n.x=1:e.vec3Normalize(n,n),e.vec3Clone(e.pool.vector3_zero,o),e.vec3Cross(i,n,o),e.vec3Normalize(o,o),r.rawData[0]=n.x,r.rawData[1]=o.x,r.rawData[2]=i.x,r.rawData[3]=0,r.rawData[4]=n.y,r.rawData[5]=o.y,r.rawData[6]=i.y,r.rawData[7]=0,r.rawData[8]=n.z,r.rawData[9]=o.z,r.rawData[10]=i.z,r.rawData[11]=0,r.rawData[12]=0,r.rawData[13]=0,r.rawData[14]=0,r.rawData[15]=1,e.pool.delete_vector3(n),e.pool.delete_vector3(o),e.pool.delete_vector3(i)},e.matrixViewLookatLH=function matrixViewLookatLH(t,a,r,i){var o=e.pool.new_vector3(a.x,a.y,a.z);e.vec3Normalize(o,o);var n=e.pool.new_vector3();e.vec3Clone(r,n),e.vec3Normalize(n,n);var s=e.pool.new_vector3();e.vec3Cross(n,o,s),e.vec3SqrLength(s),0==e.vec3SqrLength(s)?s.x=1:e.vec3Normalize(s,s),e.vec3Clone(e.pool.vector3_zero,n),e.vec3Cross(o,s,n),e.vec3Normalize(n,n);var l=-e.vec3Dot(s,t),h=-e.vec3Dot(n,t),c=-e.vec3Dot(o,t);i.rawData[0]=s.x,i.rawData[1]=n.x,i.rawData[2]=o.x,i.rawData[3]=0,i.rawData[4]=s.y,i.rawData[5]=n.y,i.rawData[6]=o.y,i.rawData[7]=0,i.rawData[8]=s.z,i.rawData[9]=n.z,i.rawData[10]=o.z,i.rawData[11]=0,i.rawData[12]=l,i.rawData[13]=h,i.rawData[14]=c,i.rawData[15]=1,e.pool.delete_vector3(s),e.pool.delete_vector3(n),e.pool.delete_vector3(o)},e.matrixLerp=function matrixLerp(t,e,a,r){for(var i=0;i<16;i++)r.rawData[i]=t.rawData[i]*(1-a)+e.rawData[i]*a},e.matrixTransformVector3=function matrixTransformVector3(t,e,a){var r=t.x*e.rawData[0]+t.y*e.rawData[4]+t.z*e.rawData[8]+e.rawData[12],i=t.x*e.rawData[1]+t.y*e.rawData[5]+t.z*e.rawData[9]+e.rawData[13],o=t.x*e.rawData[2]+t.y*e.rawData[6]+t.z*e.rawData[10]+e.rawData[14],n=t.x*e.rawData[3]+t.y*e.rawData[7]+t.z*e.rawData[11]+e.rawData[15];a.x=r/n,a.y=i/n,a.z=o/n},e.matrixTransformNormal=function matrixTransformNormal(t,e,a){var r=t.x*e.rawData[0]+t.y*e.rawData[4]+t.z*e.rawData[8],i=t.x*e.rawData[1]+t.y*e.rawData[5]+t.z*e.rawData[9],o=t.x*e.rawData[2]+t.y*e.rawData[6]+t.z*e.rawData[10];a.x=r,a.y=i,a.z=o},e.matrixGetVector3ByOffset=function matrixGetVector3ByOffset(t,e,a){a.x=t.rawData[e],a.y=t.rawData[e+1],a.z=t.rawData[e+2]},e.matrixReset=function matrixReset(t){t.rawData[0]=1,t.rawData[1]=0,t.rawData[2]=0,t.rawData[3]=0,t.rawData[4]=0,t.rawData[5]=1,t.rawData[6]=0,t.rawData[7]=0,t.rawData[8]=0,t.rawData[9]=0,t.rawData[10]=1,t.rawData[11]=0,t.rawData[12]=0,t.rawData[13]=0,t.rawData[14]=0,t.rawData[15]=1},e.matrixZero=function matrixZero(t){t.rawData[0]=0,t.rawData[1]=0,t.rawData[2]=0,t.rawData[3]=0,t.rawData[4]=0,t.rawData[5]=0,t.rawData[6]=0,t.rawData[7]=0,t.rawData[8]=0,t.rawData[9]=0,t.rawData[10]=0,t.rawData[11]=0,t.rawData[12]=0,t.rawData[13]=0,t.rawData[14]=0,t.rawData[15]=1},e.matrixScaleByNum=function matrixScaleByNum(t,e){e.rawData[0]*=t,e.rawData[1]*=t,e.rawData[2]*=t,e.rawData[3]*=t,e.rawData[4]*=t,e.rawData[5]*=t,e.rawData[6]*=t,e.rawData[7]*=t,e.rawData[8]*=t,e.rawData[9]*=t,e.rawData[10]*=t,e.rawData[11]*=t,e.rawData[12]*=t,e.rawData[13]*=t,e.rawData[14]*=t,e.rawData[15]*=t},e.matrixAdd=function matrixAdd(t,e,a){a.rawData[0]=t.rawData[0]+e.rawData[0],a.rawData[1]=t.rawData[1]+e.rawData[1],a.rawData[2]=t.rawData[2]+e.rawData[2],a.rawData[3]=t.rawData[3]+e.rawData[3],a.rawData[4]=t.rawData[4]+e.rawData[4],a.rawData[5]=t.rawData[5]+e.rawData[5],a.rawData[6]=t.rawData[6]+e.rawData[6],a.rawData[7]=t.rawData[7]+e.rawData[7],a.rawData[8]=t.rawData[8]+e.rawData[8],a.rawData[9]=t.rawData[9]+e.rawData[9],a.rawData[10]=t.rawData[10]+e.rawData[10],a.rawData[11]=t.rawData[11]+e.rawData[11],a.rawData[12]=t.rawData[12]+e.rawData[12],a.rawData[13]=t.rawData[13]+e.rawData[13],a.rawData[14]=t.rawData[14]+e.rawData[14],a.rawData[15]=t.rawData[15]+e.rawData[15]}}(t.math||(t.math={}))}(gd3d||(gd3d={}));var gd3d;!function(t){!function(e){e.floatClamp=function floatClamp(t,e,a){return void 0===e&&(e=0),void 0===a&&(a=1),t<e?e:t>a?a:t},e.sign=function sign(t){return 0==(t=+t)||isNaN(t)?t:t>0?1:-1},e.getKeyCodeByAscii=function getKeyCodeByAscii(t){return t.shiftKey?t.keyCode-32:t.keyCode},e.numberLerp=function numberLerp(t,e,a){return t*(1-a)+e*a},e.x_AXIS=function x_AXIS(){return a.x_axis},e.y_AXIS=function y_AXIS(){return a.y_axis},e.z_AXIS=function z_AXIS(){return a.z_axis};var a=function(){function commonStatic(){}return commonStatic.x_axis=new t.math.vector3(1,0,0),commonStatic.y_axis=new t.math.vector3(0,1,0),commonStatic.z_axis=new t.math.vector3(0,0,1),commonStatic}();e.commonStatic=a}(t.math||(t.math={}))}(gd3d||(gd3d={}));var gd3d;!function(t){!function(e){function quatIdentity(t){t.x=0,t.y=0,t.z=0,t.w=1}function quatNormalize(t,e){var a=1/Math.sqrt(t.x*t.x+t.y*t.y+t.z*t.z+t.w*t.w);e.x*=a,e.y*=a,e.z*=a,e.w*=a}function quatTransformVector(t,e,a){var r,i,o,n,s=e.x,l=e.y,h=e.z;n=-t.x*s-t.y*l-t.z*h,r=t.w*s+t.y*h-t.z*l,i=t.w*l-t.x*h+t.z*s,o=t.w*h+t.x*l-t.y*s,a.x=-n*t.x+r*t.w-i*t.z+o*t.y,a.y=-n*t.y+r*t.z+i*t.w-o*t.x,a.z=-n*t.z-r*t.y+i*t.x+o*t.w}function quatFromYawPitchRoll(t,e,a,r){var i=.5*a,o=.5*e,n=.5*t,s=Math.sin(i),l=Math.cos(i),h=Math.sin(o),c=Math.cos(o),u=Math.sin(n),d=Math.cos(n);r.x=d*h*l+u*c*s,r.y=u*c*l-d*h*s,r.z=d*c*s-u*h*l,r.w=d*c*l+u*h*s}function quatMultiply(t,a,r){var i=t.w,o=t.x,n=t.y,s=t.z,l=a.w,h=a.x,c=a.y,u=a.z;r.w=i*l-o*h-n*c-s*u,r.x=i*h+o*l+n*u-s*c,r.y=i*c-o*u+n*l+s*h,r.z=i*u+o*c-n*h+s*l,e.quatNormalize(r,r)}function quatFromAxisAngle(t,a,r){var i=.5*(a*=Math.PI/180),o=Math.sin(i);r.w=Math.cos(i),r.x=t.x*o,r.y=t.y*o,r.z=t.z*o,e.quatNormalize(r,r)}e.quatIdentity=quatIdentity,e.quatNormalize=quatNormalize,e.quatTransformVector=quatTransformVector,e.quatTransformVectorDataAndQuat=function quatTransformVectorDataAndQuat(t,e,a,r){var i,o,n,s,l=a.x,h=a.y,c=a.z,u=t[e],d=t[e+1],m=t[e+2],p=t[e+3];s=-u*l-d*h-m*c,i=p*l+d*c-m*h,o=p*h-u*c+m*l,n=p*c+u*h-d*l,r.x=-s*u+i*p-o*m+n*d,r.y=-s*d+i*m+o*p-n*u,r.z=-s*m-i*d+o*u+n*p},e.quatMagnitude=function quatMagnitude(t){return Math.sqrt(t.w*t.w+t.x*t.x+t.y*t.y+t.z*t.z)},e.quatClone=function quatClone(t,e){e.rawData[0]=t.rawData[0],e.rawData[1]=t.rawData[1],e.rawData[2]=t.rawData[2],e.rawData[3]=t.rawData[3]},e.quatEqual=function quatEqual(t,e,a){return void 0===a&&(a=1e-6),!(Math.abs(t.x-e.x)>a||Math.abs(t.y-e.y)>a||Math.abs(t.z-e.z)>a||Math.abs(t.w-e.w)>a)},e.quatToMatrix=function quatToMatrix(t,e){var a=2*t.x*t.y,r=2*t.x*t.z,i=2*t.x*t.w,o=2*t.y*t.z,n=2*t.y*t.w,s=2*t.z*t.w,l=t.x*t.x,h=t.y*t.y,c=t.z*t.z,u=t.w*t.w;e.rawData[0]=l-h-c+u,e.rawData[4]=a-s,e.rawData[8]=r+n,e.rawData[12]=0,e.rawData[1]=a+s,e.rawData[5]=-l+h-c+u,e.rawData[9]=o-i,e.rawData[13]=0,e.rawData[2]=r-n,e.rawData[6]=o+i,e.rawData[10]=-l-h+c+u,e.rawData[14]=0,e.rawData[3]=0,e.rawData[7]=0,e.rawData[11]=0,e.rawData[15]=1},e.quatInverse=function quatInverse(t,e){var a=t.w*t.w+t.x*t.x+t.y*t.y+t.z*t.z;if(a>0){var r=1/a;e.w=t.w*r,e.x=-t.x*r,e.y=-t.y*r,e.z=-t.z*r}},e.quatFromYawPitchRoll=quatFromYawPitchRoll,e.quatMultiply=quatMultiply,e.quatMultiplyDataAndQuat=function quatMultiplyDataAndQuat(t,a,r,i){var o=t[a+3],n=t[a+0],s=t[a+1],l=t[a+2],h=r.w,c=r.x,u=r.y,d=r.z;i.w=o*h-n*c-s*u-l*d,i.x=o*c+n*h+s*d-l*u,i.y=o*u-n*d+s*h+l*c,i.z=o*d+n*u-s*c+l*h,e.quatNormalize(i,i)},e.quatMultiplyVector=function quatMultiplyVector(t,e,a){var r=t.x,i=t.y,o=t.z;a.w=-e.x*r-e.y*i-e.z*o,a.x=e.w*r+e.y*o-e.z*i,a.y=e.w*i-e.x*o+e.z*r,a.z=e.w*o+e.x*i-e.y*r},e.quatLerp=function quatLerp(t,e,a,r){var i=t.w,o=t.x,n=t.y,s=t.z,l=e.w,h=e.x,c=e.y,u=e.z;i*l+o*h+n*c+s*u<0&&(l=-l,h=-h,c=-c,u=-u),a.w=i+r*(l-i),a.x=o+r*(h-o),a.y=n+r*(c-n),a.z=s+r*(u-s);var d=1/Math.sqrt(a.w*a.w+a.x*a.x+a.y*a.y+a.z*a.z);a.w*=d,a.x*=d,a.y*=d,a.z*=d},e.quatFromAxisAngle=quatFromAxisAngle,e.quatToAxisAngle=function quatToAxisAngle(t,e){var a=t.x*t.x+t.y*t.y+t.z*t.z,r=0;return a>0?(r=2*Math.acos(t.w),a=1/Math.sqrt(a),e.x=t.x*a,e.y=t.y*a,e.z=t.z*a):(r=0,e.x=1,e.y=0,e.z=0),r/=Math.PI/180},e.quatFromEulerAngles=function quatFromEulerAngles(t,a,r,i){var o=.5*(t*=Math.PI/180),n=.5*(a*=Math.PI/180),s=.5*(r*=Math.PI/180),l=Math.cos(o),h=Math.sin(o),c=Math.cos(n),u=Math.sin(n),d=Math.cos(s),m=Math.sin(s);i.w=l*c*d+h*u*m,i.x=h*c*d+l*u*m,i.y=l*u*d-h*c*m,i.z=l*c*m-h*u*d,e.quatNormalize(i,i)},e.quatToEulerAngles=function quatToEulerAngles(t,a){var r=2*(t.w*t.x-t.y*t.z);r=e.floatClamp(r,-1,1),a.x=Math.asin(r),a.y=Math.atan2(2*(t.w*t.y+t.z*t.x),1-2*(t.y*t.y+t.x*t.x)),a.z=Math.atan2(2*(t.w*t.z+t.y*t.x),1-2*(t.x*t.x+t.z*t.z)),a.x/=Math.PI/180,a.y/=Math.PI/180,a.z/=Math.PI/180},e.quatReset=function quatReset(t){t.x=0,t.y=0,t.z=0,t.w=1},e.quatLookat=function quatLookat(t,a,r){var i=e.pool.new_vector3();e.vec3Subtract(a,t,i),e.vec3Normalize(i,i);var o=e.pool.new_vector3(i.x,0,i.z);e.vec3Normalize(o,o);var n=Math.acos(o.z);o.x<0&&(n=-n);var s=e.pool.new_vector3(i.x,0,i.z),l=e.vec3Length(s);l>.9999999999&&(l=1),l<-.9999999999&&(l=-1);var h=Math.acos(l);i.y>0&&(h=-h),quatFromYawPitchRoll(n,h,0,r),e.quatNormalize(r,r),e.pool.delete_vector3(i),e.pool.delete_vector3(o),e.pool.delete_vector3(s)},e.quat2Lookat=function quat2Lookat(a,r,i,o){void 0===o&&(o=t.math.pool.vector3_up);var n=t.math.pool.new_vector3();e.vec3Subtract(r,a,n),e.vec3Normalize(n,n);var s=t.math.vec3Dot(t.math.pool.vector3_forward,n);s=t.math.floatClamp(s,-1,1);var l=180*Math.acos(s)/Math.PI;if(l<.01)return i.x=0,i.y=0,i.z=0,void(i.w=1);if(l>179.9)t.math.quatFromAxisAngle(o,180,i);else{var h=t.math.pool.new_vector3();t.math.vec3Cross(t.math.pool.vector3_forward,n,h),t.math.vec3Normalize(h,h),t.math.quatFromAxisAngle(h,l,i)}},e.quat2LookRotation=function quat2LookRotation(a,r,i,o){var n=t.math.pool.new_vector3();e.vec3Subtract(r,a,n),e.quatLookRotation(n,i,o)},e.quatLookRotation=function quatLookRotation(a,r,i){e.vec3Normalize(a,a);var o=e.vec3Dot(a,t.math.pool.vector3_forward),n=Math.acos(o),s=t.math.pool.new_vector3();e.vec3Cross(a,t.math.pool.vector3_forward,s),e.vec3Normalize(s,s),e.vec3Dot(s,t.math.pool.vector3_forward)<0&&(n=2*Math.PI-n),quatFromAxisAngle(s,-(n=180/Math.PI*n),i);var l=t.math.pool.new_vector3();quatTransformVector(i,t.math.pool.vector3_up,l);var h=s;e.vec3Cross(a,r,h),e.vec3Normalize(l,l),e.vec3Normalize(h,h);var c=e.vec3Dot(h,l),u=Math.sqrt(1-c*c);console.log(e.vec3Dot(l,r)),e.vec3Dot(l,r)<=0&&(u=-u);var d=Math.sqrt((1-u)/2),m=-Math.sqrt((u+1)/2);console.log(c),c<0&&(m=-m);var p=t.math.pool.new_quaternion();p.x=0,p.y=0,p.z=d,p.w=m,quatMultiply(i,p,i),t.math.pool.delete_vector3(a),t.math.pool.delete_vector3(s)},e.quatYAxis=function quatYAxis(t,a,r){var i=e.pool.new_vector3();e.vec3Subtract(a,t,i),e.vec3Normalize(i,i);var o=e.pool.new_vector3(i.x,0,i.z);e.vec3Normalize(o,o);var n=Math.acos(o.z);o.x<0&&(n=-n),quatFromYawPitchRoll(n,0,0,r),e.quatNormalize(r,r),e.pool.delete_vector3(i),e.pool.delete_vector3(o)},e.rotationTo=function rotationTo(t,a,r){var i=e.pool.new_vector3(),o=e.pool.vector3_right,n=e.pool.vector3_up,s=e.vec3Dot(t,a);s<-.999999?(e.vec3Cross(o,t,i),e.vec3Length(i)<1e-6&&e.vec3Cross(n,t,i),e.vec3Normalize(i,i),quatFromAxisAngle(i,180,r)):s>.999999?(r[0]=0,r[1]=0,r[2]=0,r[3]=1):(e.vec3Cross(t,a,i),r[0]=i[0],r[1]=i[1],r[2]=i[2],r[3]=1+s,quatNormalize(r,r)),e.pool.delete_vector3(i)},e.myLookRotation=function myLookRotation(t,a,r){if(void 0===r&&(r=e.pool.vector3_up),e.vec3Equal(t,e.pool.vector3_zero))return console.log("Zero direction in MyLookRotation"),void quatIdentity(a);if(e.vec3Equal(t,r))this.rotationTo(e.pool.vector3_forward,t,a);else{var i=e.pool.new_vector3();e.vec3ScaleByNum(r,e.vec3Dot(r,t),i),e.vec3Subtract(t,i,i);var o=e.pool.new_quaternion();this.rotationTo(e.pool.vector3_forward,i,o);var n=e.pool.new_quaternion();this.rotationTo(i,t,n),quatMultiply(o,n,a),e.pool.delete_quaternion(o),e.pool.delete_quaternion(n),e.pool.delete_vector3(i)}}}(t.math||(t.math={}))}(gd3d||(gd3d={}));var gd3d;!function(t){!function(t){t.rectSet_One=function rectSet_One(t){t.x=0,t.y=0,t.w=1,t.h=1},t.rectSet_Zero=function rectSet_Zero(t){t.x=0,t.y=0,t.w=0,t.h=0},t.rectEqul=function rectEqul(t,e){return!(t.x!=e.x||t.y!=e.y||t.w!=e.w||t.h!=e.h)},t.rectInner=function rectInner(t,e,a){return!(t<a.x||t>a.x+a.w||e<a.y||e>a.y+a.h)}}(t.math||(t.math={}))}(gd3d||(gd3d={}));var gd3d;!function(t){!function(t){t.caclStringByteLength=function caclStringByteLength(t){for(var e=0,a=0;a<t.length;a++){var r=t.charCodeAt(a);e+=r<=127?1:r<=2047?2:r<=65535?3:4}return e}}(t.math||(t.math={}))}(gd3d||(gd3d={}));var gd3d;!function(t){!function(e){e.spriteAnimation=function spriteAnimation(t,e,a,r){var i=1/e,o=1/t,n=i*(a%e),s=o*t-o*(Math.floor(a/e)+1);r.x=i,r.y=o,r.z=n,r.w=s},e.GetPointAlongCurve=function GetPointAlongCurve(e,a,r,i,o,n,s){void 0===s&&(s=.3);var l=1-o,h=Math.pow(l,3),c=Math.pow(l,2),u=1-s,d=t.math.pool.new_vector3();t.math.vec3ScaleByNum(e,h*u,d);var m=t.math.pool.new_vector3();t.math.vec3ScaleByNum(a,3*c*o*s,m);var p=t.math.pool.new_vector3();t.math.vec3ScaleByNum(i,3*l*Math.pow(o,2)*s,p);var f=t.math.pool.new_vector3();t.math.vec3ScaleByNum(r,Math.pow(o,3)*u,f);var g=t.math.pool.new_vector3();t.math.vec3Add(d,m,g),t.math.vec3Add(g,p,g),t.math.vec3Add(g,f,g),t.math.vec3ScaleByNum(g,1/(h*u+3*c*o*s+3*l*Math.pow(o,2)*s+Math.pow(o,3)*u),n),t.math.pool.delete_vector3(d),t.math.pool.delete_vector3(m),t.math.pool.delete_vector3(p),t.math.pool.delete_vector3(f),t.math.pool.delete_vector3(g)}}(t.math||(t.math={}))}(gd3d||(gd3d={}));var gd3d;!function(t){!function(t){function vec2Subtract(t,e,a){a.x=t.x-e.x,a.y=t.y-e.y}function vec2Length(t){return Math.sqrt(t.x*t.x+t.y*t.y)}t.vec2Subtract=vec2Subtract,t.vec2Add=function vec2Add(t,e,a){a.x=t.x+e.x,a.y=t.y+e.y},t.vec2Clone=function vec2Clone(t,e){e.rawData[0]=t.rawData[0],e.rawData[1]=t.rawData[1]},t.vec2Distance=function vec2Distance(e,a){var r=t.pool.new_vector2();vec2Subtract(e,a,r);var i=Math.sqrt(r.x*r.x+r.y*r.y);return t.pool.delete_vector2(r),i},t.vec2ScaleByNum=function vec2ScaleByNum(t,e,a){a.x=t.x*e,a.y=t.y*e},t.vec2ScaleByVec2=function vec2ScaleByVec2(t,e,a){a.x=t.x*e.x,a.y=t.y*e.y},t.vec4Clone=function vec4Clone(t,e){e.rawData[0]=t.rawData[0],e.rawData[1]=t.rawData[1],e.rawData[2]=t.rawData[2],e.rawData[3]=t.rawData[3]},t.vec2Length=vec2Length,t.vec2SLerp=function vec2SLerp(t,e,a,r){r.x=t.x*(1-a)+e.x*a,r.y=t.y*(1-a)+e.y*a},t.vec4SLerp=function vec4SLerp(t,e,a,r){r.x=t.x*(1-a)+e.x*a,r.y=t.y*(1-a)+e.y*a,r.z=t.z*(1-a)+e.z*a,r.w=t.w*(1-a)+e.w*a},t.vec2Normalize=function vec2Normalize(t,e){var a=vec2Length(t);a>Number.MIN_VALUE?(e.x=t.x/a,e.y=t.y/a):(e.x=0,e.y=0)},t.vec2Multiply=function vec2Multiply(t,e){return t.x*e.x+t.y*e.y},t.vec2Dot=function vec2Dot(t,e){return t.x*e.x+t.y*e.y},t.vec2Equal=function vec2Equal(t,e,a){return void 0===a&&(a=1e-5),!(Math.abs(t.x-e.x)>a||Math.abs(t.y-e.y)>a)}}(t.math||(t.math={}))}(gd3d||(gd3d={}));var gd3d;!function(t){!function(t){function vec3Add(t,e,a){a.x=t.x+e.x,a.y=t.y+e.y,a.z=t.z+e.z}function vec3Subtract(t,e,a){a.x=t.x-e.x,a.y=t.y-e.y,a.z=t.z-e.z}function vec3Length(t){return Math.sqrt(t.x*t.x+t.y*t.y+t.z*t.z)}function vec3SqrLength(t){return t.x*t.x+t.y*t.y+t.z*t.z}function vec3Normalize(t,e){var a=vec3Length(t);a>Number.MIN_VALUE?(e.x=t.x/a,e.y=t.y/a,e.z=t.z/a):(e.x=0,e.y=0,e.z=0)}function vec3ScaleByNum(t,e,a){a.x=t.x*e,a.y=t.y*e,a.z=t.z*e}function vec3Dot(t,e){return t.x*e.x+t.y*e.y+t.z*e.z}function vec3Project(t,e,a){var r=0;if((r=vec3Dot(e,e))<Number.MIN_VALUE)a.x=a.y=a.z=0;else{vec3ScaleByNum(e,vec3Dot(t,e)/r,a)}}function floatFormat(t,e){var a=Math.pow(10,e);return Math.round(t*a)/a}t.vec3Clone=function vec3Clone(t,e){e.rawData[0]=t.rawData[0],e.rawData[1]=t.rawData[1],e.rawData[2]=t.rawData[2]},t.vec3ToString=function vec3ToString(t){this.x,this.y,this.z},t.vec3Add=vec3Add,t.vec3Subtract=vec3Subtract,t.vec3Minus=function vec3Minus(t,e){e.x=-t.x,e.y=-t.y,e.z=-t.z},t.vec3Length=vec3Length,t.vec3SqrLength=vec3SqrLength,t.vec3Set_One=function vec3Set_One(t){t.x=t.y=t.z=1},t.vec3Set_Forward=function vec3Set_Forward(t){t.x=t.y=0,t.z=1},t.vec3Set_Back=function vec3Set_Back(t){t.x=t.y=0,t.z=-1},t.vec3Set_Up=function vec3Set_Up(t){t.x=t.z=0,t.y=1},t.vec3Set_Down=function vec3Set_Down(t){t.x=t.z=0,t.y=-1},t.vec3Set_Left=function vec3Set_Left(t){t.x=-1,t.y=t.z=0},t.vec3Set_Right=function vec3Set_Right(t){t.x=1,t.y=t.z=0},t.vec3Normalize=vec3Normalize,t.vec3ScaleByVec3=function vec3ScaleByVec3(t,e,a){a.x=t.x*e.x,a.y=t.y*e.y,a.z=t.z*e.z},t.vec3ScaleByNum=vec3ScaleByNum,t.vec3Product=function vec3Product(t,e,a){a.x=t.x*e.x,a.y=t.y*e.y,a.z=t.z*e.z},t.vec3Cross=function vec3Cross(t,e,a){a.x=t.y*e.z-t.z*e.y,a.y=t.z*e.x-t.x*e.z,a.z=t.x*e.y-t.y*e.x},t.vec3Reflect=function vec3Reflect(t,e,a){vec3ScaleByNum(a,-2*vec3Dot(e,t),a),vec3Add(a,t,a)},t.vec3Dot=vec3Dot,t.vec3Project=vec3Project,t.vec3ProjectOnPlane=function vec3ProjectOnPlane(t,e,a){vec3Project(t,e,a),vec3Subtract(t,a,a)},t.vec3Exclude=function vec3Exclude(t,e,a){vec3Project(e,t,a),vec3Subtract(e,a,a)},t.vec3Angle=function vec3Angle(e,a){var r=t.pool.new_vector3(),i=t.pool.new_vector3();vec3Normalize(e,r),vec3Normalize(a,i);var o=vec3Dot(r,i);return o=t.floatClamp(o,-1,1),o=57.29578*Math.acos(o),t.pool.delete_vector3(r),t.pool.delete_vector3(r),o},t.vec3Distance=function vec3Distance(e,a){var r=t.pool.new_vector3();vec3Subtract(e,a,r);var i=Math.sqrt(r.x*r.x+r.y*r.y+r.z*r.z);return t.pool.delete_vector3(r),i},t.vec3ClampLength=function vec3ClampLength(t,e,a){vec3SqrLength(t)>e*e&&(vec3Normalize(t,a),vec3ScaleByNum(a,e,a)),a=t},t.vec3Min=function vec3Min(t,e,a){a.x=Math.min(t.x,e.x),a.y=Math.min(t.y,e.y),a.z=Math.min(t.z,e.z)},t.vec3Max=function vec3Max(t,e,a){a.x=Math.max(t.x,e.x),a.y=Math.max(t.y,e.y),a.z=Math.max(t.z,e.z)},t.vec3AngleBetween=function vec3AngleBetween(e,a){vec3Normalize(e,e),vec3Normalize(a,a);var r=vec3Dot(e,a);return r=t.floatClamp(r,-1,1),r=Math.acos(r)},t.vec3Reset=function vec3Reset(t){t.x=0,t.y=0,t.z=0},t.vec3SLerp=function vec3SLerp(t,e,a,r){r.x=t.x*(1-a)+e.x*a,r.y=t.y*(1-a)+e.y*a,r.z=t.z*(1-a)+e.z*a},t.vec3SetByFloat=function vec3SetByFloat(t,e,a,r){r.x=t,r.y=e,r.z=a},t.vec3Format=function vec3Format(t,e,a){a.x=floatFormat(t.x,e),a.y=floatFormat(t.y,e),a.z=floatFormat(t.z,e)},t.quaternionFormat=function quaternionFormat(t,e,a){a.x=floatFormat(t.x,e),a.y=floatFormat(t.y,e),a.z=floatFormat(t.z,e),a.w=floatFormat(t.w,e)},t.floatFormat=floatFormat,t.vec3Equal=function vec3Equal(t,e,a){return void 0===a&&(a=1e-5),!(Math.abs(t.x-e.x)>a||Math.abs(t.y-e.y)>a||Math.abs(t.z-e.z)>a)}}(t.math||(t.math={}))}(gd3d||(gd3d={}));var gd3d;!function(t){!function(t){var e=function(){function navVec3(){this.x=0,this.y=0,this.z=0}return navVec3.prototype.clone=function(){var t=new navVec3;return t.x=this.x,t.y=this.y,t.z=this.z,t},navVec3.DistAZ=function(t,e){var a=e.x-t.x,r=e.z-t.z;return Math.sqrt(a*a+r*r)},navVec3.NormalAZ=function(t,e){var a=e.x-t.x,r=e.z-t.z,i=Math.sqrt(a*a+r*r),o=new navVec3;return o.x=a/i,o.y=0,o.z=r/i,o},navVec3.Cross=function(t,e){var a=new navVec3;return a.x=t.y*e.z-t.z*e.y,a.y=t.z*e.x-t.x*e.z,a.z=t.x*e.y-t.y*e.x,a},navVec3.DotAZ=function(t,e){return t.x*e.x+t.z*e.z},navVec3.Angle=function(t,e){var a=t.x*e.x+t.z*e.z,r=navVec3.Cross(t,e),i=Math.acos(a);return r.y<0&&(i=-i),i},navVec3.Border=function(t,e,a){var r=navVec3.NormalAZ(t,e),i=new navVec3;return i.x=t.x+r.x*a,i.y=t.y+r.y*a,i.z=t.z+r.z*a,i},navVec3}();t.navVec3=e;var a=function(){function navNode(){this.nodeID=0,this.poly=null,this.borderByPoly=null,this.borderByPoint=null,this.center=null}return navNode.prototype.genBorder=function(){for(var t=[],e=0;e<this.poly.length;e+=1){var a=e,r=e+1;r>=this.poly.length&&(r=0);var i=this.poly[a],o=this.poly[r];i<o?t.push(i+"-"+o):t.push(o+"-"+i)}this.borderByPoint=t},navNode.prototype.isLinkTo=function(t,e){var a;if(this.nodeID===e)a=null;else if(e<0)a=null;else{for(var r=this.borderByPoly,i=0;i<r.length;i+=1){var o=r[i];if(!(void 0==t.borders[o])&&(t.borders[o].nodeA===e||t.borders[o].nodeB===e))return a=o}a=null}return a},navNode.prototype.getLinked=function(t){for(var e=[],a=this.borderByPoly,r=0;r<a.length;r+=1){var i=a[r];if(!(void 0==t.borders[i])){var o;(o=t.borders[i].nodeA===this.nodeID?t.borders[i].nodeB:t.borders[i].nodeA)>=0&&e.push(o)}}return e},navNode.prototype.genCenter=function(t){this.center=new e,this.center.x=0,this.center.y=0,this.center.z=0;for(var a=this.poly,r=0;r<a.length;r+=1){var i=a[r];this.center.x+=t.vecs[i].x,this.center.y+=t.vecs[i].y,this.center.z+=t.vecs[i].z}this.center.x/=this.poly.length,this.center.y/=this.poly.length,this.center.z/=this.poly.length},navNode}();t.navNode=a;var r=function(){return function navBorder(){this.borderName=null,this.nodeA=0,this.nodeB=0,this.pointA=0,this.pointB=0,this.length=0,this.center=null}}();t.navBorder=r;var i=function(){function navMeshInfo(){this.vecs=null,this.nodes=null,this.borders=null,this.min=null,this.max=null}return navMeshInfo.prototype.calcBound=function(){this.min=new e,this.max=new e,this.min.x=1.7976931348623157e308,this.min.y=1.7976931348623157e308,this.min.z=1.7976931348623157e308,this.max.x=-1.7976931348623157e308,this.max.y=-1.7976931348623157e308,this.max.z=-1.7976931348623157e308;for(var t=0;t<this.vecs.length;t+=1)this.vecs[t].x<this.min.x&&(this.min.x=this.vecs[t].x),this.vecs[t].y<this.min.y&&(this.min.y=this.vecs[t].y),this.vecs[t].z<this.min.z&&(this.min.z=this.vecs[t].z),this.vecs[t].x>this.max.x&&(this.max.x=this.vecs[t].x),this.vecs[t].y>this.max.y&&(this.max.y=this.vecs[t].y),this.vecs[t].z>this.max.z&&(this.max.z=this.vecs[t].z)},navMeshInfo.cross=function(t,e,a){return(e.x-t.x)*(a.z-t.z)-(a.x-t.x)*(e.z-t.z)},navMeshInfo.prototype.inPoly=function(t,e){var a;if(e.length<3)a=!1;else if(navMeshInfo.cross(this.vecs[e[0]],t,this.vecs[e[1]])<-0)a=!1;else if(navMeshInfo.cross(this.vecs[e[0]],t,this.vecs[e[e.length-1]])>0)a=!1;else{for(var r=2,i=e.length-1,o=-1;r<=i;){var n=r+i>>1;navMeshInfo.cross(this.vecs[e[0]],t,this.vecs[e[n]])<-0?(o=n,i=n-1):r=n+1}a=navMeshInfo.cross(this.vecs[e[o-1]],t,this.vecs[e[o]])>0}return a},navMeshInfo.prototype.genBorder=function(){for(var t={},a=0;a<this.nodes.length;a+=1)for(var i=this.nodes[a],o=0;o<i.borderByPoint.length;o+=1)if(void 0==t[w=i.borderByPoint[o]])t[w]=new r,t[w].borderName=w,t[w].nodeA=i.nodeID,t[w].nodeB=-1,t[w].pointA=-1;else{t[w].nodeB=i.nodeID,t[w].nodeA>t[w].nodeB&&(t[w].nodeB=t[w].nodeA,t[w].nodeB=i.nodeID);for(var n=this.nodes[t[w].nodeA],s=this.nodes[t[w].nodeB],l=0;l<n.poly.length;l+=1){var h=n.poly[l];s.poly.indexOf(h)>=0&&(-1==t[w].pointA?t[w].pointA=h:t[w].pointB=h)}var c=t[w].pointA,u=t[w].pointB,d=this.vecs[c].x-this.vecs[u].x,m=this.vecs[c].y-this.vecs[u].y,p=this.vecs[c].z-this.vecs[u].z;t[w].length=Math.sqrt(d*d+m*m+p*p),t[w].center=new e,t[w].center.x=.5*this.vecs[c].x+.5*this.vecs[u].x,t[w].center.y=.5*this.vecs[c].y+.5*this.vecs[u].y,t[w].center.z=.5*this.vecs[c].z+.5*this.vecs[u].z,t[w].borderName=t[w].nodeA+"-"+t[w].nodeB}var f={};for(var g in t)t[g].nodeB<0||(f[g]=t[g].borderName);this.borders={};for(var g in t)void 0!=f[g]&&(this.borders[f[g]]=t[g]);for(var v=0;v<this.nodes.length;v+=1){for(var y=this.nodes[v],_=[],b=0;b<y.borderByPoint.length;b+=1){var w=y.borderByPoint[b];void 0!=f[w]&&_.push(f[w])}y.borderByPoly=_}},navMeshInfo.LoadMeshInfo=function(t){var r=JSON.parse(t),i=new navMeshInfo,o=[];for(var n in r.v){var s=new e;s.x=r.v[n][0],s.y=r.v[n][1],s.z=r.v[n][2],o.push(s)}i.vecs=o;for(var l=[],h=r.p,c=0;c<h.length;c++){var u=h[c],d=new a;d.nodeID=c;var m=[];for(var p in u)m.push(u[p]);d.poly=m,d.genBorder(),d.genCenter(i),l.push(d)}return i.nodes=l,i.calcBound(),i.genBorder(),i},navMeshInfo}();t.navMeshInfo=i}(t.framework||(t.framework={}))}(gd3d||(gd3d={}));var gd3d;!function(t){!function(e){var a=function(){function Navigate(t,e){this.navinfo=t,this.navindexmap=e}return Navigate.prototype.pathPoints=function(a,r,i,o){var n=new e.navVec3;n.x=a.x,n.y=a.y,n.z=a.z;var s=new e.navVec3;s.x=r.x,s.y=r.y,s.z=r.z;var l=this.navindexmap[i],h=this.navindexmap[o];if(l>=0&&h>=0)var c=t.framework.pathFinding.calcAStarPolyPath(this.navinfo,l,h,s,.3);if(c){for(var u=t.framework.pathFinding.calcWayPoints(this.navinfo,n,s,c),d=[],m=0;m<u.length;m++)d[m]=new t.math.vector3(u[m].x,u[m].y,u[m].z);return d}return null},Navigate.prototype.dispose=function(){this.navinfo=null,this.navindexmap=null},Navigate}();e.Navigate=a}(t.framework||(t.framework={}))}(gd3d||(gd3d={}));var gd3d;!function(t){!function(e){var a=function(){function NavMeshLoadManager(){this.navMeshVertexOffset=new t.math.vector3(0,0,0),this._navmeshJson=""}return Object.defineProperty(NavMeshLoadManager.prototype,"navmeshJson",{get:function(){return this._navmeshJson},enumerable:!0,configurable:!0}),NavMeshLoadManager.prototype.loadNavMesh=function(e,a,r){var i=this;a&&(this.app=a,this.navTrans&&this.navTrans.parent.removeChild(this.navTrans),a.getAssetMgr().load(e,t.framework.AssetTypeEnum.Auto,function(t){if(t.isfinish){var o=a.getAssetMgr().getAssetByName(e.substring(e.lastIndexOf("/")+1));i.navmeshLoaded(o.content,function(){r&&r(t)})}else t.iserror&&r&&r(t)}))},NavMeshLoadManager.prototype.loadNavMeshByDate=function(t,e,a){e&&(this.app=e,this.navmeshLoaded(t,a))},NavMeshLoadManager.prototype.navmeshLoaded=function(e,a){if(console.warn("navmeshLoaded"),null!=e&&""!=e){this._navmeshJson=e,null!=this.navTrans&&(this.navTrans.parent&&this.navTrans.parent.removeChild(this.navTrans),this.navTrans.dispose()),this.navTrans=new t.framework.transform,this.navTrans.name="navMesh",this.navTrans.gameObject.hideFlags=t.framework.HideFlags.HideInHierarchy;var r=new t.render.meshData;r.pos=[],r.trisindex=[];for(var i=t.framework.navMeshInfo.LoadMeshInfo(e),o=0;o<i.vecs.length;o++){var n=i.vecs[o],s=n.x-this.navMeshVertexOffset.x,l=n.y-this.navMeshVertexOffset.y,h=n.z-this.navMeshVertexOffset.z;r.pos[o]=new t.math.vector3(s,l,h)}for(var c={},u=[],o=0;o<i.nodes.length;o++)for(var d=i.nodes[o].poly,m=0;m<d.length-2;m++)c[u.length/3]=o,u.push(d[0]),u.push(d[m+2]),u.push(d[m+1]);r.trisindex=u;var p=this.navTrans.gameObject.addComponent("meshFilter");this.navMesh=this.createMesh(r,this.app.webgl),p.mesh=this.navMesh,this.app.getScene().addChild(this.navTrans),this.navTrans.markDirty(),this.navigate=new t.framework.Navigate(i,c),a()}},NavMeshLoadManager.prototype.createMesh=function(e,a){var r=new t.framework.mesh;r.data=e;var i=t.render.VertexFormatMask.Position,o=r.data.genVertexDataArray(i),n=r.data.genIndexDataArray();r.glMesh=new t.render.glMesh,r.glMesh.initBuffer(a,i,r.data.pos.length),r.glMesh.uploadVertexSubData(a,o),r.glMesh.addIndex(a,n.length),r.glMesh.uploadIndexSubData(a,0,n),r.submesh=[];var s=new t.framework.subMeshInfo;return s.matIndex=0,s.useVertexIndex=0,s.start=0,s.size=n.length,s.line=!1,r.submesh.push(s),r},NavMeshLoadManager.prototype.showNavmesh=function(e,a){if(void 0===a&&(a=null),this.navTrans){if(this.navTrans.gameObject.visible=e,!e)return this.navTrans.localTranslate=new t.math.vector3(0,0,0),void this.navTrans.markDirty();var r=this.navTrans.gameObject.getComponent("meshRenderer");null==r&&(r=this.navTrans.gameObject.addComponent("meshRenderer"),a&&(r.materials=[],r.materials[0]=a)),this.navTrans.localTranslate=new t.math.vector3(0,0,0),this.navTrans.markDirty()}},NavMeshLoadManager.prototype.dispose=function(){this.navTrans&&(this.navTrans.parent.removeChild(this.navTrans),this.navTrans.dispose(),this.navTrans=null,this.navMesh.dispose(),this.navMesh=null,this.navigate.dispose(),this.navigate=null)},Object.defineProperty(NavMeshLoadManager,"Instance",{get:function(){return null==NavMeshLoadManager._instance&&(NavMeshLoadManager._instance=new NavMeshLoadManager),NavMeshLoadManager._instance},enumerable:!0,configurable:!0}),NavMeshLoadManager.prototype.moveToPoints=function(e,a){var r=NavMeshLoadManager.Instance.navTrans,i=NavMeshLoadManager.Instance.navigate;if(i){var o=NavMeshLoadManager.findtriIndex(e,r);if(void 0==o){var n=new t.math.vector3,s=new t.math.vector3;t.math.vec3Subtract(a,e,n),t.math.vec3Normalize(n,n);for(var l=0;l<5;l++){t.math.vec3Clone(n,s),t.math.vec3ScaleByNum(s,2*(l+1),s);var h=new t.math.vector3;if(t.math.vec3Add(e,s,h),void 0!=(o=NavMeshLoadManager.findtriIndex(h,r)))break}}var c=NavMeshLoadManager.findtriIndex(a,r);return i.pathPoints(e,a,o,c)}},NavMeshLoadManager.findtriIndex=function(e,a){var r,i=-1,o=new t.framework.ray(new t.math.vector3(e.x,e.y+500,e.z),new t.math.vector3(0,-1,0)),n=a.gameObject.getComponent("meshFilter");if(null!=n&&(r=n.getMeshOutput()),r){var s=t.math.pool.new_pickInfo();return r.intersects(o,a.getWorldMatrix(),s)&&(i=s.faceId),t.math.pool.delete_pickInfo(s),i}},NavMeshLoadManager}();e.NavMeshLoadManager=a}(t.framework||(t.framework={}))}(gd3d||(gd3d={}));var gd3d;!function(t){!function(e){var a=function(){function FindNode(){this.nodeid=0,this.pathSessionId=0,this.ParentID=-1,this.Open=!1,this.HValue=0,this.GValue=0,this.ArrivalWall=0}return FindNode.prototype.CalcHeuristic=function(t,e){var a=t.nodes[this.nodeid].center,r=Math.abs(a.x-e.x),i=Math.abs(a.z-e.z);this.HValue=Math.sqrt(r*r+i*i)},FindNode.prototype.GetCost=function(t,e){var a=t.nodes[e].center,r=t.nodes[this.nodeid].center,i=a.x-r.x,o=a.y-r.y,n=a.z-r.z;return Math.sqrt(i*i+o*o+n*n)},FindNode}(),r=function(){function pathFinding(){}return pathFinding.calcAStarPolyPath=function(t,e,r,i,o){void 0===i&&(i=null),void 0===o&&(o=.1);for(var n=[],s=t.nodes,l=0;l<s.length;l+=1){var h=s[l],c=new a;c.nodeid=h.nodeID,n.push(c)}null===i&&(i=t.nodes[r].center.clone());var u=n[e];u.nodeid=e;var d=[],m=[];u.pathSessionId=1,d.push(e);for(;d.length>0;){var p=n[d[d.length-1]];if(d.splice(d.length-1,1),m.push(p.nodeid),p.nodeid===r){!0;break}for(var f=t.nodes[p.nodeid].getLinked(t),g=0;g<f.length;g+=1){var v=f[g];if(!(v<0)){var y=n[v];if(null===y||y.nodeid!==v)return null;if(1!==y.pathSessionId){var _=t.nodes[y.nodeid].isLinkTo(t,p.nodeid);null!==_&&t.borders[_].length>=2*o&&(y.pathSessionId=1,y.ParentID=p.nodeid,y.Open=!0,y.CalcHeuristic(t,i),y.GValue=p.GValue+p.GetCost(t,y.nodeid),d.push(y.nodeid),d.sort(function(t,e){var a=n[t].HValue+n[t].GValue,r=n[e].HValue+n[e].GValue;return a<r-.001?1:a>r+.001?-1:0}),y.ArrivalWall=p.nodeid)}else y.Open&&y.GValue+y.GetCost(t,p.nodeid)<p.GValue&&(p.GValue=y.GValue+y.GetCost(t,p.nodeid),p.ParentID=y.nodeid,p.ArrivalWall=y.nodeid)}}}var b=[];if(m.length>0){var w=n[m[m.length-1]];for(b.push(w.nodeid);-1!==w.ParentID;)b.push(w.ParentID),w=n[w.ParentID]}return b},pathFinding.NearAngle=function(t,e){var a=t;t>=180&&(a=360-t);var r=e;e>=180&&(r=360-e);return a<r?t:e},pathFinding.FindPath=function(t,e,a,r){void 0===r&&(r=.1);for(var i=-1,o=-1,n=0;n<t.nodes.length;n+=1)t.inPoly(e,t.nodes[n].poly)&&(i=n),t.inPoly(e,t.nodes[n].poly)&&(o=n);var s=pathFinding.calcAStarPolyPath(t,i,o,a,r);return pathFinding.calcWayPoints(t,e,a,s,r)},pathFinding.calcWayPoints=function(e,a,r,i,o){void 0===o&&(o=.1);var n=[];if(0==i.length||null==a||null==r)return null;var s=i.reverse();n.push(a);for(var l=0,h=null,c=-1,u=null,d=-1,m=0,p=null,f=null,g=a.clone(),v=0;v<100;v++){for(var y=l;y<s.length;y++)if(y===s.length-1){if(null==h||null==u){m=0;break}var _=t.framework.navVec3.NormalAZ(g,r),b=t.framework.navVec3.Angle(h,_),w=t.framework.navVec3.Angle(u,_);if(!(b*w>0)){m=0;break}m=b>0?1:-1}else{var x=s[y],D=s[y+1],E=x+"-"+D;D<x&&(E=D+"-"+x);var T=e.borders[E],M=t.framework.navVec3.Border(e.vecs[T.pointA],e.vecs[T.pointB],o),A=t.framework.navVec3.Border(e.vecs[T.pointB],e.vecs[T.pointA],o),S=t.framework.navVec3.DistAZ(g,M),C=t.framework.navVec3.DistAZ(g,A);if(S<.001||C<.001)continue;if(null==h&&(h=t.framework.navVec3.NormalAZ(g,M),p=M.clone(),c=y),null==u&&(u=t.framework.navVec3.NormalAZ(g,A),f=A.clone(),d=y),t.framework.navVec3.Angle(h,u)<0){var F=h,R=p,k=c;h=u,p=f,c=d,u=F,f=R,d=k}if(c!=y||d!=y){var P=t.framework.navVec3.NormalAZ(g,M),B=t.framework.navVec3.NormalAZ(g,A);if(t.framework.navVec3.Angle(P,B)<0){var I=P,N=M;P=B,M=A,B=I,A=N}var O=t.framework.navVec3.Angle(h,P),L=t.framework.navVec3.Angle(u,P),V=t.framework.navVec3.Angle(h,B),U=t.framework.navVec3.Angle(u,B);if(O<0&&V<0){m=-1;break}if(L>0&&U>0){m=1;break}O>0&&L<0&&(h=P,p=M,c=y),V>0&&U<0&&(u=B,f=A,d=y)}}if(0==m)break;-1==m?(n.push(p.clone()),g=p,l=c):(n.push(f.clone()),g=f,l=d),h=null,u=null,c=-1,d=-1}return n.push(r),n},pathFinding}();e.pathFinding=r}(t.framework||(t.framework={}))}(gd3d||(gd3d={}));var gd3d;!function(t){!function(e){var a=function(){function RVOManager(){this.sim=new RVO.Simulator(1,60,20,20,5,1,.1,[0,0]),this.transforms=[],this.goals=[],this.radius=[],this.attackRanges=[],this.speeds=[],this.map={},this.isRunning=!1,this.currMoveDir=new t.math.vector2,this._RoadPoints=[]}return RVOManager.prototype.setRoadPoints=function(e){var a=this;if(e&&!(e.length<1)){this._RoadPoints.forEach(function(e){e&&e!=a.lastGoal&&t.math.pool.delete_vector3(e)}),this._RoadPoints.length=0;for(var r=0;r<e.length;r++){var i=t.math.pool.new_vector3();t.math.vec3Clone(e[r],i),this._RoadPoints.push(i)}this.currGoal=this._RoadPoints.pop(),this.goals[0][0]=this.currGoal.x,this.goals[0][1]=this.currGoal.z}},RVOManager.prototype.addAgent=function(t,e,a,r,i){var o=this.sim.agents.length,n=[e.localTranslate.x,e.localTranslate.z];this.transforms.push(e),this.attackRanges.push(r),this.radius.push(a),this.speeds.push(i),this.goals.push(n),this.sim.addAgent(n),this.sim.agents[o].id=t,this.sim.agents[o].radius=a,this.sim.agents[o].maxSpeed=i,this.map[t]=o,0==o&&(this.sim.agents[0].neighborDist=0),this.isRunning=!0},RVOManager.prototype.removeAgent=function(t){var e=this.map[t];this.transforms.splice(e,1),this.attackRanges.splice(e,1),this.radius.splice(e,1),this.speeds.splice(e,1),this.goals.splice(e,1),this.sim.agents.splice(e,1),this.reBuildHashMap()},RVOManager.prototype.reBuildHashMap=function(){for(var t=0;t<this.sim.agents.length;t++)this.map[this.sim.agents[t].id]=t;this.sim.kdTree.agents=[],this.sim.kdTree.agentTree=[],this.sim.kdTree.obstacleTree=0},RVOManager.prototype.getTransformByKey=function(t){var e=this.map[t];return this.transforms[e]},RVOManager.prototype.setRadius=function(t,e){var a=this.map[t];this.sim.agents[a].radius=e},RVOManager.prototype.setSpeed=function(t,e){var a=this.map[t];this.sim.agents[a].maxSpeed=e},RVOManager.prototype.setAttackRange=function(t,e){var a=this.map[t];this.attackRanges[a]=e},RVOManager.prototype.disable=function(){this.isRunning=!1},RVOManager.prototype.enable=function(){this.isRunning=!0;for(var t in this.transforms)this.sim.agents[t].position=[this.transforms[t].localTranslate.x,this.transforms[t].localTranslate.z]},RVOManager.prototype.update=function(){this.isRunning&&this.transforms.length>=1&&(this.RVO_check(this.sim,this.goals),this.RVO_walking(this.sim,this.goals),this.updateTransform(this.sim))},RVOManager.prototype.isAlmostStatic=function(){for(var t=0,e=0;e<this.sim.agents.length;e++)null!=this.sim.agents[e].prefVelocity&&this.sim.agents[e].prefVelocity[0]<.01&&this.sim.agents[e].prefVelocity[1]<.01&&t++;return t/this.sim.agents.length>=.1},RVOManager.prototype.RVO_walking=function(t,e){for(var a=0,r=t.agents.length;a<r;a++)if(null!=t.agents[a]){var i=RVO.Vector.subtract(e[a],t.agents[a].position);RVO.Vector.absSq(i)>1&&(i=RVO.Vector.normalize(i)),t.agents[a].prefVelocity=i}t.doStep()},RVOManager.prototype.updateTransform=function(e){for(var a=0;a<e.agents.length;a++){if(this.transforms[a].localTranslate.x=e.agents[a].position[0],this.transforms[a].localTranslate.z=e.agents[a].position[1],0==a&&this.currGoal&&this.lastGoal){var r=this.transforms[a].localTranslate,i=t.math.pool.new_vector2();this.cal2dDir(this.lastGoal,r,i);var o=t.math.vec2Length(i),n=t.math.vec2Length(this.currMoveDir),s=t.math.numberLerp(this.lastGoal.y,this.currGoal.y,o/n);isNaN(s)||(r.y=t.math.numberLerp(this.lastGoal.y,this.currGoal.y,o/n)),t.math.pool.delete_vector2(i)}this.transforms[a].markDirty()}},RVOManager.prototype.RVO_check=function(e,a){if(this.currGoal){var r=this.transforms[0],i=t.math.pool.new_vector2();i.x=r.localTranslate.x,i.y=r.localTranslate.z;var o=t.math.pool.new_vector2();o.x=this.currGoal.x,o.y=this.currGoal.z,t.math.vec2Distance(i,o)<.01&&(this.currGoal&&(this.lastGoal&&t.math.pool.delete_vector3(this.lastGoal),this.lastGoal=this.currGoal,this.currGoal=null,a[0]=e.agents[0].position,e.agents[0].radius=this.radius[0]),this._RoadPoints&&this._RoadPoints.length>0&&(this.currGoal=this._RoadPoints.pop(),this.cal2dDir(this.lastGoal,this.currGoal,this.currMoveDir),a[0]=[this.currGoal.x,this.currGoal.z],e.agents[0].radius=.1))}else this._RoadPoints&&this._RoadPoints.length>0&&(this.currGoal=this._RoadPoints.pop(),a[0]=[this.currGoal.x,this.currGoal.z],e.agents[0].radius=.1);for(var n=1,s=e.agents.length;n<s;n++)RVO.Vector.absSq(RVO.Vector.subtract(e.agents[n].position,e.agents[0].position))<this.attackRanges[n]?(a[n]=e.agents[n].position,e.agents[n].neighborDist=0):(a[n]=e.agents[0].position,e.agents[n].neighborDist=e.agentDefaults.neighborDist)},RVOManager.prototype.cal2dDir=function(e,a,r){if(e&&a&&r){var i=t.math.pool.new_vector2();i.x=e.x,i.y=e.z;var o=t.math.pool.new_vector2();o.x=a.x,o.y=a.z,t.math.vec2Subtract(o,i,r),t.math.pool.delete_vector2(i),t.math.pool.delete_vector2(o)}},RVOManager}();e.RVOManager=a}(t.framework||(t.framework={}))}(gd3d||(gd3d={}));var gd3d;!function(t){!function(e){var a=function(){function EffectSystemData(){this.beLoop=!1,this.elementDic={}}return EffectSystemData.prototype.clone=function(){var t=new EffectSystemData;t.life=this.life,t.beLoop=this.beLoop;for(var e in this.elementDic)t.elementDic[e]=this.elementDic[e].clone();return t},EffectSystemData.prototype.dispose=function(){for(var t in this.elementDic)this.elementDic[t].dispose(),delete this.elementDic[t]},EffectSystemData}();e.EffectSystemData=a;var r=function(){function EffectElement(t){this.startVboIndex=0,this.startEboIndex=0,this.endEboIndex=0,this.delayTime=0,this.actionActive=!1,this.loopFrame=Number.MAX_VALUE,this.active=!0,this.data=t,this.name=this.data.name,this.timelineFrame={},this.delayTime=t.delayTime,this.initActions(),this.recordElementLerpAttributes()}return EffectElement.prototype.recordElementLerpAttributes=function(){if(void 0!=this.data.timelineFrame)for(var t in this.data.timelineFrame){var e=this.data.timelineFrame[t];if(-1!=e.frameIndex)if(void 0!=e.lerpDatas&&0!=e.lerpDatas.length)this.recordLerpValues(e);else if(void 0!=e.attrsData){void 0==this.timelineFrame[e.frameIndex]&&(this.timelineFrame[e.frameIndex]=new n,this.timelineFrame[e.frameIndex].attrsData=new o,this.timelineFrame[e.frameIndex].frameIndex=e.frameIndex);for(var a in e.attrsData)this.timelineFrame[e.frameIndex].attrsData.setLerpAttribute(a,e.attrsData.getAttribute(a))}}},EffectElement.prototype.recordLerpValues=function(t){for(var e in t.lerpDatas)if(t.lerpDatas[e].type==d.Linear)for(var a in t.lerpDatas[e].attrsList){var r=t.lerpDatas[e].attrsList[a];this.recordLerp(t,t.lerpDatas[e],r)}},EffectElement.prototype.recordLerp=function(e,a,r){var i=a.fromFrame,s=a.toFrame.getValue(),l=a.attrsData.getAttribute(r);void 0==e.attrsData[r]&&e.attrsData.initAttribute(r);for(var h=e.attrsData.getAttribute(r),c=i+1;c<=s;c++){var u=void 0;h instanceof t.math.vector3?(u=new t.math.vector3,t.math.vec3SLerp(h,l,(c-i)/(s-i),u)):h instanceof t.math.vector2?(u=new t.math.vector2,t.math.vec2SLerp(h,l,(c-i)/(s-i),u)):"number"==typeof h&&(u=t.math.numberLerp(h,l,(c-i)/(s-i)));var d=this.timelineFrame[c];void 0==d&&((d=new n).attrsData=new o,d.frameIndex=c,this.timelineFrame[c]=d),d.attrsData.setLerpAttribute(r,u)}},EffectElement.prototype.initActions=function(){this.actions=[];var t;for(var a in this.data.actionData){var r=this.data.actionData[a];switch(r.actionType){case"linear":t=new e.LinearAction;break;case"destroy":t=new e.DestroyAction;break;case"loop":t=new e.LoopAction;break;case"destroy":t=new e.DestroyAction;break;case"rotation":t=new e.RotationAction;break;case"breath":t=new e.BreathAction;break;case"uvroll":t=new e.UVRollAction;break;case"uvsprite":t=new e.UVSpriteAnimationAction;break;case"rosepath":t=new e.RoseCurveAction;break;case"trail":t=new e.TrailAction}t.init(r.startFrame,r.endFrame,r.params,this),this.actions.push(t)}},EffectElement.prototype.update=function(){void 0!=this.curAttrData&&null!=this.curAttrData&&(this.active?(void 0!=this.curAttrData.euler&&t.math.quatFromEulerAngles(this.curAttrData.euler.x,this.curAttrData.euler.y,this.curAttrData.euler.z,this.curAttrData.rotationByEuler),this.updateElementRotation(),t.math.matrixMakeTransformRTS(this.curAttrData.pos,this.curAttrData.scale,this.curAttrData.localRotation,this.curAttrData.matrix)):this.curAttrData.resetMatrix())},EffectElement.prototype.updateElementRotation=function(){var a=t.framework.sceneMgr.app.getScene().mainCamera.gameObject.transform,r=t.math.pool.new_quaternion(),i=t.math.pool.new_quaternion();if(this.curAttrData.renderModel!=m.None){var o=t.math.pool.new_quaternion(),n=t.math.pool.new_vector3(),s=t.math.pool.new_vector3();if(t.math.vec3Clone(this.curAttrData.pos,s),void 0!=this.transform&&t.math.matrixTransformVector3(s,this.transform.getWorldMatrix(),n),this.curAttrData.renderModel==m.BillBoard)t.math.quatLookat(n,a.getWorldTranslate(),r);else if(this.curAttrData.renderModel==m.HorizontalBillBoard)r.x=-.5,r.y=.5,r.z=.5,r.w=.5;else if(this.curAttrData.renderModel==m.VerticalBillBoard){var l=t.math.pool.new_vector3();t.math.vec3Clone(a.getWorldTranslate(),l),l.y=n.y,t.math.quatLookat(n,l,r),t.math.pool.delete_vector3(l)}else{if(this.curAttrData.renderModel==m.StretchedBillBoard){t.math.quatMultiply(r,this.curAttrData.rotationByEuler,this.curAttrData.localRotation),t.math.quatLookat(n,a.getWorldTranslate(),r);var h=new t.math.quaternion;t.math.quatClone(this.transform.getWorldRotate(),o),t.math.quatInverse(o,o),t.math.quatMultiply(o,r,h);var c=t.math.pool.new_quaternion();t.math.quatInverse(this.curAttrData.localRotation,c),t.math.quatMultiply(c,h,h);var u=t.math.pool.new_vector3();return t.math.quatToEulerAngles(h,u),t.math.quatFromEulerAngles(0,u.y,0,h),t.math.quatMultiply(this.curAttrData.localRotation,h,this.curAttrData.localRotation),t.math.pool.delete_quaternion(c),t.math.pool.delete_vector3(u),void t.math.pool.delete_quaternion(h)}this.curAttrData.renderModel==m.Mesh&&e.EffectUtil.quatLookatZ(n,a.getWorldTranslate(),r)}t.math.quatMultiply(r,this.curAttrData.rotationByEuler,r),t.math.quatClone(this.transform.gameObject.transform.getWorldRotate(),o),t.math.quatInverse(o,o),t.math.quatMultiply(o,r,this.curAttrData.localRotation),t.math.pool.delete_vector3(s),t.math.pool.delete_vector3(n),t.math.pool.delete_quaternion(o)}else t.math.quatMultiply(r,this.curAttrData.rotationByEuler,this.curAttrData.localRotation);t.math.pool.delete_quaternion(i),t.math.pool.delete_quaternion(r)},EffectElement.prototype.isCurFrameNeedRefresh=function(t){return void 0!=this.timelineFrame[t]||(void 0!=this.curAttrData&&this.curAttrData.renderModel!=m.None||this.actionActive)},EffectElement.prototype.setActive=function(t){this.active!=t&&(this.active=t,this.active||this.curAttrData.resetMatrix())},EffectElement.prototype.dispose=function(){this.data.dispose(),this.curAttrData=null,this.actions.length=0,delete this.timelineFrame},EffectElement}();e.EffectElement=r;var i=function(){function EffectElementData(){this.delayTime=0}return EffectElementData.prototype.clone=function(){var t=new EffectElementData;t.name=this.name,t.type=this.type,t.refFrom=this.refFrom,t.beloop=this.beloop,t.actionData=[],t.timelineFrame=[],this.initFrameData&&(t.initFrameData=this.initFrameData.clone()),this.emissionData&&(t.emissionData=this.emissionData.clone());for(var e in this.timelineFrame)this.timelineFrame[e]&&(t.timelineFrame[e]=this.timelineFrame[e].clone());for(var e in this.actionData)this.actionData[e]&&(t.actionData[e]=this.actionData[e].clone());return t},EffectElementData.prototype.dispose=function(){this.actionData&&(this.actionData.length=0),this.initFrameData&&this.initFrameData.dispose();for(var t in this.timelineFrame)this.timelineFrame[t].dispose();delete this.timelineFrame},EffectElementData}();e.EffectElementData=i;var o=function(){function EffectAttrsData(){this.uv=new t.math.vector2(1,1),this.renderModel=m.None,this.matrix=new t.math.matrix,this.rotationByEuler=new t.math.quaternion,this.localRotation=new t.math.quaternion}return EffectAttrsData.prototype.setLerpAttribute=function(t,e){switch(t){case"pos":this.pos=e;break;case"scale":this.scale=e;break;case"euler":this.euler=e;break;case"alpha":this.alpha=e;break;case"uv":this.uv=e;break;case"color":this.color=e;break;case"tilling":console.log("tilling 逻辑上不需要插值")}},EffectAttrsData.prototype.getAttribute=function(e){switch(e){case"pos":return t.math.pool.clone_vector3(this.pos);case"scale":return t.math.pool.clone_vector3(this.scale);case"euler":return t.math.pool.clone_vector3(this.euler);case"alpha":return this.alpha;case"color":return t.math.pool.clone_vector3(this.color);case"tilling":return t.math.pool.clone_vector2(this.tilling);case"uv":return t.math.pool.clone_vector2(this.uv);case"mat":return this.mat.clone();case"renderModel":return this.renderModel;case"rotationByEuler":return t.math.pool.clone_quaternion(this.rotationByEuler);case"localRotation":return t.math.pool.clone_quaternion(this.localRotation);case"matrix":return t.math.pool.clone_matrix(this.matrix);case"colorRate":return this.colorRate}},EffectAttrsData.prototype.initAttribute=function(e){switch(e){case"pos":this.pos=new t.math.vector3(0,0,0);break;case"scale":this.scale=new t.math.vector3(1,1,1);break;case"euler":this.euler=new t.math.vector3(0,0,0);break;case"alpha":this.alpha=0;break;case"color":this.color=new t.math.vector3(0,0,0);break;case"uv":this.uv=new t.math.vector2(0,0);break;case"tilling":this.tilling=new t.math.vector2(1,1);break;case"colorRate":this.colorRate=1;break;default:console.log("不支持的属性："+e)}},EffectAttrsData.prototype.resetMatrix=function(){t.math.matrixZero(this.matrix)},EffectAttrsData.prototype.copyandinit=function(){var e=new EffectAttrsData;return void 0!=this.pos?e.pos=t.math.pool.clone_vector3(this.pos):e.initAttribute("pos"),void 0!=this.euler?e.euler=t.math.pool.clone_vector3(this.euler):e.initAttribute("euler"),void 0!=this.color?e.color=t.math.pool.clone_vector3(this.color):e.initAttribute("color"),void 0!=this.scale?e.scale=t.math.pool.clone_vector3(this.scale):e.initAttribute("scale"),void 0!=this.uv?e.uv=t.math.pool.clone_vector2(this.uv):e.initAttribute("uv"),void 0!=this.tilling?e.tilling=t.math.pool.clone_vector2(this.tilling):e.initAttribute("tilling"),void 0!=this.colorRate?e.colorRate=this.colorRate:e.initAttribute("colorRate"),void 0!=this.mat&&(e.mat=this.mat.clone()),void 0!=this.rotationByEuler&&(e.rotationByEuler=t.math.pool.clone_quaternion(this.rotationByEuler)),void 0!=this.localRotation&&(e.localRotation=t.math.pool.clone_quaternion(this.localRotation)),void 0!=this.meshdataVbo&&(e.meshdataVbo=this.meshdataVbo),e.alpha=this.alpha,e.renderModel=this.renderModel,e.mesh=this.mesh,e},EffectAttrsData.prototype.clone=function(){var e=new EffectAttrsData;return void 0!=this.pos&&(e.pos=t.math.pool.clone_vector3(this.pos)),void 0!=this.euler&&(e.euler=t.math.pool.clone_vector3(this.euler)),void 0!=this.color&&(e.color=t.math.pool.clone_vector3(this.color)),void 0!=this.scale&&(e.scale=t.math.pool.clone_vector3(this.scale)),void 0!=this.tilling&&(e.tilling=t.math.pool.clone_vector2(this.tilling)),void 0!=this.colorRate&&(e.colorRate=this.colorRate),void 0!=this.uv&&(e.uv=t.math.pool.clone_vector2(this.uv)),void 0!=this.mat&&(e.mat=this.mat.clone()),void 0!=this.rotationByEuler&&(e.rotationByEuler=t.math.pool.clone_quaternion(this.rotationByEuler)),void 0!=this.localRotation&&(e.localRotation=t.math.pool.clone_quaternion(this.localRotation)),void 0!=this.meshdataVbo&&(e.meshdataVbo=this.meshdataVbo),e.alpha=this.alpha,e.renderModel=this.renderModel,e.mesh=this.mesh,e},EffectAttrsData}();e.EffectAttrsData=o;var n=function(){function EffectFrameData(){}return EffectFrameData.prototype.clone=function(){var t=new EffectFrameData;t.frameIndex=this.frameIndex,t.attrsData=this.attrsData.clone(),t.lerpDatas=[];for(var e in this.lerpDatas)t.lerpDatas[e]=this.lerpDatas[e].clone();return t},EffectFrameData.prototype.dispose=function(){this.attrsData=null,this.lerpDatas&&(this.lerpDatas.length=0)},EffectFrameData}();e.EffectFrameData=n;var s=function(){function EffectLerpData(){this.attrsList=[]}return EffectLerpData.prototype.clone=function(){var t=new EffectLerpData;t.type=this.type,t.fromFrame=this.fromFrame,t.toFrame=this.toFrame,t.attrsData=this.attrsData.clone();for(var e in this.attrsList)t.attrsList[e]=this.attrsList[e];return t},EffectLerpData}();e.EffectLerpData=s;var l=function(){function EffectActionData(){}return EffectActionData.prototype.clone=function(){var t=new EffectActionData;t.actionType=this.actionType,t.startFrame=this.startFrame,t.endFrame=this.endFrame,t.params=[];for(var e in this.params)t.params[e]=this.params[e];return t},EffectActionData}();e.EffectActionData=l;var h=function(){function EffectMatData(){}return EffectMatData.beEqual=function(t,e){return t.alphaCut===e.alphaCut&&t.diffuseTexture===e.diffuseTexture&&t.shader===e.shader&&t.alphaTexture===e.alphaTexture},EffectMatData.prototype.clone=function(){var t=new EffectMatData;return t.shader=this.shader,t.diffuseTexture=this.diffuseTexture,t.alphaTexture=this.alphaTexture,t.alphaCut=this.alphaCut,t},EffectMatData}();e.EffectMatData=h;var c;!function(t){t[t.NotInitedStateType=0]="NotInitedStateType",t[t.InitedStateType=1]="InitedStateType",t[t.ResizeCapacityStateType=2]="ResizeCapacityStateType"}(c=e.EffectBatcherState||(e.EffectBatcherState={}));var u=function(){function EffectBatcher(e){this.state=c.NotInitedStateType,this.effectElements=[],this._totalVertexCount=0,this._indexStartIndex=0,this._vbosize=0,this.vertexSize=0,this.vertexSize=t.render.meshData.calcByteSize(e)/4}return Object.defineProperty(EffectBatcher.prototype,"curTotalVertexCount",{get:function(){return this._totalVertexCount},set:function(t){this._totalVertexCount=t,this.resizeVboSize(this._totalVertexCount*this.vertexSize)},enumerable:!0,configurable:!0}),Object.defineProperty(EffectBatcher.prototype,"indexStartIndex",{get:function(){return this._indexStartIndex},set:function(t){if(this._indexStartIndex=t,null!=this.dataForEbo){var e=new Uint16Array(this._indexStartIndex);e.set(this.dataForEbo,0),this.dataForEbo=e}else this.dataForEbo=new Uint16Array(this._indexStartIndex)},enumerable:!0,configurable:!0}),EffectBatcher.prototype.resizeVboSize=function(t){if(!(this._vbosize>t))if(this._vbosize=t,null!=this.dataForVbo){var e=new Float32Array(this._vbosize);e.set(this.dataForVbo,0),this.dataForVbo=e}else this.dataForVbo=new Float32Array(this._vbosize)},EffectBatcher.prototype.dispose=function(){this.mesh.dispose(),this.mat.dispose(),this.dataForVbo=null,this.dataForEbo=null;for(var t in this.effectElements)this.effectElements[t].dispose()},EffectBatcher}();e.EffectBatcher=u;!function(t){t[t.None=0]="None",t[t.BeReady=1]="BeReady",t[t.Play=2]="Play",t[t.Pause=3]="Pause",t[t.Stop=4]="Stop",t[t.Dispose=5]="Dispose"}(e.EffectPlayStateEnum||(e.EffectPlayStateEnum={}));!function(t){t[t.SingleMeshType=0]="SingleMeshType",t[t.EmissionType=1]="EmissionType",t[t.MultiMeshType=2]="MultiMeshType"}(e.EffectElementTypeEnum||(e.EffectElementTypeEnum={}));var d;!function(t){t[t.Linear=0]="Linear"}(d=e.EffectLerpTypeEnum||(e.EffectLerpTypeEnum={}));var m;!function(t){t[t.None=0]="None",t[t.BillBoard=1]="BillBoard",t[t.StretchedBillBoard=2]="StretchedBillBoard",t[t.HorizontalBillBoard=3]="HorizontalBillBoard",t[t.VerticalBillBoard=4]="VerticalBillBoard",t[t.Mesh=5]="Mesh"}(m=e.RenderModel||(e.RenderModel={}))}(t.framework||(t.framework={}))}(gd3d||(gd3d={}));var gd3d;!function(t){!function(t){var e;!function(t){t[t.burst=0]="burst",t[t.continue=1]="continue"}(e=t.ParticleEmissionType||(t.ParticleEmissionType={}));var a=function(){return function EmissionData(){this.type=e.burst}}();t.EmissionData=a}(t.framework||(t.framework={}))}(gd3d||(gd3d={}));var gd3d;!function(t){!function(e){var a=function(){function Emission(){this.simulateInLocalSpace=!0,this.renderModel=e.RenderModel.Mesh,this.particleStartData=new t.framework.ParticleStartData}return Emission.prototype.getVboData=function(t){return void 0==this.dataForVbo&&(this.dataForVbo=this.mesh.data.genVertexDataArray(t)),this.dataForVbo},Emission.prototype.clone=function(){var e=new Emission;return void 0!=this.emissionType&&(e.emissionType=this.emissionType),e.simulateInLocalSpace=this.simulateInLocalSpace,void 0!=this.rootpos&&(e.rootpos=t.math.pool.clone_vector3(this.rootpos)),void 0!=this.rootRotAngle&&(e.rootRotAngle=t.math.pool.clone_vector3(this.rootRotAngle)),void 0!=this.rootScale&&(e.rootScale=t.math.pool.clone_vector3(this.rootScale)),void 0!=this.maxEmissionCount&&(e.maxEmissionCount=this.maxEmissionCount),void 0!=this.emissionCount&&(e.emissionCount=this.emissionCount),void 0!=this.time&&(e.time=this.time),void 0!=this.simulationSpeed&&(e.simulationSpeed=this.simulationSpeed.clone()),void 0!=this.moveSpeed&&(e.moveSpeed=this.moveSpeed.clone()),void 0!=this.gravity&&(e.gravity=this.gravity),void 0!=this.euler&&(e.euler=this.euler.clone()),void 0!=this.eulerNodes&&(e.eulerNodes=this.cloneParticleNodeArray(this.eulerNodes)),void 0!=this.eulerSpeed&&(e.eulerSpeed=this.eulerSpeed.clone()),void 0!=this.scale&&(e.scale=this.scale.clone()),void 0!=this.scaleNodes&&(e.scaleNodes=this.cloneParticleNodeNumberArray(this.scaleNodes)),void 0!=this.scaleSpeed&&(e.scaleSpeed=this.scaleSpeed.clone()),void 0!=this.color&&(e.color=this.color.clone()),void 0!=this.colorRate&&(e.colorRate=this.colorRate),void 0!=this.colorNodes&&(e.colorNodes=this.cloneParticleNodeArray(this.colorNodes)),void 0!=this.colorSpeed&&(e.colorSpeed=this.colorSpeed.clone()),void 0!=this.simulationSpeed&&(e.simulationSpeed=this.simulationSpeed.clone()),void 0!=this.alpha&&(e.alpha=this.alpha.clone()),void 0!=this.alphaNodes&&(e.alphaNodes=this.cloneParticleNodeNumberArray(this.alphaNodes)),void 0!=this.alphaSpeed&&(e.alphaSpeed=this.alphaSpeed.clone()),void 0!=this.uv&&(e.uv=this.uv.clone()),void 0!=this.uvType&&(e.uvType=this.uvType),void 0!=this.uvRoll&&(e.uvRoll=this.uvRoll.clone()),void 0!=this.uvSprite&&(e.uvSprite=this.uvSprite.clone()),void 0!=this.mat&&(e.mat=this.mat.clone()),void 0!=this.life&&(e.life=this.life.clone()),void 0!=this.renderModel&&(e.renderModel=this.renderModel),void 0!=this.mesh&&(e.mesh=this.mesh),void 0!=this.dataForVbo&&(e.dataForVbo=this.dataForVbo),void 0!=this.particleStartData&&(e.particleStartData=this.particleStartData.clone()),e},Emission.prototype.getworldRotation=function(){},Emission.prototype.cloneParticleNodeArray=function(t){var e=new Array;for(var a in t)e.push(t[a].clone());return e},Emission.prototype.cloneParticleNodeNumberArray=function(t){var e=new Array;for(var a in t)e.push(t[a].clone());return e},Emission}();e.Emission=a;var r=function(){function UVSprite(){}return UVSprite.prototype.clone=function(){var t=new UVSprite;return t.row=this.row,t.column=this.column,t.totalCount=this.totalCount,t},UVSprite}();e.UVSprite=r;var i=function(){function UVRoll(){}return UVRoll.prototype.clone=function(){var t=new UVRoll;if(void 0!=this.uvSpeed&&(t.uvSpeed=this.uvSpeed),void 0!=this.uvSpeedNodes){var e=new Array;for(var a in this.uvSpeedNodes)e.push(this.uvSpeedNodes[a].clone());t.uvSpeedNodes=e}return t},UVRoll}();e.UVRoll=i;!function(t){t[t.NONE=0]="NONE",t[t.UVRoll=1]="UVRoll",t[t.UVSprite=2]="UVSprite"}(e.UVTypeEnum||(e.UVTypeEnum={}))}(t.framework||(t.framework={}))}(gd3d||(gd3d={}));var gd3d;!function(t){!function(e){var a=function(){function ParticleNode(){this.x=new e.ValueData,this.y=new e.ValueData,this.z=new e.ValueData}return ParticleNode.prototype.getValue=function(){return new t.math.vector3(this.x.getValue(),this.y.getValue(),this.z.getValue())},ParticleNode.prototype.getValueRandom=function(){return new t.math.vector3(this.x.getValueRandom(),this.y.getValueRandom(),this.z.getValueRandom())},ParticleNode.prototype.clone=function(){var t=new ParticleNode;return void 0!=this.x&&(t.x=this.x.clone()),void 0!=this.y&&(t.y=this.y.clone()),void 0!=this.z&&(t.z=this.z.clone()),void 0!=this.key&&(t.key=this.key),t},ParticleNode}();e.ParticleNode=a;var r=function(){function AlphaNode(){this.alpha=new e.ValueData}return AlphaNode.prototype.getValue=function(){return this.alpha.getValue()},AlphaNode}();e.AlphaNode=r;var i=function(){function UVSpeedNode(){this.u=new e.ValueData,this.v=new e.ValueData}return UVSpeedNode.prototype.getValue=function(){return new t.math.vector2(this.u.getValue(),this.v.getValue())},UVSpeedNode.prototype.getValueRandom=function(){return new t.math.vector2(this.u.getValueRandom(),this.v.getValueRandom())},UVSpeedNode.prototype.clone=function(){var t=new UVSpeedNode;return t.u=this.u.clone(),t.v=this.v.clone(),void 0!=this.key&&(t.key=this.key),t},UVSpeedNode}();e.UVSpeedNode=i;var o=function(){function ParticleNodeVec2(){this.x=new e.ValueData,this.y=new e.ValueData}return ParticleNodeVec2.prototype.getValue=function(){return new t.math.vector2(this.x.getValue(),this.y.getValue())},ParticleNodeVec2.prototype.getValueRandom=function(){return new t.math.vector2(this.x.getValueRandom(),this.y.getValueRandom())},ParticleNodeVec2.prototype.clone=function(){var t=new ParticleNodeVec2;return t.x=this.x.clone(),t.y=this.y.clone(),void 0!=this.key&&(t.key=this.key),t},ParticleNodeVec2}();e.ParticleNodeVec2=o;var n=function(){function ParticleNodeNumber(){this.num=new e.ValueData}return ParticleNodeNumber.prototype.getValue=function(){return this.num.getValue()},ParticleNodeNumber.prototype.getValueRandom=function(){return this.num.getValueRandom()},ParticleNodeNumber.prototype.clone=function(){var t=new ParticleNodeNumber;return t.num=this.num.clone(),void 0!=this.key&&(t.key=this.key),t},ParticleNodeNumber}();e.ParticleNodeNumber=n}(t.framework||(t.framework={}))}(gd3d||(gd3d={}));var gd3d;!function(t){!function(e){var a;!function(t){t[t.NORMAL=0]="NORMAL",t[t.BOX=1]="BOX",t[t.SPHERE=2]="SPHERE",t[t.HEMISPHERE=3]="HEMISPHERE",t[t.CONE=4]="CONE",t[t.EDGE=5]="EDGE",t[t.CIRCLE=6]="CIRCLE"}(a=e.ParticleSystemShape||(e.ParticleSystemShape={}));var r=function(){function ParticleStartData(){this.shapeType=a.NORMAL,this._position=new t.math.vector3(0,0,0),this._direction=new t.math.vector3(0,1,0),this._width=0,this._height=0,this.depth=0,this._radius=0,this._angle=0,this.emitFrom=i.base}return Object.defineProperty(ParticleStartData.prototype,"position",{get:function(){return this._position},set:function(e){t.math.vec3Clone(e,this._position)},enumerable:!0,configurable:!0}),Object.defineProperty(ParticleStartData.prototype,"direction",{get:function(){return this._direction},set:function(e){t.math.vec3Clone(e,this._direction)},enumerable:!0,configurable:!0}),Object.defineProperty(ParticleStartData.prototype,"width",{get:function(){return this._width},set:function(t){this._width=t},enumerable:!0,configurable:!0}),Object.defineProperty(ParticleStartData.prototype,"height",{get:function(){return this._height},set:function(t){this._height=t},enumerable:!0,configurable:!0}),Object.defineProperty(ParticleStartData.prototype,"radius",{get:function(){return this._radius},set:function(t){this._radius=t},enumerable:!0,configurable:!0}),Object.defineProperty(ParticleStartData.prototype,"angle",{get:function(){return this._angle},set:function(t){this._angle=t},enumerable:!0,configurable:!0}),Object.defineProperty(ParticleStartData.prototype,"randomDirection",{get:function(){switch(this.shapeType){case a.BOX:return this.boxDirection;case a.SPHERE:return this.sphereDirection;case a.HEMISPHERE:return this.hemisphereDirection;case a.CONE:return this.coneDirection;case a.CIRCLE:return this.circleDirection;case a.EDGE:return this.edgeDirection;default:return this.direction}},enumerable:!0,configurable:!0}),Object.defineProperty(ParticleStartData.prototype,"boxDirection",{get:function(){return this.position.x=e.ValueData.RandomRange(-this.width/2,this.width/2),this.position.y=e.ValueData.RandomRange(-this.height/2,this.height/2),this.position.z=e.ValueData.RandomRange(-this.depth/2,this.depth/2),t.math.vec3Normalize(this.position,this.direction),this.direction},enumerable:!0,configurable:!0}),Object.defineProperty(ParticleStartData.prototype,"sphereDirection",{get:function(){var e=Math.random()*Math.PI*2,a=Math.random()*Math.PI,r=Math.random()*this.radius;return this.direction.x=Math.sin(a)*Math.cos(e),this.direction.y=Math.cos(a),this.direction.z=Math.sin(a)*Math.sin(e),t.math.vec3ScaleByNum(this.direction,r,this.position),this.direction},enumerable:!0,configurable:!0}),Object.defineProperty(ParticleStartData.prototype,"hemisphereDirection",{get:function(){var e=Math.random()*Math.PI*2,a=Math.random()*Math.PI*.5,r=Math.random()*this.radius;return this.direction.x=Math.sin(a)*Math.cos(e),this.direction.y=Math.cos(a),this.direction.z=Math.sin(a)*Math.sin(e),t.math.vec3ScaleByNum(this.direction,r,this.position),this.direction},enumerable:!0,configurable:!0}),Object.defineProperty(ParticleStartData.prototype,"coneDirection",{get:function(){var e=Math.random()*Math.PI*2,a=Math.random()*this.height,r=a*Math.tan(this.angle*Math.PI/180)+this.radius,o=Math.random()*r,n=t.math.pool.new_vector3();return n.x=this.radius*Math.cos(e),n.y=0,n.z=this.radius*Math.sin(e),this.emitFrom==i.base?t.math.vec3Clone(n,this.position):this.emitFrom==i.volume&&(this.position.x=o*Math.cos(e),this.position.z=o*Math.sin(e),this.position.y=a),this.direction.x=Math.cos(e)*Math.sin(this.angle*Math.PI/180),this.direction.z=Math.sin(e)*Math.sin(this.angle*Math.PI/180),this.direction.y=Math.cos(this.angle*Math.PI/180),this.direction},enumerable:!0,configurable:!0}),Object.defineProperty(ParticleStartData.prototype,"circleDirection",{get:function(){var a=this.angle*(Math.PI/180),r=e.ValueData.RandomRange(-a/2,a/2),i=e.ValueData.RandomRange(0,this.radius);this.direction.x=i*Math.cos(r),this.direction.z=i*Math.sin(r),this.direction.y=0;var o=t.math.vec3Length(this.direction);return t.math.vec3Normalize(this.direction,this.direction),e.EffectUtil.RotateVector3(this.direction,this.direction,this.direction),this.getposition(this.direction,o),this.direction},enumerable:!0,configurable:!0}),Object.defineProperty(ParticleStartData.prototype,"edgeDirection",{get:function(){var a=new t.math.vector3(0,0,0);a.y+=e.ValueData.RandomRange(-this.radius/2,this.radius/2);t.math.vec3Length(a);return e.EffectUtil.RotateVector3(a,this.direction,a),t.math.vec3Clone(this.direction,this.direction),this.getposition(a,length),this.direction},enumerable:!0,configurable:!0}),ParticleStartData.prototype.getposition=function(e,a){t.math.vec3ScaleByNum(e,a,e),this.position.x=e.x,this.position.y=e.y,this.position.z=e.z},ParticleStartData.prototype.clone=function(){var e=new ParticleStartData;return e.shapeType=this.shapeType,e._position=new t.math.vector3,t.math.vec3Clone(this._position,e._position),e._direction=new t.math.vector3,t.math.vec3Clone(this._direction,e._direction),e._width=this._width,e._height=this._height,e.depth=this.depth,e._radius=this._radius,e._angle=this._angle,e.position=new t.math.vector3,t.math.vec3Clone(this.position,e.position),e.direction=new t.math.vector3,t.math.vec3Clone(this.direction,e.direction),e},ParticleStartData}();e.ParticleStartData=r;var i;!function(t){t[t.base=0]="base",t[t.volume=1]="volume"}(i=e.emitfromenum||(e.emitfromenum={}))}(t.framework||(t.framework={}))}(gd3d||(gd3d={}));var gd3d;!function(t){!function(t){var e=function(){function ValueData(){this.isRandom=!0,this._value=0,this._valueLimitMin=0,this._valueLimitMax=0,this.beInited=!1}return Object.defineProperty(ValueData.prototype,"value",{set:function(t){this._value=t,this.isRandom=!1},enumerable:!0,configurable:!0}),Object.defineProperty(ValueData.prototype,"valueLimitMin",{set:function(t){this._valueLimitMin=t,this.isRandom=!0},enumerable:!0,configurable:!0}),Object.defineProperty(ValueData.prototype,"valueLimitMax",{set:function(t){this._valueLimitMax=t,this.isRandom=!0},enumerable:!0,configurable:!0}),ValueData.prototype.clone=function(){var t=new ValueData;return t.isRandom=this.isRandom,t._value=this._value,t._valueLimitMin=this._valueLimitMin,t._valueLimitMax=this._valueLimitMax,t},ValueData.prototype.getValue=function(){return this.isRandom&&(this.beInited||(this._value=ValueData.RandomRange(this._valueLimitMin,this._valueLimitMax),this.beInited=!0)),this._value},ValueData.prototype.getValueRandom=function(){return this.isRandom&&(this._value=ValueData.RandomRange(this._valueLimitMin,this._valueLimitMax)),this._value},ValueData.RandomRange=function(t,e,a){return void 0===a&&(a=!1),a?Math.floor(Math.random()*(e-t+1)+t):Math.random()*(e-t)+t},ValueData}();t.ValueData=e}(t.framework||(t.framework={}))}(gd3d||(gd3d={}));var gd3d;!function(t){!function(e){var a=function(){function Vector3AttributeData(){this.init()}return Vector3AttributeData.prototype.init=function(){this.data={},this.frameIndexs=[];var e=new o(0,new t.math.vector3);this.addFramePoint(e)},Vector3AttributeData.prototype.addFramePoint=function(t,e){this.data[t.frameIndex]=t,void 0!=t.actions&&(void 0==this.actions&&(this.actions={}),this.actions[t.frameIndex]=t.actions),n.addFrameIndex(this.frameIndexs,t.frameIndex),null!=e&&e()},Vector3AttributeData.prototype.removeFramePoint=function(t,e,a){void 0!=this.data[t]?(delete this.data[t],void 0!=this.actions&&void 0!=this.actions[t]&&delete this.actions[t],void 0!=this.frameIndexs[t]&&this.frameIndexs.splice(this.frameIndexs.indexOf(this.frameIndexs[t]),1),null!=a&&a()):console.warn("当前时间线中没有记录这一帧："+t)},Vector3AttributeData.prototype.updateFramePoint=function(t,e){void 0!=this.data[t.frameIndex]?(this.data[t.frameIndex]=t,void 0!=t.actions&&(this.actions[t.frameIndex]=t.actions),null!=e&&e()):null!=e&&e()},Vector3AttributeData=__decorate([t.reflect.SerializeType,__metadata("design:paramtypes",[])],Vector3AttributeData)}();e.Vector3AttributeData=a;var r=function(){function Vector2AttributeData(){this.init()}return Vector2AttributeData.prototype.init=function(){this.data={},this.frameIndexs=[];var e=new o(0,new t.math.vector2);this.addFramePoint(e)},Vector2AttributeData.prototype.addFramePoint=function(t,e){this.data[t.frameIndex]=t,void 0!=t.actions&&(void 0==this.actions&&(this.actions={}),this.actions[t.frameIndex]=t.actions),n.addFrameIndex(this.frameIndexs,t.frameIndex),null!=e&&e()},Vector2AttributeData.prototype.removeFramePoint=function(t,e,a){void 0!=this.data[t]?(delete this.data[t],void 0!=this.actions&&void 0!=this.actions[t]&&delete this.actions[t],void 0!=this.frameIndexs[t]&&this.frameIndexs.splice(this.frameIndexs.indexOf(this.frameIndexs[t]),1),null!=a&&a()):console.warn("当前时间线中没有记录这一帧："+t)},Vector2AttributeData.prototype.updateFramePoint=function(t,e){void 0!=this.data[t.frameIndex]?(this.data[t.frameIndex]=t,void 0!=t.actions&&(this.actions[t.frameIndex]=t.actions),null!=e&&e()):null!=e&&e()},Vector2AttributeData=__decorate([t.reflect.SerializeType,__metadata("design:paramtypes",[])],Vector2AttributeData)}();e.Vector2AttributeData=r;var i=function(){function NumberAttributeData(){this.init()}return NumberAttributeData.prototype.init=function(){this.data={},this.frameIndexs=[];var t=new o(0,0);this.addFramePoint(t,null)},NumberAttributeData.prototype.addFramePoint=function(t,e){this.data[t.frameIndex]=t,void 0!=t.actions&&(void 0==this.actions&&(this.actions={}),this.actions[t.frameIndex]=t.actions),n.addFrameIndex(this.frameIndexs,t.frameIndex),null!=e&&e()},NumberAttributeData.prototype.removeFramePoint=function(t,e,a){void 0!=this.data[t]?(delete this.data[t],void 0!=this.actions&&void 0!=this.actions[t]&&delete this.actions[t],void 0!=this.frameIndexs[t]&&this.frameIndexs.splice(this.frameIndexs.indexOf(this.frameIndexs[t]),1),null!=a&&a()):console.warn("当前时间线中没有记录这一帧："+t)},NumberAttributeData.prototype.updateFramePoint=function(t,e){void 0!=this.data[t.frameIndex]?(this.data[t.frameIndex]=t,void 0!=t.actions&&(this.actions[t.frameIndex]=t.actions),null!=e&&e()):null!=e&&e()},NumberAttributeData=__decorate([t.reflect.SerializeType,__metadata("design:paramtypes",[])],NumberAttributeData)}();e.NumberAttributeData=i;!function(t){t[t.None=0]="None",t[t.Show=1]="Show",t[t.Hide=2]="Hide"}(e.AttributeUIState||(e.AttributeUIState={}));!function(t){t[t.Number=0]="Number",t[t.Vector2=1]="Vector2",t[t.Vector3=2]="Vector3",t[t.Vector4=3]="Vector4"}(e.AttributeUIType||(e.AttributeUIType={}));!function(t){t[t.FixedValType=0]="FixedValType",t[t.LerpType=1]="LerpType"}(e.AttributeValType||(e.AttributeValType={}));var o=function(){return function FrameKeyPointData(t,e){this.frameIndex=t,this.val=e}}();e.FrameKeyPointData=o;var n=function(){function AttributeUtil(){}return AttributeUtil.addFrameIndex=function(t,e){for(var a=0;a<t.length-1;a++)if(e>t[a]&&e<=t[a+1])return void t.splice(a,0,e);t.push(e)},AttributeUtil}();e.AttributeUtil=n}(t.framework||(t.framework={}))}(gd3d||(gd3d={}));var gd3d;!function(t){!function(e){!function(t){t[t.PositionType=1]="PositionType",t[t.EulerType=2]="EulerType",t[t.ScaleType=3]="ScaleType",t[t.ColorType=4]="ColorType",t[t.ColorRateType=5]="ColorRateType",t[t.AlphaType=6]="AlphaType",t[t.TillingType=7]="TillingType"}(e.AttributeType||(e.AttributeType={}));var a=function(){function EffectElementSingleMesh(e,a){void 0===a&&(a=null),this.elementType=t.framework.EffectElementTypeEnum.SingleMeshType,this.beloop=!1,this.delayTime=0,this.life=5,this.colorRate=1,this.renderModel=t.framework.RenderModel.Mesh,this.tex_ST=new t.math.vector4(1,1,0,0),this.position=[],this.euler=[],this.scale=[],this.color=[],this.alpha=[],this.loopFrame=Number.MAX_VALUE,this.active=!0,this.rotationByEuler=new t.math.quaternion,this.localRotation=new t.math.quaternion,this.effectSys=e,null!=a?this.initByElementdata(a):this.initByDefData()}return EffectElementSingleMesh.prototype.initByElementdata=function(t){},EffectElementSingleMesh.prototype.initByDefData=function(){this.mesh=this.mgr.getDefaultMesh("quad");var t=this.mgr.getShader("diffuse.shader.json");this.mat.setShader(t)},EffectElementSingleMesh.prototype.writeToJson=function(t){},EffectElementSingleMesh.prototype.update=function(){this.active?(void 0!=this.curAttrData.euler&&t.math.quatFromEulerAngles(this.curAttrData.euler.x,this.curAttrData.euler.y,this.curAttrData.euler.z,this.curAttrData.rotationByEuler),this.updateElementRotation(),t.math.matrixMakeTransformRTS(this.curAttrData.pos,this.curAttrData.scale,this.curAttrData.localRotation,this.curAttrData.matrix)):this.curAttrData.resetMatrix()},EffectElementSingleMesh.prototype.updateElementRotation=function(){var a=t.framework.sceneMgr.app.getScene().mainCamera.gameObject.transform,r=t.math.pool.new_quaternion(),i=t.math.pool.new_quaternion();if(this.curAttrData.renderModel!=e.RenderModel.None){var o=t.math.pool.new_quaternion(),n=t.math.pool.new_vector3(),s=t.math.pool.new_vector3();if(t.math.vec3Clone(this.curAttrData.pos,s),void 0!=this.transform&&t.math.matrixTransformVector3(s,this.transform.getWorldMatrix(),n),this.curAttrData.renderModel==e.RenderModel.BillBoard)t.math.quatLookat(n,a.getWorldTranslate(),r);else if(this.curAttrData.renderModel==e.RenderModel.HorizontalBillBoard)r.x=-.5,r.y=.5,r.z=.5,r.w=.5;else if(this.curAttrData.renderModel==e.RenderModel.VerticalBillBoard){var l=t.math.pool.new_vector3();t.math.vec3Clone(a.getWorldTranslate(),l),l.y=n.y,t.math.quatLookat(n,l,r),t.math.pool.delete_vector3(l)}else{if(this.curAttrData.renderModel==e.RenderModel.StretchedBillBoard){t.math.quatMultiply(r,this.curAttrData.rotationByEuler,this.curAttrData.localRotation),t.math.quatLookat(n,a.getWorldTranslate(),r);var h=new t.math.quaternion;t.math.quatClone(this.transform.getWorldRotate(),o),t.math.quatInverse(o,o),t.math.quatMultiply(o,r,h);var c=t.math.pool.new_quaternion();t.math.quatInverse(this.curAttrData.localRotation,c),t.math.quatMultiply(c,h,h);var u=t.math.pool.new_vector3();return t.math.quatToEulerAngles(h,u),t.math.quatFromEulerAngles(0,u.y,0,h),t.math.quatMultiply(this.curAttrData.localRotation,h,this.curAttrData.localRotation),t.math.pool.delete_quaternion(c),t.math.pool.delete_vector3(u),void t.math.pool.delete_quaternion(h)}this.curAttrData.renderModel==e.RenderModel.Mesh&&e.EffectUtil.quatLookatZ(n,a.getWorldTranslate(),r)}t.math.quatMultiply(r,this.curAttrData.rotationByEuler,r),t.math.quatClone(this.transform.gameObject.transform.getWorldRotate(),o),t.math.quatInverse(o,o),t.math.quatMultiply(o,r,this.curAttrData.localRotation),t.math.pool.delete_vector3(s),t.math.pool.delete_vector3(n),t.math.pool.delete_quaternion(o)}else t.math.quatMultiply(r,this.curAttrData.rotationByEuler,this.curAttrData.localRotation);t.math.pool.delete_quaternion(i),t.math.pool.delete_quaternion(r)},EffectElementSingleMesh.prototype.dispose=function(){},EffectElementSingleMesh=__decorate([t.reflect.SerializeType,__metadata("design:paramtypes",[e.TestEffectSystem,e.EffectElementData])],EffectElementSingleMesh)}();e.EffectElementSingleMesh=a}(t.framework||(t.framework={}))}(gd3d||(gd3d={}));var gd3d;!function(t){!function(e){var a=function(){function EffectElementEmission(a,r){void 0===r&&(r=null),this.active=!0,this.vf=t.render.VertexFormatMask.Position|t.render.VertexFormatMask.Color|t.render.VertexFormatMask.UV0,this.maxVertexCount=2048,this.rotTranslate=new t.math.vector3,this.rotScale=new t.math.vector3(1,1,1),this.rotRotation=new t.math.vector3,this.rotQuta=new t.math.quaternion,this.elementType=e.EffectElementTypeEnum.EmissionType,this.delayTime=0,this.beloop=!0,this.lifeTime=new e.NumberData(5),this.simulateInLocalSpace=!0,this.startScale=new e.Vector3Data(1,1,1),this.startEuler=new e.Vector3Data,this.startColor=new t.math.color(1,1,1,1),this.colorRate=1,this.duration=new e.NumberData,this.emissionCount=new e.NumberData,this.emissionType=e.ParticleEmissionType.burst,this.shapeType=e.ParticleSystemShape.NORMAL,this.simulationSpeed=new e.NumberData,this.emitFrom=e.emitfromenum.base,this.rendermodel=e.RenderModel.BillBoard,this.enableVelocityOverLifetime=!1,this.enableSizeOverLifetime=!1,this.enableRotOverLifeTime=!1,this.enableColorOverLifetime=!1,this.enableTexAnimation=!1,this.uvType=e.UVTypeEnum.NONE,this.beBurst=!1,this.beover=!1,this.worldRotation=new t.math.quaternion,this.matToObj=new t.math.matrix,this.matToWorld=new t.math.matrix,this.webgl=t.framework.sceneMgr.app.webgl,this.effectSys=a,this.gameObject=a.gameObject,this.vertexSize=t.render.meshData.calcByteSize(this.vf)/4,null==r?this.initDefparticleData():this.initByEmissonData(r),this.perVertexCount=this.mesh.data.pos.length,this.perIndexxCount=this.mesh.data.trisindex.length,this.emissionType==e.ParticleEmissionType.continue&&(this._continueSpaceTime=this.duration.getValue()/this.emissionCount.getValue()),this.getmatrixToObj(),this.emissionBatchers=[],this.deadParticles=[],this.curTime=0,this.numcount=0,this.addBatcher()}return EffectElementEmission.prototype.initDefparticleData=function(){this.duration.setValue(2),this.emissionCount.setValue(10),this.shapeType=e.ParticleSystemShape.CONE,this.simulationSpeed.setValue(.1),this.radius=1,this.angle=45,this.height=1,this.mat=e.sceneMgr.app.getAssetMgr().getDefParticleMat(),this.mesh=e.sceneMgr.app.getAssetMgr().getDefaultMesh("quad")},EffectElementEmission.prototype.initByEmissonData=function(t){},EffectElementEmission.prototype.getWorldRotation=function(){var e=this.gameObject.transform.getWorldRotate();return t.math.quatMultiply(e,this.rotQuta,this.worldRotation),this.worldRotation},EffectElementEmission.prototype.getmatrixToObj=function(){t.math.quatFromEulerAngles(this.rotRotation.x,this.rotRotation.y,this.rotRotation.z,this.rotQuta),t.math.matrixMakeTransformRTS(this.rotTranslate,this.rotScale,this.rotQuta,this.matToObj)},EffectElementEmission.prototype.getmatrixToWorld=function(){var e=this.gameObject.transform.getWorldMatrix();return t.math.matrixMultiply(e,this.matToObj,this.matToWorld),this.matToWorld},EffectElementEmission.prototype.update=function(t){this.updateLife(t),this.updateBatcher(t)},EffectElementEmission.prototype.updateBatcher=function(t){for(var e in this.emissionBatchers)this.emissionBatchers[e].update(t)},EffectElementEmission.prototype.updateLife=function(t){this.beover||(this.curTime+=t,this.updateEmission(),this.curTime>this.lifeTime.getValue()&&(this.beloop?this.reInit():this.beover=!0))},EffectElementEmission.prototype.reInit=function(){this.beover=!1,this.curTime=0,this.beBurst=!1},EffectElementEmission.prototype.updateEmission=function(){if(this.emissionType==e.ParticleEmissionType.continue){var a=this.curTime/this.duration.getValue();a=t.math.floatClamp(a,0,1);var r=Math.floor(a*this.emissionCount.getValue());r-=this.numcount;for(var i=0;i<r;i++)this.addParticle(),this.numcount++}else this.emissionType!=e.ParticleEmissionType.burst||this.beBurst||(this.addParticle(this.emissionCount.getValue()),this.beBurst=!0)},EffectElementEmission.prototype.addParticle=function(t){void 0===t&&(t=1);for(var e=0;e<t;e++)if(this.deadParticles.length>0){var a=this.deadParticles.pop();a.initByData(),a.actived=!0}else this.curbatcher.curVerCount+this.perVertexCount<=this.maxVertexCount?this.curbatcher.addParticle():(this.addBatcher(),this.curbatcher.addParticle())},EffectElementEmission.prototype.addBatcher=function(){var t=new e.EmissionBatcher_new(this);this.emissionBatchers.push(t),this.curbatcher=t},Object.defineProperty(EffectElementEmission.prototype,"renderCamera",{get:function(){return null!=this._renderCamera?this._renderCamera:t.framework.sceneMgr.app.getScene().mainCamera},enumerable:!0,configurable:!0}),EffectElementEmission.prototype.render=function(t,e,a){this._renderCamera=a,this.simulateInLocalSpace?t.updateModel(this.gameObject.transform):t.updateModeTrail();for(var r in this.emissionBatchers)this.emissionBatchers[r].render(t,e,a)},EffectElementEmission.prototype.dispose=function(){for(var t in this.emissionBatchers)this.emissionBatchers[t].dispose();this.emissionBatchers.length=0},EffectElementEmission.prototype.getMesh=function(){if(this.rendermodel==e.RenderModel.Mesh)return this.mesh;this.rendermodel==e.RenderModel.StretchedBillBoard?this.mesh=t.framework.sceneMgr.app.getAssetMgr().getDefaultMesh("quad_particle"):this.mesh=t.framework.sceneMgr.app.getAssetMgr().getDefaultMesh("quad")},EffectElementEmission.prototype.cloneMeshVBO=function(){return null==this.vbo&&(this.vbo=this.mesh.data.genVertexDataArray(this.vf)),new Float32Array(this.vbo)},EffectElementEmission.prototype.cloneMeshEBO=function(){return null==this.ebo&&(this.ebo=this.mesh.data.genIndexDataArray()),new Uint16Array(this.ebo)},EffectElementEmission.prototype.writeToJson=function(t){throw new Error("Method not implemented.")},EffectElementEmission=__decorate([t.reflect.SerializeType,__metadata("design:paramtypes",[e.TestEffectSystem,e.EffectElementData])],EffectElementEmission)}();e.EffectElementEmission=a}(t.framework||(t.framework={}))}(gd3d||(gd3d={}));var gd3d;!function(t){!function(e){var a=function(){function EmissionBatcher_new(t){this.particles=[],this.curVerCount=0,this.curIndexCount=0,this.emission=t,this.webgl=t.webgl,this.mat=this.emission.mat,this.initMesh()}return EmissionBatcher_new.prototype.initMesh=function(){this.mesh=new e.mesh,this.mesh.data=new t.render.meshData,this.mesh.glMesh=new t.render.glMesh,this.mesh.submesh=[];var a=new e.subMeshInfo;a.matIndex=0,a.useVertexIndex=0,a.start=0,a.size=0,a.line=!1,this.mesh.submesh.push(a),this.dataForVbo=new Float32Array(128),this.dataForEbo=new Uint16Array(128),this.mesh.glMesh.initBuffer(this.webgl,this.emission.vf,128,t.render.MeshTypeEnum.Dynamic),this.mesh.glMesh.addIndex(this.webgl,this.dataForEbo.length)},EmissionBatcher_new.prototype.addParticle=function(){this.refreshBuffer();for(var t=new e.Particle_new(this),a=0;a<t.dataForEbo.length;a++)this.dataForEbo[this.curIndexCount+a]=t.dataForEbo[a]+this.curVerCount;this.particles.push(t),this.curVerCount+=this.emission.perVertexCount,this.curIndexCount+=this.emission.perIndexxCount,this.mesh.glMesh.uploadIndexData(this.webgl,0,this.dataForEbo),this.mesh.submesh[0].size=this.curIndexCount},EmissionBatcher_new.prototype.refreshBuffer=function(){var t=this.curVerCount+this.emission.perVertexCount,e=this.curIndexCount+this.emission.perIndexxCount;if(t*this.emission.vertexSize>this.dataForVbo.length){r=this.dataForVbo.length;this.mesh.glMesh.resetVboSize(this.webgl,2*r);var a=new Float32Array(2*r);a.set(this.dataForVbo,0),this.dataForVbo=a}if(e>this.dataForEbo.length){var r=this.dataForEbo.length;this.mesh.glMesh.resetEboSize(this.webgl,0,2*r);var i=new Uint16Array(2*r);i.set(this.dataForEbo,0),this.dataForEbo=i}},EmissionBatcher_new.prototype.update=function(t){for(var e in this.particles)this.particles[e].update(t),this.particles[e].uploadData(this.dataForVbo)},EmissionBatcher_new.prototype.render=function(t,e,a){var r=this.mesh;r.glMesh.uploadVertexData(t.webgl,this.dataForVbo),e.app.getScene().fog?(t.fog=e.app.getScene().fog,this.mat.draw(t,r,r.submesh[0],"base_fog")):this.mat.draw(t,r,r.submesh[0],"base")},EmissionBatcher_new.prototype.dispose=function(){this.dataForVbo=null,this.dataForEbo=null,this.mesh.dispose(),this.mat.dispose();for(var t in this.particles)this.particles[t].dispose()},EmissionBatcher_new}();e.EmissionBatcher_new=a}(t.framework||(t.framework={}))}(gd3d||(gd3d={}));var gd3d;!function(t){!function(e){var a=function(){function effTools(){}return effTools.getRandomDirAndPosByZEmission=function(a,r,i){switch(a.shapeType){case e.ParticleSystemShape.NORMAL:t.math.vec3Clone(t.math.pool.vector3_zero,i),t.math.vec3Clone(t.math.pool.vector3_up,r);break;case e.ParticleSystemShape.SPHERE:var o=Math.random()*Math.PI*2,n=Math.random()*Math.PI;r.x=Math.sin(n)*Math.cos(o),r.y=Math.cos(n),r.z=Math.sin(n)*Math.sin(o);s=Math.random()*a.radius;t.math.vec3ScaleByNum(r,s,i);break;case e.ParticleSystemShape.HEMISPHERE:var o=Math.random()*Math.PI*2,n=Math.random()*Math.PI*.5,s=Math.random()*a.radius;r.x=Math.sin(n)*Math.cos(o),r.y=Math.cos(n),r.z=Math.sin(n)*Math.sin(o),t.math.vec3ScaleByNum(r,s,i);break;case e.ParticleSystemShape.BOX:i.x=e.ValueData.RandomRange(-a.width/2,a.width/2),i.y=e.ValueData.RandomRange(-a.height/2,a.height/2),i.z=e.ValueData.RandomRange(-a.depth/2,a.depth/2),t.math.vec3Normalize(i,r);break;case e.ParticleSystemShape.CONE:var l=Math.random()*Math.PI*2,h=Math.random()*a.height,c=h*Math.tan(a.angle*Math.PI/180)+a.radius,u=Math.random()*c,d=t.math.pool.new_vector3();d.x=a.radius*Math.cos(l),d.y=0,d.z=a.radius*Math.sin(l),a.emitFrom==e.emitfromenum.base?t.math.vec3Clone(d,i):a.emitFrom==e.emitfromenum.volume&&(i.x=u*Math.cos(l),i.z=u*Math.sin(l),i.y=h),r.x=Math.cos(l)*Math.sin(a.angle*Math.PI/180),r.z=Math.sin(l)*Math.sin(a.angle*Math.PI/180),r.y=Math.cos(a.angle*Math.PI/180)}},effTools.getTex_ST=function(a,r){a.uvType!=e.UVTypeEnum.UVSprite?(r.x=1,r.y=1,r.z=0,r.w=0):t.math.spriteAnimation(a.row,a.column,0,r)},effTools}();e.effTools=a}(t.framework||(t.framework={}))}(gd3d||(gd3d={}));var gd3d;!function(t){!function(e){var a=function(){function Particle_new(e){this.startScale=new t.math.vector3,this.startRotation=new t.math.quaternion,this.rotationByShape=new t.math.quaternion,this.rotAngle=0,this.rotationByEuler=new t.math.quaternion,this.localMatrix=new t.math.matrix,this.localTranslate=new t.math.vector3,this.localRotation=new t.math.quaternion,this.localScale=new t.math.vector3(1,1,1),this.color=new t.math.vector3(1,1,1),this.tex_ST=new t.math.vector4(1,1,0,0),this.curLife=0,this.life=0,this.speedDir=new t.math.vector3(0,0,0),this.actived=!0,this.transformVertex=new t.math.matrix,this.matToworld=new t.math.matrix,this.batcher=e,this.emisson=e.emission,this.gameObject=this.emisson.gameObject,this.vertexStartIndex=e.curVerCount,this.dataForVbo=this.emisson.cloneMeshVBO(),this.dataForEbo=this.emisson.cloneMeshEBO(),this.sourceVbo=this.emisson.vbo,this.initByData()}return Particle_new.prototype.uploadData=function(t){t.set(this.dataForVbo,this.vertexStartIndex*this.emisson.vertexSize)},Particle_new.prototype.initByData=function(){if(this.totalLife=this.emisson.lifeTime.getValue(),e.effTools.getRandomDirAndPosByZEmission(this.emisson,this.speedDir,this.localTranslate),this.simulationSpeed=this.emisson.simulationSpeed.getValue(),this.Starteuler=this.emisson.startEuler.getValue(),t.math.quatFromEulerAngles(this.Starteuler.x,this.Starteuler.y,this.Starteuler.z,this.rotationByEuler),this.localScale=this.emisson.startScale.getValue(),this.startColor=this.emisson.startColor,this.sizeNodes=this.emisson.sizeNodes,this.colorNodes=this.emisson.colorNodes,this.alphaNodes=this.emisson.alphaNodes,this.emisson.enableVelocityOverLifetime&&(this.movespeed=this.emisson.moveSpeed.getValue()),this.emisson.enableRotOverLifeTime&&(this.eulerSpeed=this.emisson.angleSpeed.getValue()),this.emisson.rendermodel==e.RenderModel.StretchedBillBoard){var a=t.math.pool.vector3_zero;t.math.quatLookat(a,this.speedDir,this.rotationByShape);var r=t.math.pool.new_quaternion();t.math.quatFromEulerAngles(90,0,90,r),t.math.quatMultiply(this.rotationByShape,r,this.rotationByShape),t.math.quatClone(this.rotationByShape,this.localRotation),t.math.pool.delete_quaternion(r)}if(!this.emisson.simulateInLocalSpace){this.emissionMatToWorld=new t.math.matrix;var i=this.emisson.getmatrixToWorld();t.math.matrixClone(i,this.emissionMatToWorld),this.emissionWorldRotation=new t.math.quaternion;var o=this.emisson.getWorldRotation();t.math.quatClone(o,this.emissionWorldRotation)}},Particle_new.prototype.update=function(e){if(this.actived){if(this.curLife+=e,this.life=this.curLife/this.totalLife,t.math.floatClamp(this.life,0,1),this.curLife>=this.totalLife)return t.math.matrixZero(this.transformVertex),this._updateVBO(),this.emisson.deadParticles.push(this),this.curLife=0,void(this.actived=!1);this._updatePos(e),this._updateScale(e),this._updateEuler(e),this._updateRotation(e),this._updateLocalMatrix(e),this._updateColor(e),this._updateUV(e),this._updateVBO()}},Particle_new.prototype._updateLocalMatrix=function(e){t.math.matrixMakeTransformRTS(this.localTranslate,this.localScale,this.localRotation,this.localMatrix),this.emisson.simulateInLocalSpace?t.math.matrixMultiply(this.emisson.matToObj,this.localMatrix,this.transformVertex):t.math.matrixMultiply(this.emissionMatToWorld,this.localMatrix,this.transformVertex)},Particle_new.prototype.refreshEmissionData=function(){this.emisson.simulateInLocalSpace&&(this.emissionMatToWorld=this.emisson.getmatrixToWorld(),this.emissionWorldRotation=this.emisson.getWorldRotation())},Particle_new.prototype._updateRotation=function(a){if(this.emisson.rendermodel==e.RenderModel.Mesh)t.math.quatFromAxisAngle(t.math.pool.vector3_up,this.rotAngle,this.rotationByEuler),t.math.quatClone(this.rotationByEuler,this.localRotation);else{t.math.quatFromAxisAngle(t.math.pool.vector3_forward,this.rotAngle,this.rotationByEuler),this.refreshEmissionData();var r=t.math.pool.new_vector3(),i=t.math.pool.new_vector3(),o=t.math.pool.new_quaternion(),n=t.math.pool.new_quaternion();t.math.vec3Clone(this.localTranslate,r);var s=this.emisson.renderCamera.gameObject.transform.getWorldTranslate();if(t.math.matrixTransformVector3(r,this.emissionMatToWorld,i),this.emisson.rendermodel==e.RenderModel.BillBoard)t.math.quatLookat(i,s,o);else if(this.emisson.rendermodel==e.RenderModel.HorizontalBillBoard)o.x=-.5,o.y=.5,o.z=.5,o.w=.5;else if(this.emisson.rendermodel==e.RenderModel.VerticalBillBoard){var l=t.math.pool.new_vector3();t.math.vec3Clone(s,l),l.y=i.y,t.math.quatLookat(i,l,o),t.math.pool.delete_vector3(l)}else if(this.emisson.rendermodel==e.RenderModel.StretchedBillBoard){t.math.matrixMakeTransformRTS(this.localTranslate,this.localScale,this.localRotation,this.localMatrix),t.math.matrixMultiply(this.emissionMatToWorld,this.localMatrix,this.matToworld);var h=t.math.pool.new_vector3(),c=t.math.pool.new_vector3(),u=t.math.pool.new_vector3();return t.math.matrixTransformNormal(t.math.pool.vector3_right,this.matToworld,h),t.math.vec3Normalize(h,h),t.math.matrixTransformNormal(t.math.pool.vector3_up,this.matToworld,c),t.math.vec3Normalize(c,c),t.math.matrixTransformNormal(t.math.pool.vector3_forward,this.matToworld,u),t.math.vec3Normalize(u,u),e.EffectUtil.lookatbyXAxis(i,h,c,u,s,o),t.math.quatMultiply(this.localRotation,o,this.localRotation),t.math.pool.delete_quaternion(o),t.math.pool.delete_vector3(r),t.math.pool.delete_quaternion(n),t.math.pool.delete_vector3(h),t.math.pool.delete_vector3(c),void t.math.pool.delete_vector3(u)}t.math.quatClone(this.emissionWorldRotation,n),t.math.quatInverse(n,n),t.math.quatMultiply(n,o,this.localRotation),t.math.quatMultiply(this.localRotation,this.rotationByEuler,this.localRotation),t.math.pool.delete_vector3(r),t.math.pool.delete_vector3(i),t.math.pool.delete_quaternion(o),t.math.pool.delete_quaternion(n)}},Particle_new.prototype._updatePos=function(a){var r=e.EffectUtil.vecMuliNum(this.speedDir,this.simulationSpeed);t.math.vec3Add(this.localTranslate,r,this.localTranslate),this.emisson.enableVelocityOverLifetime&&(this.localTranslate.x+=this.movespeed.x*a,this.localTranslate.y+=this.movespeed.y*a,this.localTranslate.z+=this.movespeed.z*a)},Particle_new.prototype._updateEuler=function(t){this.emisson.enableRotOverLifeTime&&(this.rotAngle=this.eulerSpeed*this.curLife)},Particle_new.prototype._updateScale=function(e){if(this.emisson.enableSizeOverLifetime)for(var a=0;a<this.sizeNodes.length-1;a++)if(this.sizeNodes[a].key<=this.life&&this.sizeNodes[a+1].key>=this.life){var r=t.math.numberLerp(this.sizeNodes[a].value,this.sizeNodes[a+1].value,(this.life-this.sizeNodes[a].key)/(this.sizeNodes[a+1].key-this.sizeNodes[a].key));t.math.vec3ScaleByNum(this.startScale,r,this.localScale);break}},Particle_new.prototype._updateColor=function(e){if(this.emisson.enableColorOverLifetime){if(null!=this.colorNodes)for(a=0;a<this.colorNodes.length-1;a++)if(this.colorNodes[a].key<=this.life&&this.colorNodes[a+1].key>=this.life){t.math.vec3SLerp(this.colorNodes[a].value,this.colorNodes[a+1].value,(this.life-this.colorNodes[a].key)/(this.colorNodes[a+1].key-this.colorNodes[a].key),this.color);break}if(null!=this.alphaNodes)for(var a=0;a<this.alphaNodes.length-1;a++)if(this.alphaNodes[a].key<=this.life&&this.alphaNodes[a+1].key>=this.life){this.alpha=t.math.numberLerp(this.alphaNodes[a].value,this.alphaNodes[a+1].value,(this.life-this.colorNodes[a].key)/(this.colorNodes[a+1].key-this.colorNodes[a].key));break}}},Particle_new.prototype._updateUV=function(a){if(this.emisson.uvType==e.UVTypeEnum.UVRoll)this.tex_ST.z=this.emisson.uSpeed*this.curLife,this.tex_ST.w=this.emisson.vSpeed*this.curLife;else if(this.emisson.uvType==e.UVTypeEnum.UVSprite){var r=Math.floor(this.life*this.emisson.count);t.math.spriteAnimation(this.emisson.row,this.emisson.column,r,this.tex_ST)}},Particle_new.prototype._updateVBO=function(){for(var e=this.emisson.vertexSize,a=0;a<this.emisson.perVertexCount;a++){var r=t.math.pool.new_vector3();r.x=this.sourceVbo[a*e+0],r.y=this.sourceVbo[a*e+1],r.z=this.sourceVbo[a*e+2],t.math.matrixTransformVector3(r,this.transformVertex,r),this.dataForVbo[a*e+0]=r.x,this.dataForVbo[a*e+1]=r.y,this.dataForVbo[a*e+2]=r.z,t.math.pool.delete_vector3(r);var i=this.sourceVbo[a*e+3]*this.startColor.r,o=this.sourceVbo[a*e+4]*this.startColor.g,n=this.sourceVbo[a*e+5]*this.startColor.b,s=this.sourceVbo[a*e+6]*this.startColor.a;null!=this.colorNodes&&(i=this.color.x,o=this.color.y,n=this.color.z),null!=this.alphaNodes&&(s=this.alpha),i*=this.emisson.colorRate,o*=this.emisson.colorRate,n*=this.emisson.colorRate,s*=this.emisson.colorRate,i=t.math.floatClamp(i,0,3),o=t.math.floatClamp(o,0,3),n=t.math.floatClamp(n,0,3),s=t.math.floatClamp(s,0,3),this.dataForVbo[a*this.emisson.vertexSize+3]=i,this.dataForVbo[a*this.emisson.vertexSize+4]=o,this.dataForVbo[a*this.emisson.vertexSize+5]=n,this.dataForVbo[a*this.emisson.vertexSize+6]=s,this.dataForVbo[a*e+7]=this.sourceVbo[a*e+7]*this.tex_ST.x+this.tex_ST.z,this.dataForVbo[a*e+8]=this.sourceVbo[a*e+8]*this.tex_ST.y+this.tex_ST.w}},Particle_new.prototype.dispose=function(){this.dataForVbo=null,this.dataForEbo=null,this.startRotation=null,this.localRotation=null,this.rotationByEuler=null,this.rotationByShape=null,this.tex_ST=null,this.localMatrix=null,this.localTranslate=null,this.Starteuler=null,this.localScale=null,this.color=null},Particle_new}();e.Particle_new=a}(t.framework||(t.framework={}))}(gd3d||(gd3d={}));var gd3d;!function(t){!function(e){var a=function(){function Curve3(t,e){this._beizerPoints=t,this._bezierPointNum=e}return Object.defineProperty(Curve3.prototype,"beizerPoints",{get:function(){return this._beizerPoints},set:function(t){this._beizerPoints=t},enumerable:!0,configurable:!0}),Object.defineProperty(Curve3.prototype,"bezierPointNum",{get:function(){return this._bezierPointNum},set:function(t){this._bezierPointNum=t},enumerable:!0,configurable:!0}),Curve3.CreateLinearBezier=function(e,a,r){r=r>2?r:3;var i=new Array,o=function(t,e,a){return(1-t)*e+t*a};i.push(e);for(var n=1;n<=r;n++)i.push(new t.math.vector3(o(n/r,e.x,a.x),o(n/r,e.y,e.y),o(n/r,e.z,e.z)));return new Curve3(i,r)},Curve3.GetLerpBezier=function(t){for(var e=new Array,a=0;a<t.length;a++)e.push(t[a].getValue());return new Curve3(e,t.length)},Curve3.CreateQuadraticBezier=function(e,a,r,i){i=i>2?i:3;for(var o=new Array,n=function(t,e,a,r){return(1-t)*(1-t)*e+2*t*(1-t)*a+t*t*r},s=1;s<=i;s++)o.push(new t.math.vector3(n(s/i,e.x,a.x,r.x),n(s/i,e.y,a.y,r.y),n(s/i,e.z,a.z,r.z)));return new Curve3(o,i)},Curve3.CreateCubicBezier=function(e,a,r,i,o){o=o>3?o:4;for(var n=new Array,s=function(t,e,a,r,i){return(1-t)*(1-t)*(1-t)*e+3*t*(1-t)*(1-t)*a+3*t*t*(1-t)*r+t*t*t*i},l=1;l<=o;l++)n.push(new t.math.vector3(s(l/o,e.x,a.x,r.x,i.x),s(l/o,e.y,a.y,r.y,i.y),s(l/o,e.z,a.z,r.z,i.z)));return new Curve3(n,o)},Curve3.prototype.getPoints=function(){return this._beizerPoints},Curve3}();e.Curve3=a}(t.framework||(t.framework={}))}(gd3d||(gd3d={}));var gd3d;!function(t){!function(e){var a=function(){function LinearAction(){}return LinearAction.prototype.init=function(t,a,r,i){if(this.startFrame=t,this.endFrame=a,this.params=r,this.elements=i,void 0!=this.params)switch(this.attriname=this.params.name,this.attriname){case"pos":case"scale":case"euler":case"color":this.attrival=e.EffectUtil.parseEffectVec3(this.params.value);break;case"uv":this.attrival=e.EffectUtil.parseEffectUVSpeed(this.params.value);break;case"alpha":this.attrival=this.params.value}},LinearAction.prototype.update=function(t){if(!(this.startFrame>t||this.endFrame<t)){var e=this.elements.curAttrData;switch(this.attriname){case"pos":e.pos.x=e.pos.x+this.attrival.x.getValue(),e.pos.y=e.pos.y+this.attrival.y.getValue(),e.pos.z=e.pos.z+this.attrival.z.getValue();break;case"scale":e.scale.x=e.scale.x+this.attrival.x.getValue(),e.scale.y=e.scale.y+this.attrival.y.getValue(),e.scale.z=e.scale.z+this.attrival.z.getValue();break;case"euler":e.euler.x=e.euler.x+this.attrival.x.getValue(),e.euler.y=e.euler.y+this.attrival.y.getValue(),e.euler.z=e.euler.z+this.attrival.z.getValue();break;case"color":e.color.x=e.color.x+this.attrival.x.getValue(),e.color.y=e.color.y+this.attrival.y.getValue(),e.color.z=e.color.z+this.attrival.z.getValue();break;case"uv":e.uv.x=e.uv.x+this.attrival.u.getValue(),e.uv.y=e.uv.y+this.attrival.v.getValue();break;case"alpha":e.alpha=e.alpha+this.attrival}}},LinearAction}();e.LinearAction=a;var r=function(){function DestroyAction(){}return DestroyAction.prototype.init=function(t,e,a,r){this.startFrame=t,this.endFrame=e,this.params=a,this.elements=r},DestroyAction.prototype.update=function(t){t>=this.startFrame&&this.elements.setActive(!1)},DestroyAction}();e.DestroyAction=r;var i=function(){function LoopAction(){}return LoopAction.prototype.init=function(t,e,a,r){this.startFrame=t,this.endFrame=e,this.params=a,this.elements=r},LoopAction.prototype.update=function(t){t==this.startFrame&&(this.elements.loopFrame=this.startFrame+1,this.elements.curAttrData=this.elements.data.initFrameData.attrsData.copyandinit())},LoopAction}();e.LoopAction=i;var o=function(){function UVRollAction(){this.speedu=0,this.speedv=0,this.startu=0,this.startv=0}return UVRollAction.prototype.init=function(t,e,a,r){this.startFrame=t,this.endFrame=e,this.params=a,this.elements=r,void 0!=this.params.speedu&&(this.speedu=this.params.speedu),void 0!=this.params.speedv&&(this.speedv=this.params.speedv),void 0!=this.params.startu&&(this.startu=this.params.startu),void 0!=this.params.startv&&(this.startv=this.params.startv)},UVRollAction.prototype.update=function(t){if(!(this.startFrame>t||this.endFrame<t)){if(this.startFrame==t)return this.elements.curAttrData.uv.x=this.startu,void(this.elements.curAttrData.uv.y=this.startv);this.elements.curAttrData.uv.x+=this.speedu,this.elements.curAttrData.uv.y+=this.speedv}},UVRollAction}();e.UVRollAction=o;var n=function(){function UVSpriteAnimationAction(){this.fps=30,this.row=1,this.colum=1,this.totalCount=1,this.frameInternal=1,this.spriteIndex=0,this.tex_ST=new t.math.vector4(1,1,0,0)}return UVSpriteAnimationAction.prototype.init=function(t,e,a,r){this.startFrame=t,this.endFrame=e,this.params=a,this.elements=r,void 0!=this.params.row&&(this.row=this.params.row),void 0!=this.params.colum&&(this.colum=this.params.colum),void 0!=this.params.count&&(this.totalCount=this.params.count)},UVSpriteAnimationAction.prototype.update=function(e){if(!(this.startFrame>e||this.endFrame<e)){var a=Math.floor((e-this.startFrame)/(this.endFrame-this.startFrame)*this.totalCount);t.math.spriteAnimation(this.row,this.colum,a,this.tex_ST),this.elements.curAttrData.uv.x=this.tex_ST.z,this.elements.curAttrData.uv.y=this.tex_ST.w,this.elements.curAttrData.tilling.x=this.tex_ST.x,this.elements.curAttrData.tilling.y=this.tex_ST.y}},UVSpriteAnimationAction}();e.UVSpriteAnimationAction=n;var s=function(){function RotationAction(){}return RotationAction.prototype.init=function(t,a,r,i){this.startFrame=t,this.endFrame=a,this.params=r,this.elements=i,void 0!=this.params.velocity&&(this.velocity=e.EffectUtil.parseEffectVec3(this.params.velocity)),this.frameInternal=1/e.effectSystem.fps},RotationAction.prototype.update=function(t){this.elements.curAttrData.euler.z=this.elements.curAttrData.euler.z+this.velocity.z.getValue()*this.frameInternal,this.elements.curAttrData.renderModel==e.RenderModel.None&&(this.elements.curAttrData.euler.x=this.elements.curAttrData.euler.x+this.velocity.x.getValue()*this.frameInternal,this.elements.curAttrData.euler.y=this.elements.curAttrData.euler.y+this.velocity.y.getValue()*this.frameInternal)},RotationAction}();e.RotationAction=s;var l=function(){function RoseCurveAction(){}return RoseCurveAction.prototype.init=function(t,a,r,i){this.startFrame=t,this.endFrame=a,this.params=r,this.elements=i,void 0!=this.params.radius&&(this.radius=this.params.radius),void 0!=this.params.level&&(this.level=this.params.radius),void 0!=this.params.speed&&(this.speed=this.params.speed),void 0!=this.params.polar&&(this.polar=e.EffectUtil.parseEffectVec3(this.params.polar)),this.frameInternal=1/e.effectSystem.fps},RoseCurveAction.prototype.update=function(e){var a=t.math.pool.new_vector3();t.math.vec3Clone(this.elements.data.initFrameData.attrsData.pos,a);var r=this.radius,i=this.polar.x.getValue(),o=this.polar.y.getValue(),n=(this.polar.z.getValue(),e*this.speed);this.elements.curAttrData.pos.x=a.x+r*Math.cos(3*n+i)*Math.cos(n),this.elements.curAttrData.pos.z=a.z+r*Math.cos(3*n+i)*Math.sin(n),this.elements.curAttrData.pos.y=a.y+o*Math.cos(e*this.speed);var s=e*this.speed+.001,l=t.math.pool.new_vector3();l.x=a.x+r*Math.cos(3*s+i)*Math.cos(s),l.z=a.z+r*Math.cos(3*s+i)*Math.sin(s),l.y=a.y+o*Math.cos(e*this.speed);var h=t.math.pool.new_quaternion();t.math.quatLookat(this.elements.curAttrData.pos,l,h),t.math.quatToEulerAngles(h,this.elements.curAttrData.euler),t.math.pool.delete_vector3(l),t.math.pool.delete_quaternion(h),t.math.pool.delete_vector3(a)},RoseCurveAction}();e.RoseCurveAction=l;var h=function(){function TrailAction(){this.offsetTransalte=new t.math.vector3}return TrailAction.prototype.init=function(a,r,i,o){this.startFrame=a,this.endFrame=r,this.params=i,this.elements=o,void 0!=this.params.pos&&(this.position=e.EffectUtil.parseEffectVec3(this.params.pos)),this.offsetTransalte.x=this.position.x.getValue(),this.offsetTransalte.y=this.position.y.getValue(),this.offsetTransalte.z=this.position.z.getValue(),void 0!=this.params.eular&&(this.eular=e.EffectUtil.parseEffectVec3(this.params.eular)),void 0!=this.params.color&&(this.color=e.EffectUtil.parseEffectVec3(this.params.color)),void 0!=this.params.width&&(this.width=this.params.width),void 0!=this.params.speed&&(this.speed=this.params.speed),void 0!=this.params.speed&&(this.speed=this.params.speed),void 0!=this.params.alpha&&(this.alpha=this.params.alpha);var n=new t.framework.material,s=new t.framework.shader,l=new t.framework.texture;s=void 0!=this.params.shader?e.sceneMgr.app.getAssetMgr().getShader(this.params.shader):e.sceneMgr.app.getAssetMgr().getShader("shader/def"),n.setShader(s),void 0!=this.params.diffuseTexture&&(l=e.sceneMgr.app.getAssetMgr().getAssetByName(this.params.diffuseTexture)),n.setTexture("_MainTex",l),this.frameInternal=1/e.effectSystem.fps,this.transform=new t.framework.transform,e.sceneMgr.scene.addChild(this.transform);var h=this.elements.data.initFrameData.attrsData.clone(),c=t.math.pool.new_vector3();t.math.vec3Clone(h.pos,c),void 0!=this.elements.transform&&t.math.matrixTransformVector3(c,this.elements.transform.getWorldMatrix(),c),t.math.vec3Clone(c,this.transform.localTranslate),t.math.pool.delete_vector3(c);var u=new t.framework.transform;this.transform.addChild(u);var d=this.eular.x.getValue(),m=this.eular.y.getValue(),p=this.eular.z.getValue();this.startRotation=new t.math.quaternion,t.math.quatFromEulerAngles(d,m,p,this.startRotation),t.math.quatMultiply(this.startRotation,h.localRotation,this.transform.localRotate),this.transform.markDirty(),u.markDirty();var f=u.gameObject.addComponent("trailRender");f.color=new t.math.color(this.color.x.getValue(),this.color.y.getValue(),this.color.z.getValue(),this.alpha),f.setspeed(this.speed),f.setWidth(this.width),f.material=n},TrailAction.prototype.update=function(e){var a=t.math.pool.new_vector3();t.math.vec3Clone(this.elements.curAttrData.pos,a),void 0!=this.elements.transform&&t.math.matrixTransformVector3(a,this.elements.transform.getWorldMatrix(),a),t.math.vec3Clone(a,this.transform.localTranslate),t.math.vec3Add(this.transform.localTranslate,this.offsetTransalte,this.transform.localTranslate),t.math.pool.delete_vector3(a),t.math.quatMultiply(this.startRotation,this.elements.curAttrData.localRotation,this.transform.localRotate),this.transform.markDirty()},TrailAction}();e.TrailAction=h;var c=function(){function BreathAction(){}return BreathAction.prototype.init=function(t,a,r,i){if(this.startFrame=t,this.endFrame=a,this.params=r,this.elements=i,void 0!=this.params)switch(this.attriname=this.params.name,this.loopframe=this.params.loopframe,this.halfloopframe=this.loopframe/2,this.curTargetFrame=this.startFrame+this.halfloopframe,this.attriname){case"pos":case"scale":case"euler":case"color":this.startvalue=e.EffectUtil.parseEffectVec3(this.params.startvalue).getValue(),this.targetvalue=e.EffectUtil.parseEffectVec3(this.params.targetvalue).getValue();break;case"uv":this.startvalue=e.EffectUtil.parseEffectUVSpeed(this.params.startvalue).getValue(),this.targetvalue=e.EffectUtil.parseEffectUVSpeed(this.params.targetvalue).getValue();break;case"alpha":this.startvalue=this.params.startvalue,this.targetvalue=this.params.targetvalue}},BreathAction.prototype.update=function(t){if(!(this.startFrame>t)){t>=this.curTargetFrame&&(this.swap(),this.curTargetFrame+=this.halfloopframe);var e=this.elements.curAttrData;switch(this.attriname){case"pos":e.pos=this.getLerpValue(t);break;case"scale":e.scale=this.getLerpValue(t);break;case"euler":e.euler=this.getLerpValue(t);break;case"color":e.color=this.getLerpValue(t);break;case"uv":e.uv=this.getLerpValue(t);break;case"alpha":e.alpha=this.getLerpValue(t)}}},BreathAction.prototype.swap=function(){var e;this.startvalue instanceof t.math.vector3?(e=t.math.pool.clone_vector3(this.startvalue),this.startvalue=t.math.pool.clone_vector3(this.targetvalue),this.targetvalue=e):this.startvalue instanceof t.math.vector2?(e=t.math.pool.clone_vector2(this.startvalue),this.startvalue=t.math.pool.clone_vector2(this.targetvalue),this.targetvalue=e):(e=this.startvalue,this.startvalue=this.targetvalue,this.targetvalue=e)},BreathAction.prototype.getLerpValue=function(e){var a,r=(e-this.startFrame)%this.halfloopframe;return this.startvalue instanceof t.math.vector3?(a=new t.math.vector3,t.math.vec3SLerp(this.startvalue,this.targetvalue,r/this.halfloopframe,a)):this.startvalue instanceof t.math.vector2?(a=new t.math.vector2,t.math.vec2SLerp(this.startvalue,this.targetvalue,r/this.halfloopframe,a)):a=t.math.numberLerp(this.startvalue,this.targetvalue,r/this.halfloopframe),a},BreathAction}();e.BreathAction=c}(t.framework||(t.framework={}))}(gd3d||(gd3d={}));var gd3d;!function(t){!function(e){var a=function(){function EffectParser(){}return EffectParser.prototype.Parse=function(t,a){if(null==t)return null;this.asMgr=a;var r=new e.EffectSystemData,i=JSON.parse(t);void 0!=i.life&&(r.life=i.life),void 0!=i.beloop&&(r.beLoop=i.beloop);var o={},n={},s=0;if(void 0!=i.elements){r.elementDic={};var l=i.elements;for(var h in l){var c=l[h],u="";void 0!=c.name?(u=c.name,void 0==r.elementDic[u]&&void 0==o[u]?void 0==c.ref?(r.elementDic[u]=this._parse(c),n[u]=c):(o[u]=c,s++):console.error("特效中元素的名字重复："+u)):console.error("未设置特效中元素的名字！")}for(;s>0;)for(var d in o){var m=o[d];if(null!=m){var p=m.ref;if(void 0!=n[p]){var f=n[p];this.copyAndOverWrite(f,m);var g=this._parse(m);r.elementDic[m.name]=g,delete o[d],s--}}}}return r},EffectParser.prototype._parse=function(t){var a=new e.EffectElementData;if(void 0!=t.beloop&&(a.beloop=t.beloop),void 0!=t.delaytime&&(a.delayTime=t.delaytime),a.name=t.name,void 0!=t.type)switch(t.type){case"singlemesh":a.type=e.EffectElementTypeEnum.SingleMeshType;break;case"emission":a.type=e.EffectElementTypeEnum.EmissionType}switch(a.type){case e.EffectElementTypeEnum.SingleMeshType:this._parseSingleMeshTypeData(t,a);break;case e.EffectElementTypeEnum.EmissionType:this._parseEmissionTypeData(t,a)}return a},EffectParser.prototype.copyAndOverWrite=function(t,e){for(var a in t){var r=t[a];if(void 0!=r)switch((typeof r).toLowerCase()){case"number":case"string":case"boolean":void 0==e[a]&&(e[a]=r);break;default:void 0==e[a]?e[a]=t[a]:this.copyAndOverWrite(t[a],e[a])}}},EffectParser.prototype._parseSingleMeshTypeData=function(t,a){if(void 0!=t.timeline){a.timelineFrame={},a.actionData=[];var r=t.timeline;for(var i in r){var o=r[i];if(void 0!=o.frame){var n=new e.EffectFrameData;if(n.frameIndex=o.frame,a.timelineFrame[n.frameIndex]=n,n.attrsData=new e.EffectAttrsData,void 0!=o.attrs){var s=o.attrs;for(var l in s){m=this._parseToObjData(l,s[l]);"mat"==l?n.attrsData.mat=m:"pos"==l?n.attrsData.pos=m.getValue():"scale"==l?n.attrsData.scale=m.getValue():"euler"==l?n.attrsData.euler=m.getValue():"mesh"==l?n.attrsData.mesh=m:"color"==l?n.attrsData.color=m.getValue():"alpha"==l?n.attrsData.alpha=m.getValue():"tilling"==l?n.attrsData.tilling=m.getValue():"billboard"==l?n.attrsData.renderModel=m:"colorRate"==l&&(n.attrsData.colorRate=m)}}if(-1==n.frameIndex&&(a.initFrameData=n),void 0!=o.lerp){n.lerpDatas=[];for(var h in o.lerp){var c=new e.EffectLerpData;c.fromFrame=n.frameIndex,n.lerpDatas.push(c);var u=o.lerp[h];if(void 0!=u.type)switch(u.type){case"linear":c.type=e.EffectLerpTypeEnum.Linear}if(void 0!=u.to&&(c.toFrame=this._parseToValueData(u.to)),void 0!=u.attribute){c.attrsData=new e.EffectAttrsData;var d=u.attribute;for(var l in d){c.attrsList.push(l);var m=this._parseToObjData(l,d[l]);"pos"==l?c.attrsData.pos=m.getValue():"scale"==l?c.attrsData.scale=m.getValue():"euler"==l?c.attrsData.euler=m.getValue():"color"==l?c.attrsData.color=m.getValue():"alpha"==l?c.attrsData.alpha=m.getValue():console.error("未支持的插值属性："+l)}}}}if(void 0!=o.actions){var p=o.actions;for(var f in p){var g=new e.EffectActionData,v=p[f];g.actionType=v.action,g.startFrame=n.frameIndex,void 0!=v.end?g.endFrame=v.end:g.endFrame=-1,void 0!=v.param&&(g.params=v.param),a.actionData.push(g)}}}else console.error("必须要配一个关键帧的索引")}}},EffectParser.prototype._parseEmissionTypeData=function(a,r){if(void 0!=a.timeline){var i=a.timeline;if(i.length>0&&void 0!=i[0]&&void 0!=i[0].attrs){var o=i[0].attrs,n=new e.Emission;if(r.emissionData=n,void 0!=o.emissionType){switch(o.emissionType){case"burst":n.emissionType=e.ParticleEmissionType.burst;break;case"continue":n.emissionType=e.ParticleEmissionType.continue}if(void 0!=o.simulateinlocal&&(n.simulateInLocalSpace=o.simulateinlocal),void 0!=o.maxcount&&(n.maxEmissionCount=o.maxcount),void 0!=o.emissioncount&&(n.emissionCount=o.emissioncount),void 0!=o.time&&(n.time=o.time),void 0!=o.mesh&&(n.mesh=this._parseToObjData("mesh",o.mesh)),void 0!=o.mat&&(n.mat=this._parseToObjData("mat",o.mat)),void 0!=o.rootpos?n.rootpos=e.EffectUtil.parseVector3(o.rootpos):n.rootpos=new t.math.vector3,void 0!=o.rootRotAngle?n.rootRotAngle=e.EffectUtil.parseVector3(o.rootRotAngle):n.rootRotAngle=new t.math.vector3,o.rootscale?n.rootScale=e.EffectUtil.parseVector3(o.rootscale):n.rootScale=new t.math.vector3(1,1,1),void 0!=o.moveSpeed&&(n.moveSpeed=this._parseToObjData("moveSpeed",o.moveSpeed)),void 0!=o.gravity&&(n.gravity=o.gravity),void 0!=o.euler&&(n.euler=this._parseToObjData("euler",o.euler)),void 0!=o.eulerSpeed&&(n.eulerSpeed=this._parseToObjData("eulerSpeed",o.eulerSpeed)),void 0!=o.eulerNodes){n.eulerNodes=[],void 0!=n.euler&&(n.eulerNodes.push(n.euler),n.euler.key=0);for(var s in o.eulerNodes){h=e.EffectUtil.parseEffectVec3(o.eulerNodes[s]);n.eulerNodes.push(h)}}if(void 0!=o.scale&&(n.scale=this._parseToObjData("scale",o.scale)),void 0!=o.scaleSpeed&&(n.scaleSpeed=this._parseToObjData("scaleSpeed",o.scaleSpeed)),void 0!=o.scaleNodes){n.scaleNodes=[];var l=new e.ParticleNodeNumber;l.num.value=1,l.key=0,n.scaleNodes.push(l);for(var s in o.scaleNodes){h=e.EffectUtil.parseEffectNumNode(o.scaleNodes[s]);n.scaleNodes.push(h)}}if(void 0!=o.simulationSpeed&&(n.simulationSpeed=this._parseToObjData("simulationSpeed",o.simulationSpeed)),void 0!=o.alpha&&(n.alpha=this._parseToObjData("alpha",o.alpha)),void 0!=o.alphaSpeed&&(n.alphaSpeed=this._parseToObjData("alphaSpeed",o.alphaSpeed)),void 0!=o.alphaNodes){n.alphaNodes=[],void 0!=n.alpha&&(n.alphaNodes.push(n.alpha),n.alpha.key=0);for(var s in o.alphaNodes){var h=new e.ParticleNodeNumber,c=o.alphaNodes[s];null!=c.key&&(h.key=c.key);var u=c.alpha;null!=u&&(u instanceof Array?(h.num.valueLimitMin=u[0],h.num.valueLimitMax=u[1]):h.num.value=u),n.alphaNodes.push(h)}}if(void 0!=o.color&&(n.color=this._parseToObjData("color",o.color)),void 0!=o.colorRate&&(n.colorRate=o.colorRate),void 0!=o.colorSpeed&&(n.colorSpeed=this._parseToObjData("colorSpeed",o.colorSpeed)),void 0!=o.colorNodes){n.colorNodes=[],void 0!=n.color&&(n.colorNodes.push(n.color),n.color.key=0);for(var s in o.colorNodes){h=e.EffectUtil.parseEffectVec3(o.colorNodes[s]);n.colorNodes.push(h)}}if(void 0!=o.uv&&(n.uv=e.EffectUtil.parseEffectVec2(o.uv)),void 0!=o.uvtype)switch(o.uvtype){case"uvroll":n.uvType=e.UVTypeEnum.UVRoll,void 0!=o.uvroll&&(n.uvRoll=new e.UVRoll,n.uvRoll.uvSpeed=e.EffectUtil.parseEffectUVSpeed(o.uvroll));break;case"uvsprite":var d=o.uvsprite;n.uvType=e.UVTypeEnum.UVSprite,n.uvSprite=new e.UVSprite,void 0!=d.row&&(n.uvSprite.row=d.row),void 0!=d.colum&&(n.uvSprite.column=d.colum),void 0!=d.count&&(n.uvSprite.totalCount=d.count);break;default:n.uvType=e.UVTypeEnum.NONE}else n.uvType=e.UVTypeEnum.NONE;void 0!=o.billboard&&(n.renderModel=this._parseToObjData("billboard",o.billboard)),void 0!=o.life&&(n.life=e.EffectUtil.parseEffectValueData(o.life)),void 0!=o.startpos&&this._parseEmissionShape(o.startpos,r)}}}},EffectParser.prototype._parseEmissionShape=function(e,a){var r=a.emissionData.particleStartData;switch(e.type){case"normal":r.shapeType=t.framework.ParticleSystemShape.NORMAL;break;case"box":r.shapeType=t.framework.ParticleSystemShape.BOX;break;case"sphere":r.shapeType=t.framework.ParticleSystemShape.SPHERE;break;case"hemisphere":r.shapeType=t.framework.ParticleSystemShape.HEMISPHERE;break;case"cone":r.shapeType=t.framework.ParticleSystemShape.CONE;break;case"circle":r.shapeType=t.framework.ParticleSystemShape.CIRCLE;break;case"edge":r.shapeType=t.framework.ParticleSystemShape.EDGE;break;default:r.shapeType=t.framework.ParticleSystemShape.NORMAL}if(void 0!=e.width&&(r.width=e.width),void 0!=e.height&&(r.height=e.height),void 0!=e.depth&&(r.depth=e.depth),void 0!=e.angle&&(r.angle=e.angle),void 0!=e.radius&&(r.radius=e.radius),void 0!=e.direction){var i=e.direction;r.direction.x=i.x,r.direction.y=i.y,r.direction.z=i.z}},EffectParser.prototype._parseToObjData=function(t,a){switch(t){case"pos":case"scale":case"euler":case"color":case"moveSpeed":case"eulerSpeed":case"scaleSpeed":case"colorSpeed":return e.EffectUtil.parseEffectVec3(a);case"":return e.EffectUtil.parseEffectVec2(a);case"alphaSpeed":case"alpha":case"simulationSpeed":return e.EffectUtil.parseEffectNum(a);case"tilling":return e.EffectUtil.parseEffectVec2(a);case"mat":var r=new e.EffectMatData;return void 0!=a&&(void 0!=a.shader?r.shader=this.asMgr.getShader(a.shader):r.shader=this.asMgr.getShader("shader/def"),void 0!=a.diffuseTexture&&(r.diffuseTexture=this.asMgr.getAssetByName(a.diffuseTexture)),void 0!=a.alphaCut&&(r.alphaCut=a.alphaCut),void 0!=a._AlphaTex&&(r.alphaTexture=this.asMgr.getAssetByName(a._AlphaTex))),r;case"emmision":var i=new e.EmissionData;return void 0!=a.type&&(i.type=a.type),void 0!=a.time&&(i.time=a.time),void 0!=a.count&&(i.count=a.count),i;case"billboard":e.RenderModel.Mesh;return"billboard"==a?e.RenderModel.BillBoard:"horizontal"==a?e.RenderModel.HorizontalBillBoard:"stretched"==a?e.RenderModel.StretchedBillBoard:"vertical"==a?e.RenderModel.VerticalBillBoard:"mesh"==a?e.RenderModel.Mesh:e.RenderModel.None;case"mesh":return a.toString().indexOf(".mesh.bin")>=0?this.asMgr.getAssetByName(a):this.asMgr.getDefaultMesh(a);default:return a}},EffectParser.prototype._parseToParticleNode=function(t){var a=(t=e.StringUtil.replaceAll(t," ","")).match(e.RegexpUtil.vector3FloatOrRangeRegexp);if(void 0!=a){for(var r=new e.ParticleNode,i=1;i<a.length;i++)1==i?r.x=this._parseToValueData(a[i]):2==i?r.y=this._parseToValueData(a[i]):3==i&&(r.z=this._parseToValueData(a[i]));return r}return null},EffectParser.prototype._parseToValueData=function(t){var a=new e.ValueData,r=this._parseToNumberArray(t);return null!=r&&(r.length>1?(a.valueLimitMin=r[0],a.valueLimitMax=r[1],a.isRandom=!0):(a.value=r[0],a.isRandom=!1)),a},EffectParser.prototype._parseToNumberArray=function(t){t=e.StringUtil.trimAll(t),t=e.StringUtil.replaceAll(t,"\\[","");for(var a=(t=e.StringUtil.replaceAll(t,"\\]","")).split(","),r=[],i=0;i<a.length;i++)r.push(parseInt(a[i]));return r},EffectParser}();e.EffectParser=a}(t.framework||(t.framework={}))}(gd3d||(gd3d={}));var gd3d;!function(t){!function(e){var a=function(){function EffectUtil(){}return EffectUtil.lookatbyXAxis=function(e,a,r,i,o,n){var s=t.math.pool.new_vector3();t.math.vec3Subtract(o,e,s),t.math.vec3Normalize(s,s);var l=t.math.pool.new_vector3();t.math.vec3Cross(s,a,l),t.math.vec3Normalize(l,l);var h=t.math.vec3Dot(r,l);h=180*Math.acos(h)/Math.PI;var c=t.math.vec3Dot(i,l);(c=180*Math.acos(c)/Math.PI)>90&&(h=-h),t.math.quatFromAxisAngle(t.math.pool.vector3_right,h,n),t.math.pool.delete_vector3(s),t.math.pool.delete_vector3(l)},EffectUtil.eulerFromQuaternion=function(e,a,r){var i=a.x*a.x,o=a.y*a.y,n=a.z*a.z,s=a.w*a.w;if("XYZ"===r)e.x=Math.atan2(2*(a.x*a.w-a.y*a.z),s-i-o+n),e.y=Math.asin(t.math.floatClamp(2*(a.x*a.z+a.y*a.w),-1,1)),e.z=Math.atan2(2*(a.z*a.w-a.x*a.y),s+i-o-n);else if("YXZ"===r)e.x=Math.asin(t.math.floatClamp(2*(a.x*a.w-a.y*a.z),-1,1)),e.y=Math.atan2(2*(a.x*a.z+a.y*a.w),s-i-o+n),e.z=Math.atan2(2*(a.x*a.y+a.z*a.w),s-i+o-n);else if("ZXY"===r)e.x=Math.asin(t.math.floatClamp(2*(a.x*a.w+a.y*a.z),-1,1)),e.y=Math.atan2(2*(a.y*a.w-a.z*a.x),s-i-o+n),e.z=Math.atan2(2*(a.z*a.w-a.x*a.y),s-i+o-n);else if("ZYX"===r)e.x=Math.atan2(2*(a.x*a.w+a.z*a.y),s-i-o+n),e.y=Math.asin(t.math.floatClamp(2*(a.y*a.w-a.x*a.z),-1,1)),e.z=Math.atan2(2*(a.x*a.y+a.z*a.w),s+i-o-n);else if("YZX"===r)e.x=Math.atan2(2*(a.x*a.w-a.z*a.y),s-i+o-n),e.y=Math.atan2(2*(a.y*a.w-a.x*a.z),s+i-o-n),e.z=Math.asin(t.math.floatClamp(2*(a.x*a.y+a.z*a.w),-1,1));else{if("XZY"!==r)return void console.log("No order given for quaternion to euler conversion.");e.x=Math.atan2(2*(a.x*a.w+a.y*a.z),s-i+o-n),e.y=Math.atan2(2*(a.x*a.z+a.y*a.w),s+i-o-n),e.z=Math.asin(t.math.floatClamp(2*(a.z*a.w-a.x*a.y),-1,1))}},EffectUtil.RandomRange=function(t,e,a){return void 0===a&&(a=!1),a?Math.floor(Math.random()*(e-t+1)+t):Math.random()*(e-t)+t},EffectUtil.vecMuliNum=function(e,a){return new t.math.vector3(e.x*a,e.y*a,e.z*a)},EffectUtil.parseVector3=function(e){var a=new t.math.vector3;return a.x=e.x,a.y=e.y,a.z=e.z,a},EffectUtil.parseEffectVec3=function(t){var a=new e.ParticleNode;for(var r in t)t[r]instanceof Array?(a[r].valueLimitMin=t[r][0],a[r].valueLimitMax=t[r][1],a[r].isRandom=!0):"key"==r?a[r]=t[r]:(a[r].value=t[r],a[r].isRandom=!1);return a},EffectUtil.parseEffectVec2=function(t){var a=new e.ParticleNodeVec2;for(var r in t)t[r]instanceof Array?(a[r].valueLimitMin=t[r][0],a[r].valueLimitMax=t[r][1],a[r].isRandom=!0):"key"==r?a[r]=t[r]:(a[r].value=t[r],a[r].isRandom=!1);return a},EffectUtil.parseEffectNum=function(t){var a=new e.ParticleNodeNumber;return t instanceof Array?(a.num.valueLimitMin=t[0],a.num.valueLimitMax=t[1],a.num.isRandom=!0):(a.num.value=t,a.num.isRandom=!1),a},EffectUtil.parseEffectNumNode=function(t){var a=new e.ParticleNodeNumber;for(var r in t)t[r]instanceof Array?(a[r].valueLimitMin=t[r][0],a[r].valueLimitMax=t[r][1]):"key"==r?a[r]=t[r]:a.num.value=t[r];return a},EffectUtil.parseEffectValueData=function(t){var a=new e.ValueData;return t instanceof Array?(a.valueLimitMin=t[0],a.valueLimitMax=t[1],a.isRandom=!0):(a.value=t,a.isRandom=!1),a},EffectUtil.parseEffectUVSpeed=function(t){var a=new e.UVSpeedNode;for(var r in t)a[r].value=t[r];return a},EffectUtil.lookat=function(e,a,r,i){void 0===i&&(i=t.math.pool.vector3_up);var o=new t.math.vector3;t.math.vec3Subtract(a,e,o),t.math.vec3Normalize(o,o);var n=new t.math.vector3(o.x,0,o.z);t.math.vec3Normalize(n,n);var s=Math.acos(n.z)/Math.PI*180;n.x<0&&(s=-s),t.math.quatFromAxisAngle(i,s,r);var l=t.math.pool.new_vector3();t.math.vec3Cross(i,o,l),t.math.vec3Normalize(l,l);var h=new t.math.vector3(o.x,0,o.z),c=t.math.vec3Length(h),u=Math.acos(c)/Math.PI*180;o.y<0&&(u=-u);var d=t.math.pool.new_quaternion();t.math.quatFromAxisAngle(l,u,d)},EffectUtil.RotateVector3=function(e,a,r){t.math.vec3Normalize(e,e),t.math.vec3Normalize(a,a);var i=new t.math.vector3(0,0,1),o=t.math.pool.new_vector3();t.math.vec3Cross(i,a,o),t.math.vec3Normalize(o,o),0==o.x&&0==o.y&&0==o.z&&(o.x=1,o.y=0,o.z=0);var n=t.math.vec3Dot(i,a),s=180*Math.acos(n)/Math.PI;n<0&&(s=-s);var l=t.math.pool.new_quaternion();t.math.quatFromAxisAngle(o,s,l),t.math.quatTransformVector(l,e,r),t.math.pool.delete_vector3(o),t.math.pool.delete_quaternion(l)},EffectUtil.bindAxisBillboard=function(e,a){t.math.vec3Normalize(e,e);var r=t.math.pool.vector3_up,i=t.math.pool.new_vector3();t.math.vec3Cross(r,e,i),t.math.vec3Normalize(i,i),0==i.x&&0==i.y&&0==i.z&&(i.x=1,i.y=0,i.z=0);var o=t.math.vec3Dot(r,e),n=180*Math.acos(o)/Math.PI;o<0&&(n=-n),t.math.quatFromAxisAngle(i,n,a)},EffectUtil.lookatVerticalBillboard=function(e,a,r,i){void 0===i&&(i=t.math.pool.vector3_up);var o=new t.math.vector3;t.math.vec3Subtract(a,e,o),t.math.vec3Normalize(o,o);var n=new t.math.vector3(o.x,0,o.z);t.math.vec3Normalize(n,n);var s=Math.acos(n.z)/Math.PI*180;n.x<0&&(s=-s),t.math.quatFromAxisAngle(i,s,r)},EffectUtil.quatLookatZ=function(e,a,r,i){void 0===i&&(i=t.math.pool.vector3_forward);var o=new t.math.vector3;t.math.vec3Subtract(a,e,o),t.math.vec3Normalize(o,o);var n=new t.math.vector3(-o.x,o.y,0);t.math.vec3Normalize(n,n);var s=Math.acos(n.y)/Math.PI*180;n.x<0&&(s=-s),t.math.quatFromAxisAngle(i,s,r)},EffectUtil.quatLookatX=function(e,a,r,i){void 0===i&&(i=t.math.pool.vector3_right);var o=t.math.pool.new_vector3();t.math.vec3Subtract(a,e,o),t.math.vec3Normalize(o,o);var n=new t.math.vector3(0,-o.y,o.z);t.math.vec3Normalize(n,n);var s=Math.acos(n.z)/Math.PI*180;n.y<0&&(s=-s),t.math.quatFromAxisAngle(i,s,r)},EffectUtil}();e.EffectUtil=a}(t.framework||(t.framework={}))}(gd3d||(gd3d={}));var gd3d;!function(t){!function(e){var a=function(){function EmissionBatcher(a){this.particles=[],this.vertexSize=0,this.vf=0,this.curVerCount=0,this.curIndexCount=0,this.emissionElement=a,this.webgl=a.webgl,this.gameObject=a.gameObject,this.vf=a.vf,this.data=a.emissionData,this.vertexSize=t.render.meshData.calcByteSize(this.vf)/4,this.initMesh(),this.mat=new e.material,null==this.data.mat.shader?this.mat.setShader(e.sceneMgr.app.getAssetMgr().getShader("diffuse.shader.json")):this.mat.setShader(this.data.mat.shader),void 0!=this.data.mat.alphaCut&&this.mat.setFloat("_AlphaCut",this.data.mat.alphaCut),null!=this.data.mat.diffuseTexture&&this.mat.setTexture("_MainTex",this.data.mat.diffuseTexture),null!=this.data.mat.alphaTexture&&this.mat.setTexture("_AlphaTex",this.data.mat.alphaTexture)}return EmissionBatcher.prototype.initMesh=function(){this.mesh=new e.mesh,this.mesh.data=new t.render.meshData,this.mesh.glMesh=new t.render.glMesh,this.mesh.submesh=[];var a=new e.subMeshInfo;a.matIndex=0,a.useVertexIndex=0,a.start=0,a.size=0,a.line=!1,this.mesh.submesh.push(a),this.dataForVbo=new Float32Array(128),this.dataForEbo=new Uint16Array(128),this.mesh.glMesh.initBuffer(this.webgl,this.vf,128,t.render.MeshTypeEnum.Dynamic),this.mesh.glMesh.addIndex(this.webgl,this.dataForEbo.length)},EmissionBatcher.prototype.addParticle=function(){this.refreshBuffer();var t=new e.Particle(this);t.update(0),t.uploadData(this.dataForVbo);for(var a=0;a<t.dataForEbo.length;a++)this.dataForEbo[this.curIndexCount+a]=t.dataForEbo[a]+this.curVerCount;this.particles.push(t),this.curVerCount+=this.emissionElement.perVertexCount,this.curIndexCount+=this.emissionElement.perIndexxCount,this.mesh.glMesh.uploadIndexData(this.webgl,0,this.dataForEbo),this.mesh.submesh[0].size=this.curIndexCount},EmissionBatcher.prototype.refreshBuffer=function(){var t=this.curVerCount+this.emissionElement.perVertexCount,e=this.curIndexCount+this.emissionElement.perIndexxCount;if(t*this.vertexSize>this.dataForVbo.length){r=this.dataForVbo.length;this.mesh.glMesh.resetVboSize(this.webgl,2*r);var a=new Float32Array(2*r);a.set(this.dataForVbo,0),this.dataForVbo=a}if(e>this.dataForEbo.length){var r=this.dataForEbo.length;this.mesh.glMesh.resetEboSize(this.webgl,0,2*r);var i=new Uint16Array(2*r);i.set(this.dataForEbo,0),this.dataForEbo=i}},EmissionBatcher.prototype.update=function(t){for(var e in this.particles)this.particles[e].update(t),this.particles[e].uploadData(this.dataForVbo)},EmissionBatcher.prototype.render=function(t,e,a){var r=this.mesh;r.glMesh.uploadVertexData(t.webgl,this.dataForVbo),e.app.getScene().fog?(t.fog=e.app.getScene().fog,this.mat.draw(t,r,r.submesh[0],"base_fog")):this.mat.draw(t,r,r.submesh[0],"base")},EmissionBatcher.prototype.dispose=function(){this.dataForVbo=null,this.dataForEbo=null,this.mesh.dispose(),this.mat.dispose();for(var t in this.particles)this.particles[t].dispose()},EmissionBatcher}();e.EmissionBatcher=a}(t.framework||(t.framework={}))}(gd3d||(gd3d={}));var gd3d;!function(t){!function(e){var a=function(){function Particle(a){this.renderModel=e.RenderModel.Mesh,this.startScale=new t.math.vector3,this.startRotation=new t.math.quaternion,this.rotationByShape=new t.math.quaternion,this.rotationByEuler=new t.math.quaternion,this.localMatrix=new t.math.matrix,this.localRotation=new t.math.quaternion,this.tilling=new t.math.vector2(1,1),this.speedDir=new t.math.vector3(0,0,0),this.actived=!0,this.transformVertex=new t.math.matrix,this.matToworld=new t.math.matrix,this.tex_ST=new t.math.vector4(1,1,0,0),this.batcher=a,this.gameObject=a.gameObject,this.emisson=a.emissionElement,this.vf=a.vf,this.data=a.data.clone(),this.vertexSize=t.render.meshData.calcByteSize(this.vf)/4,this.vertexStartIndex=a.curVerCount,this.vertexCount=this.emisson.perVertexCount,this.dataForVbo=new Float32Array(this.vertexCount*this.vertexSize),this.dataForEbo=this.data.mesh.data.genIndexDataArray(),this.dataForVbo.set(this.data.mesh.data.genVertexDataArray(this.vf),0),this.sourceVbo=this.data.getVboData(this.vf),this.initByData()}return Particle.prototype.uploadData=function(t){t.set(this.dataForVbo,this.vertexStartIndex*this.vertexSize)},Particle.prototype.initByData=function(){this.totalLife=this.data.life.getValueRandom(),this.renderModel=this.data.renderModel,this.curLife=0;var a=this.data.particleStartData.randomDirection;this.speedDir=t.math.pool.clone_vector3(a);var r=this.data.particleStartData.position;if(this.localTranslate=t.math.pool.clone_vector3(r),this.simulationSpeed=void 0!=this.data.simulationSpeed?this.data.simulationSpeed.getValue():0,void 0==this.data.euler?this.euler=new t.math.vector3(0,0,0):this.euler=this.data.euler.getValueRandom(),void 0==this.data.scale?this.localScale=new t.math.vector3(1,1,1):this.localScale=this.data.scale.getValueRandom(),void 0==this.data.color?this.color=new t.math.vector3(0,0,0):this.color=this.data.color.getValueRandom(),void 0==this.data.alpha?this.alpha=1:this.alpha=this.data.alpha.getValueRandom(),void 0==this.data.uv?this.uv=new t.math.vector2:this.uv=this.data.uv.getValueRandom(),void 0!=this.data.moveSpeed?this.movespeed=this.data.moveSpeed.getValue():this.movespeed=new t.math.vector3,void 0==this.data.colorRate?this.colorRate=this.data.colorRate:this.colorRate=1,t.math.vec3Clone(this.localScale,this.startScale),t.math.quatFromEulerAngles(this.euler.x,this.euler.y,this.euler.z,this.rotationByEuler),(this.renderModel==e.RenderModel.None||this.renderModel==e.RenderModel.StretchedBillBoard)&&this.data.particleStartData.shapeType!=e.ParticleSystemShape.NORMAL){var i=t.math.pool.vector3_zero;t.math.quatLookat(i,a,this.rotationByShape);var o=t.math.pool.new_quaternion();t.math.quatFromEulerAngles(90,0,90,o),t.math.quatMultiply(this.rotationByShape,o,this.rotationByShape),t.math.quatClone(this.rotationByShape,this.localRotation),t.math.pool.delete_quaternion(o)}if(!this.emisson.simulateInLocalSpace){this.emissionMatToWorld=new t.math.matrix;var n=this.emisson.getmatrixToWorld();t.math.matrixClone(n,this.emissionMatToWorld),this.emissionWorldRotation=new t.math.quaternion;var s=this.emisson.getWorldRotation();t.math.quatClone(s,this.emissionWorldRotation)}},Particle.prototype.update=function(e){if(this.actived){if(this.curLife+=e,this.curLife>=this.totalLife)return t.math.matrixZero(this.transformVertex),this._updateVBO(),this.emisson.deadParticles.push(this),this.curLife=0,void(this.actived=!1);this._updatePos(e),this._updateScale(e),this._updateEuler(e),this._updateRotation(e),this._updateLocalMatrix(e),this._updateColor(e),this._updateAlpha(e),this._updateUV(e),this._updateVBO()}},Particle.prototype._updateLocalMatrix=function(e){t.math.matrixMakeTransformRTS(this.localTranslate,this.localScale,this.localRotation,this.localMatrix),this.emisson.simulateInLocalSpace?t.math.matrixMultiply(this.emisson.matToBatcher,this.localMatrix,this.transformVertex):t.math.matrixMultiply(this.emissionMatToWorld,this.localMatrix,this.transformVertex)},Particle.prototype.refreshEmissionData=function(){this.emisson.simulateInLocalSpace&&(this.emissionMatToWorld=this.emisson.getmatrixToWorld(),this.emissionWorldRotation=this.emisson.getWorldRotation())},Particle.prototype._updateRotation=function(t){this._updateElementRotation()},Particle.prototype._updateElementRotation=function(){if(this.renderModel!=e.RenderModel.Mesh){this.refreshEmissionData();var a=t.math.pool.new_vector3(),r=t.math.pool.new_vector3(),i=t.math.pool.new_quaternion(),o=t.math.pool.new_quaternion();t.math.vec3Clone(this.localTranslate,a);var n=this.batcher.emissionElement.renderCamera;null==n&&(n=t.framework.sceneMgr.app.getScene().mainCamera);var s=n.gameObject.transform.getWorldTranslate();if(t.math.matrixTransformVector3(a,this.emissionMatToWorld,r),this.renderModel==e.RenderModel.BillBoard)t.math.quatLookat(r,s,i);else if(this.renderModel==e.RenderModel.HorizontalBillBoard)i.x=-.5,i.y=.5,i.z=.5,i.w=.5;else if(this.renderModel==e.RenderModel.VerticalBillBoard){var l=t.math.pool.new_vector3();t.math.vec3Clone(s,l),l.y=r.y,t.math.quatLookat(r,l,i),t.math.pool.delete_vector3(l)}else if(this.renderModel==e.RenderModel.StretchedBillBoard){t.math.matrixMakeTransformRTS(this.localTranslate,this.localScale,this.localRotation,this.localMatrix),t.math.matrixMultiply(this.emissionMatToWorld,this.localMatrix,this.matToworld);var h=t.math.pool.new_vector3(),c=t.math.pool.new_vector3(),u=t.math.pool.new_vector3();return t.math.matrixTransformNormal(t.math.pool.vector3_right,this.matToworld,h),t.math.vec3Normalize(h,h),t.math.matrixTransformNormal(t.math.pool.vector3_up,this.matToworld,c),t.math.vec3Normalize(c,c),t.math.matrixTransformNormal(t.math.pool.vector3_forward,this.matToworld,u),t.math.vec3Normalize(u,u),e.EffectUtil.lookatbyXAxis(r,h,c,u,s,i),t.math.quatMultiply(this.localRotation,i,this.localRotation),t.math.pool.delete_quaternion(i),t.math.pool.delete_vector3(a),t.math.pool.delete_quaternion(o),t.math.pool.delete_vector3(h),t.math.pool.delete_vector3(c),void t.math.pool.delete_vector3(u)}t.math.quatClone(this.emissionWorldRotation,o),t.math.quatInverse(o,o),t.math.quatMultiply(o,i,this.localRotation),t.math.quatMultiply(this.localRotation,this.rotationByEuler,this.localRotation),t.math.pool.delete_vector3(a),t.math.pool.delete_vector3(r),t.math.pool.delete_quaternion(i),t.math.pool.delete_quaternion(o)}else t.math.quatClone(this.rotationByEuler,this.localRotation)},Particle.prototype._updatePos=function(a){void 0!=this.data.moveSpeed&&(this.localTranslate.x+=this.movespeed.x*a,this.localTranslate.y+=this.movespeed.y*a,this.localTranslate.z+=this.movespeed.z*a);var r=e.EffectUtil.vecMuliNum(this.speedDir,this.simulationSpeed);t.math.vec3Add(this.localTranslate,r,this.localTranslate)},Particle.prototype._updateEuler=function(e){void 0==this.data.eulerNodes||void 0==this.data.eulerSpeed?void 0!=this.data.eulerNodes?(this._updateNode(this.data.eulerNodes,this.totalLife,this.euler),t.math.quatFromEulerAngles(this.euler.x,this.euler.y,this.euler.z,this.rotationByEuler)):void 0!=this.data.eulerSpeed&&(void 0!=this.data.eulerSpeed.x&&(this.euler.x+=this.data.eulerSpeed.x.getValue()*e),void 0!=this.data.eulerSpeed.y&&(this.euler.y+=this.data.eulerSpeed.y.getValue()*e),void 0!=this.data.eulerSpeed.z&&(this.euler.z+=this.data.eulerSpeed.z.getValue()*e),t.math.quatFromEulerAngles(this.euler.x,this.euler.y,this.euler.z,this.rotationByEuler)):console.error("scale只能通过插值或者speed来修改，不能两个同时存在！")},Particle.prototype._updateScale=function(t){void 0==this.data.scaleNodes||void 0==this.data.scaleSpeed?void 0!=this.data.scaleNodes?this._updateNode(this.data.scaleNodes,this.totalLife,this.localScale,r.scale):void 0!=this.data.scaleSpeed&&(void 0!=this.data.scaleSpeed.x&&(this.localScale.x+=this.data.scaleSpeed.x.getValue()*t),void 0!=this.data.scaleSpeed.y&&(this.localScale.y+=this.data.scaleSpeed.y.getValue()*t),void 0!=this.data.scaleSpeed.z&&(this.localScale.z+=this.data.scaleSpeed.z.getValue()*t)):console.error("scale只能通过插值或者speed来修改，不能两个同时存在！")},Particle.prototype._updateColor=function(t){void 0==this.data.colorNodes||void 0==this.data.colorSpeed?void 0!=this.data.colorNodes?this._updateNode(this.data.colorNodes,this.totalLife,this.color):void 0!=this.data.colorSpeed&&(void 0!=this.data.colorSpeed.x&&(this.color.x+=this.data.colorSpeed.x.getValue()*t),void 0!=this.data.colorSpeed.y&&(this.color.y+=this.data.colorSpeed.y.getValue()*t),void 0!=this.data.colorSpeed.z&&(this.color.z+=this.data.colorSpeed.z.getValue()*t)):console.error("color只能通过插值或者speed来修改，不能两个同时存在！")},Particle.prototype._updateNode=function(a,i,o,n){void 0===n&&(n=r.none);var s=0;if(void 0!=a){for(var l=0;l<a.length;l++)if(l+1<a.length){if(a[l].key*i<=this.curLife&&a[l+1].key*i>=this.curLife){this.tempStartNode=a[l],this.tempEndNode=a[l+1],0,s=(this.tempEndNode.key-this.tempStartNode.key)*i;break}}else this.curLife<a[l].key*i&&(this.tempStartNode=a[l-1],this.tempEndNode=a[l],s=(this.tempEndNode.key-this.tempStartNode.key)*i);if(this.tempStartNode instanceof e.ParticleNode)s>0&&t.math.vec3SLerp(this.tempStartNode.getValue(),this.tempEndNode.getValue(),(this.curLife-this.tempStartNode.key*i)/s,o);else if(this.tempStartNode instanceof e.ParticleNodeNumber){if(s>0)if(n==r.alpha)this.alpha=t.math.numberLerp(this.tempStartNode.getValue(),this.tempEndNode.getValue(),(this.curLife-this.tempStartNode.key*i)/s);else if(n=r.scale){var h=t.math.numberLerp(this.tempStartNode.getValue(),this.tempEndNode.getValue(),(this.curLife-this.tempStartNode.key*i)/s);t.math.vec3ScaleByNum(this.startScale,h,o)}}else this.tempStartNode instanceof e.UVSpeedNode&&s>0&&t.math.vec2SLerp(this.tempStartNode.getValue(),this.tempEndNode.getValue(),(this.curLife-this.tempStartNode.key*i)/s,o)}},Particle.prototype._updateAlpha=function(t){void 0==this.data.alphaNodes||void 0==this.data.alphaSpeed?void 0!=this.data.alphaNodes?this._updateNode(this.data.alphaNodes,this.totalLife,this.alpha,r.alpha):void 0!=this.data.alphaSpeed&&(this.alpha+=this.data.alphaSpeed.getValue()*t):console.error("color只能通过插值或者speed来修改，不能两个同时存在！")},Particle.prototype._updateUV=function(a){if(void 0==this.uv&&(this.uv=new t.math.vector2),this.data.uvType==e.UVTypeEnum.NONE)this.uv=this.data.uv.getValue();else if(this.data.uvType==e.UVTypeEnum.UVRoll){if(void 0!=this.data.uvRoll){if(void 0!=this.data.uvRoll.uvSpeedNodes&&void 0!=this.data.uvRoll.uvSpeed)return void console.error("uv只能通过插值或者speed来修改，不能两个同时存在！");void 0!=this.data.uvRoll.uvSpeedNodes?this._updateNode(this.data.uvRoll.uvSpeedNodes,this.totalLife,this.uv):void 0!=this.data.uvRoll.uvSpeed&&(void 0!=this.data.uvRoll.uvSpeed.u&&(this.tex_ST.z+=this.data.uvRoll.uvSpeed.u.getValue()*a),void 0!=this.data.uvRoll.uvSpeed.v&&(this.tex_ST.w+=this.data.uvRoll.uvSpeed.v.getValue()*a))}}else if(this.data.uvType==e.UVTypeEnum.UVSprite&&void 0!=this.data.uvSprite){var r=Math.floor(this.curLife/this.totalLife*this.data.uvSprite.totalCount);t.math.spriteAnimation(this.data.uvSprite.row,this.data.uvSprite.column,r,this.tex_ST)}},Particle.prototype._updateVBO=function(){for(var e=this.vertexSize,a=0;a<this.vertexCount;a++){var r=t.math.pool.new_vector3();r.x=this.sourceVbo[a*e+0],r.y=this.sourceVbo[a*e+1],r.z=this.sourceVbo[a*e+2],t.math.matrixTransformVector3(r,this.transformVertex,r),this.dataForVbo[a*e+0]=r.x,this.dataForVbo[a*e+1]=r.y,this.dataForVbo[a*e+2]=r.z,t.math.pool.delete_vector3(r);var i=t.math.floatClamp(this.sourceVbo[a*e+3],0,1),o=t.math.floatClamp(this.sourceVbo[a*e+4],0,1),n=t.math.floatClamp(this.sourceVbo[a*e+5],0,1),s=t.math.floatClamp(this.sourceVbo[a*e+6],0,1);void 0!=this.color&&(i=this.color.x,o=this.color.y,n=this.color.z),void 0!=this.alpha&&(s=this.alpha),void 0!=this.colorRate&&(i*=this.colorRate,o*=this.colorRate,n*=this.colorRate,s*=this.colorRate),i=t.math.floatClamp(i,0,3),o=t.math.floatClamp(o,0,3),n=t.math.floatClamp(n,0,3),s=t.math.floatClamp(s,0,3),this.dataForVbo[a*this.vertexSize+3]=i,this.dataForVbo[a*this.vertexSize+4]=o,this.dataForVbo[a*this.vertexSize+5]=n,this.dataForVbo[a*this.vertexSize+6]=s,this.dataForVbo[a*e+7]=this.sourceVbo[a*e+7]*this.tex_ST.x+this.tex_ST.z,this.dataForVbo[a*e+8]=this.sourceVbo[a*e+8]*this.tex_ST.y+this.tex_ST.w}},Particle.prototype.dispose=function(){this.dataForVbo=null,this.dataForEbo=null,this.startRotation=null,this.localRotation=null,this.rotationByEuler=null,this.rotationByShape=null,this.tilling=null,this.localMatrix=null,this.localTranslate=null,this.euler=null,this.localScale=null,this.colorRate=1,this.color=null,this.uv=null},Particle}();e.Particle=a;var r;!function(t){t[t.none=0]="none",t[t.alpha=1]="alpha",t[t.scale=2]="scale"}(r=e.nodeType||(e.nodeType={}))}(t.framework||(t.framework={}))}(gd3d||(gd3d={}));var gd3d;!function(t){!function(e){var a=function(){function Particles(e){this.emissionElements=[],this.vf=t.render.VertexFormatMask.Position|t.render.VertexFormatMask.Color|t.render.VertexFormatMask.UV0,this.effectSys=e}return Particles.prototype.addEmission=function(t){var e=new r(t,this.effectSys,this);this.emissionElements.push(e)},Particles.prototype.updateForEmission=function(t){for(var e in this.emissionElements)this.emissionElements[e].updateForEmission(t)},Particles.prototype.update=function(t){for(var e in this.emissionElements)this.emissionElements[e].update(t)},Particles.prototype.render=function(t,e,a){for(var r in this.emissionElements)this.emissionElements[r].render(t,e,a)},Particles.prototype.dispose=function(){for(var t in this.emissionElements)this.emissionElements[t].dispose();this.emissionElements.length=0},Particles}();e.Particles=a;var r=function(){function EmissionElement(a,r,i){switch(this.maxVertexCount=2048,this.localtranslate=new t.math.vector3,this.localScale=new t.math.vector3(1,1,1),this.localrotate=new t.math.quaternion,this.eluerAngle=new t.math.quaternion,this.beloop=!1,this.simulateInLocalSpace=!0,this.active=!0,this.isover=!1,this.worldRotation=new t.math.quaternion,this.matToBatcher=new t.math.matrix,this.matToWorld=new t.math.matrix,this.testtime=0,this.webgl=t.framework.sceneMgr.app.webgl,this.effectSys=r,this.ParticleMgr=i,this.vf=i.vf,this.gameObject=i.effectSys.gameObject,this.beloop=a.beloop,this.emissionData=a.emissionData,this.perVertexCount=this.emissionData.mesh.data.pos.length,this.perIndexxCount=this.emissionData.mesh.data.trisindex.length,this.simulateInLocalSpace=this.emissionData.simulateInLocalSpace,this.emissionData.emissionType){case e.ParticleEmissionType.burst:break;case e.ParticleEmissionType.continue:this._continueSpaceTime=this.emissionData.time/this.emissionData.emissionCount}t.math.vec3Clone(this.emissionData.rootpos,this.localtranslate),t.math.vec3Clone(this.emissionData.rootRotAngle,this.eluerAngle),t.math.vec3Clone(this.emissionData.rootScale,this.localScale),t.math.quatFromEulerAngles(this.eluerAngle.x,this.eluerAngle.y,this.eluerAngle.z,this.localrotate),t.math.matrixMakeTransformRTS(this.localtranslate,this.localScale,this.localrotate,this.matToBatcher),this.emissionBatchers=[],this.deadParticles=[],this.curTime=0,this.numcount=0,this.addBatcher()}return EmissionElement.prototype.getWorldRotation=function(){var e=this.gameObject.transform.getWorldRotate();return t.math.quatMultiply(e,this.localrotate,this.worldRotation),this.worldRotation},EmissionElement.prototype.getmatrixToWorld=function(){var e=this.gameObject.transform.getWorldMatrix();return t.math.matrixMultiply(e,this.matToBatcher,this.matToWorld),this.matToWorld},EmissionElement.prototype.update=function(t){this.updateBatcher(t)},EmissionElement.prototype.updateForEmission=function(t){this.testtime+=t,this.curTime+=t,this.updateEmission(t)},EmissionElement.prototype.updateBatcher=function(t){for(var e in this.emissionBatchers)this.emissionBatchers[e].update(t)},EmissionElement.prototype.updateEmission=function(a){if(!this.isover)if(this.emissionData.emissionType==e.ParticleEmissionType.continue){var r=this.curTime/this.emissionData.time;r=t.math.floatClamp(r,0,1);var i=Math.floor(r*this.emissionData.emissionCount);i-=this.numcount;for(var o=0;o<i;o++)this.addParticle(),this.numcount++;1==r&&(this.beloop?(this.curTime=0,this.numcount=0,this.isover=!1):this.isover=!0)}else this.emissionData.emissionType==e.ParticleEmissionType.burst&&this.curTime>this.emissionData.time&&(this.addParticle(this.emissionData.emissionCount),this.beloop?(this.curTime=0,this.isover=!1):this.isover=!0)},EmissionElement.prototype.addParticle=function(t){void 0===t&&(t=1);for(var e=0;e<t;e++)if(this.deadParticles.length>0){var a=this.deadParticles.pop();a.initByData(),a.update(0),a.actived=!0}else this.curbatcher.curVerCount+this.perVertexCount<=this.maxVertexCount?this.curbatcher.addParticle():(this.addBatcher(),this.curbatcher.addParticle())},EmissionElement.prototype.addBatcher=function(){var t=new e.EmissionBatcher(this);this.emissionBatchers.push(t),this.curbatcher=t},EmissionElement.prototype.render=function(t,e,a){this.renderCamera=a,this.simulateInLocalSpace?t.updateModel(this.gameObject.transform):t.updateModeTrail();for(var r in this.emissionBatchers)this.emissionBatchers[r].render(t,e,a)},EmissionElement.prototype.dispose=function(){for(var t in this.emissionBatchers)this.emissionBatchers[t].dispose();this.emissionBatchers.length=0},EmissionElement.prototype.isOver=function(){return this.isover},EmissionElement}();e.EmissionElement=r}(t.framework||(t.framework={}))}(gd3d||(gd3d={}));var gd3d;!function(t){!function(e){var a;!function(t){t[t.None=0]="None",t[t.HideInHierarchy=1]="HideInHierarchy",t[t.HideInInspector=2]="HideInInspector",t[t.DontSaveInEditor=4]="DontSaveInEditor",t[t.NotEditable=8]="NotEditable",t[t.DontSaveInBuild=16]="DontSaveInBuild",t[t.DontUnloadUnusedAsset=32]="DontUnloadUnusedAsset",t[t.DontSave=52]="DontSave",t[t.HideAndDontSave=61]="HideAndDontSave"}(a=e.HideFlags||(e.HideFlags={}));var r=function(){function nodeComponent(t,e){void 0===e&&(e=!1),this.comp=t,this.init=e}return __decorate([t.reflect.Field("INodeComponent"),__metadata("design:type",Object)],nodeComponent.prototype,"comp",void 0),nodeComponent=__decorate([t.reflect.SerializeType,__metadata("design:paramtypes",[Object,Boolean])],nodeComponent)}();e.nodeComponent=r;var i=function(){function gameObject(){this.layer=e.cullingmaskutil.maskTolayer(e.CullingMask.default),this.tag=e.StringUtil.builtinTag_Untagged,this.hideFlags=a.None,this.isStatic=!1,this.components=[],this.componentsInit=[],this._visible=!0}return gameObject.prototype.getScene=function(){return this.transform.scene},Object.defineProperty(gameObject.prototype,"visibleInScene",{get:function(){for(var t=this;t.visible&&t.transform.parent;)t=t.transform.parent.gameObject;return t.visible},enumerable:!0,configurable:!0}),Object.defineProperty(gameObject.prototype,"visible",{get:function(){return this._visible},set:function(t){t!=this._visible&&(this._visible=t,e.sceneMgr.app.markNotify(this.transform,e.NotifyType.ChangeVisible))},enumerable:!0,configurable:!0}),gameObject.prototype.getName=function(){return this.transform.name},gameObject.prototype.init=function(t){if(void 0===t&&(t=!1),this.componentsInit.length>0){for(var e=0;e<this.componentsInit.length;e++)this.componentsInit[e].comp.start(),this.componentsInit[e].init=!0,t&&this.componentsInit[e].comp.onPlay&&this.componentsInit[e].comp.onPlay();this.componentsInit.length=0}},gameObject.prototype.update=function(t){for(var e=0,a=this.components;e<a.length;e++)a[e].comp.update(t)},gameObject.prototype.addComponentDirect=function(a){if(this.transform.markHaveComponent(),null!=a.gameObject)throw new Error("this components has added to a  gameObject");a.gameObject=this;var i=new r(a,!1),o=!0;return"1"!=t.reflect.getClassTag(a.__proto__,"renderer")&&"1"!=t.reflect.getClassTag(a.__proto__,"effectbatcher")||(null==this.renderer?(this.renderer=a,this.transform.markHaveRendererComp()):(o=!1,console.warn("已经有一个渲染器的组件了，不能俩"))),"1"==t.reflect.getClassTag(a.__proto__,"camera")&&(null==this.camera?this.camera=a:(o=!1,console.warn("已经有一个摄像机的组件了，不能俩"))),"1"==t.reflect.getClassTag(a.__proto__,"light")&&(null==this.light?(this.light=a,console.warn("add light:"+this.transform.name)):(o=!1,console.warn("已经有一个灯光的组件了，不能俩"))),"1"!=t.reflect.getClassTag(a.__proto__,"boxcollider")&&"1"!=t.reflect.getClassTag(a.__proto__,"meshcollider")&&"1"!=t.reflect.getClassTag(a.__proto__,"canvasRenderer")||(null==this.collider?this.collider=a:(o=!1,console.warn("已经有一个碰撞盒的组件了，不能俩"))),o&&(this.components.push(i),this.componentsInit.push(i),"1"==t.reflect.getClassTag(a.__proto__,"camera")&&e.sceneMgr.app.markNotify(this.transform,e.NotifyType.AddCamera),"1"==t.reflect.getClassTag(a.__proto__,"canvasRenderer")&&e.sceneMgr.app.markNotify(this.transform,e.NotifyType.AddCanvasRender)),a},gameObject.prototype.getComponent=function(e){for(var a=0;a<this.components.length;a++)if(t.reflect.getClassName(this.components[a].comp.__proto__)==e)return this.components[a].comp;return null},gameObject.prototype.getComponents=function(){for(var t=[],e=0;e<this.components.length;e++)t.push(this.components[e].comp);return t},gameObject.prototype.getComponentsInChildren=function(t){var e=[];return this._getComponentsInChildren(t,this,e),e},gameObject.prototype._getComponentsInChildren=function(e,a,r){for(var i=0;i<a.components.length;i++)t.reflect.getClassName(a.components[i].comp.__proto__)==e&&r.push(a.components[i].comp);for(var o=0;void 0!=a.transform.children&&o<a.transform.children.length;o++){var n=a.transform.children[o].gameObject;this._getComponentsInChildren(e,n,r)}},gameObject.prototype.getComponentInParent=function(t){for(var e=null,a=this.transform.parent;null==e&&null!=a;)e=a.gameObject.getComponent(t),a=a.parent;return e},gameObject.prototype.addComponent=function(e){for(var a in this.components)if(this.components[a].comp.constructor.name==e)throw new Error("已经有一个"+e+"的组件了，不能俩");var r=t.reflect.getPrototype(e),i=t.reflect.createInstance(r,{nodecomp:"1"});return this.addComponentDirect(i)},gameObject.prototype.removeComponent=function(t){for(var e=0;e<this.components.length;e++)if(this.components[e].comp==t){this.components[e].init&&this.components[e].comp.remove(),this.remove(this.components[e].comp),this.components.splice(e,1);break}},gameObject.prototype.remove=function(e){"1"==t.reflect.getClassTag(e.__proto__,"renderer")&&(this.renderer=null),"1"==t.reflect.getClassTag(e.__proto__,"camera")&&(this.camera=null),"1"==t.reflect.getClassTag(e.__proto__,"light")&&(this.light=null),"1"!=t.reflect.getClassTag(e.__proto__,"boxcollider")&&"1"!=t.reflect.getClassTag(e.__proto__,"meshcollider")&&"1"!=t.reflect.getClassTag(e.__proto__,"canvasRenderer")||(this.collider=null)},gameObject.prototype.removeComponentByTypeName=function(e){for(var a=0;a<this.components.length;a++)if(t.reflect.getClassName(this.components[a].comp)==e){this.components[a].init&&this.components[a].comp.remove(),this.remove(this.components[a].comp),this.components.splice(a,1);break}},gameObject.prototype.removeAllComponents=function(){for(var t=0;t<this.components.length;t++)this.components[t].comp.remove(),this.remove(this.components[t].comp);this.components.length=0},gameObject.prototype.dispose=function(){this.removeAllComponents()},__decorate([t.reflect.Field("number"),t.reflect.UIStyle("enum"),__metadata("design:type",Number)],gameObject.prototype,"layer",void 0),__decorate([t.reflect.Field("string"),__metadata("design:type",String)],gameObject.prototype,"tag",void 0),__decorate([t.reflect.Field("number"),__metadata("design:type",Number)],gameObject.prototype,"hideFlags",void 0),__decorate([t.reflect.Field("boolean"),__metadata("design:type",Boolean)],gameObject.prototype,"isStatic",void 0),__decorate([t.reflect.Field("nodeComponent[]"),__metadata("design:type",Array)],gameObject.prototype,"components",void 0),__decorate([t.reflect.Field("boolean"),__metadata("design:type",Object)],gameObject.prototype,"_visible",void 0),gameObject=__decorate([t.reflect.SerializeType],gameObject)}();e.gameObject=i}(t.framework||(t.framework={}))}(gd3d||(gd3d={}));var gd3d;!function(t){!function(e){var a=function(){function renderContext(e){this.viewPortPixel=new t.math.rect(0,0,0,0),this.eyePos=new t.math.vector4,this.matrixView=new t.math.matrix,this.matrixProject=new t.math.matrix,this.matrixModel=new t.math.matrix,this._matrixWorld2Object=new t.math.matrix,this.matrixModelViewProject=new t.math.matrix,this.matrixModelView=new t.math.matrix,this.matrixViewProject=new t.math.matrix,this.floatTimer=0,this.intLightCount=0,this.vec4LightPos=new Float32Array(32),this.vec4LightDir=new Float32Array(32),this.vec4LightColor=new Float32Array(32),this.floatLightRange=new Float32Array(8),this.floatLightIntensity=new Float32Array(8),this.floatLightSpotAngleCos=new Float32Array(8),this._intLightCount=0,this._lightCullingMask=[],this._vec4LightPos=new Float32Array(32),this._vec4LightDir=new Float32Array(32),this._vec4LightColor=new Float32Array(32),this._floatLightRange=new Float32Array(8),this._floatLightIntensity=new Float32Array(8),this._floatLightSpotAngleCos=new Float32Array(8),this.lightmap=null,this.lightmapUV=1,this.lightmapOffset=new t.math.vector4(1,1,0,0),this.webgl=e}return Object.defineProperty(renderContext.prototype,"matrixWorld2Object",{get:function(){return t.math.matrixInverse(this.matrixModel,this._matrixWorld2Object),this._matrixWorld2Object},enumerable:!0,configurable:!0}),renderContext.prototype.updateCamera=function(e,a){a.calcViewPortPixel(e,this.viewPortPixel);var r=this.viewPortPixel.w/this.viewPortPixel.h;a.calcViewMatrix(this.matrixView),a.calcProjectMatrix(r,this.matrixProject),t.math.matrixMultiply(this.matrixProject,this.matrixView,this.matrixViewProject),this.floatTimer=e.getTotalTime();var i=a.gameObject.transform.getWorldTranslate();this.eyePos.x=i.x,this.eyePos.y=i.y,this.eyePos.z=i.z},renderContext.prototype.updateLights=function(a){this._intLightCount=a.length,this._lightCullingMask.length=0;for(var r=t.math.pool.new_vector3(),i=0;i<a.length;i++){this._lightCullingMask.push(a[i].cullingMask);var o=a[i].gameObject.transform.getWorldTranslate();this._vec4LightPos[4*i+0]=o.x,this._vec4LightPos[4*i+1]=o.y,this._vec4LightPos[4*i+2]=o.z,this._vec4LightPos[4*i+3]=a[i].type==e.LightTypeEnum.Direction?0:1,a[i].gameObject.transform.getForwardInWorld(r),this._vec4LightDir[4*i+0]=r.x,this._vec4LightDir[4*i+1]=r.y,this._vec4LightDir[4*i+2]=r.z,this._vec4LightDir[4*i+3]=a[i].type==e.LightTypeEnum.Point?0:1,this._floatLightSpotAngleCos[i]=a[i].spotAngelCos,this._vec4LightColor[4*i+0]=a[i].color.r,this._vec4LightColor[4*i+1]=a[i].color.g,this._vec4LightColor[4*i+2]=a[i].color.b,this._vec4LightColor[4*i+3]=a[i].color.a,this._floatLightRange[i]=a[i].range,this._floatLightIntensity[i]=a[i].intensity}t.math.pool.delete_vector3(r)},renderContext.prototype.updateOverlay=function(){t.math.matrixMakeIdentity(this.matrixModelViewProject)},renderContext.prototype.updateModel=function(e){t.math.matrixClone(e.getWorldMatrix(),this.matrixModel),t.math.matrixMultiply(this.matrixViewProject,this.matrixModel,this.matrixModelViewProject)},renderContext.prototype.updateModeTrail=function(){t.math.matrixClone(this.matrixView,this.matrixModelView),t.math.matrixClone(this.matrixViewProject,this.matrixModelViewProject)},renderContext.prototype.updateLightMask=function(t){if(this.intLightCount=0,0!=this._intLightCount){for(var e=1<<t,a=[],r=0;r<this._lightCullingMask.length;r++)this._lightCullingMask[r]&e&&a.push(r);this.intLightCount=a.length;for(r=0;r<a.length;r++){var i=a[r];this.floatLightSpotAngleCos[r]=this._floatLightSpotAngleCos[i],this.floatLightRange[r]=this._floatLightRange[i],this.floatLightIntensity[r]=this._floatLightIntensity[i],this.vec4LightPos[4*r+0]=this._vec4LightPos[4*i+0],this.vec4LightPos[4*r+1]=this._vec4LightPos[4*i+1],this.vec4LightPos[4*r+2]=this._vec4LightPos[4*i+2],this.vec4LightPos[4*r+3]=this._vec4LightPos[4*i+3],this.vec4LightDir[4*r+0]=this._vec4LightDir[4*i+0],this.vec4LightDir[4*r+1]=this._vec4LightDir[4*i+1],this.vec4LightDir[4*r+2]=this._vec4LightDir[4*i+2],this.vec4LightDir[4*r+3]=this._vec4LightDir[4*i+3],this.vec4LightColor[4*r+0]=this._vec4LightColor[4*i+0],this.vec4LightColor[4*r+1]=this._vec4LightColor[4*i+1],this.vec4LightColor[4*r+2]=this._vec4LightColor[4*i+2],this.vec4LightColor[4*r+3]=this._vec4LightColor[4*i+3]}}},renderContext}();e.renderContext=a;var r;!function(t){t[t.Common=0]="Common",t[t.Transparent=1]="Transparent",t[t.Overlay=2]="Overlay"}(r=e.RenderLayerEnum||(e.RenderLayerEnum={}));var i=function(){function renderList(){this.renderLayers=[];var t=new o(!0),e=new o(!0),a=new o(!0);this.renderLayers.push(t),this.renderLayers.push(e),this.renderLayers.push(a)}return renderList.prototype.clear=function(){for(var t=0;t<this.renderLayers.length;t++)this.renderLayers[t].list.length=0},renderList.prototype.addRenderer=function(t){t.layer==r.Common?this.renderLayers[0].list.push(t):t.layer==r.Transparent?this.renderLayers[1].list.push(t):t.layer==r.Overlay&&this.renderLayers[2].list.push(t)},renderList}();e.renderList=i;var o=function(){return function renderLayer(t){void 0===t&&(t=!1),this.needSort=!1,this.list=[],this.needSort=t}}();e.renderLayer=o}(t.framework||(t.framework={}))}(gd3d||(gd3d={}));var gd3d;!function(t){!function(e){var a=function(){function scene(t){this.renderCameras=[],this._mainCamera=null,this.renderContext=[],this.renderLights=[],this.lightmaps=[],this.RealCameraNumber=0,this.hasPlayed=!1,this.playDirty=!1,this.app=t,this.webgl=t.webgl,this.assetmgr=t.getAssetMgr(),this.rootNode=new e.transform,this.rootNode.scene=this,this.renderList=new e.renderList}return scene.prototype.addScreenSpaceOverlay=function(t){t&&(this._overlay2d||(this._overlay2d=[]),-1==this._overlay2d.indexOf(t)&&(this._overlay2d.push(t),this.sortOverLays(this._overlay2d)))},scene.prototype.removeScreenSpaceOverlay=function(t){if(t&&this._overlay2d){var e=this._overlay2d.indexOf(t);-1!=e&&this._overlay2d.splice(e,1),this.sortOverLays(this._overlay2d)}},Object.defineProperty(scene.prototype,"mainCamera",{get:function(){return null==this._mainCamera&&(this._mainCamera=this.renderCameras[0]),this._mainCamera},set:function(t){for(var e in this.renderCameras)this.renderCameras[e]==t&&(this._mainCamera=t)},enumerable:!0,configurable:!0}),scene.prototype.update=function(a){this.rootNode.updateTran(!1),this.rootNode.updateAABBChild(),this.renderCameras.length=0,this.renderLights.length=0,this.renderList.clear(),e.aniplayer.playerCaches=[],this.updateScene(this.rootNode,a),this.renderCameras.length>1&&this.renderCameras.sort(function(t,e){return t.order-e.order}),this.RealCameraNumber=0;for(var r=0;r<this.renderCameras.length;r++)t.render.glDrawPass.resetLastState(),this._renderCamera(r);this.updateSceneOverLay(a),0==this.RealCameraNumber&&(this.webgl.clearColor(0,0,0,1),this.webgl.clearDepth(1),this.webgl.clear(this.webgl.COLOR_BUFFER_BIT|this.webgl.DEPTH_BUFFER_BIT)),this.webgl.flush(),e.DrawCallInfo.BeActived&&(e.DrawCallInfo.inc.showPerFrame(),e.DrawCallInfo.inc.reset())},scene.prototype.updateSceneOverLay=function(t){var e=this;if(this._overlay2d&&!(this._overlay2d.length<1)){var a=this.mainCamera;if(this._overlay2d&&a){var r=this.renderCameras.indexOf(a);if(-1==r){for(var i=a.gameObject.getName(),o=!1,n=0;n<this.renderCameras.length;n++){var s=this.renderCameras[n];if(s&&s.gameObject.getName()==i){a=this.mainCamera=s,o=!0;break}}o||(this._mainCamera=null,a=this.mainCamera)}r=this.renderCameras.indexOf(a),a&&this._overlay2d&&this._overlay2d.forEach(function(i){i&&(i.start(a),i.update(t),i.render(e.renderContext[r],e.assetmgr,a))})}}},scene.prototype._renderCamera=function(t){var a=this.renderCameras[t],r=this.renderContext[t];if(this.app.bePlay&&a.gameObject.transform.name.toLowerCase().indexOf("editor")<0){r.updateCamera(this.app,a),r.updateLights(this.renderLights),a.fillRenderer(this),a.renderScene(this,r),this.RealCameraNumber++;for(var i=a.getOverLays(),o=0;o<i.length;o++)a.CullingMask&e.CullingMask.ui&&i[o].render(r,this.assetmgr,a)}else if(!this.app.bePlay&&a.gameObject.transform.name.toLowerCase().indexOf("editor")>=0&&(r.updateCamera(this.app,a),r.updateLights(this.renderLights),a.fillRenderer(this),a.renderScene(this,r),this.RealCameraNumber++,this.app.be2dstate))for(var i=a.getOverLays(),o=0;o<i.length;o++)a.CullingMask&e.CullingMask.ui&&i[o].render(r,this.assetmgr,a);if(!this.app.bePlay&&this.app.be2dstate&&t==this.app.curcameraindex)for(var i=a.getOverLays(),o=0;o<i.length;o++)a.CullingMask&e.CullingMask.ui&&i[o].render(r,this.assetmgr,a)},scene.prototype.sortOverLays=function(t){!t||t.length<1||t.sort(function(t,e){return t.sortOrder-e.sortOrder})},scene.prototype.updateScene=function(t,e){this.app.bePlay?(this.hasPlayed||(this.playDirty=!0),this.objupdate(t,e),this.playDirty=!1,this.hasPlayed=!0):this.objupdateInEditor(t,e)},scene.prototype.objupdateInEditor=function(t,e){if(t.gameObject.init(),null!=t.gameObject.renderer&&t.gameObject.renderer.update(e),null!=t.gameObject.camera&&t.gameObject.camera.update(e),this.collectCameraAndLight(t),null!=t.children)for(var a=0;a<t.children.length;a++)this.objupdateInEditor(t.children[a],e)},scene.prototype.objupdate=function(t,e){if((0!=t.hasComponent||0!=t.hasComponentChild)&&(t.gameObject.init(this.playDirty),t.gameObject.components.length>0&&(t.gameObject.update(e),this.collectCameraAndLight(t)),t.children))for(var a=0,r=t.children;a<r.length;a++){var i=r[a];this.objupdate(i,e)}},scene.prototype.collectCameraAndLight=function(t){var a=t.gameObject.camera;for(null!=a&&a.gameObject.visibleInScene&&this.renderCameras.push(a);this.renderContext.length<this.renderCameras.length;)this.renderContext.push(new e.renderContext(this.webgl));var r=t.gameObject.light;null!=r&&t.gameObject.visible&&this.renderLights.push(r)},scene.prototype.addChild=function(t){this.rootNode.addChild(t)},scene.prototype.removeChild=function(t){this.rootNode.removeChild(t)},scene.prototype.getChildren=function(){return this.rootNode.children},scene.prototype.getChildCount=function(){return null==this.rootNode.children?0:this.rootNode.children.length},scene.prototype.getChild=function(t){return this.rootNode.children[t]},scene.prototype.getChildByName=function(t){return this.rootNode.find(t)},scene.prototype.getRoot=function(){return this.rootNode},scene.prototype.pickAll=function(t,e,a,r,i){return void 0===a&&(a=!1),void 0===r&&(r=this.getRoot()),void 0===i&&(i=NaN),!(!e||!t)&&this.doPick(t,!0,a,r,e,i)},scene.prototype.pick=function(t,e,a,r,i){return void 0===a&&(a=!1),void 0===r&&(r=this.getRoot()),void 0===i&&(i=NaN),!(!e||!t)&&this.doPick(t,!1,a,r,e,i)},scene.prototype.doPick=function(e,a,r,i,o,n){void 0===n&&(n=NaN);var s=!1,l=new Array;if(s=r?this.pickMesh(e,i,l,n):this.pickCollider(e,i,l,n),0==l.length)return s;if(a)o.length=0,l.forEach(function(t){o.push(t)});else{for(var h=0,c=1;c<l.length;c++)l[c].distance<l[h].distance&&(h=c);var u=l.splice(h,1);o.cloneFrom(u[0]),l.forEach(function(e){t.math.pool.delete_pickInfo(e)}),l.length=0}return s},scene.prototype.pickMesh=function(e,a,r,i){void 0===i&&(i=NaN);var o=!1;if(null!=a.gameObject){if(!a.gameObject.visible)return o;var n=!0;if(isNaN(i)||0!=(i&1<<a.gameObject.layer)||(n=!1),n){var s=a.gameObject.getComponent("meshFilter");if(null!=s){var l=s.getMeshOutput();if(l){c=t.math.pool.new_pickInfo();l.intersects(e,a.getWorldMatrix(),c)&&(o=!0,r.push(c),c.pickedtran=a)}}else{var h=a.gameObject.getComponent("skinnedMeshRenderer");if(null!=h){var c=t.math.pool.new_pickInfo();h.intersects(e,c)&&(o=!0,r.push(c),c.pickedtran=a)}}}}if(null!=a.children)for(var u=0;u<a.children.length;u++){var d=this.pickMesh(e,a.children[u],r,i);o||(o=d)}return o},scene.prototype.pickCollider=function(e,a,r,i){void 0===i&&(i=NaN);var o=!1;if(null!=a.gameObject){if(!a.gameObject.visible)return o;if(null!=a.gameObject.collider){var n=!0;if(isNaN(i)||0!=(i&1<<a.gameObject.layer)||(n=!1),n){var s=t.math.pool.new_pickInfo();e.intersectCollider(a,s)&&(o=!0,r.push(s),s.pickedtran=a)}}}if(null!=a.children)for(var l=0;l<a.children.length;l++){var h=this.pickCollider(e,a.children[l],r,i);o||(o=h)}return o},scene}();e.scene=a}(t.framework||(t.framework={}))}(gd3d||(gd3d={}));var gd3d;!function(t){!function(t){var e=function(){function uniformSetter(){}return uniformSetter.initAutouniform=function(){this.autoUniformDic.glstate_matrix_model=function(t){return t.matrixModel},this.autoUniformDic.glstate_matrix_world2object=function(t){return t.matrixWorld2Object},this.autoUniformDic.glstate_matrix_view=function(t){return t.matrixView},this.autoUniformDic.glstate_matrix_project=function(t){return t.matrixProject},this.autoUniformDic.glstate_matrix_modelview=function(t){return t.matrixModelView},this.autoUniformDic.glstate_matrix_viewproject=function(t){return t.matrixViewProject},this.autoUniformDic.glstate_matrix_mvp=function(t){return t.matrixModelViewProject},this.autoUniformDic.glstate_timer=function(t){return t.floatTimer},this.autoUniformDic.glstate_lightcount=function(t){return t.intLightCount},this.autoUniformDic.glstate_vec4_lightposs=function(t){return t.vec4LightPos},this.autoUniformDic.glstate_vec4_lightdirs=function(t){return t.vec4LightDir},this.autoUniformDic.glstate_vec4_lightcolors=function(t){return t.vec4LightColor},this.autoUniformDic.glstate_float_lightrange=function(t){return t.floatLightRange},this.autoUniformDic.glstate_float_lightintensity=function(t){return t.floatLightIntensity},this.autoUniformDic.glstate_float_spotangelcoss=function(t){return t.floatLightSpotAngleCos},this.autoUniformDic.glstate_eyepos=function(t){return t.eyePos},this.autoUniformDic._LightmapTex=function(t){return t.lightmap},this.autoUniformDic.glstate_lightmapOffset=function(t){return t.lightmapOffset},this.autoUniformDic.glstate_fog_start=function(t){return t.fog._Start},this.autoUniformDic.glstate_fog_end=function(t){return t.fog._End},this.autoUniformDic.glstate_fog_color=function(t){return t.fog._Color},this.autoUniformDic.glstate_vec4_bones=function(t){return t.vec4_bones},this.autoUniformDic.glstate_matrix_bones=function(t){return t.matrix_bones}},uniformSetter.autoUniformDic={},uniformSetter}();t.uniformSetter=e}(t.framework||(t.framework={}))}(gd3d||(gd3d={}));var gd3d;!function(t){!function(t){var e=function(){return function taskstate(){this.finish=!1,this.error=!1,this.message=null,this.cancel=!1,this.taskCall=null,this.taskInterface=null}}();t.taskstate=e;var a=function(){function taskMgr(){this.tasks=[],this.laststate=null}return taskMgr.prototype.addTaskCall=function(t){var a=new e;a.taskCall=t,this.tasks.push(a)},taskMgr.prototype.addTask=function(t){var a=new e;a.taskInterface=t,this.tasks.push(a)},taskMgr.prototype.move=function(t){if(!(null!=this.laststate&&this.laststate.cancel||null!=this.laststate&&0==this.laststate.finish)){var a=this.tasks.shift();if(null!=a){var r=new e,i=this.laststate;this.laststate=r,null==a.taskInterface?a.taskCall(i,r):a.taskInterface.move(t,i,r)}}},taskMgr.prototype.cancel=function(){null!=this.laststate&&(this.laststate.cancel=!0)},taskMgr}();t.taskMgr=a}(t.framework||(t.framework={}))}(gd3d||(gd3d={}));var gd3d;!function(t){!function(t){var e=function(){function gdPromise(t){var e=this;setTimeout(function(){t(e.resolve.bind(e),e.reject.bind(e))},0)}return gdPromise.prototype.resolve=function(t){try{this.thenCall&&this.thenCall(t)}catch(t){this.reject(t)}},gdPromise.prototype.reject=function(t){if(console.error(t),this.catchMethod)return this.catchMethod(t)},gdPromise.prototype.then=function(t){return this.thenCall=t,this},gdPromise.prototype.catch=function(t){this.catchMethod=t},gdPromise}();t.gdPromise=e}(t.threading||(t.threading={}))}(gd3d||(gd3d={}));var gd3d;!function(t){!function(t){var e=function(){function thread(){var t=this;this.callID=0,this.callMap={},thread.workerInstance?this.worker=thread.workerInstance:(this.worker=new Worker("lib/gd3d.thread.js"),this.worker.onmessage=function(e){t.OnMessage(e)},this.worker.onerror=function(t){console.error(t)})}return Object.defineProperty(thread,"Instance",{get:function(){return thread.instance||(thread.instance=new thread),thread.instance},enumerable:!0,configurable:!0}),thread.prototype.OnMessage=function(t){t.data&&this.callMap[t.data.id]&&this.callMap[t.data.id].callback(t.data.result)},thread.prototype.Call=function(t,e,a){this.worker.postMessage({handle:t,data:e,id:++this.callID}),this.callMap[this.callID]={callback:a}},thread}();t.thread=e}(t.threading||(t.threading={}))}(gd3d||(gd3d={}));var gd3d;!function(t){!function(e){var a=function(){function aabb(e,a){this.opmin=new t.math.vector3,this.opmax=new t.math.vector3,this._center=new t.math.vector3,this.srcmin=t.math.pool.clone_vector3(e),this.srcmax=t.math.pool.clone_vector3(a),this.minimum=t.math.pool.clone_vector3(e),this.maximum=t.math.pool.clone_vector3(a)}return aabb.prototype.update=function(e){t.math.matrixGetTranslation(e,this.opmin),t.math.matrixGetTranslation(e,this.opmax),e.rawData[0]>0?(this.opmin.x+=e.rawData[0]*this.srcmin.x,this.opmax.x+=e.rawData[0]*this.srcmax.x):(this.opmin.x+=e.rawData[0]*this.srcmax.x,this.opmax.x+=e.rawData[0]*this.srcmin.x),e.rawData[1]>0?(this.opmin.y+=e.rawData[1]*this.srcmin.y,this.opmax.y+=e.rawData[1]*this.srcmax.y):(this.opmin.y+=e.rawData[1]*this.srcmax.y,this.opmax.y+=e.rawData[1]*this.srcmin.y),e.rawData[2]>0?(this.opmin.z+=e.rawData[2]*this.srcmin.z,this.opmax.z+=e.rawData[2]*this.srcmax.z):(this.opmin.z+=e.rawData[2]*this.srcmax.z,this.opmax.z+=e.rawData[2]*this.srcmin.z),e.rawData[4]>0?(this.opmin.x+=e.rawData[4]*this.srcmin.x,this.opmax.x+=e.rawData[4]*this.srcmax.x):(this.opmin.x+=e.rawData[4]*this.srcmax.x,this.opmax.x+=e.rawData[4]*this.srcmin.x),e.rawData[5]>0?(this.opmin.y+=e.rawData[5]*this.srcmin.y,this.opmax.y+=e.rawData[5]*this.srcmax.y):(this.opmin.y+=e.rawData[5]*this.srcmax.y,this.opmax.y+=e.rawData[5]*this.srcmin.y),e.rawData[6]>0?(this.opmin.z+=e.rawData[6]*this.srcmin.z,this.opmax.z+=e.rawData[6]*this.srcmax.z):(this.opmin.z+=e.rawData[6]*this.srcmax.z,this.opmax.z+=e.rawData[6]*this.srcmin.z),e.rawData[8]>0?(this.opmin.x+=e.rawData[8]*this.srcmin.x,this.opmax.x+=e.rawData[8]*this.srcmax.x):(this.opmin.x+=e.rawData[8]*this.srcmax.x,this.opmax.x+=e.rawData[8]*this.srcmin.x),e.rawData[9]>0?(this.opmin.y+=e.rawData[9]*this.srcmin.y,this.opmax.y+=e.rawData[9]*this.srcmax.y):(this.opmin.y+=e.rawData[9]*this.srcmax.y,this.opmax.y+=e.rawData[9]*this.srcmin.y),e.rawData[10]>0?(this.opmin.z+=e.rawData[10]*this.srcmin.z,this.opmax.z+=e.rawData[10]*this.srcmax.z):(this.opmin.z+=e.rawData[10]*this.srcmax.z,this.opmax.z+=e.rawData[10]*this.srcmin.z),this.minimum=t.math.pool.clone_vector3(this.opmin),this.maximum=t.math.pool.clone_vector3(this.opmax)},aabb.prototype.addVector3=function(e){t.math.vec3Max(this.maximum,e,this.maximum),t.math.vec3Max(this.minimum,e,this.minimum)},aabb.prototype.containsVector3=function(t){return t.x>this.minimum.x&&t.x<this.maximum.x&&t.y>this.minimum.y&&t.x<this.maximum.y&&t.z>this.minimum.z&&t.z<this.maximum.z},aabb.prototype.intersectAABB=function(t){return!(this.minimum.x>t.maximum.x)&&(!(this.maximum.x<t.minimum.x)&&(!(this.minimum.x>t.maximum.x)&&(!(this.maximum.x<t.minimum.x)&&(!(this.minimum.x>t.maximum.x)&&!(this.maximum.x<t.minimum.x)))))},aabb.prototype.addAABB=function(e){null!=e&&(t.math.vec3Max(this.maximum,e.maximum,this.maximum),t.math.vec3Min(this.minimum,e.minimum,this.minimum))},Object.defineProperty(aabb.prototype,"center",{get:function(){return t.math.vec3Add(this.maximum,this.minimum,this._center),t.math.vec3ScaleByNum(this._center,.5,this._center),this._center},enumerable:!0,configurable:!0}),aabb.prototype.clear=function(){t.math.vec3SetByFloat(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,this.minimum),t.math.vec3SetByFloat(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE,this.maximum)},aabb.prototype.clone=function(){var e=t.math.pool.clone_vector3(this.minimum),a=t.math.pool.clone_vector3(this.maximum);return new t.framework.aabb(e,a)},aabb.prototype.cloneTo=function(e){t.math.vec3Clone(this.minimum,e.minimum),t.math.vec3Clone(this.minimum,e.srcmin),t.math.vec3Clone(this.maximum,e.maximum),t.math.vec3Clone(this.maximum,e.srcmax)},aabb.prototype.getVec3=function(e){e[0]=t.math.pool.clone_vector3(this.minimum),e[1]=t.math.pool.clone_vector3(this.minimum),e[1].z=this.maximum.z,e[2]=t.math.pool.clone_vector3(this.minimum),e[2].x=this.maximum.x,e[3]=t.math.pool.clone_vector3(this.maximum),e[3].y=this.minimum.y,e[4]=t.math.pool.clone_vector3(this.minimum),e[4].y=this.maximum.y,e[5]=t.math.pool.clone_vector3(this.maximum),e[5].x=this.minimum.x,e[6]=t.math.pool.clone_vector3(this.maximum),e[6].z=this.minimum.z,e[7]=t.math.pool.clone_vector3(this.maximum)},aabb}();e.aabb=a}(t.framework||(t.framework={}))}(gd3d||(gd3d={}));var gd3d;!function(t){!function(e){var a=function(){function obb(){this.vectors=new Array}return obb.prototype.buildByMaxMin=function(e,a){this.vectors[0]=t.math.pool.clone_vector3(e),this.vectors[1]=t.math.pool.clone_vector3(e),this.vectors[1].z=a.z,this.vectors[2]=t.math.pool.clone_vector3(e),this.vectors[2].x=a.x,this.vectors[3]=t.math.pool.clone_vector3(a),this.vectors[3].y=e.y,this.vectors[4]=t.math.pool.clone_vector3(e),this.vectors[4].y=a.y,this.vectors[5]=t.math.pool.clone_vector3(a),this.vectors[5].x=e.x,this.vectors[6]=t.math.pool.clone_vector3(a),this.vectors[6].z=e.z,this.vectors[7]=t.math.pool.clone_vector3(a),this.center=new t.math.vector3,t.math.vec3Add(a,e,this.center),t.math.vec3ScaleByNum(this.center,.5,this.center),this.halfsize=new t.math.vector3,t.math.vec3Subtract(a,e,this.halfsize),t.math.vec3ScaleByNum(this.halfsize,.5,this.halfsize),this.directions=[new t.math.vector3,new t.math.vector3,new t.math.vector3]},obb.prototype.buildByCenterSize=function(e,a){this.center=t.math.pool.clone_vector3(e),this.halfsize=t.math.pool.clone_vector3(a),t.math.vec3ScaleByNum(this.halfsize,.5,this.halfsize);var r=this.halfsize.x,i=this.halfsize.y,o=this.halfsize.z,n=this.center.x,s=this.center.y,l=this.center.z;this.vectors[0]=new t.math.vector3(n-r,s-i,l-o),this.vectors[1]=new t.math.vector3(n-r,s-i,l+o),this.vectors[2]=new t.math.vector3(n+r,s-i,l-o),this.vectors[3]=new t.math.vector3(n+r,s-i,l+o),this.vectors[4]=new t.math.vector3(n-r,s+i,l-o),this.vectors[5]=new t.math.vector3(n-r,s+i,l+o),this.vectors[6]=new t.math.vector3(n+r,s+i,l-o),this.vectors[7]=new t.math.vector3(n+r,s+i,l+o),this.directions=[new t.math.vector3,new t.math.vector3,new t.math.vector3]},obb.prototype.update=function(e){t.math.matrixGetTranslation(e,this.center),t.math.matrixGetVector3ByOffset(e,0,this.directions[0]),t.math.matrixGetVector3ByOffset(e,4,this.directions[1]),t.math.matrixGetVector3ByOffset(e,8,this.directions[2])},obb.prototype.caclWorldVecs=function(e,a){for(var r=0;r<this.vectors.length;r++)e[r]=new t.math.vector3,t.math.matrixTransformVector3(this.vectors[r],a,e[r])},obb.prototype.intersects=function(e){if(null==e)return!1;var a=this,r=e;if(!this.axisOverlap(a.directions[0],a,r))return!1;if(!this.axisOverlap(a.directions[1],a,r))return!1;if(!this.axisOverlap(a.directions[2],a,r))return!1;if(!this.axisOverlap(r.directions[0],a,r))return!1;if(!this.axisOverlap(r.directions[1],a,r))return!1;if(!this.axisOverlap(r.directions[2],a,r))return!1;var i=t.math.pool.new_vector3();return t.math.vec3Cross(a.directions[0],r.directions[0],i),!!this.axisOverlap(i,a,r)&&(t.math.vec3Cross(a.directions[0],r.directions[1],i),!!this.axisOverlap(i,a,r)&&(t.math.vec3Cross(a.directions[0],r.directions[2],i),!!this.axisOverlap(i,a,r)&&(t.math.vec3Cross(a.directions[1],r.directions[0],i),!!this.axisOverlap(i,a,r)&&(t.math.vec3Cross(a.directions[1],r.directions[1],i),!!this.axisOverlap(i,a,r)&&(t.math.vec3Cross(a.directions[1],r.directions[2],i),!!this.axisOverlap(i,a,r)&&(t.math.vec3Cross(a.directions[2],r.directions[0],i),!!this.axisOverlap(i,a,r)&&(t.math.vec3Cross(a.directions[2],r.directions[1],i),!!this.axisOverlap(i,a,r)&&(t.math.vec3Cross(a.directions[2],r.directions[2],i),!!this.axisOverlap(i,a,r)))))))))},obb.prototype.computeBoxExtents=function(e,a){var r=t.math.vec3Dot(a.center,e),i=Math.abs(t.math.vec3Dot(a.directions[0],e))*a.halfsize.x+Math.abs(t.math.vec3Dot(a.directions[1],e))*a.halfsize.y+Math.abs(t.math.vec3Dot(a.directions[2],e))*a.halfsize.z,o=t.math.pool.new_vector3();return o.x=r-i,o.y=r+i,o},obb.prototype.axisOverlap=function(t,e,a){var r=this.computeBoxExtents(t,e),i=this.computeBoxExtents(t,a);return this.extentsOverlap(r.x,r.y,i.x,i.y)},obb.prototype.extentsOverlap=function(t,e,a,r){return!(t>r||a>e)},obb.prototype.clone=function(){var e=new obb;e.center=t.math.pool.clone_vector3(this.center),e.halfsize=this.halfsize;for(var a in this.directions)e.directions[a]=t.math.pool.clone_vector3(this.directions[a]);return e},obb.prototype.dispose=function(){this.vectors.length=0,this.directions.length=0},obb}();e.obb=a}(t.framework||(t.framework={}))}(gd3d||(gd3d={}));var gd3d;!function(t){!function(e){var a=function(){function obb2d(){}return Object.defineProperty(obb2d.prototype,"size",{get:function(){return this._size},set:function(e){e&&this._size&&(t.math.vec2Clone(e,this._size),this.halfWidth=this._size.x/2,this.halfHeight=this._size.y/2)},enumerable:!0,configurable:!0}),obb2d.prototype.buildByCenterSize=function(e,a,r){this.center=t.math.pool.clone_vector2(e),this.offset=t.math.pool.new_vector2(),this.scale=t.math.pool.new_vector2(),this.rotate=new t.math.angelref,this._size=new t.math.vector2(a,r),this.halfWidth=a/2,this.halfHeight=r/2,this.directions=[new t.math.vector2,new t.math.vector2]},obb2d.prototype.update=function(e){t.math.matrix3x2Decompose(e,this.scale,this.rotate,this.center);var a=t.math.pool.new_vector2(),r=t.math.pool.new_matrix3x2();t.math.matrix3x2Clone(e,r),r.rawData[4]=r.rawData[5]=0,t.math.matrix3x2TransformVector2(r,this.offset,a),t.math.vec2Add(this.center,a,this.center),this.directions[0].x=e.rawData[0],this.directions[0].y=e.rawData[1],this.directions[1].x=e.rawData[2],this.directions[1].y=e.rawData[3],t.math.pool.delete_vector2(a),t.math.pool.delete_matrix3x2(r)},obb2d.prototype.intersects=function(t){if(null==t)return!1;var e=this,a=t;return!!this.axisOverlap(e.directions[0],e,a)&&(!!this.axisOverlap(e.directions[1],e,a)&&(!!this.axisOverlap(a.directions[0],e,a)&&!!this.axisOverlap(a.directions[1],e,a)))},obb2d.prototype.computeBoxExtents=function(e,a){var r=t.math.vec2Dot(a.center,e),i=Math.abs(t.math.vec2Dot(a.directions[0],e))*a.halfWidth+Math.abs(t.math.vec2Dot(a.directions[1],e))*a.halfHeight,o=t.math.pool.new_vector2();return o.x=r-i,o.y=r+i,o},obb2d.prototype.axisOverlap=function(t,e,a){var r=this.computeBoxExtents(t,e),i=this.computeBoxExtents(t,a);return this.extentsOverlap(r.x,r.y,i.x,i.y)},obb2d.prototype.extentsOverlap=function(t,e,a,r){return!(t>r||a>e)},obb2d.prototype.clone=function(){var e=new obb2d;e.center=t.math.pool.clone_vector2(this.center),e._size=t.math.pool.clone_vector2(this._size),e.halfWidth=this.halfWidth,e.halfHeight=this.halfHeight,e.scale=t.math.pool.clone_vector2(this.scale),e.rotate=new t.math.angelref,e.rotate.v=this.rotate.v;for(var a in this.directions)e.directions[a]=t.math.pool.clone_vector2(this.directions[a]);return e},obb2d.prototype.dispose=function(){this.center&&t.math.pool.delete_vector2(this.center),this._size&&t.math.pool.delete_vector2(this._size),this.scale&&t.math.pool.delete_vector2(this.scale),this.directions&&(this.directions.forEach(function(e){e&&t.math.pool.delete_vector2(e)}),this.directions.length=0)},__decorate([t.reflect.Field("vector2"),__metadata("design:type",t.math.vector2)],obb2d.prototype,"offset",void 0),__decorate([t.reflect.Field("vector2"),__metadata("design:type",Object),__metadata("design:paramtypes",[t.math.vector2])],obb2d.prototype,"size",null),obb2d}();e.obb2d=a}(t.framework||(t.framework={}))}(gd3d||(gd3d={}));var gd3d;!function(t){!function(e){var a=function(){function pickinfo(e,a,r){void 0===e&&(e=0),void 0===a&&(a=0),void 0===r&&(r=0),this.distance=0,this.hitposition=new t.math.vector3,this.bu=0,this.bv=0,this.faceId=-1,this.subMeshId=0,this.distance=r,this.bu=e,this.bv=a}return pickinfo.prototype.init=function(){this.pickedtran=null,this.hitposition.x=this.hitposition.y=this.hitposition.z=this.distance=this.bu=this.bv=this.subMeshId=0,this.faceId=-1},pickinfo.prototype.cloneFrom=function(e){this.pickedtran=e.pickedtran,t.math.vec3Clone(e.hitposition,this.hitposition),this.distance=e.distance,this.bu=e.bu,this.bv=e.bv,this.subMeshId=e.subMeshId,this.faceId=e.faceId},pickinfo}();e.pickinfo=a}(t.framework||(t.framework={}))}(gd3d||(gd3d={}));var gd3d;!function(t){!function(e){var a=function(){function ray(e,a){this.origin=t.math.pool.clone_vector3(e),this.direction=t.math.pool.clone_vector3(a)}return ray.prototype.intersectAABB=function(t){return this.intersectBoxMinMax(t.minimum,t.maximum)},ray.prototype.intersectPlaneTransform=function(e,a){var r=!1,i=e.getWorldTranslate(),o=t.math.pool.new_vector3();e.getForwardInWorld(o);var n=t.math.pool.new_vector3();return(r=this.intersectPlane(i,o,n))&&(t.math.vec3Clone(n,a.hitposition),a.distance=t.math.vec3Distance(a.hitposition,this.origin),a.pickedtran=e),t.math.pool.delete_vector3(o),t.math.pool.delete_vector3(n),r},ray.prototype.intersectPlane=function(t,e,a){var r=e.x,i=e.y,o=e.z,n=t.x,s=t.y,l=t.z,h=this.direction.x,c=this.direction.y,u=this.direction.z,d=this.origin.x,m=this.origin.y,p=this.origin.z,f=h*r+c*i+u*o;if(0===f)return!1;var g=((n-d)*r+(s-m)*i+(l-p)*o)/f;return a.x=d+h*g,a.y=m+c*g,a.z=p+u*g,!0},ray.prototype.intersectCollider=function(a,r){var i=!1,o=a.gameObject.collider,n=Number.MAX_VALUE;if(o instanceof e.boxcollider){var s=o.getBound();if(!s)return i;var l=[];s.caclWorldVecs(l,o.gameObject.transform.getWorldMatrix());for(var h=t.render.meshData.genBoxByArray(l),c=0;c<h.trisindex.length;c+=3){var u=h.pos[h.trisindex[c]],d=h.pos[h.trisindex[c+1]],m=h.pos[h.trisindex[c+2]],p=t.math.pool.new_pickInfo();if(this.intersectsTriangle(u,d,m,p)){if(p.distance<0)continue;if(n>p.distance){i=!0,r.cloneFrom(p),n=r.distance;var f=t.math.pool.new_vector3();t.math.vec3ScaleByNum(this.direction,r.distance,f),t.math.vec3Add(this.origin,f,r.hitposition),t.math.pool.delete_vector3(f)}}t.math.pool.delete_pickInfo(p)}}else if(o instanceof e.meshcollider){var g=o.getBound();null!=g&&(i=g.intersects(this,a.getWorldMatrix(),r))}else o instanceof e.canvasRenderer&&(i=this.intersectPlaneTransform(a,r));return i},ray.prototype.intersectBoxMinMax=function(t,e){var a,r,i,o,n=0,s=Number.MAX_VALUE;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<t.x||this.origin.x>e.x)return!1}else if(a=1/this.direction.x,r=(t.x-this.origin.x)*a,(i=(e.x-this.origin.x)*a)===-1/0&&(i=1/0),r>i&&(o=r,r=i,i=o),n=Math.max(r,n),s=Math.min(i,s),n>s)return!1;if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<t.y||this.origin.y>e.y)return!1}else if(a=1/this.direction.y,r=(t.y-this.origin.y)*a,(i=(e.y-this.origin.y)*a)===-1/0&&(i=1/0),r>i&&(o=r,r=i,i=o),n=Math.max(r,n),s=Math.min(i,s),n>s)return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<t.z||this.origin.z>e.z)return!1}else if(a=1/this.direction.z,r=(t.z-this.origin.z)*a,(i=(e.z-this.origin.z)*a)===-1/0&&(i=1/0),r>i&&(o=r,r=i,i=o),n=Math.max(r,n),s=Math.min(i,s),n>s)return!1;return!0},ray.prototype.intersectsSphere=function(e,a){var r=t.math.pool.new_vector3();t.math.vec3Subtract(e,this.origin,r);var i=t.math.vec3Dot(this.direction,r);if(o<n)return!0;if(i<0)return!1;var o=t.math.vec3SqrLength(r);t.math.pool.delete_vector3(r);var n=a*a;return!(n-(o-i*i)<0)},ray.prototype.intersectsTriangle=function(e,a,r,i){var o=t.math.pool.new_vector3(),n=t.math.pool.new_vector3(),s=t.math.pool.new_vector3(),l=t.math.pool.new_vector3(),h=t.math.pool.new_vector3();t.math.vec3Subtract(a,e,o),t.math.vec3Subtract(r,e,n),t.math.vec3Cross(this.direction,n,s);var c=t.math.vec3Dot(o,s);if(0===c)return!1;var u=1/c;t.math.vec3Subtract(this.origin,e,l);var d=t.math.vec3Dot(l,s)*u;if(d<0||d>1)return!1;t.math.vec3Cross(l,o,h);var m=t.math.vec3Dot(this.direction,h)*u;if(m<0||d+m>1)return!1;var p=t.math.vec3Dot(n,h)*u;return t.math.pool.delete_vector3(o),t.math.pool.delete_vector3(n),t.math.pool.delete_vector3(s),t.math.pool.delete_vector3(l),t.math.pool.delete_vector3(h),i.init(),i.bu=d,i.bv=m,i.distance=p,!0},ray}();e.ray=a}(t.framework||(t.framework={}))}(gd3d||(gd3d={}));var gd3d;!function(t){!function(t){!function(t){t[t.nothing=0]="nothing",t[t.default=1]="default",t[t.transparentFx=2]="transparentFx",t[t.IgnoreRaycast=4]="IgnoreRaycast",t[t.editor=8]="editor",t[t.water=16]="water",t[t.ui=32]="ui",t[t.preview=64]="preview",t[t.builtin_0=1]="builtin_0",t[t.builtin_1=2]="builtin_1",t[t.builtin_2=4]="builtin_2",t[t.builtin_3=8]="builtin_3",t[t.builtin_4=16]="builtin_4",t[t.builtin_5=32]="builtin_5",t[t.builtin_6=64]="builtin_6",t[t.builtin_7=128]="builtin_7",t[t.modelbeforeui=256]="modelbeforeui",t[t.user_8=256]="user_8",t[t.user_9=512]="user_9",t[t.user_10=1024]="user_10",t[t.user_11=2048]="user_11",t[t.user_12=4096]="user_12",t[t.user_13=8192]="user_13",t[t.user_14=16384]="user_14",t[t.user_15=32768]="user_15",t[t.user_16=65536]="user_16",t[t.user_17=131072]="user_17",t[t.user_18=262144]="user_18",t[t.user_19=524288]="user_19",t[t.user_20=1048576]="user_20",t[t.user_21=2097152]="user_21",t[t.user_22=4194304]="user_22",t[t.user_23=8388608]="user_23",t[t.user_24=16777216]="user_24",t[t.user_25=33554432]="user_25",t[t.user_26=67108864]="user_26",t[t.user_27=134217728]="user_27",t[t.user_28=268435456]="user_28",t[t.user_29=536870912]="user_29",t[t.user_30=1073741824]="user_30",t[t.user_31=2147483648]="user_31",t[t.everything=4294967295]="everything"}(t.CullingMask||(t.CullingMask={}));var e=function(){function cullingmaskutil(){}return cullingmaskutil.maskTolayer=function(t){return Math.log(t)/Math.log(2)},cullingmaskutil.layerToMask=function(t){return 1<<t},cullingmaskutil}();t.cullingmaskutil=e}(t.framework||(t.framework={}))}(gd3d||(gd3d={}));var gd3d;!function(gd3d){var framework;!function(framework){var EnumUtil=function(){function EnumUtil(){}return EnumUtil.getEnumObjByType=function(enumType){var index=enumType.indexOf("gd3d.framework.");return 0==index&&(enumType=enumType.substr(15)),eval("{result:"+enumType+"}")},EnumUtil}();framework.EnumUtil=EnumUtil}(framework=gd3d.framework||(gd3d.framework={}))}(gd3d||(gd3d={}));var gd3d;!function(t){!function(t){var e=function(){function NumberUtil(){}return NumberUtil.KEY_A=65,NumberUtil.KEY_D=68,NumberUtil.KEY_E=69,NumberUtil.KEY_Q=81,NumberUtil.KEY_R=82,NumberUtil.KEY_S=83,NumberUtil.KEY_W=87,NumberUtil.KEY_a=97,NumberUtil.KEY_d=100,NumberUtil.KEY_e=101,NumberUtil.KEY_q=113,NumberUtil.KEY_r=114,NumberUtil.KEY_s=115,NumberUtil.KEY_w=119,NumberUtil}();t.NumberUtil=e}(t.framework||(t.framework={}))}(gd3d||(gd3d={}));var gd3d;!function(t){!function(t){var e=function(){function RegexpUtil(){}return RegexpUtil.textureRegexp=/([_0-9a-zA-Z]+)[ ]*\([ ]*'(.+)'[ ]*,[ ]*([0-9a-zA-Z]+)[ ]*\)[ ]*=[ ]*'(.+)'[ ]*\{[ ]*([a-zA-Z]*)[ ]*([a-zA-Z]*)[ ]*\}/,RegexpUtil.vectorRegexp=/([_0-9a-zA-Z]+)[ ]*\([ ]*'(.+)'[ ]*,[ ]*([0-9a-zA-Z]+)[ ]*\)[ ]*=[ ]*\([ ]*([0-9.-]+)[ ]*,[ ]*([0-9.-]+)[ ]*,[ ]*([0-9.-]+)[ ]*,[ ]*([0-9.-]+)[ ]*\)/,RegexpUtil.floatRegexp=/([_0-9a-zA-Z]+)[ ]*\([ ]*'(.+)'[ ]*,[ ]*([0-9a-zA-Z]+)[ ]*\)[ ]*=[ ]*([0-9.-]+)/,RegexpUtil.rangeRegexp=/([_0-9a-zA-Z]+)[ ]*\([ ]*'(.+)'[ ]*,[ ]*([0-9a-zA-Z]+)[ ]*\([ ]*([0-9.-]+)[ ]*,[ ]*([0-9.-]+)[ ]*\)[ ]*\)[ ]*=[ ]*([0-9.-]+)/,RegexpUtil.vector4Regexp=/\([ ]*([0-9.-]+)[ ]*,[ ]*([0-9.-]+)[ ]*,[ ]*([0-9.-]+)[ ]*,[ ]*([0-9.-]+)[ ]*\)/,RegexpUtil.vector3FloatOrRangeRegexp=/([0-9.-]+|\[[0-9.-]+,[0-9.-]+\]),([0-9.-]+|\[[0-9.-]+,[0-9.-]+\]),([0-9.-]+|\[[0-9.-]+,[0-9.-]+\])/,RegexpUtil}();t.RegexpUtil=e}(t.framework||(t.framework={}))}(gd3d||(gd3d={}));var gd3d;!function(t){!function(t){var e=function(){function StringUtil(){}return StringUtil.replaceAll=function(t,e,a){return t.replace(new RegExp(e,"gm"),a)},StringUtil.trimAll=function(t){var e=(t+="").replace(/(^\s+)|(\s+$)/g,"");return e=e.replace(/\s/g,"")},StringUtil.firstCharToLowerCase=function(t){return t.substr(0,1).toLowerCase()+t.substr(1)},StringUtil.isNullOrEmptyObject=function(t){if(!t)return!0;for(var e in t)return!1;return!0},StringUtil.builtinTag_Untagged="Untagged",StringUtil.builtinTag_Player="Player",StringUtil.builtinTag_EditorOnly="EditorOnly",StringUtil.builtinTag_MainCamera="MainCamera",StringUtil.COMPONENT_CAMERA="camera",StringUtil.COMPONENT_BOXCOLLIDER="boxcollider",StringUtil.COMPONENT_LIGHT="light",StringUtil.COMPONENT_MESHFILTER="meshFilter",StringUtil.COMPONENT_MESHRENDER="meshRenderer",StringUtil.COMPONENT_EFFECTSYSTEM="effectSystem",StringUtil.COMPONENT_LABEL="label",StringUtil.COMPONENT_uirect="uirect",StringUtil.COMPONENT_IMAGE="image2D",StringUtil.COMPONENT_RAWIMAGE="rawImage2D",StringUtil.COMPONENT_BUTTON="button",StringUtil.COMPONENT_SKINMESHRENDER="skinnedMeshRenderer",StringUtil.COMPONENT_AUDIOPLAYER="AudioPlayer",StringUtil.COMPONENT_CAMERACONTROLLER="cameraController",StringUtil.COMPONENT_CANVASRENDER="canvasRenderer",StringUtil.UIStyle_RangeFloat="rangeFloat",StringUtil.UIStyle_Enum="enum",StringUtil.RESOURCES_MESH_CUBE="cube",StringUtil}();t.StringUtil=e}(t.framework||(t.framework={}))}(gd3d||(gd3d={}));var gd3d;!function(t){!function(t){var e=function(){function textureutil(){}return textureutil.loadUtil=function(t){var e=document.createElement("script"),a=document.createElement("script");e.src=t+"lib/webgl-util.js",a.src=t+"",document.body.appendChild(e),document.body.appendChild(a)},textureutil}();t.textureutil=e}(t.framework||(t.framework={}))}(gd3d||(gd3d={}));var gd3d;!function(t){!function(e){var a;!function(t){t[t.Sphere=0]="Sphere",t[t.Capsule=1]="Capsule",t[t.Cylinder=2]="Cylinder",t[t.Cube=3]="Cube",t[t.Plane=4]="Plane",t[t.Quad=5]="Quad",t[t.Pyramid=6]="Pyramid"}(a=e.PrimitiveType||(e.PrimitiveType={}));var r;!function(t){t[t.RawImage2D=0]="RawImage2D",t[t.Image2D=1]="Image2D",t[t.Label=2]="Label",t[t.Button=3]="Button"}(r=e.Primitive2DType||(e.Primitive2DType={}));var i=function(){function TransformUtil(){}return TransformUtil.CreatePrimitive=function(t,r){var i=a[t],o=new e.transform;o.name=i;var n=o.gameObject.addComponent("meshFilter"),s=r.getAssetMgr().getDefaultMesh(i.toLowerCase());n.mesh=s;var l=o.gameObject.addComponent("meshRenderer");return l.materials=[],l.materials.push(new e.material),l.materials[0].setShader(r.getAssetMgr().getShader("shader/def")),o},TransformUtil.Create2DPrimitive=function(t,a){var i=r[t],o=e.StringUtil.firstCharToLowerCase(i),n=new e.transform2D;n.name=i;var s=n.addComponent(o);switch(n.pivot.x=0,n.pivot.y=0,t){case r.RawImage2D:TransformUtil.create2D_rawImage(s,a);break;case r.Image2D:TransformUtil.create2D_image2D(s,a);break;case r.Label:TransformUtil.create2D_label(s,a);break;case r.Button:TransformUtil.create2D_button(s,a)}return n},TransformUtil.create2D_rawImage=function(t,e){t.transform.width=100,t.transform.height=100,t.image=e.getAssetMgr().getDefaultTexture("white")},TransformUtil.create2D_image2D=function(t,e){t.transform.width=100,t.transform.height=100,t.sprite=e.getAssetMgr().getDefaultSprite("white_sprite")},TransformUtil.create2D_label=function(e,a){e.transform.width=150,e.transform.height=50,e.text="label",e.fontsize=25,e.color=new t.math.color(1,0,0,1);var r=a.getAssetMgr().getAssetByName("STXINGKA.font.json");null==r?a.getAssetMgr().load("res/STXINGKA.TTF.png",t.framework.AssetTypeEnum.Auto,function(r){r.isfinish&&a.getAssetMgr().load("res/resources/STXINGKA.font.json",t.framework.AssetTypeEnum.Auto,function(t){e.font=a.getAssetMgr().getAssetByName("STXINGKA.font.json"),e.transform.markDirty()})}):(e.font=r,e.transform.markDirty())},TransformUtil.create2D_button=function(e,a){e.transform.width=150,e.transform.height=50;var r=e.transform.addComponent("image2D");r.sprite=a.getAssetMgr().getDefaultSprite("white_sprite"),r.imageType=t.framework.ImageType.Sliced,e.targetImage=r,e.transition=t.framework.TransitionType.ColorTint;var i=new t.framework.transform2D;i.name="label",i.width=150,i.height=50,i.pivot.x=0,i.pivot.y=0,i.localTranslate.y=-10;var o=i.addComponent("label");o.text="button",o.fontsize=25,o.color=new t.math.color(1,0,0,1),e.transform.addChild(i);var n=a.getAssetMgr().getAssetByName("STXINGKA.font.json");null==n?a.getAssetMgr().load("res/STXINGKA.TTF.png",t.framework.AssetTypeEnum.Auto,function(r){r.isfinish&&a.getAssetMgr().load("res/resources/STXINGKA.font.json",t.framework.AssetTypeEnum.Auto,function(t){o.font=a.getAssetMgr().getAssetByName("STXINGKA.font.json"),e.transform.markDirty()})}):(o.font=n,e.transform.markDirty())},TransformUtil}();e.TransformUtil=i}(t.framework||(t.framework={}))}(gd3d||(gd3d={}));var gd3d;!function(t){!function(t){var e=function(){function tweenUtil(){}return tweenUtil.GetEaseProgress=function(t,e){switch(t){case a.Linear:return e;case a.ExpoEaseOut:return tweenUtil.ExpoEaseOut(e,0,1,1);case a.ExpoEaseIn:return tweenUtil.ExpoEaseIn(e,0,1,1);case a.ExpoEaseOutIn:return tweenUtil.ExpoEaseOutIn(e,0,1,1);case a.ExpoEaseInOut:return tweenUtil.ExpoEaseInOut(e,0,1,1);case a.CircEaseOut:return tweenUtil.CircEaseOut(e,0,1,1);case a.CircEaseIn:return tweenUtil.CircEaseIn(e,0,1,1);case a.CircEaseOutIn:return tweenUtil.CircEaseOutIn(e,0,1,1);case a.CircEaseInOut:return tweenUtil.CircEaseInOut(e,0,1,1);case a.QuadEaseOut:return tweenUtil.QuadEaseOut(e,0,1,1);case a.QuadEaseIn:return tweenUtil.QuadEaseIn(e,0,1,1);case a.QuadEaseOutIn:return tweenUtil.QuadEaseOutIn(e,0,1,1);case a.QuadEaseInOut:return tweenUtil.QuadEaseInOut(e,0,1,1);case a.SineEaseOut:return tweenUtil.SineEaseOut(e,0,1,1);case a.SineEaseIn:return tweenUtil.SineEaseIn(e,0,1,1);case a.SineEaseOutIn:return tweenUtil.SineEaseOutIn(e,0,1,1);case a.SineEaseInOut:return tweenUtil.SineEaseInOut(e,0,1,1);case a.CubicEaseOut:return tweenUtil.CubicEaseOut(e,0,1,1);case a.CubicEaseIn:return tweenUtil.CubicEaseIn(e,0,1,1);case a.CubicEaseOutIn:return tweenUtil.CubicEaseOutIn(e,0,1,1);case a.CubicEaseInOut:return tweenUtil.CubicEaseInOut(e,0,1,1);case a.QuartEaseOut:return tweenUtil.QuartEaseOut(e,0,1,1);case a.QuartEaseIn:return tweenUtil.QuartEaseIn(e,0,1,1);case a.QuartEaseOutIn:return tweenUtil.QuartEaseOutIn(e,0,1,1);case a.QuartEaseInOut:return tweenUtil.QuartEaseInOut(e,0,1,1);case a.QuintEaseOut:return tweenUtil.QuintEaseOut(e,0,1,1);case a.QuintEaseIn:return tweenUtil.QuintEaseIn(e,0,1,1);case a.QuintEaseOutIn:return tweenUtil.QuintEaseOutIn(e,0,1,1);case a.QuintEaseInOut:return tweenUtil.QuintEaseInOut(e,0,1,1);case a.ElasticEaseOut:return tweenUtil.ElasticEaseOut(e,0,1,1);case a.ElasticEaseIn:return tweenUtil.ElasticEaseIn(e,0,1,1);case a.ElasticEaseOutIn:return tweenUtil.ElasticEaseOutIn(e,0,1,1);case a.ElasticEaseInOut:return tweenUtil.ElasticEaseInOut(e,0,1,1);case a.BounceEaseOut:return tweenUtil.BounceEaseOut(e,0,1,1);case a.BounceEaseIn:return tweenUtil.BounceEaseIn(e,0,1,1);case a.BounceEaseOutIn:return tweenUtil.BounceEaseOutIn(e,0,1,1);case a.BounceEaseInOut:return tweenUtil.BounceEaseInOut(e,0,1,1);case a.BackEaseOut:return tweenUtil.BackEaseOut(e,0,1,1);case a.BackEaseIn:return tweenUtil.BackEaseIn(e,0,1,1);case a.BackEaseOutIn:return tweenUtil.BackEaseOutIn(e,0,1,1);case a.BackEaseInOut:return tweenUtil.BackEaseInOut(e,0,1,1);default:return e}},tweenUtil.Linear=function(t,e,a,r){return a*t/r+e},tweenUtil.ExpoEaseOut=function(t,e,a,r){return t==r?e+a:a*(1-Math.pow(2,-10*t/r))+e},tweenUtil.ExpoEaseIn=function(t,e,a,r){return 0==t?e:a*Math.pow(2,10*(t/r-1))+e},tweenUtil.ExpoEaseInOut=function(t,e,a,r){return 0==t?e:t==r?e+a:(t/=r/2)<1?a/2*Math.pow(2,10*(t-1))+e:a/2*(2-Math.pow(2,-10*--t))+e},tweenUtil.ExpoEaseOutIn=function(t,e,a,r){return t<r/2?tweenUtil.ExpoEaseOut(2*t,e,a/2,r):tweenUtil.ExpoEaseIn(2*t-r,e+a/2,a/2,r)},tweenUtil.CircEaseOut=function(t,e,a,r){return a*Math.sqrt(1-(t=t/r-1)*t)+e},tweenUtil.CircEaseIn=function(t,e,a,r){return-a*(Math.sqrt(1-(t/=r)*t)-1)+e},tweenUtil.CircEaseInOut=function(t,e,a,r){return(t/=r/2)<1?-a/2*(Math.sqrt(1-t*t)-1)+e:a/2*(Math.sqrt(1-(t-=2)*t)+1)+e},tweenUtil.CircEaseOutIn=function(t,e,a,r){return t<r/2?tweenUtil.CircEaseOut(2*t,e,a/2,r):tweenUtil.CircEaseIn(2*t-r,e+a/2,a/2,r)},tweenUtil.QuadEaseOut=function(t,e,a,r){return-a*(t/=r)*(t-2)+e},tweenUtil.QuadEaseIn=function(t,e,a,r){return a*(t/=r)*t+e},tweenUtil.QuadEaseInOut=function(t,e,a,r){return(t/=r/2)<1?a/2*t*t+e:-a/2*(--t*(t-2)-1)+e},tweenUtil.QuadEaseOutIn=function(t,e,a,r){return t<r/2?tweenUtil.QuadEaseOut(2*t,e,a/2,r):tweenUtil.QuadEaseIn(2*t-r,e+a/2,a/2,r)},tweenUtil.SineEaseOut=function(t,e,a,r){return a*Math.sin(t/r*(Math.PI/2))+e},tweenUtil.SineEaseIn=function(t,e,a,r){return-a*Math.cos(t/r*(Math.PI/2))+a+e},tweenUtil.SineEaseInOut=function(t,e,a,r){return(t/=r/2)<1?a/2*Math.sin(Math.PI*t/2)+e:-a/2*(Math.cos(Math.PI*--t/2)-2)+e},tweenUtil.SineEaseOutIn=function(t,e,a,r){return t<r/2?tweenUtil.SineEaseOut(2*t,e,a/2,r):tweenUtil.SineEaseIn(2*t-r,e+a/2,a/2,r)},tweenUtil.CubicEaseOut=function(t,e,a,r){return a*((t=t/r-1)*t*t+1)+e},tweenUtil.CubicEaseIn=function(t,e,a,r){return a*(t/=r)*t*t+e},tweenUtil.CubicEaseInOut=function(t,e,a,r){return(t/=r/2)<1?a/2*t*t*t+e:a/2*((t-=2)*t*t+2)+e},tweenUtil.CubicEaseOutIn=function(t,e,a,r){return t<r/2?tweenUtil.CubicEaseOut(2*t,e,a/2,r):tweenUtil.CubicEaseIn(2*t-r,e+a/2,a/2,r)},tweenUtil.QuartEaseOut=function(t,e,a,r){return-a*((t=t/r-1)*t*t*t-1)+e},tweenUtil.QuartEaseIn=function(t,e,a,r){return a*(t/=r)*t*t*t+e},tweenUtil.QuartEaseInOut=function(t,e,a,r){return(t/=r/2)<1?a/2*t*t*t*t+e:-a/2*((t-=2)*t*t*t-2)+e},tweenUtil.QuartEaseOutIn=function(t,e,a,r){return t<r/2?tweenUtil.QuartEaseOut(2*t,e,a/2,r):tweenUtil.QuartEaseIn(2*t-r,e+a/2,a/2,r)},tweenUtil.QuintEaseOut=function(t,e,a,r){return a*((t=t/r-1)*t*t*t*t+1)+e},tweenUtil.QuintEaseIn=function(t,e,a,r){return a*(t/=r)*t*t*t*t+e},tweenUtil.QuintEaseInOut=function(t,e,a,r){return(t/=r/2)<1?a/2*t*t*t*t*t+e:a/2*((t-=2)*t*t*t*t+2)+e},tweenUtil.QuintEaseOutIn=function(t,e,a,r){return t<r/2?tweenUtil.QuintEaseOut(2*t,e,a/2,r):tweenUtil.QuintEaseIn(2*t-r,e+a/2,a/2,r)},tweenUtil.ElasticEaseOut=function(t,e,a,r){if(1==(t/=r))return e+a;var i=.3*r,o=i/4;return a*Math.pow(2,-10*t)*Math.sin((t*r-o)*(2*Math.PI)/i)+a+e},tweenUtil.ElasticEaseIn=function(t,e,a,r){if(1==(t/=r))return e+a;var i=.3*r,o=i/4;return-a*Math.pow(2,10*(t-=1))*Math.sin((t*r-o)*(2*Math.PI)/i)+e},tweenUtil.ElasticEaseInOut=function(t,e,a,r){if(2==(t/=r/2))return e+a;var i=r*(.3*1.5),o=i/4;return t<1?a*Math.pow(2,10*(t-=1))*Math.sin((t*r-o)*(2*Math.PI)/i)*-.5+e:a*Math.pow(2,-10*(t-=1))*Math.sin((t*r-o)*(2*Math.PI)/i)*.5+a+e},tweenUtil.ElasticEaseOutIn=function(t,e,a,r){return t<r/2?tweenUtil.ElasticEaseOut(2*t,e,a/2,r):tweenUtil.ElasticEaseIn(2*t-r,e+a/2,a/2,r)},tweenUtil.BounceEaseOut=function(t,e,a,r){return(t/=r)<1/2.75?a*(7.5625*t*t)+e:t<2/2.75?a*(7.5625*(t-=1.5/2.75)*t+.75)+e:t<2.5/2.75?a*(7.5625*(t-=2.25/2.75)*t+.9375)+e:a*(7.5625*(t-=2.625/2.75)*t+.984375)+e},tweenUtil.BounceEaseIn=function(t,e,a,r){return a-tweenUtil.BounceEaseOut(r-t,0,a,r)+e},tweenUtil.BounceEaseInOut=function(t,e,a,r){return t<r/2?.5*tweenUtil.BounceEaseIn(2*t,0,a,r)+e:.5*tweenUtil.BounceEaseOut(2*t-r,0,a,r)+.5*a+e},tweenUtil.BounceEaseOutIn=function(t,e,a,r){return t<r/2?tweenUtil.BounceEaseOut(2*t,e,a/2,r):tweenUtil.BounceEaseIn(2*t-r,e+a/2,a/2,r)},tweenUtil.BackEaseOut=function(t,e,a,r){return a*((t=t/r-1)*t*(2.70158*t+1.70158)+1)+e},tweenUtil.BackEaseIn=function(t,e,a,r){return a*(t/=r)*t*(2.70158*t-1.70158)+e},tweenUtil.BackEaseInOut=function(t,e,a,r){var i=1.70158;return(t/=r/2)<1?a/2*(t*t*((1+(i*=1.525))*t-i))+e:a/2*((t-=2)*t*((1+(i*=1.525))*t+i)+2)+e},tweenUtil.BackEaseOutIn=function(t,e,a,r){return t<r/2?tweenUtil.BackEaseOut(2*t,e,a/2,r):tweenUtil.BackEaseIn(2*t-r,e+a/2,a/2,r)},tweenUtil}();t.tweenUtil=e;var a;!function(t){t[t.Linear=0]="Linear",t[t.ExpoEaseOut=1]="ExpoEaseOut",t[t.ExpoEaseIn=2]="ExpoEaseIn",t[t.ExpoEaseInOut=3]="ExpoEaseInOut",t[t.ExpoEaseOutIn=4]="ExpoEaseOutIn",t[t.CircEaseOut=5]="CircEaseOut",t[t.CircEaseIn=6]="CircEaseIn",t[t.CircEaseInOut=7]="CircEaseInOut",t[t.CircEaseOutIn=8]="CircEaseOutIn",t[t.QuadEaseOut=9]="QuadEaseOut",t[t.QuadEaseIn=10]="QuadEaseIn",t[t.QuadEaseInOut=11]="QuadEaseInOut",t[t.QuadEaseOutIn=12]="QuadEaseOutIn",t[t.SineEaseOut=13]="SineEaseOut",t[t.SineEaseIn=14]="SineEaseIn",t[t.SineEaseInOut=15]="SineEaseInOut",t[t.SineEaseOutIn=16]="SineEaseOutIn",t[t.CubicEaseOut=17]="CubicEaseOut",t[t.CubicEaseIn=18]="CubicEaseIn",t[t.CubicEaseInOut=19]="CubicEaseInOut",t[t.CubicEaseOutIn=20]="CubicEaseOutIn",t[t.QuartEaseOut=21]="QuartEaseOut",t[t.QuartEaseIn=22]="QuartEaseIn",t[t.QuartEaseInOut=23]="QuartEaseInOut",t[t.QuartEaseOutIn=24]="QuartEaseOutIn",t[t.QuintEaseOut=25]="QuintEaseOut",t[t.QuintEaseIn=26]="QuintEaseIn",t[t.QuintEaseInOut=27]="QuintEaseInOut",t[t.QuintEaseOutIn=28]="QuintEaseOutIn",t[t.ElasticEaseOut=29]="ElasticEaseOut",t[t.ElasticEaseIn=30]="ElasticEaseIn",t[t.ElasticEaseInOut=31]="ElasticEaseInOut",t[t.ElasticEaseOutIn=32]="ElasticEaseOutIn",t[t.BounceEaseOut=33]="BounceEaseOut",t[t.BounceEaseIn=34]="BounceEaseIn",t[t.BounceEaseInOut=35]="BounceEaseInOut",t[t.BounceEaseOutIn=36]="BounceEaseOutIn",t[t.BackEaseOut=37]="BackEaseOut",t[t.BackEaseIn=38]="BackEaseIn",t[t.BackEaseInOut=39]="BackEaseInOut",t[t.BackEaseOutIn=40]="BackEaseOutIn"}(a=t.tweenMethod||(t.tweenMethod={}))}(t.framework||(t.framework={}))}(gd3d||(gd3d={}));var gd3d;!function(t){!function(t){var e=function(){function WebGLDebugUtils(){this.glEnums=null}return WebGLDebugUtils.prototype.log=function(t){window.console&&window.console.log&&window.console.log(t)},WebGLDebugUtils.prototype.init=function(t){if(null==this.glEnums){this.glEnums={};for(var e in t)"number"==typeof t[e]&&(this.glEnums[t[e]]=e)}},WebGLDebugUtils.prototype.checkInit=function(){if(null==this.glEnums)throw"WebGLDebugUtils.init(ctx) not called"},WebGLDebugUtils.prototype.mightBeEnum=function(t){return this.checkInit(),void 0!==this.glEnums[t]},WebGLDebugUtils.prototype.glEnumToString=function(t){this.checkInit();var e=this.glEnums[t];return void 0!==e?e:"*UNKNOWN WebGL ENUM (0x"+t.toString(16)+")"},WebGLDebugUtils.prototype.glFunctionArgToString=function(t,e,a){var r=WebGLDebugUtils.glValidEnumContexts[t];return void 0!==r&&r[e]?this.glEnumToString(a):a.toString()},WebGLDebugUtils.prototype.makeDebugContext=function(t,e){var a=this;void 0===e&&(e=null),this.init(t),e=e||function(t,e,r){for(var i="",o=0;o<r.length;++o)i+=(0==o?"":", ")+a.glFunctionArgToString(e,o,r[o]);console.error("WebGL error "+a.glEnumToString(t)+" in "+e+"("+i+")")};var r={},i={};for(var o in t)"function"==typeof t[o]?i[o]=function makeErrorWrapper(t,a){return function(){var i=t[a].apply(t,arguments),o=t.getError();return 0!=o&&(r[o]=!0,e(o,a,arguments)),i}}(t,o):i[o]=t[o];return i.getError=function(){for(var e in r)if(r[e])return r[e]=!1,e;return t.NO_ERROR},console.error(" i am ---makeDebugContext-"),i},WebGLDebugUtils.prototype.resetToInitialState=function(t){var e=t.getParameter(t.MAX_VERTEX_ATTRIBS),a=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,a);for(i=0;i<e;++i)t.disableVertexAttribArray(i),t.vertexAttribPointer(i,4,t.FLOAT,!1,0,0),t.vertexAttrib1f(i,0);t.deleteBuffer(a);for(var r=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),i=0;i<r;++i)t.activeTexture(t.TEXTURE0+i),t.bindTexture(t.TEXTURE_CUBE_MAP,null),t.bindTexture(t.TEXTURE_2D,null);for(t.activeTexture(t.TEXTURE0),t.useProgram(null),t.bindBuffer(t.ARRAY_BUFFER,null),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null),t.bindFramebuffer(t.FRAMEBUFFER,null),t.bindRenderbuffer(t.RENDERBUFFER,null),t.disable(t.BLEND),t.disable(t.CULL_FACE),t.disable(t.DEPTH_TEST),t.disable(t.DITHER),t.disable(t.SCISSOR_TEST),t.blendColor(0,0,0,0),t.blendEquation(t.FUNC_ADD),t.blendFunc(t.ONE,t.ZERO),t.clearColor(0,0,0,0),t.clearDepth(1),t.clearStencil(-1),t.colorMask(!0,!0,!0,!0),t.cullFace(t.BACK),t.depthFunc(t.LESS),t.depthMask(!0),t.depthRange(0,1),t.frontFace(t.CCW),t.hint(t.GENERATE_MIPMAP_HINT,t.DONT_CARE),t.lineWidth(1),t.pixelStorei(t.PACK_ALIGNMENT,4),t.pixelStorei(t.UNPACK_ALIGNMENT,4),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!1),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),t.UNPACK_COLORSPACE_CONVERSION_WEBGL&&t.pixelStorei(t.UNPACK_COLORSPACE_CONVERSION_WEBGL,t.BROWSER_DEFAULT_WEBGL),t.polygonOffset(0,0),t.sampleCoverage(1,!1),t.scissor(0,0,t.canvas.width,t.canvas.height),t.stencilFunc(t.ALWAYS,0,4294967295),t.stencilMask(4294967295),t.stencilOp(t.KEEP,t.KEEP,t.KEEP),t.viewport(0,0,t.canvas.clientWidth,t.canvas.clientHeight),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT|t.STENCIL_BUFFER_BIT);t.getError(););},WebGLDebugUtils.prototype.makeLostContextSimulatingContext=function(t){function isWebGLObject(t){return t instanceof WebGLBuffer||t instanceof WebGLFramebuffer||t instanceof WebGLProgram||t instanceof WebGLRenderbuffer||t instanceof WebGLShader||t instanceof WebGLTexture}function checkResources(t){for(var e=0;e<t.length;++e){var r=t[e];if(isWebGLObject(r))return r.__webglDebugContextLostId__==a}return!0}function clearErrors(){for(var t=Object.keys(l),e=0;e<t.length;++e)delete l[t[e]]}function makeWebGLContextEvent(t){return{statusMessage:t}}function freeResources(){for(var e=0;e<i.length;++e){var a=i[e];a instanceof WebGLBuffer&&t.deleteBuffer(a)}}function wrapEvent(t){return"function"==typeof t?t:function(e){t.handleEvent(e)}}var e={},a=1,r=!1,i=[],o=void 0,n=void 0,s=void 0,l={};for(var h in t)"function"==typeof t[h]?e[h]=function makeLostContextWrapper(t,e){var a=t[e];return function(){if(!r)return checkResources(arguments)?a.apply(t,arguments):void(l[t.INVALID_OPERATION]=!0)}}(t,h):e[h]=t[h];e.loseContext=function(){if(!r){for(r=!0,++a;t.getError(););clearErrors(),l[t.CONTEXT_LOST_WEBGL]=!0,setTimeout(function(){o&&o(makeWebGLContextEvent("context lost"))},0)}},e.restoreContext=function(){if(r){if(!n)throw"You can not restore the context without a listener";setTimeout(function(){if(freeResources(),this.resetToInitialState(t),r=!1,n){var e=n;n=s,s=void 0,e(makeWebGLContextEvent("context restored"))}},0)}},e.getError=function(){if(!r)for(var e;e=t.getError();)l[e]=!0;for(var a in l)if(l[a])return delete l[a],a;return t.NO_ERROR};for(var c=["createBuffer","createFramebuffer","createProgram","createRenderbuffer","createShader","createTexture"],u=0;u<c.length;++u)e[p=c[u]]=function(e){return function(){if(r)return null;var o=e.apply(t,arguments);return o.__webglDebugContextLostId__=a,i.push(o),o}}(t[p]);for(var d=["getActiveAttrib","getActiveUniform","getBufferParameter","getContextAttributes","getAttachedShaders","getFramebufferAttachmentParameter","getParameter","getProgramParameter","getProgramInfoLog","getRenderbufferParameter","getShaderParameter","getShaderInfoLog","getShaderSource","getTexParameter","getUniform","getUniformLocation","getVertexAttrib"],u=0;u<d.length;++u)e[p=d[u]]=function(e){return function(){return r?null:e.apply(t,arguments)}}(e[p]);for(var m=["isBuffer","isEnabled","isFramebuffer","isProgram","isRenderbuffer","isShader","isTexture"],u=0;u<m.length;++u){var p=m[u];e[p]=function(e){return function(){return!r&&e.apply(t,arguments)}}(e[p])}return e.checkFramebufferStatus=function(e){return function(){return r?t.FRAMEBUFFER_UNSUPPORTED:e.apply(t,arguments)}}(e.checkFramebufferStatus),e.getAttribLocation=function(e){return function(){return r?-1:e.apply(t,arguments)}}(e.getAttribLocation),e.getVertexAttribOffset=function(e){return function(){return r?0:e.apply(t,arguments)}}(e.getVertexAttribOffset),e.isContextLost=function(){return r},e.registerOnContextLostListener=function(t){o=wrapEvent(t)},e.registerOnContextRestoredListener=function(t){r?s=wrapEvent(t):n=wrapEvent(t)},e},WebGLDebugUtils.glValidEnumContexts={enable:{0:!0},disable:{0:!0},getParameter:{0:!0},drawArrays:{0:!0},drawElements:{0:!0,2:!0},createShader:{0:!0},getShaderParameter:{1:!0},getProgramParameter:{1:!0},getVertexAttrib:{1:!0},vertexAttribPointer:{2:!0},bindTexture:{0:!0},activeTexture:{0:!0},getTexParameter:{0:!0,1:!0},texParameterf:{0:!0,1:!0},texParameteri:{0:!0,1:!0,2:!0},texImage2D:{0:!0,2:!0,6:!0,7:!0},texSubImage2D:{0:!0,6:!0,7:!0},copyTexImage2D:{0:!0,2:!0},copyTexSubImage2D:{0:!0},generateMipmap:{0:!0},bindBuffer:{0:!0},bufferData:{0:!0,2:!0},bufferSubData:{0:!0},getBufferParameter:{0:!0,1:!0},pixelStorei:{0:!0,1:!0},readPixels:{4:!0,5:!0},bindRenderbuffer:{0:!0},bindFramebuffer:{0:!0},checkFramebufferStatus:{0:!0},framebufferRenderbuffer:{0:!0,1:!0,2:!0},framebufferTexture2D:{0:!0,1:!0,2:!0},getFramebufferAttachmentParameter:{0:!0,1:!0,2:!0},getRenderbufferParameter:{0:!0,1:!0},renderbufferStorage:{0:!0,1:!0},clear:{0:!0},depthFunc:{0:!0},blendFunc:{0:!0,1:!0},blendFuncSeparate:{0:!0,1:!0,2:!0,3:!0},blendEquation:{0:!0},blendEquationSeparate:{0:!0,1:!0},stencilFunc:{0:!0},stencilFuncSeparate:{0:!0,1:!0},stencilMaskSeparate:{0:!0},stencilOp:{0:!0,1:!0,2:!0},stencilOpSeparate:{0:!0,1:!0,2:!0,3:!0},cullFace:{0:!0},frontFace:{0:!0}},WebGLDebugUtils}();t.WebGLDebugUtils=e}(t.framework||(t.framework={}))}(gd3d||(gd3d={}));var gd3d;!function(t){!function(t){var e=function(){function WebGLUtils(){if(this.GET_A_WEBGL_BROWSER='This page requires a browser that supports WebGL.<br/><a href="http://get.webgl.org">Click here to upgrade your browser.</a>',this.OTHER_PROBLEM='It doesn\'t appear your computer can support WebGL.<br/><a href="http://get.webgl.org">Click here for more information.</a>',!window.requestAnimationFrame){t=window;window.requestAnimationFrame=t.requestAnimationFrame||t.webkitRequestAnimationFrame||t.mozRequestAnimationFrame||t.oRequestAnimationFrame||t.msRequestAnimationFrame||function(t,e){window.setTimeout(t,1e3/60)}}if(!window.cancelAnimationFrame){var t=window;window.cancelAnimationFrame=t.cancelRequestAnimationFrame||window.webkitCancelAnimationFrame||t.webkitCancelRequestAnimationFrame||t.mozCancelAnimationFrame||t.mozCancelRequestAnimationFrame||t.msCancelAnimationFrame||t.msCancelRequestAnimationFrame||t.oCancelAnimationFrame||t.oCancelRequestAnimationFrame||window.clearTimeout}}return WebGLUtils.prototype.makeFailHTML=function(t){return'<div style="margin: auto; width:500px;z-index:10000;margin-top:20em;text-align:center;">'+t+"</div>"},WebGLUtils.prototype.setupWebGL=function(t,e,a){var r=this;void 0===e&&(e=null),void 0===a&&(a=null);a=a||function(t){var e=document.getElementsByTagName("body")[0];if(e){var a=WebGLRenderingContext?r.OTHER_PROBLEM:r.GET_A_WEBGL_BROWSER;t&&(a+="<br/><br/>Status: "+t),e.innerHTML=r.makeFailHTML(a)}},t.addEventListener&&t.addEventListener("webglcontextcreationerror",function(t){a(t.statusMessage)},!1);var i=this.create3DContext(t,e);return i||a(WebGLRenderingContext?"":""),i},WebGLUtils.prototype.create3DContext=function(t,e){for(var a=["webgl","experimental-webgl","webkit-3d","moz-webgl"],r=null,i=0;i<a.length;++i){try{r=t.getContext(a[i],e)}catch(t){}if(r)break}return r},WebGLUtils}();t.WebGLUtils=e}(t.framework||(t.framework={}))}(gd3d||(gd3d={}));var gd3d;!function(t){!function(e){var a=function(){return function loadRetryMgr(){}}();e.xhrLoad=function xhrLoad(e,r,i,o,n){void 0===i&&(i=null);var s=new XMLHttpRequest,l=!1;s.open("GET",e),s.responseType=o,s.onreadystatechange=function(){if(4==s.readyState)if(200==s.status)n(s),l=!0;else switch(s.status){case 404:r(null,new Error("got a 404:"+e))}},s.onprogress=function(t){i&&i(t.loaded,t.total)},s.onerror=function(){r(null,new Error("onerr in req:"))},s.onloadend=function(){if(!l){a.urlCaseDic||(a.urlCaseDic={});var s=a.urlCaseDic;s[e]=isNaN(s[e])||s[e]<0?0:s[e],s[e]>=2?(s[e]=0,r(null,new Error("load this url fail  ："+e),!0)):(t.io.xhrLoad(e,r,i,o,n),s[e]++)}};try{s.send()}catch(t){r(null,t)}},e.loadText=function loadText(e,a,r){void 0===r&&(r=null),t.io.xhrLoad(e,a,r,"text",function(t){a(t.responseText,null)})},e.loadArrayBuffer=function loadArrayBuffer(e,a,r){void 0===r&&(r=null),t.io.xhrLoad(e,a,r,"arraybuffer",function(t){a(t.response,null)})},e.loadBlob=function loadBlob(e,a,r){void 0===r&&(r=null),t.io.xhrLoad(e,a,r,"blob",function(t){a(t.response,null)})},e.loadImg=function loadImg(e,a,r){void 0===r&&(r=null),t.io.xhrLoad(e,a,r,"blob",function(t){var r=t.response,i=document.createElement("img");i.onload=function(t){window.URL.revokeObjectURL(i.src),a(i,null)},i.onerror=function(t){a(null,new Error("error when blob to img:"+e))};try{i.src=window.URL.createObjectURL(r)}catch(t){a(null,t)}})}}(t.io||(t.io={}))}(gd3d||(gd3d={}));var gd3d;!function(t){!function(e){var a=function(){function pool(){}return pool.collect_all=function(){pool.collect_vector4(),pool.collect_vector3(),pool.collect_vector2(),pool.collect_matrix(),pool.collect_quaternion(),pool.collect_color(),pool.collect_pickInfo()},Object.defineProperty(pool,"vector4_one",{get:function(){return null==pool._vector4_one&&(pool._vector4_one=new e.vector4(1,1,1,1)),pool._vector4_one},enumerable:!0,configurable:!0}),pool.new_vector4=function(t,a,r,i){if(void 0===t&&(t=0),void 0===a&&(a=0),void 0===r&&(r=0),void 0===i&&(i=0),pool.unused_vector4.length>0){var o=pool.unused_vector4.pop();return o.x=t,o.y=a,o.z=r,o.w=i,o}return new e.vector4(t,a,r,i)},pool.clone_vector4=function(t){if(pool.unused_vector4.length>0){var a=pool.unused_vector4.pop();return a.rawData.set(t.rawData),a}return new e.vector4(t.x,t.y,t.z)},pool.delete_vector4=function(t){null!=t&&(t instanceof e.vector4?(t.x=t.y=t.z=0,t.w=1,pool.unused_vector4.push(t)):console.error("kindding me?确定你要回收的是vector4吗？"))},pool.collect_vector4=function(){pool.unused_vector4.length=0},Object.defineProperty(pool,"color_one",{get:function(){return null==pool._color_one&&(pool._color_one=new e.color(1,1,1,1)),pool._color_one},enumerable:!0,configurable:!0}),pool.new_color=function(t,a,r,i){if(void 0===t&&(t=0),void 0===a&&(a=0),void 0===r&&(r=0),void 0===i&&(i=0),pool.unused_color.length>0){var o=pool.unused_color.pop();return o.r=t,o.g=a,o.b=r,o.a=i,o}return new e.color(t,a,r,i)},pool.delete_color=function(t){null!=t&&(t instanceof e.color?(t.r=t.g=t.b=0,t.a=1,pool.unused_color.push(t)):console.error("kindding me?确定你要回收的是color吗？"))},pool.collect_color=function(){pool.unused_color.length=0},Object.defineProperty(pool,"vector3_up",{get:function(){return null==pool._vector3_up&&(pool._vector3_up=new e.vector3(0,1,0)),pool._vector3_up.y=1,pool._vector3_up.x=pool._vector3_up.z=0,pool._vector3_up},enumerable:!0,configurable:!0}),Object.defineProperty(pool,"vector3_right",{get:function(){return null==pool._vector3_right&&(pool._vector3_right=new e.vector3(1,0,0)),pool._vector3_right.x=1,pool._vector3_right.y=pool._vector3_right.z=0,pool._vector3_right},enumerable:!0,configurable:!0}),Object.defineProperty(pool,"vector3_forward",{get:function(){return null==pool._vector3_forward&&(pool._vector3_forward=new e.vector3(0,0,1)),pool._vector3_forward.x=pool._vector3_forward.y=0,pool._vector3_forward.z=1,pool._vector3_forward},enumerable:!0,configurable:!0}),Object.defineProperty(pool,"vector3_zero",{get:function(){return null==pool._vector3_zero&&(pool._vector3_zero=new e.vector3(0,0,0)),pool._vector3_zero.x=pool._vector3_zero.y=pool._vector3_zero.z=0,pool._vector3_zero},enumerable:!0,configurable:!0}),Object.defineProperty(pool,"vector3_one",{get:function(){return null==pool._vector3_one&&(pool._vector3_one=new e.vector3(1,1,1)),pool._vector3_one.x=pool._vector3_one.y=pool._vector3_one.z=1,pool._vector3_one},enumerable:!0,configurable:!0}),pool.new_vector3=function(t,a,r){if(void 0===t&&(t=0),void 0===a&&(a=0),void 0===r&&(r=0),pool.unused_vector3.length>0){var i=pool.unused_vector3.pop();return i.x=t,i.y=a,i.z=r,i}return new e.vector3(t,a,r)},pool.clone_vector3=function(t){if(pool.unused_vector3.length>0){var a=pool.unused_vector3.pop();return a.rawData.set(t.rawData),a}return new e.vector3(t.x,t.y,t.z)},pool.delete_vector3=function(t){null!=t&&(t instanceof e.vector3?(t.x=t.y=t.z=0,pool.unused_vector3.push(t)):console.error("kindding me?确定你要回收的是vector3吗？"))},pool.delete_vector3Array=function(t){for(var e=0;e<t.length;e++)void 0!=t[e]&&this.delete_vector3(t[e]);t.length=0},pool.collect_vector3=function(){pool.unused_vector3.length=0},Object.defineProperty(pool,"vector2_zero",{get:function(){return null==pool._vector2_zero&&(pool._vector2_zero=new e.vector2(0,0)),pool._vector2_zero.x=pool._vector2_zero.y=1,pool._vector2_zero},enumerable:!0,configurable:!0}),Object.defineProperty(pool,"vector2_up",{get:function(){return null==pool._vector2_up&&(pool._vector2_up=new e.vector2(0,1)),pool._vector2_up.x=0,pool._vector2_up.y=1,pool._vector2_up},enumerable:!0,configurable:!0}),Object.defineProperty(pool,"vector2_right",{get:function(){return null==pool._vector2_right&&(pool._vector2_right=new e.vector2(1,0)),pool._vector2_right.x=1,pool._vector2_right.y=0,pool._vector2_right},enumerable:!0,configurable:!0}),pool.new_vector2=function(t,a){if(void 0===t&&(t=0),void 0===a&&(a=0),pool.unused_vector2.length>0){var r=pool.unused_vector2.pop();return r.x=t,r.y=a,r}return new e.vector2(t,a)},pool.clone_vector2=function(t){if(pool.unused_vector2.length>0){var a=pool.unused_vector2.pop();return t.rawData.length>a.rawData.length?(t.rawData[0]=a.rawData[0],t.rawData[1]=a.rawData[1]):a.rawData.set(t.rawData),a}return new e.vector2(t.x,t.y)},pool.delete_vector2=function(t){null!=t&&(t instanceof e.vector2?(t.x=t.y=0,pool.unused_vector2.push(t)):console.error("kindding me?确定你要回收的是vector2吗？"))},pool.delete_vector2Array=function(t){for(var e=0;e<t.length;e++)void 0!=t[e]&&this.delete_vector2(t[e]);t.length=0},pool.collect_vector2=function(){pool.unused_vector2.length=0},pool.new_matrix3x2=function(){return pool.unused_matrix3x2.length>0?pool.unused_matrix3x2.pop():new e.matrix3x2},pool.clone_matrix3x2=function(t){var e=pool.new_matrix3x2();return e.rawData.set(t.rawData),e},pool.delete_matrix3x2=function(t){null!=t&&(t instanceof e.matrix3x2?(t.rawData[0]=1,t.rawData[1]=0,t.rawData[2]=0,t.rawData[3]=1,t.rawData[4]=0,t.rawData[5]=0,pool.unused_matrix3x2.push(t)):console.error("kindding me?确定你要回收的是matrix3x2吗？"))},pool.collect_matrix3x2=function(){pool.unused_matrix3x2.length=0},pool.new_matrix=function(){return pool.unused_matrix.length>0?pool.unused_matrix.pop():new e.matrix},pool.clone_matrix=function(t){var e=pool.new_matrix();return e.rawData.set(e.rawData),e},pool.delete_matrix=function(t){null!=t&&(t instanceof e.matrix?(t.rawData[0]=1,t.rawData[1]=0,t.rawData[2]=0,t.rawData[3]=0,t.rawData[4]=0,t.rawData[5]=1,t.rawData[6]=0,t.rawData[7]=0,t.rawData[8]=0,t.rawData[9]=0,t.rawData[10]=1,t.rawData[11]=0,t.rawData[12]=0,t.rawData[13]=0,t.rawData[14]=0,t.rawData[15]=1,pool.unused_matrix.push(t)):console.error("kindding me?确定你要回收的是matrix吗？"))},pool.collect_matrix=function(){pool.unused_matrix.length=0},pool.new_quaternion=function(){return pool.unused_quaternion.length>0?pool.unused_quaternion.pop():new e.quaternion},pool.clone_quaternion=function(t){if(pool.unused_quaternion.length>0){var a=pool.unused_quaternion.pop();return a.rawData.set(t.rawData),a}return new e.quaternion(t.x,t.y,t.z,t.w)},pool.delete_quaternion=function(t){null!=t&&(t instanceof e.quaternion?(t.x=t.y=t.z=0,t.w=1,pool.unused_quaternion.push(t)):console.error("kindding me?确定你要回收的是quaternion吗？"))},pool.collect_quaternion=function(){pool.unused_quaternion.length=0},pool.new_pickInfo=function(e,a,r){return void 0===e&&(e=0),void 0===a&&(a=0),void 0===r&&(r=0),pool.unused_pickInfo.length>0?pool.unused_pickInfo.pop():new t.framework.pickinfo(e,a,r)},pool.delete_pickInfo=function(e){null!=e&&(e instanceof t.framework.pickinfo?(e.init(),pool.unused_pickInfo.push(e)):console.error("kindding me?确定你要回收的是pickInfo吗？"))},pool.collect_pickInfo=function(){pool.unused_pickInfo.length=0},pool.unused_vector4=[],pool.unused_color=[],pool.unused_vector3=[],pool.unused_vector2=[],pool.unused_matrix3x2=[],pool.unused_matrix=[],pool.identityMat=new e.matrix,pool.unused_quaternion=[],pool.unused_pickInfo=[],pool}();e.pool=a}(t.math||(t.math={}))}(gd3d||(gd3d={}));var gd3d;!function(t){!function(t){var e=function(){return function caps(){}}();t.caps=e;var a=function(){function webglkit(){}return webglkit.SetMaxVertexAttribArray=function(t,e){for(var a=e;a<webglkit._maxVertexAttribArray;a++)t.disableVertexAttribArray(a);webglkit._maxVertexAttribArray=e},webglkit.GetTextureNumber=function(t,e){return webglkit.initConst(t),webglkit._texNumber[e]},webglkit.initConst=function(t){null==webglkit._texNumber&&((webglkit._texNumber=[]).push(t.TEXTURE0),webglkit._texNumber.push(t.TEXTURE1),webglkit._texNumber.push(t.TEXTURE2),webglkit._texNumber.push(t.TEXTURE3),webglkit._texNumber.push(t.TEXTURE4),webglkit._texNumber.push(t.TEXTURE5),webglkit._texNumber.push(t.TEXTURE6),webglkit._texNumber.push(t.TEXTURE7),webglkit._texNumber.push(t.TEXTURE8),webglkit._texNumber.push(t.TEXTURE9),webglkit._texNumber.push(t.TEXTURE10),webglkit._texNumber.push(t.TEXTURE11),webglkit._texNumber.push(t.TEXTURE12),webglkit._texNumber.push(t.TEXTURE13),webglkit._texNumber.push(t.TEXTURE14),webglkit._texNumber.push(t.TEXTURE15),webglkit.LEQUAL=t.LEQUAL,webglkit.NEVER=t.NEVER,webglkit.EQUAL=t.EQUAL,webglkit.GEQUAL=t.GEQUAL,webglkit.NOTEQUAL=t.NOTEQUAL,webglkit.LESS=t.LESS,webglkit.GREATER=t.GREATER,webglkit.ALWAYS=t.ALWAYS,webglkit.FUNC_ADD=t.FUNC_ADD,webglkit.FUNC_SUBTRACT=t.FUNC_SUBTRACT,webglkit.FUNC_REVERSE_SUBTRACT=t.FUNC_REVERSE_SUBTRACT,webglkit.ONE=t.ONE,webglkit.ZERO=t.ZERO,webglkit.SRC_ALPHA=t.SRC_ALPHA,webglkit.SRC_COLOR=t.SRC_COLOR,webglkit.ONE_MINUS_SRC_ALPHA=t.ONE_MINUS_SRC_ALPHA,webglkit.ONE_MINUS_SRC_COLOR=t.ONE_MINUS_SRC_COLOR,webglkit.ONE_MINUS_DST_ALPHA=t.ONE_MINUS_DST_ALPHA,webglkit.ONE_MINUS_DST_COLOR=t.ONE_MINUS_DST_COLOR,webglkit.caps.standardDerivatives=null!==t.getExtension("OES_standard_derivatives"),webglkit.caps.pvrtcExtension=t.getExtension("WEBGL_compressed_texture_pvrtc"),webglkit.caps.atcExtension=t.getExtension("WEBGL_compressed_texture_atc"))},webglkit._maxVertexAttribArray=0,webglkit._texNumber=null,webglkit.caps=new e,webglkit}();t.webglkit=a}(t.render||(t.render={}))}(gd3d||(gd3d={}));var gd3d;!function(t){!function(t){var e;!function(t){t[t.ALL=0]="ALL",t[t.CCW=1]="CCW",t[t.CW=2]="CW"}(e=t.ShowFaceStateEnum||(t.ShowFaceStateEnum={}));var a;!function(t){t[t.VboTri=0]="VboTri",t[t.VboLine=1]="VboLine",t[t.EboTri=2]="EboTri",t[t.EboLine=3]="EboLine"}(a=t.DrawModeEnum||(t.DrawModeEnum={}));var r;!function(t){t[t.Close=0]="Close",t[t.Blend=1]="Blend",t[t.Blend_PreMultiply=2]="Blend_PreMultiply",t[t.Add=3]="Add",t[t.Add_PreMultiply=4]="Add_PreMultiply"}(r=t.BlendModeEnum||(t.BlendModeEnum={}));var i=function(){function glDrawPass(){this.state_showface=e.CCW,this.state_zwrite=!1,this.state_ztest=!1,this.state_ztest_method=t.webglkit.LEQUAL,this.state_blend=!1,this.state_blendEquation=0,this.state_blendSrcRGB=0,this.state_blendDestRGB=0,this.state_blendSrcAlpha=0,this.state_blendDestALpha=0}return glDrawPass.prototype.setProgram=function(t,e){void 0===e&&(e=!1),this.program=t,this.mapuniforms=t.mapUniform},glDrawPass.prototype.setAlphaBlend=function(e){this.state_blendMode=e,e==r.Add?(this.state_blend=!0,this.state_blendEquation=t.webglkit.FUNC_ADD,this.state_blendSrcRGB=t.webglkit.SRC_ALPHA,this.state_blendDestRGB=t.webglkit.ONE,this.state_blendSrcAlpha=t.webglkit.SRC_ALPHA,this.state_blendDestALpha=t.webglkit.ONE):e==r.Add_PreMultiply?(this.state_blend=!0,this.state_blendEquation=t.webglkit.FUNC_ADD,this.state_blendSrcRGB=t.webglkit.ONE,this.state_blendDestRGB=t.webglkit.ONE,this.state_blendSrcAlpha=t.webglkit.SRC_ALPHA,this.state_blendDestALpha=t.webglkit.ONE):e==r.Blend?(this.state_blend=!0,this.state_zwrite=!1,this.state_blendEquation=t.webglkit.FUNC_ADD,this.state_blendSrcRGB=t.webglkit.SRC_ALPHA,this.state_blendDestRGB=t.webglkit.ONE_MINUS_SRC_ALPHA,this.state_blendSrcAlpha=t.webglkit.SRC_ALPHA,this.state_blendDestALpha=t.webglkit.ONE):e==r.Blend_PreMultiply?(this.state_blend=!0,this.state_blendEquation=t.webglkit.FUNC_ADD,this.state_blendSrcRGB=t.webglkit.ONE,this.state_blendDestRGB=t.webglkit.ONE_MINUS_SRC_ALPHA,this.state_blendSrcAlpha=t.webglkit.SRC_ALPHA,this.state_blendDestALpha=t.webglkit.ONE):e==r.Close&&(this.state_blend=!1)},glDrawPass.resetLastState=function(){this.lastShowFace=-1,this.lastZWrite=null,this.lastZTest=null,this.lastZTestMethod=-1,this.lastBlend=null,this.lastBlendMode=null},glDrawPass.prototype.use=function(t,a){void 0===a&&(a=!0),this.state_showface!=glDrawPass.lastShowFace&&(glDrawPass.lastShowFace=this.state_showface,this.state_showface==e.ALL?t.disable(t.CULL_FACE):(this.state_showface==e.CCW?t.frontFace(t.CCW):t.frontFace(t.CW),t.cullFace(t.BACK),t.enable(t.CULL_FACE))),this.state_zwrite!=glDrawPass.lastZWrite&&(glDrawPass.lastZWrite=this.state_zwrite,this.state_zwrite?t.depthMask(!0):t.depthMask(!1)),this.state_ztest!=glDrawPass.lastZTest&&(glDrawPass.lastZTest=this.state_ztest,this.state_ztest?t.enable(t.DEPTH_TEST):t.disable(t.DEPTH_TEST)),this.state_ztest&&glDrawPass.lastZTestMethod!=this.state_ztest_method&&(glDrawPass.lastZTestMethod=this.state_ztest_method,t.depthFunc(this.state_ztest_method)),this.state_blend!=glDrawPass.lastBlend&&(glDrawPass.lastBlend=this.state_blend,this.state_blend?t.enable(t.BLEND):t.disable(t.BLEND)),this.state_blend&&glDrawPass.lastBlendMode!=this.state_blendMode&&(glDrawPass.lastBlendMode=this.state_blendMode,t.blendEquation(this.state_blendEquation),t.blendFuncSeparate(this.state_blendSrcRGB,this.state_blendDestRGB,this.state_blendSrcAlpha,this.state_blendDestALpha)),this.program.use(t)},glDrawPass.prototype.draw=function(t,e,r,i,o,n){void 0===r&&(r=a.EboTri),void 0===i&&(i=0),void 0===o&&(o=0),void 0===n&&(n=-1),this.use(t),e.bind(t,this.program,i),r==a.VboTri?e.drawArrayTris(t,o,n):r==a.VboLine?e.drawArrayLines(t,o,n):r==a.EboTri?e.drawElementTris(t,o,n):r==a.EboLine&&e.drawElementLines(t,o,n)},glDrawPass.prototype.getCurDrawState=function(){var t="";return t=this.formate(this.state_showface.toString(),t),t=this.formate(this.state_zwrite.toString(),t),t=this.formate(this.state_ztest.toString(),t),t=this.state_ztest?this.formate(this.state_ztest_method.toString(),t):this.formate("ztestnone",t),t=this.formate(this.state_blend.toString(),t),t=this.state_blend?this.formate(this.state_blendEquation.toString(),t):this.formate("blendnone",t)},glDrawPass.prototype.getCurBlendVal=function(){var t="";return t=this.formate(this.state_blendSrcRGB.toString(),t),t=this.formate(this.state_blendDestRGB.toString(),t),t=this.formate(this.state_blendSrcAlpha.toString(),t),t=this.formate(this.state_blendDestALpha.toString(),t)},glDrawPass.prototype.formate=function(t,e){return e+=t+"_"},glDrawPass.lastShowFace=-1,glDrawPass.lastZWrite=null,glDrawPass.lastZTest=null,glDrawPass.lastZTestMethod=-1,glDrawPass.lastBlend=null,glDrawPass.lastBlendMode=null,glDrawPass}();t.glDrawPass=i}(t.render||(t.render={}))}(gd3d||(gd3d={}));var gd3d;!function(t){!function(t){var e;!function(t){t[t.Position=1]="Position",t[t.Normal=2]="Normal",t[t.Tangent=4]="Tangent",t[t.Color=8]="Color",t[t.UV0=16]="UV0",t[t.UV1=32]="UV1",t[t.BlendIndex4=64]="BlendIndex4",t[t.BlendWeight4=128]="BlendWeight4",t[t.ColorEX=256]="ColorEX"}(e=t.VertexFormatMask||(t.VertexFormatMask={}));var a=function(){return function number4(){}}();t.number4=a;var r;!function(t){t[t.Static=0]="Static",t[t.Dynamic=1]="Dynamic",t[t.Stream=2]="Stream"}(r=t.MeshTypeEnum||(t.MeshTypeEnum={}));var i=function(){function drawInfo(){this.triCount=0,this.vboCount=0,this.renderCount=0}return Object.defineProperty(drawInfo,"ins",{get:function(){return null==drawInfo._ins&&(drawInfo._ins=new drawInfo),drawInfo._ins},enumerable:!0,configurable:!0}),drawInfo}();t.drawInfo=i;var o=function(){function glMesh(){this.lineMode=WebGLRenderingContext.LINES,this.bindIndex=-1,this.vertexFormat=e.Position}return glMesh.prototype.initBuffer=function(e,a,i,o){if(void 0===o&&(o=r.Static),null!=this.vbo)throw new Error("you can only initbuffer once.");o==r.Static?this.mode=e.STATIC_DRAW:o==r.Dynamic?this.mode=e.DYNAMIC_DRAW:o==r.Stream&&(this.mode=e.STREAM_DRAW),this.vertexFormat=a,this.vertexCount=i,i>0&&(this.vertexByteSize=t.meshData.calcByteSize(a),this.vbo=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.vbo),e.bufferData(e.ARRAY_BUFFER,i*this.vertexByteSize,this.mode)),this.indexCounts=[],this.ebos=[]},glMesh.prototype.addIndex=function(t,e){var a=this.ebos.length,r=t.createBuffer();return t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,r),t.bufferData(t.ELEMENT_ARRAY_BUFFER,2*e,this.mode),this.ebos.push(r),this.indexCounts.push(e),a},glMesh.prototype.resetVboSize=function(t,e){this.vertexCount=e,t.bindBuffer(t.ARRAY_BUFFER,this.vbo),t.bufferData(t.ARRAY_BUFFER,e*this.vertexByteSize,this.mode)},glMesh.prototype.resetEboSize=function(t,e,a){this.indexCounts[e]=a,t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.ebos[e]),t.bufferData(t.ELEMENT_ARRAY_BUFFER,2*a,this.mode)},glMesh.prototype.dispose=function(t){if(t.deleteBuffer(this.vbo),this.vbo=null,this.ebos){for(var e=0;e<this.ebos.length;e++)t.deleteBuffer(this.ebos[e]);this.ebos.length=0}},glMesh.prototype.caclByteLength=function(){var t=0;t+=this.vertexByteSize*this.vertexCount;for(var e in this.indexCounts)t+=2*this.indexCounts[e];return t},glMesh.prototype.bindVboBuffer=function(t){t.bindBuffer(t.ARRAY_BUFFER,this.vbo)},glMesh.prototype.bind=function(a,r,i){void 0===i&&(i=0),this.bindIndex=i,i>=0&&a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,this.ebos[i]);var o=this.vertexByteSize,n=0,s=0;r.posPos>=0&&(a.enableVertexAttribArray(r.posPos),a.vertexAttribPointer(r.posPos,3,a.FLOAT,!1,o,n),s++),n+=12,this.vertexFormat&e.Normal?(r.posNormal>=0&&(a.enableVertexAttribArray(r.posNormal),a.vertexAttribPointer(r.posNormal,3,a.FLOAT,!0,o,n),s++),n+=12):r.posNormal>=0&&(a.disableVertexAttribArray(r.posNormal),s++),this.vertexFormat&e.Tangent?(r.posTangent>=0&&(a.enableVertexAttribArray(r.posTangent),a.vertexAttribPointer(r.posTangent,3,a.FLOAT,!0,o,n),s++),n+=12):r.posTangent>=0&&(a.disableVertexAttribArray(r.posTangent),s++),this.vertexFormat&e.Color?(r.posColor>=0&&(a.enableVertexAttribArray(r.posColor),a.vertexAttribPointer(r.posColor,4,a.FLOAT,!1,o,n),s++),n+=16):r.posColor>=0&&(a.disableVertexAttribArray(r.posColor),s++),this.vertexFormat&e.UV0?(r.posUV0>=0&&(a.enableVertexAttribArray(r.posUV0),a.vertexAttribPointer(r.posUV0,2,a.FLOAT,!1,o,n),s++),n+=8):r.posUV0>=0&&(a.disableVertexAttribArray(r.posUV0),s++),this.vertexFormat&e.UV1?(r.posUV2>=0&&(a.enableVertexAttribArray(r.posUV2),a.vertexAttribPointer(r.posUV2,2,a.FLOAT,!1,o,n),s++),n+=8):r.posUV2>=0&&(a.disableVertexAttribArray(r.posUV2),s++),this.vertexFormat&e.BlendIndex4?(r.posBlendIndex4>=0&&(a.enableVertexAttribArray(r.posBlendIndex4),a.vertexAttribPointer(r.posBlendIndex4,4,a.FLOAT,!1,o,n),s++),n+=16):r.posBlendIndex4>=0&&(a.disableVertexAttribArray(r.posBlendIndex4),s++),this.vertexFormat&e.BlendWeight4?(r.posBlendWeight4>=0&&(a.enableVertexAttribArray(r.posBlendWeight4),a.vertexAttribPointer(r.posBlendWeight4,4,a.FLOAT,!1,o,n),s++),n+=16):r.posBlendWeight4>=0&&(a.disableVertexAttribArray(r.posBlendWeight4),s++),this.vertexFormat&e.ColorEX?(r.posColorEx>=0&&(a.enableVertexAttribArray(r.posColorEx),a.vertexAttribPointer(r.posColorEx,4,a.FLOAT,!1,o,n),s++),n+=16):r.posColorEx>=0&&(a.disableVertexAttribArray(r.posColorEx),s++),t.webglkit.SetMaxVertexAttribArray(a,s)},glMesh.prototype.uploadVertexSubData=function(t,e,a){void 0===a&&(a=0),t.bindBuffer(t.ARRAY_BUFFER,this.vbo),t.bufferSubData(t.ARRAY_BUFFER,a,e)},glMesh.prototype.uploadVertexData=function(t,e){t.bindBuffer(t.ARRAY_BUFFER,this.vbo),t.bufferData(t.ARRAY_BUFFER,e,this.mode)},glMesh.prototype.uploadIndexSubData=function(t,e,a,r){void 0===r&&(r=0),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.ebos[e]),t.bufferSubData(t.ELEMENT_ARRAY_BUFFER,r,a)},glMesh.prototype.uploadIndexData=function(t,e,a){t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.ebos[e]),t.bufferData(t.ELEMENT_ARRAY_BUFFER,a,this.mode)},glMesh.prototype.drawArrayTris=function(t,e,a){void 0===e&&(e=0),void 0===a&&(a=-1),a<0&&(a=3*(this.vertexCount/3|0)),i.ins.triCount+=a/3,i.ins.renderCount++,t.drawArrays(t.TRIANGLES,e,a)},glMesh.prototype.drawArrayLines=function(t,e,a){void 0===e&&(e=0),void 0===a&&(a=-1),a<0&&(a=2*(this.vertexCount/2|0)),i.ins.renderCount++,t.drawArrays(this.lineMode,e,a)},glMesh.prototype.drawElementTris=function(t,e,a){void 0===e&&(e=0),void 0===a&&(a=-1),a<0&&(a=3*(this.indexCounts[this.bindIndex]/3|0)),i.ins.triCount+=a/3,i.ins.renderCount++,t.drawElements(t.TRIANGLES,a,t.UNSIGNED_SHORT,2*e)},glMesh.prototype.drawElementLines=function(t,e,a){void 0===e&&(e=0),void 0===a&&(a=-1),a<0&&(a=2*(this.indexCounts[this.bindIndex]/2|0)),i.ins.renderCount++,t.drawElements(this.lineMode,a,t.UNSIGNED_SHORT,2*e)},glMesh}();t.glMesh=o}(t.render||(t.render={}))}(gd3d||(gd3d={}));var gd3d;!function(t){!function(e){var a=function(){function meshData(){}return meshData.addQuadPos=function(t,e){var a=t.pos.length;meshData.addQuadVec3(t.pos,e),t.trisindex.push(a+0),t.trisindex.push(a+1),t.trisindex.push(a+2),t.trisindex.push(a+2),t.trisindex.push(a+1),t.trisindex.push(a+3)},meshData.addQuadPos_Quad=function(t,e){var a=t.pos.length;meshData.addQuadVec3(t.pos,e),t.trisindex.push(a+0),t.trisindex.push(a+1),t.trisindex.push(a+3),t.trisindex.push(a+2)},meshData.addQuadVec3ByValue=function(e,a){for(var r=0;r<4;r++){var i=t.math.pool.clone_vector3(a);e.push(i)}},meshData.addQuadVec3=function(t,e){t.push(e[0]),t.push(e[1]),t.push(e[2]),t.push(e[3])},meshData.addQuadVec2=function(t,e){t.push(e[0]),t.push(e[1]),t.push(e[2]),t.push(e[3])},meshData.genQuad=function(e){var a=.5*e,r=new meshData;return r.pos=[],r.trisindex=[],r.normal=[],r.tangent=[],r.uv=[],meshData.addQuadVec3ByValue(r.normal,new t.math.vector3(0,0,1)),meshData.addQuadPos(r,[new t.math.vector3(-a,a,0),new t.math.vector3(-a,-a,0),new t.math.vector3(a,a,0),new t.math.vector3(a,-a,0)]),meshData.addQuadVec2(r.uv,[new t.math.vector2(0,1),new t.math.vector2(0,0),new t.math.vector2(1,1),new t.math.vector2(1,0)]),meshData.addQuadVec3ByValue(r.tangent,new t.math.vector3(1,0,0)),r},meshData.genQuad_forparticle=function(e){var a=.5*e,r=new meshData;return r.pos=[],r.trisindex=[],r.normal=[],r.tangent=[],r.uv=[],meshData.addQuadVec3ByValue(r.normal,new t.math.vector3(0,0,1)),meshData.addQuadPos(r,[new t.math.vector3(0,a,0),new t.math.vector3(0,-a,0),new t.math.vector3(2*a,a,0),new t.math.vector3(2*a,-a,0)]),meshData.addQuadVec2(r.uv,[new t.math.vector2(0,0),new t.math.vector2(0,1),new t.math.vector2(1,0),new t.math.vector2(1,1)]),meshData.addQuadVec3ByValue(r.tangent,new t.math.vector3(1,0,0)),r},meshData.genPlaneCCW=function(e){var a=.5*e,r=new meshData;return r.pos=[],r.trisindex=[],r.normal=[],r.tangent=[],r.uv=[],meshData.addQuadVec3ByValue(r.normal,new t.math.vector3(0,1,0)),meshData.addQuadPos(r,[new t.math.vector3(-a,0,a),new t.math.vector3(-a,0,-a),new t.math.vector3(a,0,a),new t.math.vector3(a,0,-a)]),meshData.addQuadVec2(r.uv,[new t.math.vector2(0,0),new t.math.vector2(0,1),new t.math.vector2(1,0),new t.math.vector2(1,1)]),meshData.addQuadVec3ByValue(r.tangent,new t.math.vector3(1,0,0)),r},meshData.genCylinderCCW=function(e,a,r){void 0===r&&(r=20);var i=new meshData;i.pos=[],i.trisindex=[],i.normal=[],i.uv=[];for(var o=new t.math.vector3(0,1,0),n=0;n<4;n++){var s=(n<2?.5:-.5)*e;0==n?o=new t.math.vector3(0,1,0):3==n&&(o=new t.math.vector3(0,-1,0));for(p=0;p<r;p++){var l=p/r*Math.PI*2,h=Math.sin(l),c=Math.cos(l);1!=n&&2!=n||(o=new t.math.vector3(h,0,c)),i.pos.push(new t.math.vector3(h*a,s,c*a));var u=t.math.pool.clone_vector3(o);i.normal.push(u),0==n||3==n?i.uv.push(new t.math.vector2(h/2+.5,c/2+.5)):i.uv.push(new t.math.vector2(p/r,s<0?0:1))}}var d=i.pos.length;i.pos.push(new t.math.vector3(0,.5*e,0)),i.normal.push(new t.math.vector3(0,1,0)),i.uv.push(new t.math.vector2(.5,.5));var m=i.pos.length;i.pos.push(new t.math.vector3(0,-.5*e,0)),i.normal.push(new t.math.vector3(0,-1,0)),i.uv.push(new t.math.vector2(.5,.5));for(var p=0;p<r;p++){i.trisindex.push(d),i.trisindex.push(p==r-1?0*r+0:0*r+p+1),i.trisindex.push(0*r+p+0),i.trisindex.push(m),i.trisindex.push(3*r+p+0),i.trisindex.push(p==r-1?3*r+0:3*r+p+1);var f=1*r+p,g=p==r-1?1*r+0:1*r+p+1,v=2*r+p,y=p==r-1?2*r+0:2*r+p+1;i.trisindex.push(f),i.trisindex.push(g),i.trisindex.push(v),i.trisindex.push(g),i.trisindex.push(y),i.trisindex.push(v)}return i},meshData.genPyramid=function(e,a){var r=new meshData;r.pos=[],r.trisindex=[],r.normal=[],r.uv=[];var i=new t.math.vector3,o=new t.math.vector3,n=new t.math.vector3,s=new t.math.vector3,l=new t.math.vector3(0,-1,0),h=new t.math.vector2(.5,.5),c=new t.math.vector2(0,0),u=new t.math.vector2(0,1),d=new t.math.vector2(1,0),m=new t.math.vector2(1,1),p=0;return r.pos.push(new t.math.vector3(-a,.5*-e,-a)),r.pos.push(new t.math.vector3(0,.5*e,0)),r.pos.push(new t.math.vector3(a,.5*-e,-a)),t.math.vec3Cross(new t.math.vector3(a,e,a),new t.math.vector3(a,-e,-a),i),r.normal.push(i),r.normal.push(i),r.normal.push(i),r.uv.push(c),r.uv.push(h),r.uv.push(u),r.trisindex.push(p),r.trisindex.push(p+2),r.trisindex.push(p+1),p+=3,r.pos.push(new t.math.vector3(a,.5*-e,-a)),r.pos.push(new t.math.vector3(0,.5*e,0)),r.pos.push(new t.math.vector3(a,.5*-e,a)),t.math.vec3Cross(new t.math.vector3(-a,e,a),new t.math.vector3(a,-e,a),o),r.normal.push(o),r.normal.push(o),r.normal.push(o),r.uv.push(u),r.uv.push(h),r.uv.push(m),r.trisindex.push(p),r.trisindex.push(p+2),r.trisindex.push(p+1),p+=3,r.pos.push(new t.math.vector3(a,.5*-e,a)),r.pos.push(new t.math.vector3(0,.5*e,0)),r.pos.push(new t.math.vector3(-a,.5*-e,a)),t.math.vec3Cross(new t.math.vector3(-a,e,-a),new t.math.vector3(-a,-e,a),n),r.normal.push(n),r.normal.push(n),r.normal.push(n),r.uv.push(m),r.uv.push(h),r.uv.push(d),r.trisindex.push(p),r.trisindex.push(p+2),r.trisindex.push(p+1),p+=3,r.pos.push(new t.math.vector3(-a,.5*-e,a)),r.pos.push(new t.math.vector3(0,.5*e,0)),r.pos.push(new t.math.vector3(-a,.5*-e,-a)),t.math.vec3Cross(new t.math.vector3(a,e,-a),new t.math.vector3(-a,-e,-a),s),r.normal.push(s),r.normal.push(s),r.normal.push(s),r.uv.push(d),r.uv.push(h),r.uv.push(c),r.trisindex.push(p),r.trisindex.push(p+2),r.trisindex.push(p+1),p+=3,r.pos.push(new t.math.vector3(-a,.5*-e,-a)),r.pos.push(new t.math.vector3(a,.5*-e,-a)),r.pos.push(new t.math.vector3(a,.5*-e,a)),r.pos.push(new t.math.vector3(-a,.5*-e,a)),r.normal.push(l),r.normal.push(l),r.normal.push(l),r.normal.push(l),r.uv.push(c),r.uv.push(d),r.uv.push(m),r.uv.push(u),r.trisindex.push(p),r.trisindex.push(p+2),r.trisindex.push(p+1),r.trisindex.push(p+3),r.trisindex.push(p+2),r.trisindex.push(p),p+=4,r},meshData.genSphereCCW=function(e,a,r){void 0===e&&(e=1),void 0===a&&(a=24),void 0===r&&(r=12);var i=new meshData;i.pos=[],i.trisindex=[],i.normal=[],i.tangent=[],i.uv=[],a=Math.max(3,Math.floor(a)),r=Math.max(2,Math.floor(r));var o,n,s=0,l=[],h=new t.math.vector3,c=new t.math.vector3;for(n=0;n<=r;n++){var u=[],d=n/r;for(o=0;o<=a;o++){var m=o/a;h.x=-e*Math.cos(m*Math.PI*2)*Math.sin(d*Math.PI),h.y=e*Math.cos(d*Math.PI),h.z=e*Math.sin(m*Math.PI*2)*Math.sin(d*Math.PI),i.pos.push(t.math.pool.clone_vector3(h)),c=t.math.pool.clone_vector3(h);var p=Math.sqrt(c.x*c.x+c.y*c.y+c.z*c.z);p>Number.MIN_VALUE?(c.x=c.x/p,c.y=c.y/p,c.z=c.z/p):(c.x=0,c.y=0,c.z=0),i.normal.push(c);var f=new t.math.vector2(1-m,d);i.uv.push(f),u.push(s++)}l.push(u)}for(n=0;n<r;n++)for(o=0;o<a;o++){var g=l[n][o+1],v=l[n][o],y=l[n+1][o],_=l[n+1][o+1];0!==n&&i.trisindex.push(g,_,v),n!==r-1&&i.trisindex.push(v,_,y)}return i},meshData.genBoxCCW=function(e){var a=.5*e,r=new meshData;return r.pos=[],r.trisindex=[],r.normal=[],r.tangent=[],r.uv=[],meshData.addQuadVec3ByValue(r.normal,new t.math.vector3(0,-1,0)),meshData.addQuadPos(r,[new t.math.vector3(-a,-a,-a),new t.math.vector3(-a,-a,a),new t.math.vector3(a,-a,-a),new t.math.vector3(a,-a,a)]),meshData.addQuadVec2(r.uv,[new t.math.vector2(0,0),new t.math.vector2(0,1),new t.math.vector2(1,0),new t.math.vector2(1,1)]),meshData.addQuadVec3ByValue(r.tangent,new t.math.vector3(-1,0,0)),meshData.addQuadVec3ByValue(r.normal,new t.math.vector3(0,1,0)),meshData.addQuadPos(r,[new t.math.vector3(-a,a,a),new t.math.vector3(-a,a,-a),new t.math.vector3(a,a,a),new t.math.vector3(a,a,-a)]),meshData.addQuadVec2(r.uv,[new t.math.vector2(0,0),new t.math.vector2(0,1),new t.math.vector2(1,0),new t.math.vector2(1,1)]),meshData.addQuadVec3ByValue(r.tangent,new t.math.vector3(1,0,0)),meshData.addQuadVec3ByValue(r.normal,new t.math.vector3(0,0,1)),meshData.addQuadPos(r,[new t.math.vector3(-a,-a,a),new t.math.vector3(-a,a,a),new t.math.vector3(a,-a,a),new t.math.vector3(a,a,a)]),meshData.addQuadVec2(r.uv,[new t.math.vector2(1,1),new t.math.vector2(1,0),new t.math.vector2(0,1),new t.math.vector2(0,0)]),meshData.addQuadVec3ByValue(r.tangent,new t.math.vector3(-1,0,0)),meshData.addQuadVec3ByValue(r.normal,new t.math.vector3(0,0,-1)),meshData.addQuadPos(r,[new t.math.vector3(-a,a,-a),new t.math.vector3(-a,-a,-a),new t.math.vector3(a,a,-a),new t.math.vector3(a,-a,-a)]),meshData.addQuadVec2(r.uv,[new t.math.vector2(0,0),new t.math.vector2(0,1),new t.math.vector2(1,0),new t.math.vector2(1,1)]),meshData.addQuadVec3ByValue(r.tangent,new t.math.vector3(1,0,0)),meshData.addQuadVec3ByValue(r.normal,new t.math.vector3(1,0,0)),meshData.addQuadPos(r,[new t.math.vector3(a,-a,-a),new t.math.vector3(a,-a,a),new t.math.vector3(a,a,-a),new t.math.vector3(a,a,a)]),meshData.addQuadVec2(r.uv,[new t.math.vector2(0,1),new t.math.vector2(1,1),new t.math.vector2(0,0),new t.math.vector2(1,0)]),meshData.addQuadVec3ByValue(r.tangent,new t.math.vector3(0,0,1)),meshData.addQuadVec3ByValue(r.normal,new t.math.vector3(-1,0,0)),meshData.addQuadPos(r,[new t.math.vector3(-a,-a,a),new t.math.vector3(-a,-a,-a),new t.math.vector3(-a,a,a),new t.math.vector3(-a,a,-a)]),meshData.addQuadVec2(r.uv,[new t.math.vector2(0,1),new t.math.vector2(1,1),new t.math.vector2(0,0),new t.math.vector2(1,0)]),meshData.addQuadVec3ByValue(r.tangent,new t.math.vector3(0,0,-1)),r},meshData.genBoxByArray=function(e){var a=new meshData;return a.pos=[],a.trisindex=[],a.normal=[],a.tangent=[],a.uv=[],meshData.addQuadVec3ByValue(a.normal,new t.math.vector3(0,-1,0)),meshData.addQuadPos(a,[e[0],e[1],e[2],e[3]]),meshData.addQuadVec3ByValue(a.tangent,new t.math.vector3(-1,0,0)),meshData.addQuadVec3ByValue(a.normal,new t.math.vector3(0,1,0)),meshData.addQuadPos(a,[e[4],e[5],e[6],e[7]]),meshData.addQuadVec3ByValue(a.tangent,new t.math.vector3(1,0,0)),meshData.addQuadVec3ByValue(a.normal,new t.math.vector3(0,0,1)),meshData.addQuadPos(a,[e[1],e[3],e[5],e[7]]),meshData.addQuadVec3ByValue(a.tangent,new t.math.vector3(1,0,0)),meshData.addQuadVec3ByValue(a.normal,new t.math.vector3(0,0,-1)),meshData.addQuadPos(a,[e[0],e[2],e[4],e[6]]),meshData.addQuadVec3ByValue(a.tangent,new t.math.vector3(-1,0,0)),meshData.addQuadVec3ByValue(a.normal,new t.math.vector3(1,0,0)),meshData.addQuadPos(a,[e[6],e[2],e[7],e[3]]),meshData.addQuadVec3ByValue(a.tangent,new t.math.vector3(0,0,-1)),meshData.addQuadVec3ByValue(a.normal,new t.math.vector3(-1,0,0)),meshData.addQuadPos(a,[e[0],e[4],e[1],e[5]]),meshData.addQuadVec3ByValue(a.tangent,new t.math.vector3(0,0,1)),a},meshData.genBoxByArray_Quad=function(e){var a=new meshData;return a.pos=[],a.trisindex=[],a.normal=[],a.tangent=[],a.uv=[],meshData.addQuadVec3ByValue(a.normal,new t.math.vector3(0,-1,0)),meshData.addQuadPos_Quad(a,[e[0],e[1],e[2],e[3]]),meshData.addQuadVec3ByValue(a.tangent,new t.math.vector3(-1,0,0)),meshData.addQuadVec3ByValue(a.normal,new t.math.vector3(0,1,0)),meshData.addQuadPos_Quad(a,[e[4],e[5],e[6],e[7]]),meshData.addQuadVec3ByValue(a.tangent,new t.math.vector3(1,0,0)),meshData.addQuadVec3ByValue(a.normal,new t.math.vector3(0,0,1)),meshData.addQuadPos_Quad(a,[e[1],e[3],e[5],e[7]]),meshData.addQuadVec3ByValue(a.tangent,new t.math.vector3(1,0,0)),meshData.addQuadVec3ByValue(a.normal,new t.math.vector3(0,0,-1)),meshData.addQuadPos_Quad(a,[e[0],e[2],e[4],e[6]]),meshData.addQuadVec3ByValue(a.tangent,new t.math.vector3(-1,0,0)),meshData.addQuadVec3ByValue(a.normal,new t.math.vector3(1,0,0)),meshData.addQuadPos_Quad(a,[e[6],e[2],e[7],e[3]]),meshData.addQuadVec3ByValue(a.tangent,new t.math.vector3(0,0,-1)),meshData.addQuadVec3ByValue(a.normal,new t.math.vector3(-1,0,0)),meshData.addQuadPos_Quad(a,[e[0],e[4],e[1],e[5]]),meshData.addQuadVec3ByValue(a.tangent,new t.math.vector3(0,0,1)),a},meshData.genCircleLineCCW=function(e,a,r){void 0===a&&(a=64),void 0===r&&(r=.05);var i=new meshData;i.pos=[],i.trisindex=[],i.normal=[],i.uv=[];for(var o=0;o<a;o++){var n=2*Math.PI*o/a,s=Math.sin(n)*e,l=Math.cos(n)*e,h=2*Math.PI*(o+1)/a,c=Math.sin(h)*e,u=Math.cos(h)*e;meshData.addQuadPos(i,[new t.math.vector3(c,r,u),new t.math.vector3(s,r,l),new t.math.vector3(c,-r,u),new t.math.vector3(s,-r,l)])}return i},meshData.prototype.caclByteLength=function(){var t=0;return void 0!=this.pos&&(t+=12),void 0!=this.color&&(t+=16),void 0!=this.normal&&(t+=12),void 0!=this.tangent&&(t+=12),void 0!=this.uv&&(t+=8),void 0!=this.uv2&&(t+=8),void 0!=this.blendIndex&&(t+=16),void 0!=this.blendWeight&&(t+=16),void 0!=this.colorex&&(t+=16),void 0!=this.trisindex&&(t+=12),t*=this.pos.length},meshData.calcByteSize=function(t){var a=0;return t&e.VertexFormatMask.Position&&(a+=12),t&e.VertexFormatMask.Normal&&(a+=12),t&e.VertexFormatMask.Tangent&&(a+=12),t&e.VertexFormatMask.Color&&(a+=16),t&e.VertexFormatMask.UV0&&(a+=8),t&e.VertexFormatMask.UV1&&(a+=8),t&e.VertexFormatMask.BlendIndex4&&(a+=16),t&e.VertexFormatMask.BlendWeight4&&(a+=16),t&e.VertexFormatMask.ColorEX&&(a+=16),a},meshData.prototype.genVertexDataArray=function(t){for(var a=this.pos.length,r=meshData.calcByteSize(t)/4,i=new Float32Array(r*a),o=0;o<a;o++){var n=0;i[o*r+n]=this.pos[o].x,i[o*r+ ++n]=this.pos[o].y,i[o*r+ ++n]=this.pos[o].z,n++,t&e.VertexFormatMask.Normal&&(void 0==this.normal||0==this.normal.length?(i[o*r+n]=0,i[o*r+ ++n]=0,i[o*r+ ++n]=0,n++):(i[o*r+n]=this.normal[o].x,i[o*r+ ++n]=this.normal[o].y,i[o*r+ ++n]=this.normal[o].z,n++)),t&e.VertexFormatMask.Tangent&&(void 0==this.tangent||0==this.tangent.length?(i[o*r+n]=0,i[o*r+ ++n]=0,i[o*r+ ++n]=0,n++):(i[o*r+n]=this.tangent[o].x,i[o*r+ ++n]=this.tangent[o].y,i[o*r+ ++n]=this.tangent[o].z,n++)),t&e.VertexFormatMask.Color&&(void 0==this.color||0==this.color.length?(i[o*r+n]=1,i[o*r+ ++n]=1,i[o*r+ ++n]=1,i[o*r+ ++n]=1,n++):(i[o*r+n]=this.color[o].r,i[o*r+ ++n]=this.color[o].g,i[o*r+ ++n]=this.color[o].b,i[o*r+ ++n]=this.color[o].a,n++)),t&e.VertexFormatMask.UV0&&(void 0==this.uv||0==this.uv.length?(i[o*r+n]=0,i[o*r+ ++n]=0,n++):(i[o*r+n]=this.uv[o].x,i[o*r+ ++n]=this.uv[o].y,n++)),t&e.VertexFormatMask.UV1&&(void 0==this.uv2||0==this.uv2.length?(i[o*r+n]=0,i[o*r+ ++n]=0,n++):(i[o*r+n]=this.uv2[o].x,i[o*r+ ++n]=this.uv2[o].y,n++)),t&e.VertexFormatMask.BlendIndex4&&(void 0==this.blendIndex||0==this.blendIndex.length?(i[o*r+n]=0,i[o*r+ ++n]=0,i[o*r+ ++n]=0,i[o*r+ ++n]=0,n++):(i[o*r+n]=this.blendIndex[o].v0,i[o*r+ ++n]=this.blendIndex[o].v1,i[o*r+ ++n]=this.blendIndex[o].v2,i[o*r+ ++n]=this.blendIndex[o].v3,n++)),t&e.VertexFormatMask.BlendWeight4&&(void 0==this.blendWeight||0==this.blendWeight.length?(i[o*r+n]=1,i[o*r+ ++n]=0,i[o*r+ ++n]=0,i[o*r+ ++n]=0,n++):(i[o*r+n]=this.blendWeight[o].v0,i[o*r+ ++n]=this.blendWeight[o].v1,i[o*r+ ++n]=this.blendWeight[o].v2,i[o*r+ ++n]=this.blendWeight[o].v3,n++)),t&e.VertexFormatMask.ColorEX&&(void 0==this.colorex||0==this.colorex.length?(i[o*r+n]=1,i[o*r+ ++n]=1,i[o*r+ ++n]=1,i[o*r+ ++n]=1,n++):(i[o*r+n]=this.colorex[o].r,i[o*r+ ++n]=this.colorex[o].g,i[o*r+ ++n]=this.colorex[o].b,i[o*r+ ++n]=this.colorex[o].a,n++))}return i},meshData.prototype.genIndexDataArray=function(){return new Uint16Array(this.trisindex)},meshData.prototype.genIndexDataArrayTri2Line=function(){for(var t=[],e=0;e<(this.trisindex.length/3|0);e++)t.push(this.trisindex[3*e+0]),t.push(this.trisindex[3*e+1]),t.push(this.trisindex[3*e+1]),t.push(this.trisindex[3*e+2]),t.push(this.trisindex[3*e+2]),t.push(this.trisindex[3*e+0]);return new Uint16Array(t)},meshData.prototype.genIndexDataArrayQuad2Line=function(){for(var t=[],e=0;e<(this.trisindex.length/4|0);e++)t.push(this.trisindex[4*e+0]),t.push(this.trisindex[4*e+1]),t.push(this.trisindex[4*e+1]),t.push(this.trisindex[4*e+2]),t.push(this.trisindex[4*e+2]),t.push(this.trisindex[4*e+3]);return new Uint16Array(t)},meshData}();e.meshData=a}(t.render||(t.render={}))}(gd3d||(gd3d={}));var gd3d;!function(t){!function(t){var e=function(){function staticMeshRenderer(){this.eboIndex=0,this.drawMode=t.DrawModeEnum.EboTri,this.drawbegin=0,this.drawcount=-1}return staticMeshRenderer.prototype.draw=function(e){this.material.use(e),this.mesh.bind(e,this.material.program,this.eboIndex),this.drawMode==t.DrawModeEnum.VboTri?this.mesh.drawArrayTris(e,this.drawbegin,this.drawcount):this.drawMode==t.DrawModeEnum.VboLine?this.mesh.drawArrayLines(e,this.drawbegin,this.drawcount):this.drawMode==t.DrawModeEnum.EboTri?this.mesh.drawElementTris(e,this.drawbegin,this.drawcount):this.drawMode==t.DrawModeEnum.EboLine&&this.mesh.drawElementLines(e,this.drawbegin,this.drawcount)},staticMeshRenderer}();t.staticMeshRenderer=e;var a=function(){function batchRenderer(){this.vboCount=0,this.eboCount=0}return batchRenderer.prototype.initBuffer=function(e,a,r){this.mesh=new t.glMesh,this.mesh.initBuffer(e,a,128,t.MeshTypeEnum.Dynamic),this.dataForVbo=new Float32Array(128),this.drawMode=r,r!=t.DrawModeEnum.EboLine&&r!=t.DrawModeEnum.EboTri||(this.mesh.addIndex(e,128),this.dataForEbo=new Uint16Array(128))},batchRenderer.prototype.begin=function(t,e){this.vboCount>0&&this.end(t),this.curmaterial=e},batchRenderer.prototype.push=function(e,a,r){if((this.vboCount+a.length>2048||null!=r&&this.eboCount+r.length>2048)&&this.end(e),this.vboCount+a.length>this.dataForVbo.length){for(var i=new Float32Array(2*this.dataForVbo.length),o=0,n=this.dataForVbo.length;o<n;++o)i[o]=this.dataForVbo[o];this.dataForVbo=i,this.mesh.resetVboSize(e,this.dataForVbo.length)}for(var o=0,n=a.length;o<n;++o)this.dataForVbo[this.vboCount+o]=a[o];if(this.vboCount+=a.length,this.drawMode!=t.DrawModeEnum.VboLine&&this.drawMode!=t.DrawModeEnum.VboTri&&null!=r){if(this.eboCount+r.length>this.dataForEbo.length){for(var i=new Uint16Array(2*this.dataForEbo.length),o=0,n=this.dataForEbo.length;o<n;++o)i[o]=this.dataForEbo[o];this.dataForEbo=i,this.mesh.resetEboSize(e,0,this.dataForEbo.length)}for(var o=0,n=r.length;o<n;++o)this.dataForEbo[this.eboCount+o]=r[o];this.eboCount+=r.length}},batchRenderer.prototype.end=function(e){if(0!=this.vboCount){this.mesh.uploadVertexData(e,this.dataForVbo.slice(0,this.vboCount)),this.eboCount>0&&this.mesh.uploadIndexData(e,0,this.dataForEbo.slice(0,this.eboCount));var a=this.vboCount/(this.mesh.vertexByteSize/4)|0;this.curmaterial.use(e),this.mesh.bind(e,this.curmaterial.program,this.drawMode==t.DrawModeEnum.EboLine||this.drawMode==t.DrawModeEnum.EboTri?0:-1),this.drawMode==t.DrawModeEnum.EboLine?this.mesh.drawElementLines(e,0,this.eboCount):this.drawMode==t.DrawModeEnum.EboTri?this.mesh.drawElementTris(e,0,this.eboCount):this.drawMode==t.DrawModeEnum.VboLine?this.mesh.drawArrayLines(e,0,a):this.drawMode==t.DrawModeEnum.VboTri&&this.mesh.drawArrayTris(e,0,a),this.vboCount=0,this.eboCount=0}},batchRenderer}();t.batchRenderer=a}(t.render||(t.render={}))}(gd3d||(gd3d={}));var gd3d;!function(t){!function(t){var e=function(){function shaderUniform(){}return shaderUniform.initApplyUnifmFunc=function(){var e=this;this.applyuniformFunc[t.UniformTypeEnum.Float]=function(t,a){e.webgl.uniform1f(t,a)},this.applyuniformFunc[t.UniformTypeEnum.Floatv]=function(t,a){e.webgl.uniform1fv(t,a)},this.applyuniformFunc[t.UniformTypeEnum.Float4]=function(t,a){e.webgl.uniform4f(t,a.x,a.y,a.z,a.w)},this.applyuniformFunc[t.UniformTypeEnum.Float4v]=function(t,a){e.webgl.uniform4fv(t,a)},this.applyuniformFunc[t.UniformTypeEnum.Float4x4]=function(t,a){e.webgl.uniformMatrix4fv(t,!1,a.rawData)},this.applyuniformFunc[t.UniformTypeEnum.Float4x4v]=function(t,a){e.webgl.uniformMatrix4fv(t,!1,a)},this.applyuniformFunc[t.UniformTypeEnum.Texture]=function(a,r){var i=r.glTexture.texture;e.webgl.activeTexture(t.webglkit.GetTextureNumber(e.webgl,e.texindex)),e.webgl.bindTexture(e.webgl.TEXTURE_2D,i),e.webgl.uniform1i(a,e.texindex),e.texindex++},this.applyuniformFunc[t.UniformTypeEnum.CubeTexture]=function(a,r){var i=r.glTexture.texture;e.webgl.activeTexture(t.webglkit.GetTextureNumber(e.webgl,e.texindex)),e.webgl.bindTexture(e.webgl.TEXTURE_CUBE_MAP,i),e.webgl.uniform1i(a,e.texindex),e.texindex++}},shaderUniform.texindex=0,shaderUniform.applyuniformFunc={},shaderUniform}();t.shaderUniform=e}(t.render||(t.render={}))}(gd3d||(gd3d={}));var gd3d;!function(t){!function(t){var e;!function(t){t[t.Texture=0]="Texture",t[t.Float=1]="Float",t[t.Floatv=2]="Floatv",t[t.Float4=3]="Float4",t[t.Float4v=4]="Float4v",t[t.Float4x4=5]="Float4x4",t[t.Float4x4v=6]="Float4x4v",t[t.CubeTexture=7]="CubeTexture"}(e=t.UniformTypeEnum||(t.UniformTypeEnum={}));var a=function(){return function uniform(){}}();t.uniform=a;var r;!function(t){t[t.VS=0]="VS",t[t.FS=1]="FS"}(r=t.ShaderTypeEnum||(t.ShaderTypeEnum={}));var i=function(){return function glShader(t,e,a,r){this.name=t,this.type=e,this.shader=a}}();t.glShader=i;var o=function(){function glProgram(t,e,a){this.posPos=-1,this.posNormal=-1,this.posTangent=-1,this.posColor=-1,this.posUV0=-1,this.posUV2=-1,this.posBlendIndex4=-1,this.posBlendWeight4=-1,this.posColorEx=-1,this.mapUniform={},this.vs=t,this.fs=e,this.program=a}return glProgram.prototype.initAttribute=function(t){this.posPos=t.getAttribLocation(this.program,"_glesVertex"),this.posColor=t.getAttribLocation(this.program,"_glesColor"),this.posUV0=t.getAttribLocation(this.program,"_glesMultiTexCoord0"),this.posUV2=t.getAttribLocation(this.program,"_glesMultiTexCoord1"),this.posNormal=t.getAttribLocation(this.program,"_glesNormal"),this.posTangent=t.getAttribLocation(this.program,"_glesTangent"),this.posBlendIndex4=t.getAttribLocation(this.program,"_glesBlendIndex4"),this.posBlendWeight4=t.getAttribLocation(this.program,"_glesBlendWeight4"),this.posColorEx=t.getAttribLocation(this.program,"_glesColorEx")},glProgram.prototype.use=function(t){t.useProgram(this.program)},glProgram.prototype.initUniforms=function(t){for(var r=t.getProgramParameter(this.program,t.ACTIVE_UNIFORMS),i=0;i<r;i++){var o=t.getActiveUniform(this.program,i);if(!o)break;var n=o.name;"[0]"===n.substr(-3)&&(n=n.substr(0,n.length-3));var s=t.getUniformLocation(this.program,o.name),l=o.type,h=o.size>1&&"[0]"===o.name.substr(-3),c=new a;c.name=n,c.location=s,this.mapUniform[n]=c,l===t.FLOAT&&h?c.type=e.Floatv:l===t.FLOAT?c.type=e.Float:l===t.FLOAT_VEC4&&h?c.type=e.Float4v:l===t.FLOAT_VEC4?c.type=e.Float4:l===t.FLOAT_MAT4&&h?c.type=e.Float4x4v:l===t.FLOAT_MAT4?c.type=e.Float4x4:l===t.SAMPLER_2D?c.type=e.Texture:l===t.SAMPLER_CUBE?c.type=e.CubeTexture:console.log("Unifrom parse Erorr : not have this type!")}},glProgram}();t.glProgram=o;var n=function(){function shaderPool(){this.mapVS={},this.mapFS={},this.mapProgram={},this.mapVSString={},this.mapFSString={}}return shaderPool.prototype.disposeVS=function(t,e){t.deleteShader(this.mapVS[e].shader)},shaderPool.prototype.disposeFS=function(t,e){t.deleteShader(this.mapFS[e].shader)},shaderPool.prototype.disposeProgram=function(t,e){t.deleteProgram(this.mapProgram[e].program)},shaderPool.prototype.disposeAll=function(t){for(var e in this.mapVS)this.disposeVS(t,e);for(var e in this.mapFS)this.disposeFS(t,e);for(var e in this.mapProgram)this.disposeProgram(t,e);this.mapVS={},this.mapFS={},this.mapProgram={}},shaderPool.prototype.compileVS=function(t,e,a){var o=t.createShader(t.VERTEX_SHADER);if(t.shaderSource(o,a),t.compileShader(o),0==t.getShaderParameter(o,t.COMPILE_STATUS))return confirm("a vs:"+e+" error!!!"+t.getShaderInfoLog(o)+"\ndid you want see the code?")&&(t.deleteShader(o),alert(a)),null;var n=new i(e,r.VS,o,a);return this.mapVS[e]=n,n},shaderPool.prototype.compileFS=function(t,e,a){var o=t.createShader(t.FRAGMENT_SHADER);if(t.shaderSource(o,a),t.compileShader(o),0==t.getShaderParameter(o,t.COMPILE_STATUS))return confirm("a fs:"+e+" error!!!"+t.getShaderInfoLog(o)+"\ndid you want see the code?")&&(t.deleteShader(o),alert(a)),null;var n=new i(e,r.FS,o,a);return this.mapFS[e]=n,n},shaderPool.prototype.linkProgram=function(t,e,a){var r=t.createProgram();if(t.attachShader(r,this.mapVS[e].shader),t.attachShader(r,this.mapFS[a].shader),t.linkProgram(r),0==t.getProgramParameter(r,t.LINK_STATUS))return alert("vs:"+e+"   fs:"+a+"a webgl program error:"+t.getProgramInfoLog(r)),t.deleteProgram(r),null;var i=e+"_"+a,n=new o(this.mapVS[e],this.mapFS[a],r);return n.initUniforms(t),n.initAttribute(t),this.mapProgram[i]=n,n},shaderPool.prototype.linkProgrambyPassType=function(t,e,a,r){var i=this.mapVSString[a],o=this.mapFSString[r];return"base"==e||("base_fog"==e||"fog"==e?(i="#define FOG \n"+i,o="#define FOG \n"+o):"skin"==e?(i="#define SKIN \n"+i,o="#define SKIN \n"+o):"skin_fog"==e?(i="#define SKIN \n#define FOG \n"+i,o="#define SKIN \n#define FOG \n"+o):"lightmap"==e?(i="#define LIGHTMAP \n"+i,o="#define LIGHTMAP \n"+o):"lightmap_fog"==e?(i="#define LIGHTMAP \n#define FOG \n"+i,o="#define LIGHTMAP \n#define FOG \n"+o):"quad"==e&&(i="#define QUAD \n"+i,o="#define QUAD \n"+o)),this.compileVS(t,a+e,i),this.compileFS(t,r+e,o),this.linkProgram(t,a+e,r+e)},shaderPool}();t.shaderPool=n}(t.render||(t.render={}))}(gd3d||(gd3d={}));var gd3d;!function(t){!function(e){var a;!function(t){t[t.RGBA=1]="RGBA",t[t.RGB=2]="RGB",t[t.Gray=3]="Gray",t[t.PVRTC4_RGB=4]="PVRTC4_RGB",t[t.PVRTC4_RGBA=4]="PVRTC4_RGBA",t[t.PVRTC2_RGB=4]="PVRTC2_RGB",t[t.PVRTC2_RGBA=4]="PVRTC2_RGBA"}(a=e.TextureFormatEnum||(e.TextureFormatEnum={}));var r=function(){function textureReader(t,e,a,r,i){void 0===i&&(i=!1),this._gray=i,this._width=a,this._height=r,this.webgl=t,this._data=new Uint8Array(this._width*this._height*4),i&&(this._grayData=new Uint8Array(this._width*this._height)),this.refresh(e)}return Object.defineProperty(textureReader.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(textureReader.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),Object.defineProperty(textureReader.prototype,"data",{get:function(){return this._gray?this._grayData:this._data},enumerable:!0,configurable:!0}),Object.defineProperty(textureReader.prototype,"gray",{get:function(){return this._gray},enumerable:!0,configurable:!0}),textureReader.prototype.getPixel=function(e,a){var r=e*this._width|0,i=a*this._height|0;if(r<0||r>=this._width||i<0||i>=this._height)return 0;if(this._gray)return this._grayData[i*this._width+r];var o=4*(i*this._width+r);return new t.math.color(this._data[o],this._data[o+1],this._data[o+2],this._data[o+3])},textureReader.prototype.refresh=function(t){if(t){var e=this.webgl.createFramebuffer(),a=this.webgl.getParameter(this.webgl.FRAMEBUFFER_BINDING);if(this.webgl.bindFramebuffer(this.webgl.FRAMEBUFFER,e),this.webgl.framebufferTexture2D(this.webgl.FRAMEBUFFER,this.webgl.COLOR_ATTACHMENT0,this.webgl.TEXTURE_2D,t,0),this._data[0]=2,this.webgl.readPixels(0,0,this._width,this._height,this.webgl.RGBA,this.webgl.UNSIGNED_BYTE,this._data),this.webgl.deleteFramebuffer(e),this.webgl.bindFramebuffer(this.webgl.FRAMEBUFFER,a),this._gray)for(var r=0;r<this._width*this._height;r++)this._grayData[r]=this._data[4*r]}else console.warn("texRGBA is null ")},textureReader}();e.textureReader=r;var i=function(){function glRenderTarget(t,e,a,r,i){void 0===r&&(r=!1),void 0===i&&(i=!1),this.width=e,this.height=a,this.fbo=t.createFramebuffer(),t.bindFramebuffer(t.FRAMEBUFFER,this.fbo),(r||i)&&(this.renderbuffer=t.createRenderbuffer(),t.bindRenderbuffer(t.RENDERBUFFER,this.renderbuffer),r&&i?(t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_STENCIL,e,a),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.RENDERBUFFER,this.renderbuffer)):r?(t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_COMPONENT16,e,a),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,this.renderbuffer)):(t.renderbufferStorage(t.RENDERBUFFER,t.STENCIL_INDEX8,e,a),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.STENCIL_ATTACHMENT,t.RENDERBUFFER,this.renderbuffer))),this.texture=t.createTexture(),this.fbo.width=e,this.fbo.height=a,t.bindTexture(t.TEXTURE_2D,this.texture),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,e,a,0,t.RGBA,t.UNSIGNED_BYTE,null),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,this.texture,0)}return glRenderTarget.prototype.use=function(t){t.bindFramebuffer(t.FRAMEBUFFER,this.fbo),t.bindRenderbuffer(t.RENDERBUFFER,this.renderbuffer),t.bindTexture(t.TEXTURE_2D,this.texture)},glRenderTarget.useNull=function(t){t.bindFramebuffer(t.FRAMEBUFFER,null),t.bindRenderbuffer(t.RENDERBUFFER,null)},glRenderTarget.prototype.dispose=function(t){null!=this.texture&&(t.deleteFramebuffer(this.renderbuffer),this.renderbuffer=null,t.deleteTexture(this.texture),this.texture=null)},glRenderTarget.prototype.caclByteLength=function(){return this.width*this.height*4},glRenderTarget.prototype.isFrameBuffer=function(){return!0},glRenderTarget}();e.glRenderTarget=i;var o=function(){function glTexture2D(t,e,r,i){void 0===e&&(e=a.RGBA),void 0===r&&(r=!1),void 0===i&&(i=!0),this.linear=!0,this.premultiply=!0,this.repeat=!0,this.mirroredU=!0,this.mirroredV=!0,this.loaded=!1,this.width=0,this.height=0,this.mipmap=!1,this.webgl=t,this.format=e,this.linear=i,this.mipmap=r,this.texture=t.createTexture();this.ext=this.getExt("WEBGL_compressed_texture_pvrtc")}return glTexture2D.prototype.getExt=function(t){return this.webgl.getExtension(t)||this.webgl.getExtension("MOZ_"+t)||this.webgl.getExtension("OP_"+t)||this.webgl.getExtension("WEBKIT_"+t)||null},glTexture2D.prototype.uploadImage=function(t,e,r,i,o,n,s){void 0===i&&(i=!0),void 0===o&&(o=!1),void 0===n&&(n=!1),void 0===s&&(s=!1),this.width=t.width,this.height=t.height,this.mipmap=e,this.linear=r,this.premultiply=i,this.repeat=o,this.mirroredU=n,this.mirroredV=s,this.loaded=!0,this.webgl.pixelStorei(this.webgl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i?1:0),this.webgl.pixelStorei(this.webgl.UNPACK_FLIP_Y_WEBGL,1),this.webgl.bindTexture(this.webgl.TEXTURE_2D,this.texture);var l=this.webgl.RGBA;this.format==a.RGB?l=this.webgl.RGB:this.format==a.Gray&&(l=this.webgl.LUMINANCE),this.webgl.texImage2D(this.webgl.TEXTURE_2D,0,l,l,this.webgl.UNSIGNED_BYTE,t),e?(this.webgl.generateMipmap(this.webgl.TEXTURE_2D),r?(this.webgl.texParameteri(this.webgl.TEXTURE_2D,this.webgl.TEXTURE_MAG_FILTER,this.webgl.LINEAR),this.webgl.texParameteri(this.webgl.TEXTURE_2D,this.webgl.TEXTURE_MIN_FILTER,this.webgl.LINEAR_MIPMAP_LINEAR)):(this.webgl.texParameteri(this.webgl.TEXTURE_2D,this.webgl.TEXTURE_MAG_FILTER,this.webgl.NEAREST),this.webgl.texParameteri(this.webgl.TEXTURE_2D,this.webgl.TEXTURE_MIN_FILTER,this.webgl.NEAREST_MIPMAP_NEAREST))):r?(this.webgl.texParameteri(this.webgl.TEXTURE_2D,this.webgl.TEXTURE_MAG_FILTER,this.webgl.LINEAR),this.webgl.texParameteri(this.webgl.TEXTURE_2D,this.webgl.TEXTURE_MIN_FILTER,this.webgl.LINEAR)):(this.webgl.texParameteri(this.webgl.TEXTURE_2D,this.webgl.TEXTURE_MAG_FILTER,this.webgl.NEAREST),this.webgl.texParameteri(this.webgl.TEXTURE_2D,this.webgl.TEXTURE_MIN_FILTER,this.webgl.NEAREST)),o?n&&s?(this.webgl.texParameteri(this.webgl.TEXTURE_2D,this.webgl.TEXTURE_WRAP_S,this.webgl.MIRRORED_REPEAT),this.webgl.texParameteri(this.webgl.TEXTURE_2D,this.webgl.TEXTURE_WRAP_T,this.webgl.MIRRORED_REPEAT)):n?(this.webgl.texParameteri(this.webgl.TEXTURE_2D,this.webgl.TEXTURE_WRAP_S,this.webgl.MIRRORED_REPEAT),this.webgl.texParameteri(this.webgl.TEXTURE_2D,this.webgl.TEXTURE_WRAP_T,this.webgl.REPEAT)):s?(this.webgl.texParameteri(this.webgl.TEXTURE_2D,this.webgl.TEXTURE_WRAP_S,this.webgl.REPEAT),this.webgl.texParameteri(this.webgl.TEXTURE_2D,this.webgl.TEXTURE_WRAP_T,this.webgl.MIRRORED_REPEAT)):(this.webgl.texParameteri(this.webgl.TEXTURE_2D,this.webgl.TEXTURE_WRAP_S,this.webgl.REPEAT),this.webgl.texParameteri(this.webgl.TEXTURE_2D,this.webgl.TEXTURE_WRAP_T,this.webgl.REPEAT)):(this.webgl.texParameteri(this.webgl.TEXTURE_2D,this.webgl.TEXTURE_WRAP_S,this.webgl.CLAMP_TO_EDGE),this.webgl.texParameteri(this.webgl.TEXTURE_2D,this.webgl.TEXTURE_WRAP_T,this.webgl.CLAMP_TO_EDGE))},glTexture2D.prototype.uploadByteArray=function(t,e,r,i,o,n,s,l){void 0===n&&(n=!1),void 0===s&&(s=!1),void 0===l&&(l=!1),this.width=r,this.height=i,this.mipmap=t,this.linear=e,this.repeat=n,this.mirroredU=s,this.mirroredV=l,this.loaded=!0,this.webgl.pixelStorei(this.webgl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1),this.webgl.pixelStorei(this.webgl.UNPACK_FLIP_Y_WEBGL,1),this.webgl.bindTexture(this.webgl.TEXTURE_2D,this.texture);var h=this.webgl.RGBA;this.format==a.RGB?h=this.webgl.RGB:this.format==a.Gray&&(h=this.webgl.LUMINANCE),this.webgl.texImage2D(this.webgl.TEXTURE_2D,0,h,r,i,0,h,this.webgl.UNSIGNED_BYTE,o),t?(this.webgl.generateMipmap(this.webgl.TEXTURE_2D),e?(this.webgl.texParameteri(this.webgl.TEXTURE_2D,this.webgl.TEXTURE_MAG_FILTER,this.webgl.LINEAR),this.webgl.texParameteri(this.webgl.TEXTURE_2D,this.webgl.TEXTURE_MIN_FILTER,this.webgl.LINEAR_MIPMAP_LINEAR)):(this.webgl.texParameteri(this.webgl.TEXTURE_2D,this.webgl.TEXTURE_MAG_FILTER,this.webgl.NEAREST),this.webgl.texParameteri(this.webgl.TEXTURE_2D,this.webgl.TEXTURE_MIN_FILTER,this.webgl.NEAREST_MIPMAP_NEAREST))):e?(this.webgl.texParameteri(this.webgl.TEXTURE_2D,this.webgl.TEXTURE_MAG_FILTER,this.webgl.LINEAR),this.webgl.texParameteri(this.webgl.TEXTURE_2D,this.webgl.TEXTURE_MIN_FILTER,this.webgl.LINEAR)):(this.webgl.texParameteri(this.webgl.TEXTURE_2D,this.webgl.TEXTURE_MAG_FILTER,this.webgl.NEAREST),this.webgl.texParameteri(this.webgl.TEXTURE_2D,this.webgl.TEXTURE_MIN_FILTER,this.webgl.NEAREST)),n?s&&l?(this.webgl.texParameteri(this.webgl.TEXTURE_2D,this.webgl.TEXTURE_WRAP_S,this.webgl.MIRRORED_REPEAT),this.webgl.texParameteri(this.webgl.TEXTURE_2D,this.webgl.TEXTURE_WRAP_T,this.webgl.MIRRORED_REPEAT)):s?(this.webgl.texParameteri(this.webgl.TEXTURE_2D,this.webgl.TEXTURE_WRAP_S,this.webgl.MIRRORED_REPEAT),this.webgl.texParameteri(this.webgl.TEXTURE_2D,this.webgl.TEXTURE_WRAP_T,this.webgl.REPEAT)):l?(this.webgl.texParameteri(this.webgl.TEXTURE_2D,this.webgl.TEXTURE_WRAP_S,this.webgl.REPEAT),this.webgl.texParameteri(this.webgl.TEXTURE_2D,this.webgl.TEXTURE_WRAP_T,this.webgl.MIRRORED_REPEAT)):(this.webgl.texParameteri(this.webgl.TEXTURE_2D,this.webgl.TEXTURE_WRAP_S,this.webgl.REPEAT),this.webgl.texParameteri(this.webgl.TEXTURE_2D,this.webgl.TEXTURE_WRAP_T,this.webgl.REPEAT)):(this.webgl.texParameteri(this.webgl.TEXTURE_2D,this.webgl.TEXTURE_WRAP_S,this.webgl.CLAMP_TO_EDGE),this.webgl.texParameteri(this.webgl.TEXTURE_2D,this.webgl.TEXTURE_WRAP_T,this.webgl.CLAMP_TO_EDGE))},glTexture2D.prototype.caclByteLength=function(){var t=1;this.format==a.RGBA?t=4:this.format==a.RGB&&(t=3);var e=this.width*this.height*t;return this.mipmap&&(e=e*(1-Math.pow(.25,10))/.75),e},glTexture2D.prototype.getReader=function(t){if(void 0===t&&(t=!1),null!=this.reader){if(this.reader.gray!=t)throw new Error("get param diff with this.reader");return this.reader}if(this.format!=a.RGBA)throw new Error("only rgba texture can read");return null==this.texture?null:(null==this.reader&&(this.reader=new r(this.webgl,this.texture,this.width,this.height,t)),this.reader)},glTexture2D.prototype.dispose=function(t){null!=this.texture&&(t.deleteTexture(this.texture),this.texture=null)},glTexture2D.prototype.isFrameBuffer=function(){return!1},glTexture2D.formGrayArray=function(t,e,r,i){for(var o=new glTexture2D(t,a.RGBA,!1,!0),n=new Uint8Array(4*e.length),s=0;s<r;s++)for(var l=0;l<r;l++){var h=512*s+l,c=s*r+l;n[4*h]=255*e[c],n[4*h+1]=255*e[c],n[4*h+2]=255*e[c],n[4*h+3]=255}return o.uploadByteArray(!1,!0,512,512,n),o},glTexture2D.staticTexture=function(t,e){var r=glTexture2D.mapTexture[e];if(void 0!=r)return r;r=new glTexture2D(t,a.RGBA,!1,!0);var i=new Uint8Array(4),o=1,n=1;if(i[0]=128,i[1]=0,i[2]=128,i[3]=255,"gray"==e)i[0]=128,i[1]=128,i[2]=128,i[3]=255;else if("white"==e)i[0]=255,i[1]=255,i[2]=255,i[3]=255;else if("black"==e)i[0]=0,i[1]=0,i[2]=0,i[3]=255;else if("normal"==e)i[0]=128,i[1]=128,i[2]=255,i[3]=255;else if("grid"==e){o=256,n=256,i=new Uint8Array(o*o*4);for(var s=0;s<n;s++)for(var l=0;l<o;l++){var h=4*(s*o+l);(l-.5*o)*(s-.5*n)>0?(i[h]=0,i[h+1]=0,i[h+2]=0,i[h+3]=255):(i[h]=255,i[h+1]=255,i[h+2]=255,i[h+3]=255)}}return r.uploadByteArray(!1,!0,o,n,i),glTexture2D.mapTexture[e]=r,r},glTexture2D.mapTexture={},glTexture2D}();e.glTexture2D=o;var n=function(){function glTextureCube(t,e,r,i){void 0===e&&(e=a.RGBA),void 0===r&&(r=!1),void 0===i&&(i=!0),this.loaded=!1,this.width=0,this.height=0,this.mipmap=!1,this.linear=!1,this.webgl=t,this.format=e,this.mipmap=r,this.linear=i,this.texture=t.createTexture()}return glTextureCube.prototype.uploadImages=function(t,e,a,r,i,o){for(var n=WebGLRenderingContext,s=[t,e,a,r,i,o],l=[n.TEXTURE_CUBE_MAP_NEGATIVE_X,n.TEXTURE_CUBE_MAP_NEGATIVE_Y,n.TEXTURE_CUBE_MAP_NEGATIVE_Z,n.TEXTURE_CUBE_MAP_POSITIVE_X,n.TEXTURE_CUBE_MAP_POSITIVE_Y,n.TEXTURE_CUBE_MAP_POSITIVE_Z],h=0;h<l.length;h++){var c=s[h].glTexture.getReader();if(!c)return void console.warn("getReader() fail : "+s[h].getName());this.upload(c.data,c.width,c.height,l[h])}},glTextureCube.prototype.upload=function(t,e,r,i){this.width=e,this.height=r,this.loaded=!0;var o=this.webgl;o.pixelStorei(o.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1),this.webgl.bindTexture(this.webgl.TEXTURE_CUBE_MAP,this.texture);var n=this.webgl.RGBA;this.format==a.RGB?n=this.webgl.RGB:this.format==a.Gray&&(n=this.webgl.LUMINANCE),t instanceof HTMLImageElement?this.webgl.texImage2D(i,0,n,n,this.webgl.UNSIGNED_BYTE,t):this.webgl.texImage2D(i,0,n,e,r,0,n,this.webgl.UNSIGNED_BYTE,t),o.texParameteri(o.TEXTURE_CUBE_MAP,o.TEXTURE_MIN_FILTER,o.NEAREST),o.texParameteri(o.TEXTURE_CUBE_MAP,o.TEXTURE_MAG_FILTER,o.NEAREST),o.texParameteri(o.TEXTURE_CUBE_MAP,o.TEXTURE_WRAP_S,o.CLAMP_TO_EDGE),o.texParameteri(o.TEXTURE_CUBE_MAP,o.TEXTURE_WRAP_T,o.CLAMP_TO_EDGE);this.mipmap,this.linear},glTextureCube.prototype.caclByteLength=function(){var t=1;this.format==a.RGBA?t=4:this.format==a.RGB&&(t=3);var e=this.width*this.height*t*6;return this.mipmap&&(e=e*(1-Math.pow(.25,10))/.75),e},glTextureCube.prototype.dispose=function(t){null!=this.texture&&(t.deleteTexture(this.texture),this.texture=null)},glTextureCube.prototype.isFrameBuffer=function(){return!1},glTextureCube}();e.glTextureCube=n;var s=function(){function WriteableTexture2D(t,e,r,i,o,n,s,l,h){void 0===e&&(e=a.RGBA),void 0===n&&(n=!0),void 0===s&&(s=!1),void 0===l&&(l=!1),void 0===h&&(h=!1),this.premultiply=!0,this.repeat=!1,this.mirroredU=!1,this.mirroredV=!1,this.width=0,this.height=0,this.webgl=t,this.texture=t.createTexture(),this.webgl.pixelStorei(this.webgl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n?1:0),this.webgl.pixelStorei(this.webgl.UNPACK_FLIP_Y_WEBGL,0),this.webgl.bindTexture(this.webgl.TEXTURE_2D,this.texture),this.format=e,this.formatGL=this.webgl.RGBA,e==a.RGB?this.formatGL=this.webgl.RGB:e==a.Gray&&(this.formatGL=this.webgl.LUMINANCE);this.webgl.texImage2D(this.webgl.TEXTURE_2D,0,this.formatGL,r,i,0,this.formatGL,this.webgl.UNSIGNED_BYTE,null),o?(this.webgl.texParameteri(this.webgl.TEXTURE_2D,this.webgl.TEXTURE_MAG_FILTER,this.webgl.LINEAR),this.webgl.texParameteri(this.webgl.TEXTURE_2D,this.webgl.TEXTURE_MIN_FILTER,this.webgl.LINEAR)):(this.webgl.texParameteri(this.webgl.TEXTURE_2D,this.webgl.TEXTURE_MAG_FILTER,this.webgl.NEAREST),this.webgl.texParameteri(this.webgl.TEXTURE_2D,this.webgl.TEXTURE_MIN_FILTER,this.webgl.NEAREST)),s?l&&h?(this.webgl.texParameteri(this.webgl.TEXTURE_2D,this.webgl.TEXTURE_WRAP_S,this.webgl.MIRRORED_REPEAT),this.webgl.texParameteri(this.webgl.TEXTURE_2D,this.webgl.TEXTURE_WRAP_T,this.webgl.MIRRORED_REPEAT)):l?(this.webgl.texParameteri(this.webgl.TEXTURE_2D,this.webgl.TEXTURE_WRAP_S,this.webgl.MIRRORED_REPEAT),this.webgl.texParameteri(this.webgl.TEXTURE_2D,this.webgl.TEXTURE_WRAP_T,this.webgl.REPEAT)):h?(this.webgl.texParameteri(this.webgl.TEXTURE_2D,this.webgl.TEXTURE_WRAP_S,this.webgl.REPEAT),this.webgl.texParameteri(this.webgl.TEXTURE_2D,this.webgl.TEXTURE_WRAP_T,this.webgl.MIRRORED_REPEAT)):(this.webgl.texParameteri(this.webgl.TEXTURE_2D,this.webgl.TEXTURE_WRAP_S,this.webgl.REPEAT),this.webgl.texParameteri(this.webgl.TEXTURE_2D,this.webgl.TEXTURE_WRAP_T,this.webgl.REPEAT)):(this.webgl.texParameteri(this.webgl.TEXTURE_2D,this.webgl.TEXTURE_WRAP_S,this.webgl.CLAMP_TO_EDGE),this.webgl.texParameteri(this.webgl.TEXTURE_2D,this.webgl.TEXTURE_WRAP_T,this.webgl.CLAMP_TO_EDGE))}return WriteableTexture2D.prototype.updateRect=function(t,e,a,r,i){this.webgl.bindTexture(this.webgl.TEXTURE_2D,this.texture),this.webgl.texSubImage2D(this.webgl.TEXTURE_2D,0,e,a,r,i,this.formatGL,this.webgl.UNSIGNED_BYTE,t)},WriteableTexture2D.prototype.updateRectImg=function(t,e,a){this.webgl.bindTexture(this.webgl.TEXTURE_2D,this.texture),this.webgl.texSubImage2D(this.webgl.TEXTURE_2D,0,e,a,this.formatGL,this.webgl.UNSIGNED_BYTE,t)},WriteableTexture2D.prototype.isFrameBuffer=function(){return!1},WriteableTexture2D.prototype.dispose=function(t){null!=this.texture&&(t.deleteTexture(this.texture),this.texture=null)},WriteableTexture2D.prototype.caclByteLength=function(){var t=1;return this.format==a.RGBA?t=4:this.format==a.RGB&&(t=3),this.width*this.height*t},WriteableTexture2D}();e.WriteableTexture2D=s}(t.render||(t.render={}))}(gd3d||(gd3d={}));